#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 09:26:29 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.650000000000 AA    0.000000000000   0.000000000000   1.228321980967 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.650000000000 AA    0.000000000000   0.000000000000  -1.228321980967 Bohr   0.0

nuclear repulsion = 234.466210376862
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:         0.46


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmplgy1_e6x
max_memory 4000 MB (current use 76 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.65076926239
HOMO (E2ux) = -0.267258729803639  LUMO (E2ux) = -0.267258729803639
cycle= 1 E= -2098.06503830622  delta_E= 1.59  |g|= 1.71  |ddm|= 2.82
HOMO (A1g) = 0.0467351345395093  LUMO (E1ux) = 0.0569990314223998
cycle= 2 E= -2096.97738259433  delta_E= 1.09  |g|= 2.99  |ddm|= 1.45e+03
HOMO (E2ux) = 0.13530695077848  LUMO (A1u) = -0.0335216270527823
cycle= 3 E= -2098.40857219822  delta_E= -1.43  |g|= 0.154  |ddm|= 1.45e+03
HOMO (E2ux) = 0.162703780401339  LUMO (A1u) = 0.00362355717454882
cycle= 4 E= -2098.37089355633  delta_E= 0.0377  |g|= 0.159  |ddm|= 2.44
HOMO (E2ux) = 0.135448590895416  LUMO (A1u) = -0.00257327637654108
cycle= 5 E= -2098.43587774995  delta_E= -0.065  |g|= 0.261  |ddm|=  3.6
HOMO (E2ux) = 0.156355455124594  LUMO (A1u) = 0.00244288332259607
cycle= 6 E= -2098.3973463452  delta_E= 0.0385  |g|= 0.0993  |ddm|=  2.5
HOMO (E2ux) = 0.156154429818217  LUMO (A1u) = 0.00235006534163384
cycle= 7 E= -2098.39789607055  delta_E= -0.00055  |g|= 0.099  |ddm|= 0.0297
HOMO (E2ux) = 0.157234963751786  LUMO (A1u) = 0.00284036563274211
cycle= 8 E= -2098.39448899833  delta_E= 0.00341  |g|= 0.101  |ddm|= 0.186
HOMO (E2ux) = 0.151345172722408  LUMO (A1u) = 0.00181288725364742
cycle= 9 E= -2098.41071213778  delta_E= -0.0162  |g|= 0.111  |ddm|= 0.924
HOMO (E2ux) = 0.14796675599688  LUMO (A1u) = -6.54182274241035e-05
cycle= 10 E= -2098.41740403082  delta_E= -0.00669  |g|= 0.131  |ddm|= 0.403
HOMO (E2ux) = 0.149286668512776  LUMO (A1u) = 0.000916146579672316
cycle= 11 E= -2098.41339785805  delta_E= 0.00401  |g|= 0.11  |ddm|= 0.236
HOMO (E2ux) = 0.151404642119104  LUMO (A1u) = 0.00224934845379377
cycle= 12 E= -2098.41116690789  delta_E= 0.00223  |g|= 0.114  |ddm|= 0.17
HOMO (E2ux) = 0.151305162924142  LUMO (A1u) = 0.00216937518995494
cycle= 13 E= -2098.41136438348  delta_E= -0.000197  |g|= 0.114  |ddm|= 0.0125
HOMO (E2ux) = 0.153737173021776  LUMO (A1u) = 0.00278763324294673
cycle= 14 E= -2098.40506238076  delta_E= 0.0063  |g|= 0.101  |ddm|= 0.374
HOMO (E2ux) = 0.156049109681526  LUMO (A1u) = 0.00324019447048948
cycle= 15 E= -2098.39845747796  delta_E= 0.0066  |g|= 0.0979  |ddm|= 0.378
HOMO (E2ux) = 0.154493654667888  LUMO (A1u) = 0.00336476995367918
cycle= 16 E= -2098.40475085253  delta_E= -0.00629  |g|= 0.102  |ddm|= 0.357
HOMO (E2ux) = 0.157029831493854  LUMO (A1u) = 0.00388014307413501
cycle= 17 E= -2098.39643907523  delta_E= 0.00831  |g|= 0.0981  |ddm|= 0.47
HOMO (E2ux) = 0.156192705922898  LUMO (A1u) = 0.00374250591732131
cycle= 18 E= -2098.39951774361  delta_E= -0.00308  |g|= 0.0975  |ddm|= 0.168
HOMO (E2ux) = 0.157415445295703  LUMO (A1u) = 0.00403133481271294
cycle= 19 E= -2098.39503259461  delta_E= 0.00449  |g|= 0.101  |ddm|= 0.235
HOMO (E2ux) = 0.155552387803207  LUMO (A1u) = 0.00354738664667612
cycle= 20 E= -2098.40110121193  delta_E= -0.00607  |g|= 0.0988  |ddm|= 0.33
HOMO (E2ux) = 0.152404167501313  LUMO (A1u) = 0.00189034772794448
cycle= 21 E= -2098.40879353446  delta_E= -0.00769  |g|= 0.108  |ddm|= 0.448
HOMO (E2ux) = 0.149694544943525  LUMO (A1u) = 0.00135600424680977
cycle= 22 E= -2098.41568726688  delta_E= -0.00689  |g|= 0.131  |ddm|= 0.412
HOMO (E2ux) = 0.139618947662597  LUMO (A1u) = -0.00317527964314161
cycle= 23 E= -2098.42912064789  delta_E= -0.0134  |g|= 0.189  |ddm|= 0.928
HOMO (E2ux) = 0.140685141886255  LUMO (A1u) = -0.00300543727433503
cycle= 24 E= -2098.4279092508  delta_E= 0.00121  |g|= 0.18  |ddm|= 0.0974
HOMO (E2ux) = 0.143640339877666  LUMO (A1u) = -0.00255351483763625
cycle= 25 E= -2098.42409411816  delta_E= 0.00382  |g|= 0.157  |ddm|= 0.302
HOMO (E2ux) = 0.140632888244765  LUMO (A1u) = -0.00380745881496658
cycle= 26 E= -2098.42690860803  delta_E= -0.00281  |g|= 0.17  |ddm|= 0.231
HOMO (E2ux) = 0.144858334547082  LUMO (A1u) = -0.000570197085966904
cycle= 27 E= -2098.42279974504  delta_E= 0.00411  |g|= 0.168  |ddm|= 0.286
HOMO (E2ux) = 0.154355552320037  LUMO (A1u) = 0.00294999001559774
cycle= 28 E= -2098.40444914401  delta_E= 0.0184  |g|= 0.102  |ddm|= 1.18
HOMO (E2ux) = 0.153772046032675  LUMO (A1u) = 0.00242577837142328
cycle= 29 E= -2098.40575043818  delta_E= -0.0013  |g|= 0.103  |ddm|= 0.0843
HOMO (E2ux) = 0.154963883465772  LUMO (A1u) = 0.00356568392767323
cycle= 30 E= -2098.40342376315  delta_E= 0.00233  |g|=  0.1  |ddm|= 0.154
HOMO (E2ux) = 0.155173687753248  LUMO (A1u) = 0.00371504384816956
cycle= 31 E= -2098.402656256  delta_E= 0.000768  |g|= 0.0989  |ddm|= 0.0467
HOMO (E2ux) = 0.154885959775605  LUMO (A1u) = 0.00349317265274562
cycle= 32 E= -2098.40338192111  delta_E= -0.000726  |g|= 0.0998  |ddm|= 0.0454
SCF not converged.
SCF energy = -2098.40338192111
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 29 31 39]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmplgy1_e6x
max_memory 4000 MB (current use 2120 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.596150900347
CASCI E = -2098.59615090035  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -34.222405063790
2 -1
State   0 energy     -34.244895424139
3 -1
State   0 energy     -34.269340936151
4 -1
State   0 energy   -2098.684969974466
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.68496997447  dE = -0.088819074  S^2 = 0.0000000
               |grad[o]|=0.173  |ddm|= 0.13  |maxRot[o]|=0.313
5 -1
State   0 energy     -34.294473354269
6 -1
State   0 energy     -34.321064563395
7 -1
State   0 energy     -34.352531077480
8 -1
State   0 energy   -2098.796768827983
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.79676882798  dE = -0.11179885  S^2 = 0.0000000
               |grad[o]|=0.139  |ddm|=0.0864  |maxRot[o]|=0.277
9 -1
State   0 energy     -34.393857228338
10 -1
State   0 energy     -34.425869131784
11 -1
State   0 energy     -34.457669719611
12 -1
State   0 energy   -2098.915814658815
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.91581465881  dE = -0.11904583  S^2 = 0.0000000
               |grad[o]|=0.101  |ddm|=0.0723  |maxRot[o]|=0.304
13 -1
State   0 energy     -34.552098851990
14 -1
State   0 energy     -34.569315871838
15 -1
State   0 energy     -34.577977733107
16 -1
State   0 energy   -2098.963537777923
macro iter 4 (21 JK  4 micro), CASSCF E = -2098.96353777792  dE = -0.047723119  S^2 = 0.0000000
               |grad[o]|=0.0808  |ddm|=0.0519  |maxRot[o]|=0.189
17 -1
State   0 energy     -34.701944734418
18 -1
State   0 energy     -34.717021665173
19 -1
State   0 energy     -34.735464298029
20 -1
State   0 energy   -2099.015936919121
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.01593691912  dE = -0.052399141  S^2 = 0.0000000
               |grad[o]|=0.0393  |ddm|=0.0343  |maxRot[o]|=0.303
21 -1
State   0 energy     -34.830113766303
22 -1
State   0 energy     -34.840826989368
23 -1
State   0 energy     -34.849518461279
24 -1
State   0 energy   -2099.051989298824
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.05198929882  dE = -0.03605238  S^2 = 0.0000000
               |grad[o]|=0.062  |ddm|=0.0253  |maxRot[o]|=0.308
25 -1
State   0 energy     -34.993478702098
26 -1
State   0 energy     -34.994322135763
27 -1
State   0 energy     -34.994350944283
28 -1
State   0 energy   -2099.055987952318
macro iter 7 (16 JK  4 micro), CASSCF E = -2099.05598795232  dE = -0.0039986535  S^2 = 0.0000000
               |grad[o]|=0.0274  |ddm|=0.0153  |maxRot[o]|=0.141
29 -1
State   0 energy     -34.973630354523
30 -1
State   0 energy     -34.973630398581
31 -1
State   0 energy   -2099.055988149124
macro iter 8 (6 JK  2 micro), CASSCF E = -2099.05598814912  dE = -1.9680647e-07  S^2 = 0.0000000
               |grad[o]|=0.000441  |ddm|=0.00031  |maxRot[o]|=0.000594
32 -1
State   0 energy     -34.974261912005
33 -1
State   0 energy   -2099.055988149125
macro iter 9 (1 JK  1 micro), CASSCF E = -2099.05598814912  dE = -4.5474735e-13  S^2 = 0.0000000
               |grad[o]|=1.81e-05  |ddm|=3.06e-05  |maxRot[o]|=    0
1-step CASSCF converged in 9 macro (149 JK 31 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.92418446 1.92418475 1.94566704 1.88531543 1.88531421 1.81837125
 0.11684685 0.1309024  0.07452729 0.07452758 0.10331071 0.11684804]
CASSCF energy = -2099.05598814912
CASCI E = -2099.05598814912  E(CI) = -34.9742619113827  S^2 = 0.0000000
energy =  -2099.055988149125
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 10, 11, 6, 7, 2, 3, 5, 6, 7, 0, 14, 15, 5, 2, 3, 5, 0, 0, 2, 3, 10, 11, 6, 7, 5, 6, 7, 2, 3, 14, 15, 5, 0, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 2, 3, 5, 6, 7, 0, 14, 15, 5, 6, 7, 10, 11, 0, 6, 7, 2, 3, 0, 14, 15, 5, 16, 17, 20, 21, 10, 11, 5, 0, 2, 3, 6, 7, 24, 25, 14, 15, 2, 3, 16, 17, 12, 13, 0, 10, 11, 5, 12, 13, 6, 7, 5, 0, 14, 15, 6, 7, 2, 3, 0, 5, 10, 11, 2, 3, 14, 15, 6, 7, 0, 2, 3, 5, 16, 17, 20, 21, 0, 10, 11, 26, 27, 0, 6, 7, 22, 23, 5, 24, 25, 2, 3, 14, 15, 12, 13, 5, 6, 7, 0, 16, 17, 10, 11, 20, 21, 16, 17, 24, 25, 12, 13, 12, 13, 14, 15, 5, 10, 11, 2, 3, 6, 7, 14, 15, 0, 5, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 58]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 63 64 65 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 09:44:19 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.700000000000 AA    0.000000000000   0.000000000000   1.322808287196 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.700000000000 AA    0.000000000000   0.000000000000  -1.322808287196 Bohr   0.0

nuclear repulsion = 217.718623921371
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:      4499.18


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmphyzx5kf6
max_memory 4000 MB (current use 2219 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.245011197
HOMO (E2ux) = -0.253320891280688  LUMO (E2ux) = -0.253320891280688
cycle= 1 E= -2098.24956325277  delta_E= 0.995  |g|= 1.49  |ddm|= 2.76
HOMO (A1g) = 0.0500100561810288  LUMO (E1ux) = 0.056053565642047
cycle= 2 E= -2096.79041865396  delta_E= 1.46  |g|= 3.07  |ddm|= 1.15e+03
HOMO (E2ux) = -0.0445697188623971  LUMO (A1g) = -0.119229828983199
cycle= 3 E= -2098.42479339222  delta_E= -1.63  |g|= 0.598  |ddm|= 1.15e+03
HOMO (E2ux) = 0.0781343210589865  LUMO (A1g) = -0.00496964994112294
cycle= 4 E= -2098.48027435174  delta_E= -0.0555  |g|= 0.17  |ddm|= 0.361
HOMO (E2ux) = 0.0983507165409491  LUMO (A1g) = 0.0205934494101533
cycle= 5 E= -2098.48601934702  delta_E= -0.00574  |g|= 0.0525  |ddm|= 0.427
HOMO (E2ux) = 0.101499084103506  LUMO (A1g) = 0.0235276009980227
cycle= 6 E= -2098.4866280878  delta_E= -0.000609  |g|= 0.0144  |ddm|= 0.486
HOMO (E2ux) = 0.0985711105650629  LUMO (A1g) = 0.0239721923968166
cycle= 7 E= -2098.48718123126  delta_E= -0.000553  |g|= 0.0135  |ddm|= 0.315
HOMO (E2ux) = 0.100242741292417  LUMO (A1g) = 0.0243893728292084
cycle= 8 E= -2098.48727030531  delta_E= -8.91e-05  |g|= 0.00131  |ddm|= 0.085
HOMO (E2ux) = 0.100078375450727  LUMO (A1g) = 0.0243432169565079
cycle= 9 E= -2098.48727347086  delta_E= -3.17e-06  |g|= 0.000576  |ddm|= 0.0202
HOMO (E2ux) = 0.100005236559016  LUMO (A1g) = 0.0243662064125753
cycle= 10 E= -2098.48727418096  delta_E= -7.1e-07  |g|= 0.000568  |ddm|= 0.00526
HOMO (E2ux) = 0.0998502714988407  LUMO (A1g) = 0.0243523916820156
cycle= 11 E= -2098.48727456012  delta_E= -3.79e-07  |g|= 0.000164  |ddm|= 0.00161
HOMO (E2ux) = 0.0997687199660181  LUMO (A1g) = 0.0243593971340906
cycle= 12 E= -2098.48727466539  delta_E= -1.05e-07  |g|= 6.24e-05  |ddm|= 0.00114
HOMO (E2ux) = 0.0997483753396738  LUMO (A1g) = 0.024363886013574
cycle= 13 E= -2098.48727467536  delta_E= -9.98e-09  |g|= 1.5e-05  |ddm|= 0.000372
HOMO (E2ux) = 0.099739794026756  LUMO (A1g) = 0.02436306028011
cycle= 14 E= -2098.4872746757  delta_E= -3.31e-10  |g|= 5.28e-06  |ddm|= 8.52e-05
HOMO (E2ux) = 0.0997386475110726  LUMO (A1g) = 0.0243627591200984
Extra cycle  E= -2098.48727467569  delta_E= 1e-11  |g|= 9.61e-06  |ddm|= 0.000128
converged SCF energy = -2098.48727467569
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmphyzx5kf6
max_memory 4000 MB (current use 772 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy E2uy E2ux A1g A1u E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.584546825654
CASCI E = -2098.58454682565  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -33.215050512497
2 -1
State   0 energy     -33.234011161774
3 -1
State   0 energy     -33.255884015195
4 -1
State   0 energy   -2098.716211576132
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.71621157613  dE = -0.13166475  S^2 = 0.0000000
               |grad[o]|=0.573  |ddm|=0.0562  |maxRot[o]|=0.267
5 -1
State   0 energy     -33.285034668751
6 -1
State   0 energy     -33.314198156534
7 -1
State   0 energy     -33.346546424502
8 -1
State   0 energy   -2098.837870922123
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.83787092212  dE = -0.12165935  S^2 = 0.0000000
               |grad[o]|=0.147  |ddm|=0.0842  |maxRot[o]|=0.306
9 -1
State   0 energy     -33.474689809330
10 -1
State   0 energy     -33.542227643041
11 -1
State   0 energy     -33.601826281453
12 -1
State   0 energy   -2099.077546685360
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.07754668536  dE = -0.23967576  S^2 = 0.0000000
               |grad[o]|=0.659  |ddm|= 0.79  |maxRot[o]|=0.306
13 -1
State   0 energy     -33.661128377874
14 -1
State   0 energy     -33.687292055050
15 -1
State   0 energy     -33.708213041883
16 -1
State   0 energy   -2099.170601821272
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.17060182127  dE = -0.093055136  S^2 = 0.0000000
               |grad[o]|=0.162  |ddm|=0.0541  |maxRot[o]|=  0.3
17 -1
State   0 energy     -33.767427419540
18 -1
State   0 energy     -33.771239145746
19 -1
State   0 energy     -33.771610194244
20 -1
State   0 energy   -2099.186964382317
macro iter 5 (15 JK  4 micro), CASSCF E = -2099.18696438232  dE = -0.016362561  S^2 = 0.0000000
               |grad[o]|=0.0698  |ddm|=0.031  |maxRot[o]|=0.152
21 -1
State   0 energy     -33.744822318945
22 -1
State   0 energy     -33.744823138188
23 -1
State   0 energy     -33.744823023335
24 -1
State   0 energy   -2099.186968585877
macro iter 6 (10 JK  3 micro), CASSCF E = -2099.18696858588  dE = -4.2035599e-06  S^2 = 0.0000000
               |grad[o]|=0.00157  |ddm|=0.00124  |maxRot[o]|=0.00305
25 -1
State   0 energy     -33.749219602451
26 -1
State   0 energy   -2099.186968585878
macro iter 7 (1 JK  1 micro), CASSCF E = -2099.18696858588  dE = -1.3642421e-12  S^2 = 0.0000000
               |grad[o]|=2.55e-05  |ddm|=2.7e-05  |maxRot[o]|=    0
1-step CASSCF converged in 7 macro (110 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.90633264 1.90633312 1.92864735 1.84872073 1.84872076 0.15361148
 0.15361152 1.833313   0.13386897 0.09255701 0.09255751 0.10172591]
CASSCF energy = -2099.18696858588
CASCI E = -2099.18696858588  E(CI) = -33.7492196019666  S^2 = 0.0000000
energy =  -2099.1869685858783
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 0, 5, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 2, 3, 6, 7, 6, 7, 14, 15, 0, 5, 2, 3, 5, 0, 0, 2, 3, 5, 10, 11, 6, 7, 6, 7, 2, 3, 14, 15, 0, 5, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 2, 3, 5, 0, 6, 7, 14, 15, 5, 6, 7, 10, 11, 0, 6, 7, 2, 3, 0, 14, 15, 5, 16, 17, 0, 5, 20, 21, 10, 11, 2, 3, 6, 7, 24, 25, 2, 3, 14, 15, 0, 16, 17, 12, 13, 12, 13, 10, 11, 5, 6, 7, 0, 5, 14, 15, 6, 7, 2, 3, 0, 2, 3, 5, 10, 11, 14, 15, 6, 7, 0, 2, 3, 5, 5, 0, 16, 17, 10, 11, 20, 21, 0, 6, 7, 26, 27, 22, 23, 24, 25, 2, 3, 12, 13, 14, 15, 5, 0, 6, 7, 10, 11, 16, 17, 20, 21, 16, 17, 12, 13, 24, 25, 12, 13, 14, 15, 5, 10, 11, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 63 64 66 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 10:02:57 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.750000000000 AA    0.000000000000   0.000000000000   1.417294593424 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.750000000000 AA    0.000000000000   0.000000000000  -1.417294593424 Bohr   0.0

nuclear repulsion = 203.20404899328
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     10422.24


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpcqy1qhw1
max_memory 4000 MB (current use 2798 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.9411739713
HOMO (E2ux) = -0.241240098829204  LUMO (E2ux) = -0.241240098829204
cycle= 1 E= -2098.47409155556  delta_E= 0.467  |g|= 1.16  |ddm|= 2.82
HOMO (E2ux) = 0.258812043045119  LUMO (A1u) = 0.0218373166719212
cycle= 2 E= -2098.38019398709  delta_E= 0.0939  |g|= 1.43  |ddm|= 1.95
HOMO (E2ux) = -0.00487483899602525  LUMO (E2ux) = -0.00487483899602525
cycle= 3 E= -2098.58206026555  delta_E= -0.202  |g|= 0.334  |ddm|= 2.18
HOMO (E2ux) = 0.00662516753387786  LUMO (E2ux) = 0.00662516753387786
cycle= 4 E= -2098.60652654771  delta_E= -0.0245  |g|= 0.121  |ddm|= 0.356
HOMO (E2ux) = 0.00109970294574186  LUMO (E2ux) = 0.00109970294574186
cycle= 5 E= -2098.6071520649  delta_E= -0.000626  |g|= 0.127  |ddm|= 0.0599
HOMO (E2ux) = -0.0064351277658469  LUMO (E2ux) = -0.0064351277658469
cycle= 6 E= -2098.60807981124  delta_E= -0.000928  |g|= 0.125  |ddm|= 0.0414
HOMO (E2ux) = -0.0134878310530785  LUMO (E2ux) = -0.0134878310530785
cycle= 7 E= -2098.60958929326  delta_E= -0.00151  |g|= 0.12  |ddm|= 0.0662
HOMO (E2ux) = -0.0122445334921994  LUMO (E2ux) = -0.0122445334921994
cycle= 8 E= -2098.60794219872  delta_E= 0.00165  |g|= 0.123  |ddm|= 0.0673
HOMO (E2ux) = -0.0218942829903527  LUMO (E2ux) = -0.0218942829903527
cycle= 9 E= -2098.61210105223  delta_E= -0.00416  |g|= 0.125  |ddm|= 0.343
HOMO (E2ux) = -0.014338999831309  LUMO (E2ux) = -0.014338999831309
cycle= 10 E= -2098.61107647961  delta_E= 0.00102  |g|= 0.136  |ddm|= 0.131
HOMO (E2ux) = -0.0191414355399068  LUMO (E2ux) = -0.0191414355399068
cycle= 11 E= -2098.61059733342  delta_E= 0.000479  |g|= 0.151  |ddm|= 0.172
HOMO (E2ux) = -0.0173977656958711  LUMO (E2ux) = -0.0173977656958711
cycle= 12 E= -2098.61010154438  delta_E= 0.000496  |g|= 0.156  |ddm|= 0.0484
HOMO (E2ux) = -0.0172108758498103  LUMO (E2ux) = -0.0172108758498103
cycle= 13 E= -2098.60988613798  delta_E= 0.000215  |g|= 0.16  |ddm|= 0.0356
HOMO (E2ux) = -0.0359874844358235  LUMO (E2ux) = -0.0359874844358235
cycle= 14 E= -2098.60858588082  delta_E= 0.0013  |g|= 0.141  |ddm|= 0.257
HOMO (E2ux) = -0.0392506608527921  LUMO (E2ux) = -0.0392506608527921
cycle= 15 E= -2098.60771610593  delta_E= 0.00087  |g|= 0.142  |ddm|= 0.0587
HOMO (E2ux) = 0.00915938215550487  LUMO (E2ux) = 0.00915938215550487
cycle= 16 E= -2098.59152699772  delta_E= 0.0162  |g|= 0.338  |ddm|= 0.444
HOMO (E2ux) = 0.00500254514511022  LUMO (E2ux) = 0.00500254514511022
cycle= 17 E= -2098.59196113955  delta_E= -0.000434  |g|= 0.325  |ddm|= 0.0742
HOMO (E2ux) = -0.0149734925392986  LUMO (E2ux) = -0.0149734925392986
cycle= 18 E= -2098.60653735262  delta_E= -0.0146  |g|=  0.2  |ddm|= 0.242
HOMO (E2ux) = -0.0107212354190643  LUMO (E2ux) = -0.0107212354190643
cycle= 19 E= -2098.60367473926  delta_E= 0.00286  |g|= 0.228  |ddm|= 0.154
HOMO (E2ux) = -0.0107724690278936  LUMO (E2ux) = -0.0107724690278936
cycle= 20 E= -2098.60382677877  delta_E= -0.000152  |g|= 0.228  |ddm|= 0.064
HOMO (E2ux) = -0.0124508537940239  LUMO (E2ux) = -0.0124508537940239
cycle= 21 E= -2098.60458055696  delta_E= -0.000754  |g|= 0.224  |ddm|= 0.0473
HOMO (E2ux) = -0.00860399010347529  LUMO (E2ux) = -0.00860399010347529
cycle= 22 E= -2098.60063800972  delta_E= 0.00394  |g|= 0.262  |ddm|= 0.17
HOMO (E2ux) = -0.0380785625245648  LUMO (E2ux) = -0.0380785625245648
cycle= 23 E= -2098.61287218162  delta_E= -0.0122  |g|= 0.117  |ddm|= 0.196
HOMO (E2ux) = -0.036881553557395  LUMO (E2ux) = -0.036881553557395
cycle= 24 E= -2098.61275436055  delta_E= 0.000118  |g|= 0.12  |ddm|= 0.0133
HOMO (E2ux) = -0.0368901245031109  LUMO (E2ux) = -0.0368901245031109
cycle= 25 E= -2098.61254211972  delta_E= 0.000212  |g|= 0.122  |ddm|= 0.114
HOMO (E2ux) = -0.0394075173416423  LUMO (E2ux) = -0.0394075173416423
cycle= 26 E= -2098.61201821313  delta_E= 0.000524  |g|= 0.125  |ddm|= 0.11
HOMO (E2ux) = -0.0027263524662267  LUMO (E2ux) = -0.0027263524662267
cycle= 27 E= -2098.59926969488  delta_E= 0.0127  |g|= 0.253  |ddm|= 0.461
HOMO (E2ux) = -0.00234944646933651  LUMO (E2ux) = -0.00234944646933651
cycle= 28 E= -2098.60029371829  delta_E= -0.00102  |g|= 0.248  |ddm|= 0.0417
HOMO (E2ux) = -0.0287561341357379  LUMO (E2ux) = -0.0287561341357379
cycle= 29 E= -2098.61160829481  delta_E= -0.0113  |g|= 0.133  |ddm|= 0.272
HOMO (E2ux) = -0.023322577087815  LUMO (E2ux) = -0.023322577087815
cycle= 30 E= -2098.61046629342  delta_E= 0.00114  |g|= 0.144  |ddm|= 0.062
HOMO (A1g) = 0.0226602055014891  LUMO (E2ux) = 0.0199240183851742
cycle= 31 E= -2098.55458505052  delta_E= 0.0559  |g|= 0.457  |ddm|= 0.802
HOMO (E2ux) = 0.018842317915678  LUMO (E2ux) = 0.018842317915678
cycle= 32 E= -2098.55986531409  delta_E= -0.00528  |g|= 0.438  |ddm|= 0.118
SCF not converged.
SCF energy = -2098.55986531409
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 31]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpcqy1qhw1
max_memory 4000 MB (current use 969 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2gx E2gy A1g E2uy E2ux A1u E1gx E1gy A1u
Active space CI wfn symmetry = E2uy
0 -1
State   0 energy   -2098.634089130430
CASCI E = -2098.63408913043  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -32.205976846587
2 -1
State   0 energy     -32.224959016785
3 -1
State   0 energy     -32.246257380276
4 -1
State   0 energy   -2098.794717536370
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.79471753637  dE = -0.16062841  S^2 = 0.0000000
               |grad[o]|=0.464  |ddm|=0.298  |maxRot[o]|=0.291
5 -1
State   0 energy     -32.378359118831
6 -1
State   0 energy     -32.443101007502
7 -1
State   0 energy     -32.495892064694
8 -1
State   0 energy   -2099.037608007123
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.03760800712  dE = -0.24289047  S^2 = 0.0000000
               |grad[o]|=0.646  |ddm|=0.412  |maxRot[o]|=0.304
9 -1
State   0 energy     -32.530815902670
10 -1
State   0 energy     -32.557727976141
11 -1
State   0 energy     -32.574509109142
12 -1
State   0 energy   -2099.128301385843
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.12830138584  dE = -0.090693379  S^2 = 0.0000000
               |grad[o]|=0.188  |ddm|=0.0858  |maxRot[o]|=0.286
13 -1
State   0 energy     -32.615041051823
14 -1
State   0 energy     -32.630232203466
15 -1
State   0 energy     -32.645868848266
16 -1
State   0 energy   -2099.188934359414
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.18893435941  dE = -0.060632974  S^2 = 0.0000000
               |grad[o]|=0.0963  |ddm|=0.0539  |maxRot[o]|=0.307
17 -1
State   0 energy     -32.709895383547
18 -1
State   0 energy     -32.722204230491
19 -1
State   0 energy     -32.731680953779
20 -1
State   0 energy   -2099.233158257553
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.23315825755  dE = -0.044223898  S^2 = 0.0000000
               |grad[o]|=0.0827  |ddm|=0.0429  |maxRot[o]|=0.306
21 -1
State   0 energy     -32.778092098105
22 -1
State   0 energy     -32.781581878182
23 -1
State   0 energy     -32.783446056252
24 -1
State   0 energy   -2099.244167690645
macro iter 6 (19 JK  4 micro), CASSCF E = -2099.24416769065  dE = -0.011009433  S^2 = 0.0000000
               |grad[o]|=0.0457  |ddm|=0.0352  |maxRot[o]|=0.274
25 -1
State   0 energy     -32.773845479824
26 -1
State   0 energy     -32.773847211631
27 -1
State   0 energy     -32.773847938857
28 -1
State   0 energy   -2099.244184302041
macro iter 7 (10 JK  3 micro), CASSCF E = -2099.24418430204  dE = -1.6611395e-05  S^2 = 0.0000000
               |grad[o]|=0.00368  |ddm|=0.00273  |maxRot[o]|=0.00398
29 -1
State   0 energy     -32.769531143656
30 -1
State   0 energy   -2099.244184310796
macro iter 8 (3 JK  1 micro), CASSCF E = -2099.2441843108  dE = -8.7557055e-09  S^2 = 0.0000000
               |grad[o]|=4.48e-05  |ddm|=0.000145  |maxRot[o]|=0.000143
1-step CASSCF converged in 8 macro (137 JK 28 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.89561488 1.88443655 1.88443653 1.79508913 1.79508889 1.86127215
 0.20709553 0.20709526 0.12593456 0.11479135 0.11479134 0.11435382]
CASSCF energy = -2099.2441843108
CASCI E = -2099.2441843108  E(CI) = -32.7694907771192  S^2 = 0.0000000
energy =  -2099.2441843107963
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 10, 11, 0, 14, 15, 5, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 2, 3, 6, 7, 6, 7, 14, 15, 0, 5, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 6, 7, 2, 3, 5, 14, 15, 0, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 5, 0, 2, 3, 6, 7, 14, 15, 5, 6, 7, 10, 11, 0, 6, 7, 2, 3, 0, 14, 15, 5, 0, 16, 17, 2, 3, 10, 11, 20, 21, 5, 6, 7, 24, 25, 0, 2, 3, 16, 17, 14, 15, 12, 13, 12, 13, 10, 11, 0, 5, 6, 7, 14, 15, 5, 6, 7, 2, 3, 0, 2, 3, 5, 10, 11, 14, 15, 6, 7, 5, 0, 2, 3, 0, 5, 10, 11, 16, 17, 20, 21, 6, 7, 26, 27, 22, 23, 24, 25, 0, 12, 13, 2, 3, 14, 15, 5, 10, 11, 16, 17, 6, 7, 0, 20, 21, 16, 17, 12, 13, 24, 25, 14, 15, 12, 13, 5, 2, 3, 10, 11, 14, 15, 6, 7, 0, 5, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 63 64 65 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 10:26:01 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.800000000000 AA    0.000000000000   0.000000000000   1.511780899652 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.800000000000 AA    0.000000000000   0.000000000000  -1.511780899652 Bohr   0.0

nuclear repulsion = 190.5037959312
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     18808.77


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp9h94bdj6
max_memory 4000 MB (current use 2877 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.7036359884
HOMO (E2ux) = -0.230909119737002  LUMO (E2ux) = -0.230909119737002
cycle= 1 E= -2098.48330808799  delta_E= 0.22  |g|= 1.05  |ddm|= 2.83
HOMO (E2gy) = 0.205326980945427  LUMO (E1ux) = 0.0494181002963286
cycle= 2 E= -2097.19500917059  delta_E= 1.29  |g|= 2.32  |ddm|=  774
HOMO (E2gy) = -0.0833867402649828  LUMO (E2gy) = -0.0833867402649828
cycle= 3 E= -2098.40163119555  delta_E= -1.21  |g|= 0.556  |ddm|=  774
HOMO (E2gy) = -0.023188815511602  LUMO (A1u) = -0.0341948419548993
cycle= 4 E= -2098.43213395227  delta_E= -0.0305  |g|= 0.291  |ddm|= 0.226
HOMO (E2gy) = 0.00311639499589537  LUMO (A1u) = -0.00968675996002447
cycle= 5 E= -2098.44174494807  delta_E= -0.00961  |g|= 0.209  |ddm|= 0.137
HOMO (E2gy) = -0.00595227922715103  LUMO (E2gy) = -0.00595227922715103
cycle= 6 E= -2098.44636051301  delta_E= -0.00462  |g|= 0.205  |ddm|= 0.0669
HOMO (E2gy) = -0.00538393116526277  LUMO (E2gy) = -0.00538393116526277
cycle= 7 E= -2098.44626251857  delta_E= 9.8e-05  |g|= 0.206  |ddm|= 0.00531
HOMO (E2gy) = -0.00274605665236542  LUMO (A1u) = -0.00384210764098923
cycle= 8 E= -2098.44399946032  delta_E= 0.00226  |g|= 0.211  |ddm|= 0.06
HOMO (E2gy) = -0.00132064282534959  LUMO (A1u) = -0.00259800397325426
cycle= 9 E= -2098.43914457714  delta_E= 0.00485  |g|= 0.211  |ddm|= 0.285
HOMO (E2gy) = 0.00912771167703371  LUMO (A1u) = 0.00236074475990105
cycle= 10 E= -2098.43561207531  delta_E= 0.00353  |g|= 0.185  |ddm|= 0.0845
HOMO (E2gy) = 0.0163367871472035  LUMO (A1u) = 0.00500406588486002
cycle= 11 E= -2098.43272389586  delta_E= 0.00289  |g|= 0.176  |ddm|= 0.0744
HOMO (E2gy) = 0.00738512155526846  LUMO (A1u) = 0.00276454416934106
cycle= 12 E= -2098.43480312824  delta_E= -0.00208  |g|= 0.184  |ddm|= 0.144
HOMO (E2gy) = 0.0136351660339192  LUMO (A1u) = 0.00381758903840492
cycle= 13 E= -2098.43407901492  delta_E= 0.000724  |g|= 0.174  |ddm|= 0.0493
HOMO (E2gy) = 0.0159476791333389  LUMO (E2ux) = 0.0079122049622174
cycle= 14 E= -2098.15348294074  delta_E= 0.281  |g|= 1.19  |ddm|=  297
HOMO (E2ux) = 0.0358907821973777  LUMO (E2gy) = 0.0235372003230515
cycle= 15 E= -2098.0644653865  delta_E= 0.089  |g|=  1.3  |ddm|=  142
HOMO (E2ux) = 0.0350202726915493  LUMO (E2gy) = 0.0259963749079953
cycle= 16 E= -2098.09000235938  delta_E= -0.0255  |g|= 1.28  |ddm|= 89.2
HOMO (E2ux) = 0.0186027670366981  LUMO (E2gy) = 0.0161698070935526
cycle= 17 E= -2098.12524038663  delta_E= -0.0352  |g|= 1.23  |ddm|= 24.5
HOMO (E2ux) = 0.013673546277343  LUMO (E2gy) = 0.0126677293414793
cycle= 18 E= -2098.11984641483  delta_E= 0.00539  |g|= 1.25  |ddm|= 1.47
HOMO (E2ux) = 0.034981172724496  LUMO (E2gy) = 0.0279946180755593
cycle= 19 E= -2098.09404027444  delta_E= 0.0258  |g|= 1.29  |ddm|= 52.3
HOMO (E2gy) = 0.0258924809795249  LUMO (E2ux) = 0.0216867900280614
cycle= 20 E= -2098.1035875382  delta_E= -0.00955  |g|= 1.26  |ddm|= 31.8
HOMO (E2gy) = 0.0157113117958001  LUMO (E2ux) = -0.00368260346306455
cycle= 21 E= -2098.15576457564  delta_E= -0.0522  |g|= 1.21  |ddm|=  133
HOMO (E2gy) = -0.0600147068564628  LUMO (A1u) = -0.188356517561684
cycle= 22 E= -2098.18890353327  delta_E= -0.0331  |g|= 1.22  |ddm|=  222
HOMO (E2gy) = -0.0432144472915838  LUMO (A1u) = -0.116140636547853
cycle= 23 E= -2098.33480289159  delta_E= -0.146  |g|= 0.755  |ddm|= 0.439
HOMO (E2gy) = 0.0152141384543945  LUMO (E2ux) = -0.0139731704316787
cycle= 24 E= -2098.18188033384  delta_E= 0.153  |g|= 1.15  |ddm|=  296
HOMO (E2gy) = 0.0265291864513479  LUMO (E2ux) = 0.00752777438544367
cycle= 25 E= -2098.13541333016  delta_E= 0.0465  |g|= 1.22  |ddm|=   30
HOMO (E2gy) = 0.0252341970956097  LUMO (E2ux) = 0.00475566538366546
cycle= 26 E= -2098.14825642014  delta_E= -0.0128  |g|=  1.2  |ddm|= 5.31
HOMO (E2gy) = 0.0251789733173303  LUMO (E2ux) = 0.00744710286317516
cycle= 27 E= -2098.14471113069  delta_E= 0.00355  |g|= 1.21  |ddm|= 1.37
HOMO (E2gy) = 0.0274051393809087  LUMO (E2ux) = 0.00830286445739906
cycle= 28 E= -2098.15151310174  delta_E= -0.0068  |g|=  1.2  |ddm|= 30.6
HOMO (E2gy) = 0.0338802934295251  LUMO (E2ux) = 0.0112599094511381
cycle= 29 E= -2098.17375425392  delta_E= -0.0222  |g|= 1.18  |ddm|=  109
HOMO (E2gy) = 0.0330763278841745  LUMO (E2ux) = 0.0203930615865371
cycle= 30 E= -2098.12746462614  delta_E= 0.0463  |g|= 1.23  |ddm|=  125
HOMO (E2gy) = -0.0170019267289732  LUMO (A1u) = -0.0951049264359765
cycle= 31 E= -2098.3639835058  delta_E= -0.237  |g|= 0.648  |ddm|=  248
HOMO (E2gy) = -0.0148680771093367  LUMO (A1u) = -0.0855269116757888
cycle= 32 E= -2098.37633029741  delta_E= -0.0123  |g|= 0.596  |ddm|= 0.0378
SCF not converged.
SCF energy = -2098.37633029741
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp9h94bdj6
max_memory 4000 MB (current use 990 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g A1g E2ux E2uy E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.802475935380
CASCI E = -2098.80247593538  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -31.300470990208
2 -1
State   0 energy     -31.339625033210
3 -1
State   0 energy     -31.376501431460
4 -1
State   0 energy   -2098.977713699924
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.97771369992  dE = -0.17523776  S^2 = 0.0000000
               |grad[o]|=0.312  |ddm|=0.114  |maxRot[o]|=0.307
5 -1
State   0 energy     -31.574353176913
6 -1
State   0 energy     -31.611915333577
7 -1
State   0 energy     -31.648845137756
8 -1
State   0 energy   -2099.123780843080
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.12378084308  dE = -0.14606714  S^2 = 0.0000000
               |grad[o]|=0.161  |ddm|=0.124  |maxRot[o]|=  0.3
9 -1
State   0 energy     -31.774456265134
10 -1
State   0 energy     -31.796714570627
11 -1
State   0 energy     -31.817136715404
12 -1
State   0 energy   -2099.208512893123
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.20851289312  dE = -0.08473205  S^2 = 0.0000000
               |grad[o]|=0.107  |ddm|=0.0763  |maxRot[o]|=0.306
13 -1
State   0 energy     -31.889967768451
14 -1
State   0 energy     -31.901570265311
15 -1
State   0 energy     -31.910853256430
16 -1
State   0 energy   -2099.251080440445
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.25108044045  dE = -0.042567547  S^2 = 0.0000000
               |grad[o]|=0.0855  |ddm|=0.0446  |maxRot[o]|=0.312
17 -1
State   0 energy     -31.956581502219
18 -1
State   0 energy     -31.960529453081
19 -1
State   0 energy     -31.962788000102
20 -1
State   0 energy   -2099.263849599375
macro iter 5 (20 JK  4 micro), CASSCF E = -2099.26384959938  dE = -0.012769159  S^2 = 0.0000000
               |grad[o]|=0.0476  |ddm|=0.0318  |maxRot[o]|=0.293
21 -1
State   0 energy     -31.962450473049
22 -1
State   0 energy     -31.962455933462
23 -1
State   0 energy     -31.962458922867
24 -1
State   0 energy   -2099.263875873047
macro iter 6 (12 JK  4 micro), CASSCF E = -2099.26387587305  dE = -2.6273672e-05  S^2 = 0.0000000
               |grad[o]|=0.00382  |ddm|=0.00467  |maxRot[o]|=0.00619
25 -1
State   0 energy     -31.955217214894
26 -1
State   0 energy   -2099.263875916748
macro iter 7 (4 JK  1 micro), CASSCF E = -2099.26387591675  dE = -4.3701675e-08  S^2 = 0.0000000
               |grad[o]|=8.38e-05  |ddm|=0.000265  |maxRot[o]|=0.000301
1-step CASSCF converged in 7 macro (120 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.85380931 1.85380954 1.83759323 1.8940427  0.29289265 0.2928925
 1.70868016 0.1416016  1.70867994 0.14587275 0.14587297 0.12425265]
CASSCF energy = -2099.26387591675
CASCI E = -2099.26387591675  E(CI) = -31.9551216493328  S^2 = 0.0000000
energy =  -2099.2638759167485
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 0, 15, 14, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 2, 3, 5, 6, 7, 10, 11, 0, 5, 14, 15, 6, 7, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 5, 6, 7, 14, 15, 2, 3, 0, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 5, 0, 6, 7, 2, 3, 14, 15, 6, 7, 5, 10, 11, 0, 6, 7, 0, 2, 3, 14, 15, 5, 0, 2, 3, 16, 17, 10, 11, 20, 21, 5, 6, 7, 24, 25, 0, 2, 3, 16, 17, 12, 13, 12, 13, 14, 15, 10, 11, 0, 5, 6, 7, 14, 15, 5, 2, 3, 6, 7, 2, 3, 0, 5, 10, 11, 14, 15, 6, 7, 5, 2, 3, 0, 0, 5, 10, 11, 16, 17, 6, 7, 20, 21, 26, 27, 22, 23, 24, 25, 0, 12, 13, 2, 3, 14, 15, 5, 10, 11, 6, 7, 16, 17, 20, 21, 0, 16, 17, 12, 13, 24, 25, 14, 15, 2, 3, 12, 13, 5, 10, 11, 14, 15, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 62 63 64 65 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 10:46:32 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.840000000000 AA    0.000000000000   0.000000000000   1.587369944635 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.840000000000 AA    0.000000000000   0.000000000000  -1.587369944635 Bohr   0.0

nuclear repulsion = 181.432186601143
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     26434.18


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpf0xr6wkw
max_memory 4000 MB (current use 2885 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.54622868335
HOMO (E2ux) = -0.223805943761094  LUMO (E2ux) = -0.223805943761094
cycle= 1 E= -2098.4815311618  delta_E= 0.0647  |g|= 0.993  |ddm|= 2.82
HOMO (E2gy) = 0.207069315726066  LUMO (E1ux) = 0.050248953765601
cycle= 2 E= -2097.31568485626  delta_E= 1.17  |g|= 2.22  |ddm|=  601
HOMO (E2gy) = -0.0637208655432551  LUMO (E2ux) = -0.197041957422878
cycle= 3 E= -2098.52560370887  delta_E= -1.21  |g|= 0.373  |ddm|=  601
HOMO (E2gy) = -0.0312598469083105  LUMO (E2ux) = -0.242667005965114
cycle= 4 E= -2098.5468259345  delta_E= -0.0212  |g|= 0.165  |ddm|= 0.185
HOMO (E2gy) = -0.0244712711009301  LUMO (E2gy) = -0.0244712711009301
cycle= 5 E= -2098.14839929358  delta_E= 0.398  |g|= 0.757  |ddm|= 1.84
HOMO (E2gy) = -0.00651291117316135  LUMO (A1u) = -0.00794052201030976
cycle= 6 E= -2098.17527244059  delta_E= -0.0269  |g|= 0.631  |ddm|= 0.0803
HOMO (E2gy) = 0.0696838646411232  LUMO (A1u) = 0.00783076852974221
cycle= 7 E= -2098.20883002234  delta_E= -0.0336  |g|= 0.126  |ddm|= 0.542
HOMO (E2gy) = 0.0549582961593307  LUMO (A1u) = 0.00584974858972161
cycle= 8 E= -2098.22238590899  delta_E= -0.0136  |g|= 0.129  |ddm|= 0.11
HOMO (E2gy) = 0.0559769037188785  LUMO (A1u) = 0.00578300629539991
cycle= 9 E= -2098.22204334303  delta_E= 0.000343  |g|= 0.123  |ddm|= 0.0358
HOMO (E2gy) = 0.0636075940167623  LUMO (A1u) = 0.00927463491958496
cycle= 10 E= -2098.2138910804  delta_E= 0.00815  |g|= 0.118  |ddm|= 0.11
HOMO (E2gy) = 0.0801441369653129  LUMO (A1u) = 0.0183552666718492
cycle= 11 E= -2098.16167282848  delta_E= 0.0522  |g|= 0.341  |ddm|= 0.504
HOMO (E2gy) = 0.0674542683457284  LUMO (A1u) = 0.0158682839229245
cycle= 12 E= -2098.20237237378  delta_E= -0.0407  |g|= 0.161  |ddm|= 0.227
HOMO (E2gy) = 0.0743573069526694  LUMO (A1u) = 0.0176290640179524
cycle= 13 E= -2098.17617034605  delta_E= 0.0262  |g|= 0.265  |ddm|= 0.24
HOMO (E2gy) = 0.0854214180841555  LUMO (A1u) = 0.0203460462855616
cycle= 14 E= -2098.09250820892  delta_E= 0.0837  |g|= 0.55  |ddm|= 0.663
HOMO (E2gy) = 0.088231790645561  LUMO (A1u) = 0.021470045966685
cycle= 15 E= -2098.11155950054  delta_E= -0.0191  |g|= 0.496  |ddm|= 0.326
HOMO (E2gy) = 0.0794198268235286  LUMO (A1u) = 0.0192489251989954
cycle= 16 E= -2098.14354807668  delta_E= -0.032  |g|= 0.407  |ddm|= 0.131
HOMO (E2gy) = 0.0652785521549437  LUMO (A1u) = 0.0162750891036422
cycle= 17 E= -2098.20846660374  delta_E= -0.0649  |g|= 0.13  |ddm|= 0.546
HOMO (E2gy) = 0.0715851749107315  LUMO (A1u) = 0.0181627122543119
cycle= 18 E= -2098.17601507637  delta_E= 0.0325  |g|= 0.279  |ddm|= 0.295
HOMO (E2gy) = 0.0608521632063554  LUMO (A1u) = 0.0151752018107462
cycle= 19 E= -2098.2184836135  delta_E= -0.0425  |g|= 0.116  |ddm|= 0.49
HOMO (E2gy) = 0.0657828146636581  LUMO (A1u) = 0.0164789898741669
cycle= 20 E= -2098.18813738816  delta_E= 0.0303  |g|= 0.237  |ddm|= 0.504
HOMO (E2gy) = 0.0645054954578514  LUMO (A1u) = 0.0158287587394985
cycle= 21 E= -2098.21331151271  delta_E= -0.0252  |g|= 0.117  |ddm|= 0.441
HOMO (E2gy) = 0.0588015627744226  LUMO (A1u) = 0.0137630994389241
cycle= 22 E= -2098.21992114918  delta_E= -0.00661  |g|= 0.106  |ddm|= 0.111
HOMO (E2gy) = 0.0584138727439591  LUMO (A1u) = 0.013613801284272
cycle= 23 E= -2098.22000030517  delta_E= -7.92e-05  |g|= 0.106  |ddm|= 0.0142
HOMO (E2gy) = 0.0643669036866268  LUMO (A1u) = 0.0156166966184306
cycle= 24 E= -2098.21259753531  delta_E= 0.0074  |g|= 0.113  |ddm|= 0.123
HOMO (E2gy) = 0.0621695102230414  LUMO (A1u) = 0.0148646213875283
cycle= 25 E= -2098.21705753933  delta_E= -0.00446  |g|= 0.112  |ddm|= 0.121
HOMO (E2gy) = 0.0622929814044965  LUMO (A1u) = 0.0149033874601113
cycle= 26 E= -2098.20393917324  delta_E= 0.0131  |g|= 0.132  |ddm|= 0.354
HOMO (E2gy) = 0.0631678624181283  LUMO (A1u) = 0.015169655386611
cycle= 27 E= -2098.20106388451  delta_E= 0.00288  |g|= 0.134  |ddm|= 0.0657
HOMO (E2gy) = 0.068026674577575  LUMO (A1u) = 0.0168613151920663
cycle= 28 E= -2098.1864357408  delta_E= 0.0146  |g|= 0.229  |ddm|= 0.139
HOMO (E2gy) = 0.0681647433422811  LUMO (A1u) = 0.0165204990783911
cycle= 29 E= -2098.14872822644  delta_E= 0.0377  |g|= 0.398  |ddm|= 0.641
HOMO (E2gy) = 0.0671914417952707  LUMO (A1u) = 0.0162846414545689
cycle= 30 E= -2098.15486358458  delta_E= -0.00614  |g|= 0.38  |ddm|= 0.161
HOMO (E2gy) = 0.0681373713938681  LUMO (A1u) = 0.0164587920167394
cycle= 31 E= -2098.13448265184  delta_E= 0.0204  |g|= 0.441  |ddm|= 0.671
HOMO (E2gy) = 0.0772599876501499  LUMO (A1u) = 0.0198878891326329
cycle= 32 E= -2098.15183069206  delta_E= -0.0173  |g|= 0.383  |ddm|= 0.876
SCF not converged.
SCF energy = -2098.15183069206
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpf0xr6wkw
max_memory 4000 MB (current use 996 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2uy E2ux A1g E2gy A1u E1gx E1gy E2gx A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.323907571446
CASCI E = -2098.32390757145  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.589993164296
2 -1
State   0 energy     -30.717971855255
3 -1
State   0 energy     -30.836027552755
4 -1
State   0 energy   -2098.768940600096
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.7689406001  dE = -0.44503303  S^2 = 0.0000000
               |grad[o]|=0.973  |ddm|= 1.09  |maxRot[o]|=0.313
5 -1
State   0 energy     -30.950686884695
6 -1
State   0 energy     -30.973927704169
7 -1
State   0 energy     -30.994448121187
8 -1
State   0 energy   -2098.897017880719
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.89701788072  dE = -0.12807728  S^2 = 0.0000000
               |grad[o]|=0.456  |ddm|=0.215  |maxRot[o]|=0.287
9 -1
State   0 energy     -31.063700863471
10 -1
State   0 energy     -31.102792908287
11 -1
State   0 energy     -31.146668182695
12 -1
State   0 energy   -2099.051226248716
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.05122624872  dE = -0.15420837  S^2 = 0.0000000
               |grad[o]|=0.182  |ddm|=0.212  |maxRot[o]|=0.303
13 -1
State   0 energy     -31.253351246847
14 -1
State   0 energy     -31.293127726282
15 -1
State   0 energy     -31.330369548972
16 -1
State   0 energy   -2099.198882040691
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.19888204069  dE = -0.14765579  S^2 = 0.0000000
               |grad[o]|=0.164  |ddm|=0.159  |maxRot[o]|=0.307
17 -1
State   0 energy     -31.441741401495
18 -1
State   0 energy     -31.453614110619
19 -1
State   0 energy     -31.462934350231
20 -1
State   0 energy   -2099.249703676664
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.24970367666  dE = -0.050821636  S^2 = 0.0000000
               |grad[o]|=0.107  |ddm|=0.064  |maxRot[o]|=0.287
21 -1
State   0 energy     -31.927073130559
22 -1
State   0 energy     -31.931070321101
23 -1
State   0 energy     -31.934605635042
24 -1
State   0 energy   -2099.263921012627
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.26392101263  dE = -0.014217336  S^2 = 0.0000000
               |grad[o]|=0.041  |ddm|=0.0257  |maxRot[o]|=0.304
25 -1
State   0 energy     -31.825786206637
26 -1
State   0 energy     -31.829437266507
27 -1
State   0 energy     -31.829689218231
28 -1
State   0 energy   -2099.267426263489
macro iter 7 (19 JK  4 micro), CASSCF E = -2099.26742626349  dE = -0.0035052509  S^2 = 0.0000000
               |grad[o]|=0.0189  |ddm|=0.0418  |maxRot[o]|=0.103
29 -1
State   0 energy     -31.435953411272
30 -1
State   0 energy     -31.436131940155
31 -1
State   0 energy     -31.436203872828
32 -1
State   0 energy   -2099.267785698664
macro iter 8 (15 JK  4 micro), CASSCF E = -2099.26778569866  dE = -0.00035943518  S^2 = 0.0000000
               |grad[o]|=0.00944  |ddm|=0.0356  |maxRot[o]|=0.0535
33 -1
State   0 energy     -31.392468257809
34 -1
State   0 energy     -31.392469862237
35 -1
State   0 energy     -31.392470408634
36 -1
State   0 energy   -2099.267789644989
macro iter 9 (12 JK  4 micro), CASSCF E = -2099.26778964499  dE = -3.9463248e-06  S^2 = 0.0000000
               |grad[o]|=0.000874  |ddm|=0.00378  |maxRot[o]|=0.00526
37 -1
State   0 energy     -31.388882310755
38 -1
State   0 energy   -2099.267789661532
macro iter 10 (3 JK  1 micro), CASSCF E = -2099.26778966153  dE = -1.6543254e-08  S^2 = 0.0000000
               |grad[o]|=5.64e-05  |ddm|=0.000168  |maxRot[o]|=0.000218
1-step CASSCF converged in 10 macro (175 JK 37 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.78610181 1.81667282 1.8166728  0.39844478 0.39844599 1.89668907
 1.60238566 0.13825237 0.18337321 0.1833732  1.60238437 0.1772039 ]
CASSCF energy = -2099.26778966153
CASCI E = -2099.26778966153  E(CI) = -31.3888041772857  S^2 = 0.0000000
energy =  -2099.267789661532
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 14, 15, 0, 11, 5, 2, 3, 10, 5, 6, 7, 0, 0, 5, 2, 3, 10, 11, 6, 7, 6, 7, 14, 15, 0, 5, 5, 2, 3, 0, 2, 3, 0, 5, 10, 11, 6, 7, 5, 6, 7, 0, 14, 15, 2, 3, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 5, 0, 6, 7, 2, 3, 14, 15, 6, 7, 5, 0, 10, 11, 6, 7, 0, 2, 3, 14, 15, 5, 0, 2, 3, 16, 17, 10, 11, 20, 21, 6, 7, 5, 24, 25, 0, 12, 13, 16, 17, 2, 3, 12, 13, 10, 11, 14, 15, 5, 0, 6, 7, 14, 15, 2, 3, 5, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 5, 2, 3, 0, 0, 5, 10, 11, 6, 7, 16, 17, 20, 21, 26, 27, 22, 23, 24, 25, 0, 12, 13, 14, 15, 2, 3, 5, 10, 11, 6, 7, 16, 17, 0, 16, 17, 20, 21, 12, 13, 24, 25, 14, 15, 2, 3, 12, 13, 10, 11, 5, 14, 15, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 63 64 65 66 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 11:13:14 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.900000000000 AA    0.000000000000   0.000000000000   1.700753512109 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.900000000000 AA    0.000000000000   0.000000000000  -1.700753512109 Bohr   0.0

nuclear repulsion = 169.3367074944
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     36031.05


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpi6fy0ze2
max_memory 4000 MB (current use 2887 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.34814989149
HOMO (E2ux) = -0.214883886060262  LUMO (E2ux) = -0.214883886060262
cycle= 1 E= -2098.47354444445  delta_E= -0.125  |g|= 0.934  |ddm|= 2.77
HOMO (E2ux) = 0.300406489356909  LUMO (E1ux) = 0.0511448070759157
cycle= 2 E= -2097.5389790131  delta_E= 0.935  |g|=  2.1  |ddm|=  385
HOMO (E2ux) = 0.0569839267873481  LUMO (A1u) = -0.056391567121
cycle= 3 E= -2098.54730794512  delta_E= -1.01  |g|= 0.474  |ddm|=  385
HOMO (E2ux) = 0.0813708920453062  LUMO (A1u) = -0.0301912931663322
cycle= 4 E= -2098.57840218622  delta_E= -0.0311  |g|= 0.284  |ddm|= 0.203
HOMO (E2ux) = 0.0934911965626057  LUMO (A1u) = -0.00595383139302514
cycle= 5 E= -2098.58192145064  delta_E= -0.00352  |g|= 0.242  |ddm|= 0.175
HOMO (E2ux) = 0.079491977989485  LUMO (A1u) = -0.00435804477650523
cycle= 6 E= -2098.58765606377  delta_E= -0.00573  |g|= 0.251  |ddm|= 0.16
HOMO (E2ux) = 0.0830210702269669  LUMO (A1u) = -0.00387397434816598
cycle= 7 E= -2098.58653402226  delta_E= 0.00112  |g|= 0.256  |ddm|= 0.0614
HOMO (E2ux) = 0.0853208305937452  LUMO (A1u) = -0.00238335402190595
cycle= 8 E= -2098.57801226951  delta_E= 0.00852  |g|= 0.27  |ddm|= 0.131
HOMO (E2ux) = 0.085258519503423  LUMO (A1u) = -0.002570662122407
cycle= 9 E= -2098.57933329387  delta_E= -0.00132  |g|= 0.269  |ddm|= 0.0253
HOMO (E2ux) = 0.0892615682950718  LUMO (A1u) = 0.000362737946803259
cycle= 10 E= -2098.58547770038  delta_E= -0.00614  |g|= 0.242  |ddm|= 0.0784
HOMO (E2ux) = 0.0891131841363315  LUMO (A1u) = 0.00155192921049783
cycle= 11 E= -2098.58435180791  delta_E= 0.00113  |g|= 0.248  |ddm|= 0.0541
HOMO (E2ux) = 0.082062408096788  LUMO (A1u) = -0.00229429264841705
cycle= 12 E= -2098.58611464819  delta_E= -0.00176  |g|= 0.254  |ddm|= 0.121
HOMO (E2ux) = 0.0870672832645382  LUMO (A1u) = -0.00158931247261311
cycle= 13 E= -2098.58378956334  delta_E= 0.00233  |g|= 0.25  |ddm|= 0.0833
HOMO (E2ux) = 0.0890892633131496  LUMO (A1u) = -0.000873010249972987
cycle= 14 E= -2098.58286482735  delta_E= 0.000925  |g|= 0.248  |ddm|= 0.0402
HOMO (E2ux) = 0.0816019110513771  LUMO (A1u) = -0.00331557166419119
cycle= 15 E= -2098.58724945411  delta_E= -0.00438  |g|= 0.247  |ddm|= 0.115
HOMO (E2ux) = 0.0929553591270003  LUMO (A1u) = 0.000309970096690128
cycle= 16 E= -2098.58104458711  delta_E= 0.0062  |g|= 0.245  |ddm|= 0.15
HOMO (E2ux) = 0.099309766705154  LUMO (A1u) = 0.0016150659572176
cycle= 17 E= -2098.5747926845  delta_E= 0.00625  |g|= 0.243  |ddm|= 0.133
HOMO (E2ux) = 0.10293267574284  LUMO (A1u) = 0.0033973351453692
cycle= 18 E= -2098.57258047263  delta_E= 0.00221  |g|= 0.237  |ddm|= 0.146
HOMO (E2ux) = 0.0950125687367386  LUMO (A1u) = 0.00120067593807098
cycle= 19 E= -2098.58819592312  delta_E= -0.0156  |g|= 0.215  |ddm|= 0.217
HOMO (E2ux) = 0.0998521999695086  LUMO (A1u) = 0.00166563820932461
cycle= 20 E= -2098.57313131972  delta_E= 0.0151  |g|= 0.247  |ddm|= 0.275
HOMO (E2ux) = 0.0943968749381889  LUMO (A1u) = -0.0010170258702201
cycle= 21 E= -2098.57352690515  delta_E= -0.000396  |g|= 0.25  |ddm|= 0.166
HOMO (E2ux) = 0.0965410729035895  LUMO (A1u) = -0.000649233598915495
cycle= 22 E= -2098.5769312559  delta_E= -0.0034  |g|= 0.236  |ddm|= 0.0846
HOMO (E2ux) = 0.0821938435820966  LUMO (A1u) = -0.00565363211632886
cycle= 23 E= -2098.58591364489  delta_E= -0.00898  |g|= 0.243  |ddm|= 0.264
HOMO (E2ux) = 0.0912384210489024  LUMO (A1u) = -0.0033053053526079
cycle= 24 E= -2098.58383320861  delta_E= 0.00208  |g|= 0.24  |ddm|= 0.134
HOMO (E2ux) = 0.0907629807874218  LUMO (A1u) = -0.00345135170086193
cycle= 25 E= -2098.58445226878  delta_E= -0.000619  |g|= 0.24  |ddm|= 0.04
HOMO (E2ux) = 0.0953444184717081  LUMO (A1u) = -0.00150488656830477
cycle= 26 E= -2098.58315602978  delta_E= 0.0013  |g|= 0.237  |ddm|= 0.0736
HOMO (E2ux) = 0.111493250937708  LUMO (A1u) = 0.00502677168194927
cycle= 27 E= -2098.57273115839  delta_E= 0.0104  |g|= 0.226  |ddm|= 0.259
HOMO (E2ux) = 0.0931588621146915  LUMO (A1u) = 0.00312582626164541
cycle= 28 E= -2098.58704215322  delta_E= -0.0143  |g|= 0.223  |ddm|= 0.257
HOMO (E2ux) = 0.0976578998333284  LUMO (A1u) = 0.00366770999591937
cycle= 29 E= -2098.58264101483  delta_E= 0.0044  |g|= 0.225  |ddm|= 0.0933
HOMO (E2ux) = 0.115735040444324  LUMO (A1u) = 0.00789645513926825
cycle= 30 E= -2098.56518975849  delta_E= 0.0175  |g|= 0.225  |ddm|= 0.322
HOMO (E2ux) = 0.118040608324631  LUMO (A1u) = 0.00996572570238113
cycle= 31 E= -2098.56347409724  delta_E= 0.00172  |g|= 0.232  |ddm|= 0.235
HOMO (E2ux) = 0.110757525616847  LUMO (A1u) = 0.00528918509878413
cycle= 32 E= -2098.57052202134  delta_E= -0.00705  |g|= 0.241  |ddm|= 0.277
SCF not converged.
SCF energy = -2098.57052202134
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpi6fy0ze2
max_memory 4000 MB (current use 997 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g A1g E2gy E2gx E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.741347133303
CASCI E = -2098.7413471333  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.003236039229
2 -1
State   0 energy     -30.042319730926
3 -1
State   0 energy     -30.068011783292
4 -1
State   0 energy   -2098.887094115026
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.88709411503  dE = -0.14574698  S^2 = 0.0000000
               |grad[o]|=0.238  |ddm|=0.149  |maxRot[o]|=0.257
5 -1
State   0 energy     -30.192152264064
6 -1
State   0 energy     -30.236988668574
7 -1
State   0 energy     -30.290060853289
8 -1
State   0 energy   -2099.070069576813
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.07006957681  dE = -0.18297546  S^2 = 0.0000000
               |grad[o]|=0.118  |ddm|=0.236  |maxRot[o]|=0.308
9 -1
State   0 energy     -30.438985210217
10 -1
State   0 energy     -30.486043034739
11 -1
State   0 energy     -30.523808303525
12 -1
State   0 energy   -2099.229592167866
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.22959216787  dE = -0.15952259  S^2 = 0.0000000
               |grad[o]|=0.164  |ddm|= 0.23  |maxRot[o]|=0.289
13 -1
State   0 energy     -30.680517181519
14 -1
State   0 energy     -30.687400187606
15 -1
State   0 energy     -30.694112280006
16 -1
State   0 energy   -2099.257486567406
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.25748656741  dE = -0.0278944  S^2 = 0.0000000
               |grad[o]|=0.0694  |ddm|=0.0605  |maxRot[o]|=0.299
17 -1
State   0 energy     -30.765675753365
18 -1
State   0 energy     -30.769514975725
19 -1
State   0 energy     -30.772405905906
20 -1
State   0 energy   -2099.269149175650
macro iter 5 (20 JK  4 micro), CASSCF E = -2099.26914917565  dE = -0.011662608  S^2 = 0.0000000
               |grad[o]|=0.0361  |ddm|=0.074  |maxRot[o]|=0.282
21 -1
State   0 energy     -30.641689271775
22 -1
State   0 energy     -30.641688908763
23 -1
State   0 energy     -30.641689051321
24 -1
State   0 energy   -2099.269411827912
macro iter 6 (13 JK  4 micro), CASSCF E = -2099.26941182791  dE = -0.00026265226  S^2 = 0.0000000
               |grad[o]|=0.00785  |ddm|=0.0095  |maxRot[o]|=0.0435
25 -1
State   0 energy     -30.646317721081
26 -1
State   0 energy   -2099.269411872073
macro iter 7 (4 JK  1 micro), CASSCF E = -2099.26941187207  dE = -4.416097e-08  S^2 = 0.0000000
               |grad[o]|=0.000106  |ddm|=0.000338  |maxRot[o]|=0.000314
1-step CASSCF converged in 7 macro (121 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.72738123 1.72738202 1.67853314 1.87563931 1.40285108 1.40284778
 0.5971801  0.1803319  0.27292416 0.27292496 0.26482776 0.59717658]
CASSCF energy = -2099.26941187207
CASCI E = -2099.26941187207  E(CI) = -30.6461700246859  S^2 = 0.0000000
energy =  -2099.269411872073
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 0, 11, 10, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 5, 2, 3, 10, 11, 6, 7, 5, 0, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 5, 0, 6, 7, 2, 3, 14, 15, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 6, 7, 5, 0, 14, 15, 2, 3, 0, 6, 7, 10, 11, 5, 6, 7, 0, 2, 3, 14, 15, 5, 0, 2, 3, 16, 17, 10, 11, 6, 7, 20, 21, 0, 5, 24, 25, 12, 13, 16, 17, 12, 13, 5, 2, 3, 10, 11, 14, 15, 0, 14, 15, 6, 7, 2, 3, 5, 6, 7, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 5, 2, 3, 0, 0, 5, 6, 7, 10, 11, 16, 17, 0, 20, 21, 26, 27, 22, 23, 24, 25, 12, 13, 14, 15, 5, 2, 3, 6, 7, 10, 11, 0, 16, 17, 16, 17, 12, 13, 20, 21, 24, 25, 14, 15, 10, 11, 2, 3, 5, 12, 13, 14, 15, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 63 64 65 66 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 11:34:45 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.950000000000 AA    0.000000000000   0.000000000000   1.795239818337 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.950000000000 AA    0.000000000000   0.000000000000  -1.795239818337 Bohr   0.0

nuclear repulsion = 160.424249205221
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     43646.19


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp7jk6ogkx
max_memory 4000 MB (current use 2889 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.20893903983
HOMO (E2ux) = -0.208842213743687  LUMO (E2ux) = -0.208842213743687
cycle= 1 E= -2098.42826665331  delta_E= -0.219  |g|= 0.868  |ddm|= 2.72
HOMO (E2gy) = 0.207214517940088  LUMO (E1ux) = 0.0515718443053084
cycle= 2 E= -2097.44490436035  delta_E= 0.983  |g|= 2.07  |ddm|=  252
HOMO (E2gy) = -0.0294091618535727  LUMO (A1u) = -0.0588470901012536
cycle= 3 E= -2098.41029521464  delta_E= -0.965  |g|= 0.51  |ddm|=  252
HOMO (E2gy) = 0.00166438525423184  LUMO (A1u) = -0.0384569173634006
cycle= 4 E= -2098.43386967546  delta_E= -0.0236  |g|= 0.293  |ddm|= 0.181
HOMO (E2gy) = 0.01585114253597  LUMO (A1u) = -0.0173303229724532
cycle= 5 E= -2098.4448207452  delta_E= -0.011  |g|= 0.225  |ddm|= 0.146
HOMO (E2gy) = 0.00800789963029632  LUMO (A1u) = -0.0099921390193553
cycle= 6 E= -2098.45030488646  delta_E= -0.00548  |g|= 0.215  |ddm|= 0.0935
HOMO (E2gy) = 0.00836946495139943  LUMO (A1u) = -0.009885422766835
cycle= 7 E= -2098.45017765386  delta_E= 0.000127  |g|= 0.215  |ddm|= 0.00449
HOMO (E2gy) = 0.0115788646379669  LUMO (A1u) = -0.0088086588699248
cycle= 8 E= -2098.44824005743  delta_E= 0.00194  |g|= 0.216  |ddm|= 0.0624
HOMO (E2gy) = 0.0128823825706646  LUMO (A1u) = -0.00883786379473096
cycle= 9 E= -2098.44985470107  delta_E= -0.00161  |g|= 0.211  |ddm|= 0.137
HOMO (E2gy) = 0.0199465154461026  LUMO (A1u) = -0.00317855349590354
cycle= 10 E= -2098.44645424027  delta_E= 0.0034  |g|= 0.188  |ddm|= 0.059
HOMO (E2gy) = 0.0246398662716732  LUMO (A1u) = 0.000522012899433831
cycle= 11 E= -2098.44346869207  delta_E= 0.00299  |g|= 0.179  |ddm|= 0.12
HOMO (E2gy) = 0.0189062979587087  LUMO (A1u) = -0.000945345046491172
cycle= 12 E= -2098.44824771108  delta_E= -0.00478  |g|= 0.179  |ddm|= 0.145
HOMO (E2gy) = 0.0310396797423128  LUMO (A1u) = 0.00262733124558066
cycle= 13 E= -2098.44478935115  delta_E= 0.00346  |g|= 0.176  |ddm|= 0.11
HOMO (E2gy) = 0.0326495078406042  LUMO (A1u) = 0.00254731356787219
cycle= 14 E= -2098.44449116261  delta_E= 0.000298  |g|= 0.174  |ddm|= 0.0303
HOMO (E2gy) = 0.0266540637204241  LUMO (A1u) = 0.000148977350038742
cycle= 15 E= -2098.44672281812  delta_E= -0.00223  |g|= 0.174  |ddm|= 0.0775
HOMO (E2gy) = 0.0219722228619843  LUMO (A1u) = -0.00191702378729052
cycle= 16 E= -2098.44859212129  delta_E= -0.00187  |g|= 0.174  |ddm|= 0.175
HOMO (E2gy) = 0.0189422065760166  LUMO (A1u) = -0.0034109000278822
cycle= 17 E= -2098.449538207  delta_E= -0.000946  |g|= 0.172  |ddm|= 0.164
HOMO (E2gy) = 0.0238006425868683  LUMO (A1u) = -0.00123741228041559
cycle= 18 E= -2098.44824221706  delta_E= 0.0013  |g|= 0.17  |ddm|= 0.118
HOMO (E2gy) = 0.0160949501809123  LUMO (A1u) = -0.00443214673967803
cycle= 19 E= -2098.44787165664  delta_E= 0.000371  |g|= 0.174  |ddm|= 0.169
HOMO (E2gy) = 0.0195695083382391  LUMO (A1u) = -0.00297441709522787
cycle= 20 E= -2098.44736599011  delta_E= 0.000506  |g|= 0.172  |ddm|= 0.0583
HOMO (E2gy) = 0.0220214883613821  LUMO (A1u) = -0.00300455642108154
cycle= 21 E= -2098.44663947663  delta_E= 0.000727  |g|= 0.17  |ddm|= 0.0795
HOMO (E2gy) = 0.0215731754078044  LUMO (A1u) = -0.00322550873292036
cycle= 22 E= -2098.44684133947  delta_E= -0.000202  |g|= 0.174  |ddm|= 0.0979
HOMO (E2gy) = 0.0198290034080271  LUMO (A1u) = -0.00383802800347452
cycle= 23 E= -2098.44511846381  delta_E= 0.00172  |g|= 0.185  |ddm|= 0.156
HOMO (E2gy) = 0.0171438461824204  LUMO (A1u) = -0.00264019367933424
cycle= 24 E= -2098.44934720257  delta_E= -0.00423  |g|= 0.178  |ddm|= 0.0556
HOMO (E2gy) = 0.0221678460716225  LUMO (A1u) = -0.000577182540642203
cycle= 25 E= -2098.44381487775  delta_E= 0.00553  |g|= 0.181  |ddm|= 0.105
HOMO (E2gy) = 0.0251266989495663  LUMO (A1u) = -0.000895389599097993
cycle= 26 E= -2098.4339783483  delta_E= 0.00984  |g|= 0.194  |ddm|= 0.382
HOMO (E2gy) = 0.0279398794168537  LUMO (A1u) = 0.000175566492264759
cycle= 27 E= -2098.43494631755  delta_E= -0.000968  |g|= 0.191  |ddm|= 0.0975
HOMO (E2gy) = 0.0255398204292158  LUMO (A1u) = -0.00183086422005672
cycle= 28 E= -2098.42269715157  delta_E= 0.0122  |g|= 0.167  |ddm|= 1.52
HOMO (E2gy) = 0.0504656333374911  LUMO (A1u) = -0.00209156839769598
cycle= 29 E= -2098.41474467411  delta_E= 0.00795  |g|= 0.191  |ddm|= 1.53
HOMO (E2gy) = 0.044803003046285  LUMO (A1u) = -0.00339932193987716
cycle= 30 E= -2098.41942764132  delta_E= -0.00468  |g|= 0.184  |ddm|= 0.0514
HOMO (E2gy) = 0.0428614583012707  LUMO (A1u) = -0.0042052529388605
cycle= 31 E= -2098.41983688838  delta_E= -0.000409  |g|= 0.184  |ddm|= 0.0343
HOMO (E2gy) = 0.0396969753852061  LUMO (A1u) = -0.00502187671364291
cycle= 32 E= -2098.42276608116  delta_E= -0.00293  |g|= 0.177  |ddm|= 0.147
SCF not converged.
SCF energy = -2098.42276608116
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp7jk6ogkx
max_memory 4000 MB (current use 999 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2ux E2uy E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.666110656076
CASCI E = -2098.66611065608  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -29.383066152475
2 -1
State   0 energy     -29.436702640763
3 -1
State   0 energy     -29.469139643001
4 -1
State   0 energy   -2098.844912970550
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.84491297055  dE = -0.17880231  S^2 = 0.0000000
               |grad[o]|=0.378  |ddm|=0.365  |maxRot[o]|=0.227
5 -1
State   0 energy     -29.621544867845
6 -1
State   0 energy     -29.658360450297
7 -1
State   0 energy     -29.702776505115
8 -1
State   0 energy   -2098.996390786399
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.9963907864  dE = -0.15147782  S^2 = 0.0000000
               |grad[o]|= 0.15  |ddm|=0.277  |maxRot[o]|=0.306
9 -1
State   0 energy     -29.822857343685
10 -1
State   0 energy     -29.858298500206
11 -1
State   0 energy     -29.891143660367
12 -1
State   0 energy   -2099.135684118219
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.13568411822  dE = -0.13929333  S^2 = 0.0000000
               |grad[o]|=0.163  |ddm|=0.181  |maxRot[o]|=0.308
13 -1
State   0 energy     -29.962721879005
14 -1
State   0 energy     -29.989185799846
15 -1
State   0 energy     -30.013380136240
16 -1
State   0 energy   -2099.235032195528
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.23503219553  dE = -0.099348077  S^2 = 0.0000000
               |grad[o]|=0.146  |ddm|=0.214  |maxRot[o]|=0.309
17 -1
State   0 energy     -30.071412310164
18 -1
State   0 energy     -30.084291816150
19 -1
State   0 energy     -30.088681862113
20 -1
State   0 energy   -2099.272646239321
macro iter 5 (17 JK  4 micro), CASSCF E = -2099.27264623932  dE = -0.037614044  S^2 = 0.0000000
               |grad[o]|=0.105  |ddm|=0.158  |maxRot[o]|=0.227
21 -1
State   0 energy     -30.109740500349
22 -1
State   0 energy     -30.109740966136
23 -1
State   0 energy     -30.109741022361
24 -1
State   0 energy   -2099.272656172298
macro iter 6 (9 JK  3 micro), CASSCF E = -2099.2726561723  dE = -9.9329777e-06  S^2 = 0.0000000
               |grad[o]|=0.00377  |ddm|=0.00123  |maxRot[o]|=0.00214
25 -1
State   0 energy     -30.107772327549
26 -1
State   0 energy   -2099.272656172298
macro iter 7 (1 JK  1 micro), CASSCF E = -2099.2726561723  dE = 0  S^2 = 0.0000000
               |grad[o]|=1.71e-05  |ddm|=6.84e-05  |maxRot[o]|=    0
1-step CASSCF converged in 7 macro (111 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.5910236  1.62433546 1.62433547 1.82946795 0.73412229 0.73412492
 1.26576227 0.18044198 1.26576487 0.37590623 0.37590623 0.39880873]
CASSCF energy = -2099.2726561723
CASCI E = -2099.2726561723  E(CI) = -30.1077723259132  S^2 = 0.0000000
energy =  -2099.2726561722984
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 15, 14, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 5, 2, 3, 5, 10, 11, 6, 7, 0, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 5, 0, 6, 7, 14, 15, 2, 3, 0, 2, 3, 5, 10, 11, 16, 17, 12, 13, 6, 7, 5, 0, 14, 15, 2, 3, 0, 6, 7, 10, 11, 5, 6, 7, 0, 2, 3, 14, 15, 5, 0, 2, 3, 10, 11, 16, 17, 6, 7, 20, 21, 0, 5, 24, 25, 12, 13, 5, 16, 17, 12, 13, 10, 11, 14, 15, 2, 3, 14, 15, 6, 7, 0, 2, 3, 5, 6, 7, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 0, 5, 0, 5, 6, 7, 10, 11, 0, 16, 17, 20, 21, 26, 27, 22, 23, 24, 25, 12, 13, 14, 15, 5, 2, 3, 5, 6, 7, 10, 11, 0, 16, 17, 16, 17, 12, 13, 20, 21, 24, 25, 14, 15, 10, 11, 12, 13, 2, 3, 14, 15, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 63 64 65 66 73 74 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 11:54:58 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.000000000000 AA    0.000000000000   0.000000000000   1.889726124565 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.000000000000 AA    0.000000000000   0.000000000000  -1.889726124565 Bohr   0.0

nuclear repulsion = 152.40303674496
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     51090.01


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmptt5jfe84
max_memory 4000 MB (current use 2889 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.08791120791
HOMO (E2ux) = -0.203881932284524  LUMO (E2ux) = -0.203881932284524
cycle= 1 E= -2098.40771943221  delta_E= -0.32  |g|= 0.846  |ddm|= 2.69
HOMO (E2ux) = 0.144997720516085  LUMO (A1u) = 0.0144447024427165
cycle= 2 E= -2098.31787653816  delta_E= 0.0898  |g|= 1.16  |ddm|=  1.2
HOMO (E2ux) = -0.0496684017785782  LUMO (E2ux) = -0.0496684017785782
cycle= 3 E= -2098.53514847406  delta_E= -0.217  |g|= 0.151  |ddm|= 0.971
HOMO (E2ux) = -0.0474028859236567  LUMO (E2ux) = -0.0474028859236567
cycle= 4 E= -2098.53488721738  delta_E= 0.000261  |g|= 0.155  |ddm|= 0.267
HOMO (E2ux) = -0.0508839216726095  LUMO (E2ux) = -0.0508839216726095
cycle= 5 E= -2098.53600369347  delta_E= -0.00112  |g|= 0.147  |ddm|= 0.0984
HOMO (E2ux) = -0.0504090137130034  LUMO (E2ux) = -0.0504090137130034
cycle= 6 E= -2098.53587570498  delta_E= 0.000128  |g|= 0.148  |ddm|= 0.0174
HOMO (E2ux) = -0.0525971706292609  LUMO (E2ux) = -0.0525971706292609
cycle= 7 E= -2098.53628769006  delta_E= -0.000412  |g|= 0.147  |ddm|= 0.0678
HOMO (E2ux) = -0.0549323848678766  LUMO (E2ux) = -0.0549323848678766
cycle= 8 E= -2098.53796555201  delta_E= -0.00168  |g|= 0.146  |ddm|= 0.0838
HOMO (E2ux) = -0.0546751570311172  LUMO (E2ux) = -0.0546751570311172
cycle= 9 E= -2098.53891589987  delta_E= -0.00095  |g|= 0.143  |ddm|= 0.0473
HOMO (E2ux) = -0.0551012677161807  LUMO (E2ux) = -0.0551012677161807
cycle= 10 E= -2098.53952900182  delta_E= -0.000613  |g|= 0.144  |ddm|= 0.0382
HOMO (E2ux) = -0.0575419961982363  LUMO (E2ux) = -0.0575419961982363
cycle= 11 E= -2098.53984979627  delta_E= -0.000321  |g|= 0.142  |ddm|= 0.0286
HOMO (E2ux) = -0.0597183929233681  LUMO (E2ux) = -0.0597183929233681
cycle= 12 E= -2098.54028517091  delta_E= -0.000435  |g|= 0.136  |ddm|= 0.0492
HOMO (E2ux) = -0.0596919887424129  LUMO (E2ux) = -0.0596919887424129
cycle= 13 E= -2098.54033129986  delta_E= -4.61e-05  |g|= 0.136  |ddm|= 0.00839
HOMO (E2ux) = -0.0575155442086546  LUMO (E2ux) = -0.0575155442086546
cycle= 14 E= -2098.54007271252  delta_E= 0.000259  |g|= 0.139  |ddm|= 0.0554
HOMO (E2ux) = -0.0568610184868373  LUMO (E2ux) = -0.0568610184868373
cycle= 15 E= -2098.53967012047  delta_E= 0.000403  |g|= 0.14  |ddm|= 0.0328
HOMO (E2ux) = -0.0581980684408751  LUMO (E2ux) = -0.0581980684408751
cycle= 16 E= -2098.53955667768  delta_E= 0.000113  |g|= 0.14  |ddm|= 0.0215
HOMO (E2ux) = -0.0576248617837007  LUMO (E2ux) = -0.0576248617837007
cycle= 17 E= -2098.5393309389  delta_E= 0.000226  |g|= 0.139  |ddm|= 0.0355
HOMO (E2ux) = -0.0577359650683508  LUMO (E2ux) = -0.0577359650683508
cycle= 18 E= -2098.53999323518  delta_E= -0.000662  |g|= 0.139  |ddm|= 0.0353
HOMO (E2ux) = -0.0621744247400442  LUMO (E2ux) = -0.0621744247400442
cycle= 19 E= -2098.53989840653  delta_E= 9.48e-05  |g|= 0.136  |ddm|= 0.0481
HOMO (E2ux) = -0.0562201484305374  LUMO (E2ux) = -0.0562201484305374
cycle= 20 E= -2098.53963840887  delta_E= 0.00026  |g|= 0.142  |ddm|= 0.0324
HOMO (E2ux) = -0.054432492072856  LUMO (E2ux) = -0.054432492072856
cycle= 21 E= -2098.53993118032  delta_E= -0.000293  |g|= 0.144  |ddm|= 0.0312
HOMO (E2ux) = -0.0539376106628381  LUMO (E2ux) = -0.0539376106628381
cycle= 22 E= -2098.54005920998  delta_E= -0.000128  |g|= 0.142  |ddm|= 0.0478
HOMO (E2ux) = -0.0541666752667604  LUMO (E2ux) = -0.0541666752667604
cycle= 23 E= -2098.54009422935  delta_E= -3.5e-05  |g|= 0.142  |ddm|= 0.0115
HOMO (E2ux) = -0.0612666064426645  LUMO (E2ux) = -0.0612666064426645
cycle= 24 E= -2098.5403256819  delta_E= -0.000231  |g|= 0.136  |ddm|= 0.0511
HOMO (E2ux) = -0.0622487228605926  LUMO (E2ux) = -0.0622487228605926
cycle= 25 E= -2098.54044846184  delta_E= -0.000123  |g|= 0.135  |ddm|= 0.026
HOMO (E2ux) = -0.0626166295514275  LUMO (E2ux) = -0.0626166295514275
cycle= 26 E= -2098.54050446669  delta_E= -5.6e-05  |g|= 0.136  |ddm|= 0.0133
HOMO (E2ux) = -0.0607843269478934  LUMO (E2ux) = -0.0607843269478934
cycle= 27 E= -2098.54016412363  delta_E= 0.00034  |g|= 0.137  |ddm|= 0.0433
HOMO (E2ux) = -0.0615893216654747  LUMO (E2ux) = -0.0615893216654747
cycle= 28 E= -2098.53995824427  delta_E= 0.000206  |g|= 0.136  |ddm|= 0.0154
HOMO (E2ux) = -0.0581301585468571  LUMO (E2ux) = -0.0581301585468571
cycle= 29 E= -2098.53986083584  delta_E= 9.74e-05  |g|= 0.139  |ddm|= 0.0993
HOMO (E2ux) = -0.0588956485454718  LUMO (E2ux) = -0.0588956485454718
cycle= 30 E= -2098.53936403551  delta_E= 0.000497  |g|= 0.138  |ddm|= 0.0514
HOMO (E2ux) = -0.0598698791754891  LUMO (E2ux) = -0.0598698791754891
cycle= 31 E= -2098.53982740696  delta_E= -0.000463  |g|= 0.138  |ddm|= 0.0746
HOMO (E2ux) = -0.0643731543375212  LUMO (E2ux) = -0.0643731543375212
cycle= 32 E= -2098.54049396785  delta_E= -0.000667  |g|= 0.134  |ddm|= 0.082
SCF not converged.
SCF energy = -2098.54049396785
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmptt5jfe84
max_memory 4000 MB (current use 999 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2gx E2gy E2uy E2ux A1u E1gx E1gy A1u
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.756418442703
CASCI E = -2098.7564184427  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.883626381603
2 -1
State   0 energy     -28.918077435694
3 -1
State   0 energy     -28.957490241426
4 -1
State   0 energy   -2098.903636605526
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.90363660553  dE = -0.14721816  S^2 = 0.0000000
               |grad[o]|=0.214  |ddm|=0.183  |maxRot[o]|=0.311
5 -1
State   0 energy     -29.105267235744
6 -1
State   0 energy     -29.159091551797
7 -1
State   0 energy     -29.216852259949
8 -1
State   0 energy   -2099.119100878994
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.11910087899  dE = -0.21546427  S^2 = 0.0000000
               |grad[o]|=0.197  |ddm|=0.376  |maxRot[o]|=0.312
9 -1
State   0 energy     -29.388620212076
10 -1
State   0 energy     -29.429847312264
11 -1
State   0 energy     -29.461488707771
12 -1
State   0 energy   -2099.259872480506
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.25987248051  dE = -0.1407716  S^2 = 0.0000000
               |grad[o]|=0.191  |ddm|= 0.38  |maxRot[o]|=0.281
13 -1
State   0 energy     -29.596402772869
14 -1
State   0 energy     -29.600993856453
15 -1
State   0 energy     -29.601315036519
16 -1
State   0 energy   -2099.278335028137
macro iter 4 (15 JK  4 micro), CASSCF E = -2099.27833502814  dE = -0.018462548  S^2 = 0.0000000
               |grad[o]|=0.0832  |ddm|=0.101  |maxRot[o]|=0.175
17 -1
State   0 energy     -29.627456525992
18 -1
State   0 energy     -29.627456649517
19 -1
State   0 energy     -29.627456676450
20 -1
State   0 energy   -2099.278340468969
macro iter 5 (8 JK  3 micro), CASSCF E = -2099.27834046897  dE = -5.440832e-06  S^2 = 0.0000000
               |grad[o]|=0.00184  |ddm|=0.00123  |maxRot[o]|=0.00379
21 -1
State   0 energy     -29.627497797952
22 -1
State   0 energy   -2099.278340470092
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.27834047009  dE = -1.1236807e-09  S^2 = 0.0000000
               |grad[o]|=3.48e-05  |ddm|=4.16e-05  |maxRot[o]|=6.26e-05
1-step CASSCF converged in 6 macro (89 JK 20 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.51993722 1.51169746 1.51169654 1.77036297 1.17759656 1.17759465
 0.82232827 0.82232633 0.17740406 0.48843202 0.4884311  0.53219282]
CASSCF energy = -2099.27834047009
CASCI E = -2099.27834047009  E(CI) = -29.6275134152365  S^2 = 0.0000000
energy =  -2099.278340470092
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 10, 11, 14, 15, 5, 2, 3, 5, 6, 7, 0, 5, 0, 2, 3, 5, 10, 11, 6, 7, 0, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 5, 0, 6, 7, 14, 15, 2, 3, 0, 2, 3, 5, 10, 11, 16, 17, 12, 13, 6, 7, 5, 0, 14, 15, 2, 3, 0, 6, 7, 10, 11, 6, 7, 5, 0, 2, 3, 14, 15, 5, 2, 3, 0, 10, 11, 16, 17, 6, 7, 5, 20, 21, 0, 24, 25, 12, 13, 5, 16, 17, 14, 15, 10, 11, 12, 13, 2, 3, 14, 15, 6, 7, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 2, 3, 0, 5, 0, 5, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 26, 27, 22, 23, 24, 25, 12, 13, 14, 15, 2, 3, 5, 6, 7, 0, 10, 11, 16, 17, 16, 17, 12, 13, 20, 21, 10, 11, 14, 15, 24, 25, 12, 13, 2, 3, 5, 14, 15, 6, 7, 2, 3, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 63 64 65 66 73 74 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 12:13:00 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.100000000000 AA    0.000000000000   0.000000000000   2.078698737022 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.100000000000 AA    0.000000000000   0.000000000000  -2.078698737022 Bohr   0.0

nuclear repulsion = 138.548215222691
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     57915.62


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpx6t7g041
max_memory 4000 MB (current use 2890 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.88905611314
HOMO (E2ux) = -0.19657146621035  LUMO (E2ux) = -0.19657146621035
cycle= 1 E= -2098.31400101358  delta_E= -0.425  |g|= 0.779  |ddm|= 2.66
HOMO (E2ux) = 0.316318705531385  LUMO (A1u) = 0.0114122313615953
cycle= 2 E= -2098.10022408687  delta_E= 0.214  |g|= 1.11  |ddm|= 2.58
HOMO (E2ux) = 0.118862675793191  LUMO (A1u) = -0.00608350971314058
cycle= 3 E= -2098.29140400566  delta_E= -0.191  |g|= 0.205  |ddm|= 2.61
HOMO (E2ux) = 0.0812943961919851  LUMO (A1u) = -0.00783609651218548
cycle= 4 E= -2098.33475248893  delta_E= -0.0433  |g|= 0.156  |ddm|= 0.459
HOMO (E2ux) = 0.0801809706061164  LUMO (A1u) = -0.00633019250652945
cycle= 5 E= -2098.34046705583  delta_E= -0.00571  |g|= 0.157  |ddm|= 0.143
HOMO (E2ux) = 0.0730762337483115  LUMO (A1u) = -0.00954072149952531
cycle= 6 E= -2098.34453650139  delta_E= -0.00407  |g|= 0.151  |ddm|= 0.11
HOMO (E2ux) = 0.0753520496702974  LUMO (A1u) = -0.00882906582583252
cycle= 7 E= -2098.34340335364  delta_E= 0.00113  |g|= 0.153  |ddm|= 0.0292
HOMO (E2ux) = 0.0746103507932245  LUMO (A1u) = -0.00911026049638533
cycle= 8 E= -2098.34358696681  delta_E= -0.000184  |g|= 0.152  |ddm|= 0.0666
HOMO (E2ux) = 0.0782088166398502  LUMO (A1u) = -0.0086898105775704
cycle= 9 E= -2098.3416592076  delta_E= 0.00193  |g|= 0.157  |ddm|= 0.293
HOMO (E2ux) = 0.0700972929502139  LUMO (A1u) = -0.00658686600505763
cycle= 10 E= -2098.3456871225  delta_E= -0.00403  |g|= 0.147  |ddm|= 0.463
HOMO (E2ux) = 0.0746309156177763  LUMO (A1u) = -0.0048727799429651
cycle= 11 E= -2098.3438688967  delta_E= 0.00182  |g|= 0.151  |ddm|= 0.737
HOMO (E2ux) = 0.0731384258010351  LUMO (A1u) = -0.00447678532324504
cycle= 12 E= -2098.34381192166  delta_E= 5.7e-05  |g|= 0.147  |ddm|= 0.274
HOMO (E2ux) = 0.0718885474965498  LUMO (A1u) = -0.00484361124249646
cycle= 13 E= -2098.34501455281  delta_E= -0.0012  |g|= 0.146  |ddm|= 0.293
HOMO (E2ux) = 0.070790542501896  LUMO (A1u) = -0.00525562795666555
cycle= 14 E= -2098.34540533846  delta_E= -0.000391  |g|= 0.145  |ddm|= 0.195
HOMO (E2ux) = 0.0720807669189232  LUMO (A1u) = -0.0056289561242124
cycle= 15 E= -2098.34380198899  delta_E= 0.0016  |g|= 0.15  |ddm|= 0.342
HOMO (E2ux) = 0.072116381368257  LUMO (A1u) = -0.00553917941066583
cycle= 16 E= -2098.34387361339  delta_E= -7.16e-05  |g|= 0.15  |ddm|= 0.039
HOMO (E2ux) = 0.0710600943541651  LUMO (A1u) = -0.00490673295187337
cycle= 17 E= -2098.3433995205  delta_E= 0.000474  |g|= 0.148  |ddm|= 0.563
HOMO (E2ux) = 0.0654595413056267  LUMO (A1u) = -0.00807677219020432
cycle= 18 E= -2098.34715778494  delta_E= -0.00376  |g|= 0.143  |ddm|= 0.503
HOMO (E2ux) = 0.0668650706819684  LUMO (A1u) = -0.00823131230799553
cycle= 19 E= -2098.3474216857  delta_E= -0.000264  |g|= 0.145  |ddm|= 0.132
HOMO (E2ux) = 0.0653376453543294  LUMO (A1u) = -0.0086589230405841
cycle= 20 E= -2098.34811747304  delta_E= -0.000696  |g|= 0.143  |ddm|= 0.141
HOMO (E2ux) = 0.0663499062537145  LUMO (A1u) = -0.00823435151387143
cycle= 21 E= -2098.34802861069  delta_E= 8.89e-05  |g|= 0.143  |ddm|= 0.0649
HOMO (E2ux) = 0.0666569268673272  LUMO (A1u) = -0.00813321090478598
cycle= 22 E= -2098.34806212364  delta_E= -3.35e-05  |g|= 0.144  |ddm|= 0.0941
HOMO (E2ux) = 0.0664795216703844  LUMO (A1u) = -0.00829083168367609
cycle= 23 E= -2098.34812339139  delta_E= -6.13e-05  |g|= 0.144  |ddm|= 0.0744
HOMO (E2ux) = 0.0627909530890708  LUMO (A1u) = -0.00974271296505896
cycle= 24 E= -2098.34915188739  delta_E= -0.00103  |g|= 0.143  |ddm|= 0.0562
HOMO (E2ux) = 0.0612938875629249  LUMO (A1u) = -0.00948766964504861
cycle= 25 E= -2098.34920861941  delta_E= -5.67e-05  |g|= 0.141  |ddm|= 0.536
HOMO (E2ux) = 0.0584504301351347  LUMO (A1u) = -0.0106540772122444
cycle= 26 E= -2098.35057522548  delta_E= -0.00137  |g|= 0.14  |ddm|= 0.441
HOMO (E2ux) = 0.0591495695237863  LUMO (A1u) = -0.0105089371828704
cycle= 27 E= -2098.35039812771  delta_E= 0.000177  |g|= 0.14  |ddm|= 0.139
HOMO (E2ux) = 0.0592346640823877  LUMO (A1u) = -0.0104980816893599
cycle= 28 E= -2098.35041133078  delta_E= -1.32e-05  |g|= 0.14  |ddm|= 0.0861
HOMO (E2ux) = 0.0592623036977964  LUMO (A1u) = -0.0104640414688663
cycle= 29 E= -2098.35048187608  delta_E= -7.05e-05  |g|= 0.14  |ddm|= 0.0275
HOMO (E2ux) = 0.0591678655267175  LUMO (A1u) = -0.0105641263021382
cycle= 30 E= -2098.3505069047  delta_E= -2.5e-05  |g|= 0.14  |ddm|= 0.00736
HOMO (E2ux) = 0.0592709175411661  LUMO (A1u) = -0.0106422868822541
cycle= 31 E= -2098.3505359767  delta_E= -2.91e-05  |g|= 0.14  |ddm|= 0.0667
HOMO (E2ux) = 0.0581321368464277  LUMO (A1u) = -0.0111265380475418
cycle= 32 E= -2098.35071536227  delta_E= -0.000179  |g|= 0.141  |ddm|= 0.208
SCF not converged.
SCF energy = -2098.35071536227
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpx6t7g041
max_memory 4000 MB (current use 1000 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2gx E2gy E1uy E1ux A1g A1g E2ux A1u E2uy E1gx E1gy A1u
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.679493345469
CASCI E = -2098.67949334547  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -27.957192638878
2 -1
State   0 energy     -28.004507906786
3 -1
State   0 energy     -28.057525596033
4 -1
State   0 energy   -2098.874965162853
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.87496516285  dE = -0.19547182  S^2 = 0.0000000
               |grad[o]|=0.305  |ddm|=0.503  |maxRot[o]|=0.312
5 -1
State   0 energy     -28.218107506937
6 -1
State   0 energy     -28.267840466644
7 -1
State   0 energy     -28.311734392337
8 -1
State   0 energy   -2099.066806318870
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.06680631887  dE = -0.19184116  S^2 = 0.0000000
               |grad[o]|=0.267  |ddm|=  0.5  |maxRot[o]|=0.313
9 -1
State   0 energy     -28.512031685085
10 -1
State   0 energy     -28.543812370772
11 -1
State   0 energy     -28.579888982056
12 -1
State   0 energy   -2099.192546467716
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.19254646772  dE = -0.12574015  S^2 = 0.0000000
               |grad[o]|=0.168  |ddm|=0.526  |maxRot[o]|=0.298
13 -1
State   0 energy     -28.663420280388
14 -1
State   0 energy     -28.683489243745
15 -1
State   0 energy     -28.700001949438
16 -1
State   0 energy   -2099.266990076369
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.26699007637  dE = -0.074443609  S^2 = 0.0000000
               |grad[o]|=0.143  |ddm|=0.226  |maxRot[o]|=0.311
17 -1
State   0 energy     -28.768069991013
18 -1
State   0 energy     -28.775424384159
19 -1
State   0 energy     -28.780060867617
20 -1
State   0 energy   -2099.292559419873
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.29255941987  dE = -0.025569344  S^2 = 0.0000000
               |grad[o]|=0.0895  |ddm|= 0.12  |maxRot[o]|=0.311
21 -1
State   0 energy     -28.800196917275
22 -1
State   0 energy     -28.800210221570
23 -1
State   0 energy     -28.800210842448
24 -1
State   0 energy   -2099.292890513208
macro iter 6 (12 JK  4 micro), CASSCF E = -2099.29289051321  dE = -0.00033109333  S^2 = 0.0000000
               |grad[o]|=0.0157  |ddm|=0.0163  |maxRot[o]|=0.0121
25 -1
State   0 energy     -28.797941576275
26 -1
State   0 energy   -2099.292890529531
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.29289052953  dE = -1.6323156e-08  S^2 = 0.0000000
               |grad[o]|=0.000127  |ddm|=3.33e-05  |maxRot[o]|=0.000108
1-step CASSCF converged in 7 macro (120 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.09110726 1.09110612 1.32455032 1.32454979 1.78491419 1.30479774
 0.90887999 0.44090647 0.90888114 0.67547813 0.6754776  0.46935128]
CASSCF energy = -2099.29289052953
CASCI E = -2099.29289052953  E(CI) = -28.7978341643211  S^2 = 0.0000000
energy =  -2099.292890529531
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 10, 11, 6, 7, 0, 0, 15, 5, 14, 2, 3, 5, 6, 7, 0, 0, 2, 3, 5, 5, 10, 11, 0, 6, 7, 6, 7, 14, 15, 2, 3, 0, 5, 2, 3, 0, 5, 10, 11, 0, 6, 7, 5, 6, 7, 2, 3, 14, 15, 0, 2, 3, 5, 10, 11, 16, 17, 12, 13, 6, 7, 5, 0, 14, 15, 2, 3, 0, 6, 7, 10, 11, 6, 7, 5, 2, 3, 0, 14, 15, 5, 2, 3, 0, 5, 10, 11, 6, 7, 16, 17, 5, 0, 20, 21, 24, 25, 12, 13, 14, 15, 16, 17, 10, 11, 12, 13, 2, 3, 14, 15, 6, 7, 5, 2, 3, 5, 0, 6, 7, 0, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 0, 5, 5, 0, 6, 7, 10, 11, 16, 17, 12, 13, 20, 21, 24, 25, 14, 15, 26, 27, 22, 23, 2, 3, 5, 6, 7, 0, 10, 11, 10, 11, 16, 17, 16, 17, 12, 13, 14, 15, 20, 21, 24, 25, 2, 3, 12, 13, 5, 6, 7, 14, 15, 2, 3, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 58
 59 60 63 64 65 66 73 74 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 12:37:12 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.250000000000 AA    0.000000000000   0.000000000000   2.362157655706 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.250000000000 AA    0.000000000000   0.000000000000  -2.362157655706 Bohr   0.0

nuclear repulsion = 121.922429395968
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     65399.63


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpsawbihpx
max_memory 4000 MB (current use 2890 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.67365452768
HOMO (E2ux) = -0.190174940704274  LUMO (E2ux) = -0.190174940704274
cycle= 1 E= -2098.19318110381  delta_E= -0.52  |g|= 0.761  |ddm|= 2.65
HOMO (E2gy) = 0.20530976481882  LUMO (E2ux) = -0.0072308018176629
cycle= 2 E= -2097.81365579066  delta_E= 0.38  |g|=  1.4  |ddm|= 2.41
HOMO (E2gy) = 0.0477244053962362  LUMO (A1u) = -0.025937845337718
cycle= 3 E= -2098.04901624628  delta_E= -0.235  |g|= 0.643  |ddm|= 2.21
HOMO (E2gy) = 0.0554465171672628  LUMO (A1u) = -0.0184872670517534
cycle= 4 E= -2098.10609277812  delta_E= -0.0571  |g|= 0.347  |ddm|= 0.207
HOMO (E2gy) = 0.0417927259872537  LUMO (A1u) = -0.0108825502200022
cycle= 5 E= -2098.16048199935  delta_E= -0.0544  |g|= 0.18  |ddm|= 0.329
HOMO (E2gy) = 0.0234141918940582  LUMO (A1u) = -0.0109549568202919
cycle= 6 E= -2098.18203742073  delta_E= -0.0216  |g|= 0.136  |ddm|= 0.261
HOMO (E2gy) = 0.0174228725832993  LUMO (A1u) = -0.0135357339954767
cycle= 7 E= -2098.18443271961  delta_E= -0.0024  |g|= 0.134  |ddm|= 0.0927
HOMO (E2gy) = 0.0169756740876286  LUMO (A1u) = -0.0137237462582598
cycle= 8 E= -2098.18476138179  delta_E= -0.000329  |g|= 0.132  |ddm|= 0.0163
HOMO (E2gy) = 0.0122359989229663  LUMO (A1u) = -0.01550320409355
cycle= 9 E= -2098.18515514465  delta_E= -0.000394  |g|= 0.133  |ddm|= 0.169
HOMO (A1g) = 0.0057540544932218  LUMO (A1u) = -0.01584256425204
cycle= 10 E= -2098.18372978245  delta_E= 0.00143  |g|= 0.133  |ddm|= 0.299
HOMO (E2gy) = 0.0164248746561193  LUMO (A1u) = -0.0154891634041806
cycle= 11 E= -2098.18120595675  delta_E= 0.00252  |g|= 0.135  |ddm|=  0.9
HOMO (E2gy) = 0.0148105734631228  LUMO (A1u) = -0.0155100103914551
cycle= 12 E= -2098.18338975971  delta_E= -0.00218  |g|= 0.128  |ddm|= 0.147
HOMO (E2gy) = 0.0130855071021427  LUMO (A1u) = -0.0169255070099806
cycle= 13 E= -2098.1835287421  delta_E= -0.000139  |g|= 0.131  |ddm|= 0.232
HOMO (E2gy) = 0.0154082813110162  LUMO (A1u) = -0.0154594504543573
cycle= 14 E= -2098.18305083949  delta_E= 0.000478  |g|= 0.128  |ddm|= 0.131
HOMO (E2gy) = 0.0154908734315612  LUMO (A1u) = -0.0156959183835454
cycle= 15 E= -2098.18321724149  delta_E= -0.000166  |g|= 0.128  |ddm|= 0.0731
HOMO (E2gy) = 0.0181292343912854  LUMO (A1u) = -0.0148042939297908
cycle= 16 E= -2098.18177846907  delta_E= 0.00144  |g|= 0.13  |ddm|= 0.198
HOMO (E2gy) = 0.0171406701528043  LUMO (A1u) = -0.0152123165026448
cycle= 17 E= -2098.18165891263  delta_E= 0.00012  |g|= 0.13  |ddm|= 0.0554
HOMO (E2gy) = 0.0187574766271978  LUMO (A1u) = -0.0134563333437684
cycle= 18 E= -2098.18181415854  delta_E= -0.000155  |g|= 0.129  |ddm|= 0.434
HOMO (E2gy) = 0.0175376981647072  LUMO (A1u) = -0.0142383957075607
cycle= 19 E= -2098.18343317089  delta_E= -0.00162  |g|= 0.126  |ddm|= 0.357
HOMO (E2gy) = 0.0196733090727812  LUMO (A1u) = -0.0129793860287416
cycle= 20 E= -2098.18272756602  delta_E= 0.000706  |g|= 0.126  |ddm|= 0.274
HOMO (E2gy) = 0.020857520045792  LUMO (A1u) = -0.0122443226870906
cycle= 21 E= -2098.18216334431  delta_E= 0.000564  |g|= 0.126  |ddm|= 0.0576
HOMO (E2gy) = 0.0198025462408722  LUMO (A1u) = -0.0134729600997623
cycle= 22 E= -2098.18214019861  delta_E= 2.31e-05  |g|= 0.126  |ddm|= 0.164
HOMO (E2gy) = 0.0185433709547744  LUMO (A1u) = -0.0138052238170858
cycle= 23 E= -2098.18250845585  delta_E= -0.000368  |g|= 0.125  |ddm|= 0.106
HOMO (E2gy) = 0.0183532524907187  LUMO (A1u) = -0.0139117376130352
cycle= 24 E= -2098.18253956589  delta_E= -3.11e-05  |g|= 0.125  |ddm|= 0.0356
HOMO (E2gy) = 0.0222623606301371  LUMO (A1u) = -0.0120659630005997
cycle= 25 E= -2098.18117649075  delta_E= 0.00136  |g|= 0.127  |ddm|= 0.22
HOMO (E2gy) = 0.0191213059132848  LUMO (A1u) = -0.0141598721186952
cycle= 26 E= -2098.18194256033  delta_E= -0.000766  |g|= 0.127  |ddm|= 0.0677
HOMO (E2gy) = 0.0170497701549853  LUMO (A1u) = -0.0143864048444164
cycle= 27 E= -2098.18301581732  delta_E= -0.00107  |g|= 0.125  |ddm|= 0.0864
HOMO (E2gy) = 0.0187244075216165  LUMO (A1u) = -0.0137832033109611
cycle= 28 E= -2098.18220451777  delta_E= 0.000811  |g|= 0.125  |ddm|= 0.314
HOMO (E2gy) = 0.0176969815434375  LUMO (A1u) = -0.0143398383665602
cycle= 29 E= -2098.18302904027  delta_E= -0.000825  |g|= 0.125  |ddm|= 0.135
HOMO (E2gy) = 0.019022842864445  LUMO (A1u) = -0.0134808547239121
cycle= 30 E= -2098.18208827896  delta_E= 0.000941  |g|= 0.125  |ddm|= 0.0567
HOMO (E2gy) = 0.0187294244162153  LUMO (A1u) = -0.0136453802867416
cycle= 31 E= -2098.18219678143  delta_E= -0.000109  |g|= 0.125  |ddm|= 0.0356
HOMO (E2gy) = 0.018688425208238  LUMO (A1u) = -0.013767887966232
cycle= 32 E= -2098.18206508375  delta_E= 0.000132  |g|= 0.125  |ddm|= 0.0555
SCF not converged.
SCF energy = -2098.18206508375
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpsawbihpx
max_memory 4000 MB (current use 1000 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2uy E2ux A1g E1uy E1ux A1g E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.635619390060
CASCI E = -2098.63561939006  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -26.914433859856
2 -1
State   0 energy     -26.996908257383
3 -1
State   0 energy     -27.075969516618
4 -1
State   0 energy   -2098.942162340387
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.94216234039  dE = -0.30654295  S^2 = 0.0000000
               |grad[o]|=0.481  |ddm|=0.914  |maxRot[o]|=0.313
5 -1
State   0 energy     -27.295334156755
6 -1
State   0 energy     -27.348299246416
7 -1
State   0 energy     -27.397485413493
8 -1
State   0 energy   -2099.150029249224
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.15002924922  dE = -0.20786691  S^2 = 0.0000000
               |grad[o]|=0.319  |ddm|=0.995  |maxRot[o]|=0.298
9 -1
State   0 energy     -27.533385035603
10 -1
State   0 energy     -27.558338556218
11 -1
State   0 energy     -27.580193613544
12 -1
State   0 energy   -2099.249560036015
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.24956003601  dE = -0.099530787  S^2 = 0.0000000
               |grad[o]|=0.227  |ddm|=0.374  |maxRot[o]|=0.308
13 -1
State   0 energy     -27.683525706822
14 -1
State   0 energy     -27.695825479434
15 -1
State   0 energy     -27.705476850988
16 -1
State   0 energy   -2099.296695664567
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.29669566457  dE = -0.047135629  S^2 = 0.0000000
               |grad[o]|=0.125  |ddm|=0.175  |maxRot[o]|=0.312
17 -1
State   0 energy     -27.762524184695
18 -1
State   0 energy     -27.766721830511
19 -1
State   0 energy     -27.767791699794
20 -1
State   0 energy   -2099.310035086607
macro iter 5 (17 JK  4 micro), CASSCF E = -2099.31003508661  dE = -0.013339422  S^2 = 0.0000000
               |grad[o]|=0.0642  |ddm|=0.112  |maxRot[o]|=0.198
21 -1
State   0 energy     -27.789765444344
22 -1
State   0 energy     -27.789766226859
23 -1
State   0 energy     -27.789766293099
24 -1
State   0 energy   -2099.310069134195
macro iter 6 (10 JK  3 micro), CASSCF E = -2099.3100691342  dE = -3.4047589e-05  S^2 = 0.0000000
               |grad[o]|=0.00355  |ddm|=0.00494  |maxRot[o]|=0.00996
25 -1
State   0 energy     -27.788101743741
26 -1
State   0 energy   -2099.310069139164
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.31006913916  dE = -4.9690243e-09  S^2 = 0.0000000
               |grad[o]|=6.07e-05  |ddm|=6.81e-05  |maxRot[o]|=4.18e-05
1-step CASSCF converged in 7 macro (114 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [0.95694446 0.9569446  1.74131753 1.17199119 1.1719911  1.17201139
 1.04305615 0.50757228 1.043056   0.82802069 0.8280206  0.57907401]
CASSCF energy = -2099.31006913916
CASCI E = -2099.31006913916  E(CI) = -27.7881037004263  S^2 = 0.0000000
energy =  -2099.310069139164
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 14, 15, 0, 6, 7, 0, 11, 5, 10, 2, 3, 5, 6, 7, 0, 2, 3, 5, 0, 5, 10, 11, 0, 6, 7, 14, 15, 6, 7, 2, 3, 0, 2, 3, 5, 5, 0, 0, 10, 11, 6, 7, 5, 6, 7, 14, 15, 2, 3, 0, 2, 3, 5, 10, 11, 5, 16, 17, 6, 7, 12, 13, 0, 14, 15, 2, 3, 5, 0, 6, 7, 10, 11, 6, 7, 2, 3, 14, 15, 5, 0, 2, 3, 0, 5, 5, 6, 7, 10, 11, 0, 16, 17, 20, 21, 24, 25, 12, 13, 14, 15, 2, 3, 5, 10, 11, 16, 17, 12, 13, 6, 7, 14, 15, 0, 2, 3, 5, 0, 6, 7, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5, 0, 6, 7, 10, 11, 14, 15, 16, 17, 12, 13, 2, 3, 20, 21, 24, 25, 22, 23, 26, 27, 5, 0, 6, 7, 10, 11, 10, 11, 16, 17, 14, 15, 2, 3, 12, 13, 6, 7, 16, 17, 5, 12, 13, 20, 21, 24, 25, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 56 57 58
 59 60 63 64 65 66 74 75 78 79]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 13:00:30 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.400000000000 AA    0.000000000000   0.000000000000   2.645616574391 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.400000000000 AA    0.000000000000   0.000000000000  -2.645616574391 Bohr   0.0

nuclear repulsion = 108.859311960686
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     72753.83


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp58gdwc6i
max_memory 4000 MB (current use 2890 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.53050301008
HOMO (A1u) = -0.189435513194611  LUMO (E2ux) = -0.187004599711554
cycle= 1 E= -2098.05016033634  delta_E= -0.52  |g|= 0.643  |ddm|= 2.59
HOMO (E2gy) = 0.105993235318178  LUMO (A1u) = 0.0250363722421454
cycle= 2 E= -2097.94322505353  delta_E= 0.107  |g|= 1.26  |ddm|= 1.87
HOMO (E2gy) = -0.0255606066998125  LUMO (A1u) = -0.0124787271044165
cycle= 3 E= -2098.28468506789  delta_E= -0.341  |g|= 0.211  |ddm|= 1.03
HOMO (E2gy) = -0.014867197128617  LUMO (A1u) = -0.0129525000460131
cycle= 4 E= -2098.30809311909  delta_E= -0.0234  |g|= 0.117  |ddm|= 0.25
HOMO (E2gy) = -0.0066793087883778  LUMO (A1u) = -0.0138874849740485
cycle= 5 E= -2098.32922054707  delta_E= -0.0211  |g|= 0.074  |ddm|= 0.276
HOMO (E2gy) = -0.0168130983072267  LUMO (A1u) = -0.0161293820822116
cycle= 6 E= -2098.34617132643  delta_E= -0.017  |g|= 0.0587  |ddm|= 0.298
HOMO (E2gy) = -0.0271732568679652  LUMO (A1u) = -0.0201930783980986
cycle= 7 E= -2098.35189460542  delta_E= -0.00572  |g|= 0.0539  |ddm|= 0.185
HOMO (E2gy) = -0.0410566449343361  LUMO (A1u) = -0.0285478479897292
cycle= 8 E= -2098.35325486133  delta_E= -0.00136  |g|= 0.0213  |ddm|= 0.077
HOMO (E2gy) = -0.044246999330868  LUMO (A1u) = -0.0292851847900888
cycle= 9 E= -2098.3539012309  delta_E= -0.000646  |g|= 0.00953  |ddm|= 0.0954
HOMO (E2gy) = -0.0445116636404816  LUMO (A1u) = -0.0289969634863114
cycle= 10 E= -2098.35393669141  delta_E= -3.55e-05  |g|= 0.00401  |ddm|= 0.0223
HOMO (E2gy) = -0.0448620135777133  LUMO (A1u) = -0.0294463705655452
cycle= 11 E= -2098.35394412869  delta_E= -7.44e-06  |g|= 0.0018  |ddm|= 0.01
HOMO (E2gy) = -0.0453723571616854  LUMO (A1u) = -0.0296604615704588
cycle= 12 E= -2098.35394673073  delta_E= -2.6e-06  |g|= 0.000659  |ddm|= 0.00606
HOMO (E2gy) = -0.0455150793172812  LUMO (A1u) = -0.0297687966189108
cycle= 13 E= -2098.35394699039  delta_E= -2.6e-07  |g|= 0.000228  |ddm|= 0.00177
HOMO (E2gy) = -0.0455709492789253  LUMO (A1u) = -0.0298054217087278
cycle= 14 E= -2098.35394701907  delta_E= -2.87e-08  |g|= 4.96e-05  |ddm|= 0.00056
HOMO (E2gy) = -0.0455723161803057  LUMO (A1u) = -0.0298093348074245
cycle= 15 E= -2098.35394702073  delta_E= -1.66e-09  |g|= 9.74e-06  |ddm|= 0.000315
HOMO (E2gy) = -0.0455729033778657  LUMO (A1u) = -0.0298099021709191
cycle= 16 E= -2098.35394702084  delta_E= -1.07e-10  |g|= 2.26e-06  |ddm|= 2.93e-05
HOMO (E2gy) = -0.0455732904584579  LUMO (A1u) = -0.0298101065484534
Extra cycle  E= -2098.35394702085  delta_E= -6.37e-12  |g|= 1.32e-06  |ddm|= 1.29e-05
converged SCF energy = -2098.35394702085
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp58gdwc6i
max_memory 4000 MB (current use 1000 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E1uy E1ux E2gx E2gy A1u E2uy E2ux E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.816529850773
CASCI E = -2098.81652985077  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -26.223416381247
2 -1
State   0 energy     -26.249892757672
3 -1
State   0 energy     -26.270873870740
4 -1
State   0 energy   -2098.933944577871
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.93394457787  dE = -0.11741473  S^2 = 0.0000000
               |grad[o]|=0.366  |ddm|= 1.15  |maxRot[o]|=0.313
5 -1
State   0 energy     -26.398011814346
6 -1
State   0 energy     -26.426755220790
7 -1
State   0 energy     -26.511062423165
8 -1
State   0 energy   -2099.135540381869
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.13554038187  dE = -0.2015958  S^2 = 0.0000000
               |grad[o]|=0.227  |ddm|= 2.04  |maxRot[o]|=0.298
9 -1
State   0 energy     -26.674269892700
10 -1
State   0 energy     -26.708057557437
11 -1
State   0 energy     -26.736130596440
12 -1
State   0 energy   -2099.265012426079
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.26501242608  dE = -0.12947204  S^2 = 0.0000000
               |grad[o]|=0.343  |ddm|=0.206  |maxRot[o]|=0.314
13 -1
State   0 energy     -26.896636729287
14 -1
State   0 energy     -26.912468763070
15 -1
State   0 energy     -26.914841410148
16 -1
State   0 energy   -2099.317941950821
macro iter 4 (16 JK  4 micro), CASSCF E = -2099.31794195082  dE = -0.052929525  S^2 = 0.0000000
               |grad[o]|=0.199  |ddm|=0.101  |maxRot[o]|=0.197
17 -1
State   0 energy     -26.988456511854
18 -1
State   0 energy     -26.988457086593
19 -1
State   0 energy     -26.988456772888
20 -1
State   0 energy   -2099.318097306637
macro iter 5 (12 JK  4 micro), CASSCF E = -2099.31809730664  dE = -0.00015535582  S^2 = 0.0000000
               |grad[o]|=0.0101  |ddm|=0.00354  |maxRot[o]|=0.0105
21 -1
State   0 energy     -26.982586343219
22 -1
State   0 energy   -2099.318097316246
macro iter 6 (4 JK  1 micro), CASSCF E = -2099.31809731625  dE = -9.6083568e-09  S^2 = 0.0000000
               |grad[o]|=6.03e-05  |ddm|=8.02e-05  |maxRot[o]|=8.21e-05
1-step CASSCF converged in 6 macro (95 JK 21 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.13494976 0.88314823 1.65780582 1.09874872 1.0987495  1.02302312
 1.02302266 0.32408104 0.9769778  0.97697735 0.90125761 0.90125839]
CASSCF energy = -2099.31809731625
CASCI E = -2099.31809731625  E(CI) = -26.9825481576677  S^2 = 0.0000000
energy =  -2099.3180973162457
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 0, 6, 7, 10, 11, 5, 14, 15, 2, 3, 0, 6, 7, 5, 2, 3, 0, 5, 10, 11, 0, 6, 7, 14, 15, 6, 7, 2, 3, 5, 0, 2, 3, 5, 0, 5, 10, 11, 0, 6, 7, 6, 7, 2, 3, 14, 15, 0, 2, 3, 5, 5, 10, 11, 6, 7, 16, 17, 12, 13, 0, 14, 15, 2, 3, 5, 6, 7, 5, 0, 10, 11, 2, 3, 14, 15, 6, 7, 0, 2, 3, 0, 5, 5, 6, 7, 0, 10, 11, 20, 21, 24, 25, 16, 17, 12, 13, 14, 15, 2, 3, 5, 16, 17, 10, 11, 12, 13, 6, 7, 14, 15, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 10, 11, 14, 15, 6, 7, 2, 3, 0, 5, 16, 17, 12, 13, 10, 11, 20, 21, 24, 25, 6, 7, 16, 17, 12, 13, 14, 15, 10, 11, 0, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 59 60 63 64 65 66 76 77 78 79]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 13:23:18 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.600000000000 AA    0.000000000000   0.000000000000   3.023561799304 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.600000000000 AA    0.000000000000   0.000000000000  -3.023561799304 Bohr   0.0

nuclear repulsion = 95.2518979656
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 26
num. orbitals of irrep E1gx = 18
num. orbitals of irrep E1gy = 18
num. orbitals of irrep A1u = 26
num. orbitals of irrep E1uy = 18
num. orbitals of irrep E1ux = 18
num. orbitals of irrep E2gx = 11
num. orbitals of irrep E2gy = 11
num. orbitals of irrep E3gx = 6
num. orbitals of irrep E3gy = 6
num. orbitals of irrep E2uy = 11
num. orbitals of irrep E2ux = 11
num. orbitals of irrep E3uy = 6
num. orbitals of irrep E3ux = 6
num. orbitals of irrep E4gx = 3
num. orbitals of irrep E4gy = 3
num. orbitals of irrep E5gx = 1
num. orbitals of irrep E5gy = 1
num. orbitals of irrep E4uy = 3
num. orbitals of irrep E4ux = 3
num. orbitals of irrep E5uy = 1
num. orbitals of irrep E5ux = 1
number of shells = 24
number of NR pGTOs = 362
number of NR cGTOs = 208
basis = ccpvqz-dk
ecp = {}
CPU time:     78085.97


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpouilpa2s
max_memory 4000 MB (current use 2890 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.41385847124
HOMO (E2gy) = -0.189363199610108  LUMO (E2ux) = -0.185215349277429
cycle= 1 E= -2098.09044717388  delta_E= -0.677  |g|= 0.402  |ddm|= 2.46
HOMO (E2gy) = 0.00168378771137492  LUMO (A1u) = -0.0144163333979243
cycle= 2 E= -2098.13817051899  delta_E= -0.0477  |g|= 0.304  |ddm|= 0.761
HOMO (E2gy) = -0.0456991411035308  LUMO (A1u) = -0.0320564019300087
cycle= 3 E= -2098.16983887593  delta_E= -0.0317  |g|= 0.214  |ddm|= 0.439
HOMO (E2gy) = -0.0126399002297841  LUMO (A1u) = -0.0196753522442292
cycle= 4 E= -2098.20045861161  delta_E= -0.0306  |g|= 0.113  |ddm|= 0.339
HOMO (E2gy) = -0.00377068782312741  LUMO (A1u) = -0.0163307813064074
cycle= 5 E= -2098.23100000785  delta_E= -0.0305  |g|= 0.0822  |ddm|= 0.393
HOMO (E2gy) = -0.0182828916489955  LUMO (A1u) = -0.025274807949865
cycle= 6 E= -2098.25450233522  delta_E= -0.0235  |g|= 0.0524  |ddm|= 0.356
HOMO (E2gy) = -0.0316806449967591  LUMO (A1u) = -0.0369600801153903
cycle= 7 E= -2098.26237663942  delta_E= -0.00787  |g|= 0.0235  |ddm|= 0.203
HOMO (E2gy) = -0.032428285478367  LUMO (A1u) = -0.0306508477225178
cycle= 8 E= -2098.26406566432  delta_E= -0.00169  |g|= 0.0545  |ddm|= 0.156
HOMO (E2gy) = -0.0370127078551073  LUMO (A1u) = -0.0345203417097012
cycle= 9 E= -2098.26467384088  delta_E= -0.000608  |g|= 0.0193  |ddm|= 0.0445
HOMO (E2gy) = -0.0439899523725088  LUMO (A1u) = -0.0381083812131987
cycle= 10 E= -2098.26499808605  delta_E= -0.000324  |g|= 0.0127  |ddm|= 0.0823
HOMO (E2gy) = -0.0461051946039018  LUMO (A1u) = -0.0394150965403251
cycle= 11 E= -2098.26505217522  delta_E= -5.41e-05  |g|= 0.00264  |ddm|= 0.0189
HOMO (E2gy) = -0.0462522104087466  LUMO (A1u) = -0.0400356364700365
cycle= 12 E= -2098.26505537693  delta_E= -3.2e-06  |g|= 0.00129  |ddm|= 0.00726
HOMO (E2gy) = -0.0463256907119783  LUMO (A1u) = -0.0400050712593184
cycle= 13 E= -2098.26505623529  delta_E= -8.58e-07  |g|= 0.000197  |ddm|= 0.00296
HOMO (E2gy) = -0.0463379794355945  LUMO (A1u) = -0.0400102033802495
cycle= 14 E= -2098.26505624972  delta_E= -1.44e-08  |g|= 0.000158  |ddm|= 0.000718
HOMO (E2gy) = -0.0463676951677352  LUMO (A1u) = -0.0400291282473395
cycle= 15 E= -2098.26505625804  delta_E= -8.32e-09  |g|= 3.49e-05  |ddm|= 0.000377
HOMO (E2gy) = -0.0463652303397116  LUMO (A1u) = -0.040029215695833
cycle= 16 E= -2098.26505625863  delta_E= -5.93e-10  |g|= 4.83e-06  |ddm|= 7.13e-05
HOMO (E2gy) = -0.0463636900530148  LUMO (A1u) = -0.0400287861377697
Extra cycle  E= -2098.26505625865  delta_E= -1.77e-11  |g|= 4.17e-06  |ddm|= 2.77e-05
converged SCF energy = -2098.26505625865
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 27 28 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 178
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpouilpa2s
max_memory 4000 MB (current use 1000 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E1uy E1ux E2gx E2gy A1u E2uy E2ux E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.848146469267
CASCI E = -2098.84814646927  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -25.423574102368
2 -1
State   0 energy     -25.537660017447
3 -1
State   0 energy     -25.630010751151
4 -1
State   0 energy   -2099.194492638843
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.19449263884  dE = -0.34634617  S^2 = 0.0000000
               |grad[o]|=0.379  |ddm|= 1.64  |maxRot[o]|=0.314
5 -1
State   0 energy     -25.865784373200
6 -1
State   0 energy     -25.902805436067
7 -1
State   0 energy     -25.918896339009
8 -1
State   0 energy   -2099.319194203985
macro iter 2 (19 JK  4 micro), CASSCF E = -2099.31919420399  dE = -0.12470157  S^2 = 0.0000000
               |grad[o]|=0.301  |ddm|=0.187  |maxRot[o]|=0.254
9 -1
State   0 energy     -26.143601347463
10 -1
State   0 energy     -26.143631507706
11 -1
State   0 energy     -26.143635021849
12 -1
State   0 energy   -2099.320493623700
macro iter 3 (12 JK  4 micro), CASSCF E = -2099.3204936237  dE = -0.0012994197  S^2 = 0.0000000
               |grad[o]|=0.0354  |ddm|=0.0164  |maxRot[o]|=0.0191
13 -1
State   0 energy     -26.134852021401
14 -1
State   0 energy     -26.134852022012
15 -1
State   0 energy   -2099.320493676038
macro iter 4 (5 JK  2 micro), CASSCF E = -2099.32049367604  dE = -5.2338237e-08  S^2 = 0.0000000
               |grad[o]|=0.000173  |ddm|=0.000144  |maxRot[o]|=0.000256
1-step CASSCF converged in 4 macro (57 JK 14 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.0762837  0.93393414 1.57326231 1.05058244 1.05058232 1.01072498
 1.01072482 0.41651487 0.98927527 0.98927511 0.94942007 0.94941996]
CASSCF energy = -2099.32049367604
CASCI E = -2099.32049367604  E(CI) = -26.1347400610198  S^2 = 0.0000000
energy =  -2099.320493676038
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 0, 6, 7, 10, 11, 5, 14, 15, 2, 3, 0, 6, 7, 2, 3, 5, 0, 5, 10, 11, 0, 6, 7, 14, 15, 6, 7, 2, 3, 5, 2, 3, 0, 5, 0, 5, 0, 10, 11, 6, 7, 6, 7, 14, 15, 2, 3, 0, 2, 3, 5, 5, 6, 7, 10, 11, 16, 17, 12, 13, 0, 14, 15, 2, 3, 5, 6, 7, 5, 0, 2, 3, 10, 11, 14, 15, 6, 7, 0, 2, 3, 0, 5, 5, 20, 21, 24, 25, 16, 17, 6, 7, 12, 13, 0, 10, 11, 14, 15, 2, 3, 5, 6, 7, 16, 17, 12, 13, 10, 11, 14, 15, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 10, 11, 14, 15, 6, 7, 0, 2, 3, 5, 0, 5, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 10, 11, 14, 15, 6, 7, 2, 3, 0, 5, 16, 17, 12, 13, 20, 21, 24, 25, 10, 11, 6, 7, 16, 17, 12, 13, 14, 15, 0, 10, 11, 14, 15, 2, 3, 6, 7, 5, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 57 58
 59 60 63 64 65 66 76 77 78 79]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 13:40:17 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.650000000000 AA    0.000000000000   0.000000000000   1.228321980967 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.650000000000 AA    0.000000000000   0.000000000000  -1.228321980967 Bohr   0.0

nuclear repulsion = 234.466210376862
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:     82222.03


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp8yy1f74a
max_memory 4000 MB (current use 2890 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.65092682557
HOMO (E2ux) = -0.267310157733216  LUMO (E2ux) = -0.267310157733216
cycle= 1 E= -2098.06497665108  delta_E= 1.59  |g|= 1.73  |ddm|= 2.86
HOMO (A1g) = 0.0426696620101004  LUMO (E1ux) = 0.0538595122554235
cycle= 2 E= -2096.49232336997  delta_E= 1.57  |g|=  3.4  |ddm|= 2.04e+03
HOMO (E2ux) = -0.0154381722148789  LUMO (A1g) = -0.117373001890713
cycle= 3 E= -2098.27748298635  delta_E= -1.79  |g|= 0.664  |ddm|= 2.04e+03
HOMO (E2ux) = 0.135389432867646  LUMO (A1g) = -0.00228890609256933
cycle= 4 E= -2098.34262709359  delta_E= -0.0651  |g|= 0.0647  |ddm|= 1.79
HOMO (E2ux) = 0.111682702693448  LUMO (A1g) = 0.015900130713256
cycle= 5 E= -2098.34258628227  delta_E= 4.08e-05  |g|= 0.132  |ddm|= 2.99
HOMO (E2ux) = 0.131168447499886  LUMO (A1g) = 0.0190871626750628
cycle= 6 E= -2098.34397427369  delta_E= -0.00139  |g|= 0.0713  |ddm|= 2.98
HOMO (E2ux) = 0.130352273125884  LUMO (A1g) = 0.0194217566285694
cycle= 7 E= -2098.35237328109  delta_E= -0.0084  |g|= 0.0225  |ddm|= 0.881
HOMO (E2ux) = 0.145010174943672  LUMO (A1g) = 0.0212931618845434
cycle= 8 E= -2098.34946560106  delta_E= 0.00291  |g|= 0.0525  |ddm|= 1.84
HOMO (E2ux) = 0.139570706521561  LUMO (A1g) = 0.0211149523138653
cycle= 9 E= -2098.35072128157  delta_E= -0.00126  |g|= 0.0457  |ddm|= 2.02
HOMO (E2ux) = 0.142084023266131  LUMO (A1g) = 0.0215076522026735
cycle= 10 E= -2098.35305971978  delta_E= -0.00234  |g|= 0.0275  |ddm|= 0.323
HOMO (E2ux) = 0.143256584406576  LUMO (A1g) = 0.0216866895440299
cycle= 11 E= -2098.35346664766  delta_E= -0.000407  |g|= 0.0246  |ddm|= 0.0751
HOMO (E2ux) = 0.147288893008137  LUMO (A1g) = 0.0222807675282535
cycle= 12 E= -2098.35492142985  delta_E= -0.00145  |g|= 0.00302  |ddm|= 0.467
HOMO (E2ux) = 0.149067926627486  LUMO (A1g) = 0.022521821102444
cycle= 13 E= -2098.35489964726  delta_E= 2.18e-05  |g|= 0.00672  |ddm|= 0.0196
HOMO (E2ux) = 0.148509528236762  LUMO (A1g) = 0.0224772807998984
cycle= 14 E= -2098.35496882891  delta_E= -6.92e-05  |g|= 0.00109  |ddm|= 0.0939
HOMO (E2ux) = 0.148827601215746  LUMO (A1g) = 0.0225309802576221
cycle= 15 E= -2098.35496979199  delta_E= -9.63e-07  |g|= 0.00109  |ddm|= 0.0529
HOMO (E2ux) = 0.148717312689868  LUMO (A1g) = 0.0225112602410561
cycle= 16 E= -2098.35497195968  delta_E= -2.17e-06  |g|= 0.000518  |ddm|= 0.0359
HOMO (E2ux) = 0.148770315328131  LUMO (A1g) = 0.0225208380848275
cycle= 17 E= -2098.35497253991  delta_E= -5.8e-07  |g|= 0.000131  |ddm|= 0.0147
HOMO (E2ux) = 0.14875137815049  LUMO (A1g) = 0.0225179201469263
cycle= 18 E= -2098.35497258504  delta_E= -4.51e-08  |g|= 1.49e-05  |ddm|= 0.00347
HOMO (E2ux) = 0.148750892387719  LUMO (A1g) = 0.0225179117345404
cycle= 19 E= -2098.35497258502  delta_E= 2e-11  |g|= 1.48e-05  |ddm|= 8.48e-06
HOMO (E2ux) = 0.148745612923962  LUMO (A1g) = 0.0225173794388506
Extra cycle  E= -2098.35497256858  delta_E= 1.64e-08  |g|= 0.000121  |ddm|= 0.00218
converged SCF energy = -2098.35497256858
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp8yy1f74a
max_memory 4000 MB (current use 1437 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy E2uy E2ux A1g A1u E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.464127408636
CASCI E = -2098.46412740864  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -34.356578497013
2 -1
State   0 energy     -34.376952311134
3 -1
State   0 energy     -34.394097226307
4 -1
State   0 energy   -2098.582860380154
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.58286038015  dE = -0.11873297  S^2 = 0.0000000
               |grad[o]|=0.601  |ddm|=0.0791  |maxRot[o]|=0.254
5 -1
State   0 energy     -34.371434715070
6 -1
State   0 energy     -34.391948484108
7 -1
State   0 energy     -34.415427755595
8 -1
State   0 energy   -2098.666340011885
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.66634001189  dE = -0.083479632  S^2 = 0.0000000
               |grad[o]|=0.143  |ddm|=0.0502  |maxRot[o]|= 0.31
9 -1
State   0 energy     -34.482746164218
10 -1
State   0 energy     -34.509893609107
11 -1
State   0 energy     -34.538568169128
12 -1
State   0 energy   -2098.791473316996
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.791473317  dE = -0.12513331  S^2 = 0.0000000
               |grad[o]|=0.115  |ddm|=0.0523  |maxRot[o]|=0.297
13 -1
State   0 energy     -34.738537013992
14 -1
State   0 energy     -34.803013153109
15 -1
State   0 energy     -34.857905582465
16 -1
State   0 energy   -2099.009446113908
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.00944611391  dE = -0.2179728  S^2 = 0.0000000
               |grad[o]|=0.671  |ddm|=0.949  |maxRot[o]|=0.306
17 -1
State   0 energy     -34.966095204632
18 -1
State   0 energy     -34.980451259223
19 -1
State   0 energy     -34.989682812945
20 -1
State   0 energy   -2099.057352753522
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.05735275352  dE = -0.04790664  S^2 = 0.0000000
               |grad[o]|=0.153  |ddm|=0.0305  |maxRot[o]|=0.306
21 -1
State   0 energy     -35.038803577900
22 -1
State   0 energy     -35.038952738583
23 -1
State   0 energy     -35.038975068625
24 -1
State   0 energy   -2099.057950774830
macro iter 6 (13 JK  4 micro), CASSCF E = -2099.05795077483  dE = -0.00059802131  S^2 = 0.0000000
               |grad[o]|=0.0214  |ddm|=0.0102  |maxRot[o]|=0.031
25 -1
State   0 energy     -34.978819017226
26 -1
State   0 energy     -34.978819016686
27 -1
State   0 energy   -2099.057950910762
macro iter 7 (6 JK  2 micro), CASSCF E = -2099.05795091076  dE = -1.3593171e-07  S^2 = 0.0000000
               |grad[o]|=0.00041  |ddm|=5.77e-05  |maxRot[o]|=0.000504
28 -1
State   0 energy     -34.976761703824
29 -1
State   0 energy   -2099.057950910762
macro iter 8 (1 JK  1 micro), CASSCF E = -2099.05795091076  dE = 4.5474735e-13  S^2 = 0.0000000
               |grad[o]|=2.63e-05  |ddm|=1.04e-05  |maxRot[o]|=    0
1-step CASSCF converged in 8 macro (125 JK 27 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.9242259  1.92422571 1.94665756 1.88539745 1.88539711 0.11676401
 0.11676367 1.81730948 0.13323889 0.07448554 0.07448535 0.10104934]
CASSCF energy = -2099.05795091076
CASCI E = -2099.05795091076  E(CI) = -34.9767617037637  S^2 = 0.0000000
energy =  -2099.0579509107615
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 0, 5, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 6, 7, 2, 3, 14, 15, 6, 7, 0, 5, 2, 3, 0, 5, 2, 3, 0, 10, 11, 5, 6, 7, 0, 14, 15, 6, 7, 2, 3, 5, 16, 17, 0, 2, 3, 10, 11, 12, 13, 5, 0, 6, 7, 14, 15, 2, 3, 5, 0, 5, 10, 11, 6, 7, 14, 15, 6, 7, 0, 2, 3, 20, 21, 5, 16, 17, 2, 3, 5, 10, 11, 0, 6, 7, 14, 15, 24, 25, 12, 13, 16, 17, 2, 3, 10, 11, 0, 5, 12, 13, 0, 6, 7, 5, 10, 11, 6, 7, 14, 15, 5, 14, 15, 2, 3, 0, 6, 7, 2, 3, 5, 20, 21, 0, 26, 27, 16, 17, 22, 23, 6, 7, 2, 3, 14, 15, 10, 11, 5, 0, 24, 25, 12, 13, 2, 3, 6, 7, 10, 11, 20, 21, 16, 17, 0, 16, 17, 24, 25, 12, 13, 0, 5, 14, 15, 10, 11, 2, 3, 12, 13, 5, 6, 7, 14, 15, 0, 2, 3, 10, 11, 5, 14, 15, 6, 7, 0, 6, 7, 5, 2, 3, 0, 5, 2, 3, 16, 17, 20, 21, 26, 27, 0, 10, 11, 30, 31, 34, 35, 5, 22, 23, 6, 7, 24, 25, 14, 15, 0, 2, 3, 12, 13, 6, 7, 20, 21, 5, 26, 27, 22, 23, 24, 25, 16, 17, 0, 12, 13, 10, 11, 14, 15, 2, 3, 16, 17, 10, 11, 16, 17, 20, 21, 12, 13, 24, 25, 6, 7, 5, 10, 11, 14, 15, 0, 12, 13, 2, 3, 5, 14, 15, 6, 7, 2, 3, 0, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 60 61 64 65 66 67 68 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 14:53:59 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.700000000000 AA    0.000000000000   0.000000000000   1.322808287196 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.700000000000 AA    0.000000000000   0.000000000000  -1.322808287196 Bohr   0.0

nuclear repulsion = 217.718623921371
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    144990.63


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpzldr9bkt
max_memory 4000 MB (current use 1975 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.24526055668
HOMO (E2ux) = -0.253374905406111  LUMO (E2ux) = -0.253374905406111
cycle= 1 E= -2098.24941336196  delta_E= 0.996  |g|=  1.5  |ddm|= 2.66
HOMO (A1g) = 0.110672017425861  LUMO (A1u) = 0.02479985703565
cycle= 2 E= -2096.95913928518  delta_E= 1.29  |g|= 2.97  |ddm|=  113
HOMO (E2ux) = -0.0268568102079602  LUMO (A1g) = -0.130106441534769
cycle= 3 E= -2098.42905979693  delta_E= -1.47  |g|= 0.596  |ddm|=  113
HOMO (E2ux) = 0.0818785064263829  LUMO (A1g) = -0.00969191658895
cycle= 4 E= -2098.48174829559  delta_E= -0.0527  |g|= 0.179  |ddm|= 0.345
HOMO (E2ux) = 0.0987905911544106  LUMO (A1g) = 0.0181963590733418
cycle= 5 E= -2098.48674764924  delta_E= -0.005  |g|= 0.0598  |ddm|= 0.692
HOMO (E2ux) = 0.101749597052095  LUMO (A1g) = 0.0208646660297708
cycle= 6 E= -2098.48601943759  delta_E= 0.000728  |g|= 0.0337  |ddm|=  1.1
HOMO (E2ux) = 0.0975420825197921  LUMO (A1g) = 0.02115523910842
cycle= 7 E= -2098.48898091879  delta_E= -0.00296  |g|= 0.0175  |ddm|= 0.652
HOMO (E2ux) = 0.101310897435919  LUMO (A1g) = 0.022115685339465
cycle= 8 E= -2098.48907731471  delta_E= -9.64e-05  |g|= 0.00306  |ddm|= 0.0228
HOMO (E2ux) = 0.100674187160167  LUMO (A1g) = 0.0223065835759995
cycle= 9 E= -2098.48909734425  delta_E= -2e-05  |g|= 0.00271  |ddm|= 0.0114
HOMO (E2ux) = 0.0999181361871292  LUMO (A1g) = 0.0223869583431996
cycle= 10 E= -2098.489107418  delta_E= -1.01e-05  |g|= 0.00255  |ddm|= 0.0246
HOMO (E2ux) = 0.0995685542679502  LUMO (A1g) = 0.0223233330413032
cycle= 11 E= -2098.48911192602  delta_E= -4.51e-06  |g|= 0.000364  |ddm|= 0.0218
HOMO (E2ux) = 0.0993063095865023  LUMO (A1g) = 0.0223089741422823
cycle= 12 E= -2098.48911238869  delta_E= -4.63e-07  |g|= 0.000109  |ddm|= 0.00878
HOMO (E2ux) = 0.0993678818658329  LUMO (A1g) = 0.0223203607051101
cycle= 13 E= -2098.48911243309  delta_E= -4.44e-08  |g|= 2.59e-05  |ddm|= 0.00246
HOMO (E2ux) = 0.0993654220283014  LUMO (A1g) = 0.0223211557552224
cycle= 14 E= -2098.48911243428  delta_E= -1.19e-09  |g|= 7.75e-06  |ddm|= 0.000147
HOMO (E2ux) = 0.0993603057889152  LUMO (A1g) = 0.0223198518466677
cycle= 15 E= -2098.48911243445  delta_E= -1.69e-10  |g|= 2.53e-06  |ddm|= 0.000121
HOMO (E2ux) = 0.0993610675920766  LUMO (A1g) = 0.0223199223244896
Extra cycle  E= -2098.48911243445  delta_E=    0  |g|= 2.57e-06  |ddm|= 8.98e-06
converged SCF energy = -2098.48911243445
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpzldr9bkt
max_memory 4000 MB (current use 1976 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy E2uy E2ux A1g A1u E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.583450709574
CASCI E = -2098.58345070957  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -33.213813001450
2 -1
State   0 energy     -33.231765512763
3 -1
State   0 energy     -33.250670256800
4 -1
State   0 energy   -2098.707443876841
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.70744387684  dE = -0.12399317  S^2 = 0.0000000
               |grad[o]|=0.581  |ddm|=0.0536  |maxRot[o]|=0.266
5 -1
State   0 energy     -33.281310293989
6 -1
State   0 energy     -33.305694842221
7 -1
State   0 energy     -33.333335734559
8 -1
State   0 energy   -2098.807666760393
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.80766676039  dE = -0.10022288  S^2 = 0.0000000
               |grad[o]|=0.148  |ddm|=0.0685  |maxRot[o]|=0.309
9 -1
State   0 energy     -33.396074250411
10 -1
State   0 energy     -33.429046805570
11 -1
State   0 energy     -33.456790102202
12 -1
State   0 energy   -2098.942181074809
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.94218107481  dE = -0.13451431  S^2 = 0.0000000
               |grad[o]|=0.121  |ddm|=0.0645  |maxRot[o]|=0.286
13 -1
State   0 energy     -33.596986081761
14 -1
State   0 energy     -33.665666185880
15 -1
State   0 energy     -33.718085699975
16 -1
State   0 energy   -2099.158435537064
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.15843553706  dE = -0.21625446  S^2 = 0.0000000
               |grad[o]|=0.632  |ddm|=0.823  |maxRot[o]|=0.281
17 -1
State   0 energy     -33.810870457277
18 -1
State   0 energy     -33.820443910664
19 -1
State   0 energy     -33.823228471637
20 -1
State   0 energy   -2099.188499066024
macro iter 5 (17 JK  4 micro), CASSCF E = -2099.18849906602  dE = -0.030063529  S^2 = 0.0000000
               |grad[o]|=0.122  |ddm|=0.0223  |maxRot[o]|= 0.23
21 -1
State   0 energy     -33.753196645085
22 -1
State   0 energy     -33.753197407766
23 -1
State   0 energy     -33.753197633410
24 -1
State   0 energy   -2099.188507517547
macro iter 6 (9 JK  3 micro), CASSCF E = -2099.18850751755  dE = -8.4515232e-06  S^2 = 0.0000000
               |grad[o]|=0.00365  |ddm|=0.00189  |maxRot[o]|=0.00133
25 -1
State   0 energy     -33.750572726697
26 -1
State   0 energy   -2099.188507519773
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.18850751977  dE = -2.226443e-09  S^2 = 0.0000000
               |grad[o]|=4.6e-05  |ddm|=1.26e-05  |maxRot[o]|=4.9e-05
1-step CASSCF converged in 7 macro (113 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.90638329 1.90638379 1.92882111 1.84884237 1.84884238 0.15348869
 0.1534887  1.83319163 0.13756075 0.09250538 0.09250591 0.097986  ]
CASSCF energy = -2099.18850751977
CASCI E = -2099.18850751977  E(CI) = -33.750625102829  S^2 = 0.0000000
energy =  -2099.1885075197733
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 0, 5, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 2, 3, 6, 7, 14, 15, 6, 7, 0, 5, 2, 3, 0, 5, 0, 2, 3, 10, 11, 5, 6, 7, 0, 14, 15, 2, 3, 6, 7, 5, 0, 16, 17, 2, 3, 10, 11, 12, 13, 5, 0, 5, 2, 3, 14, 15, 6, 7, 0, 5, 10, 11, 6, 7, 14, 15, 6, 7, 0, 2, 3, 5, 20, 21, 16, 17, 2, 3, 5, 10, 11, 0, 24, 25, 6, 7, 14, 15, 12, 13, 2, 3, 16, 17, 10, 11, 0, 12, 13, 5, 0, 6, 7, 5, 10, 11, 14, 15, 6, 7, 5, 14, 15, 0, 2, 3, 6, 7, 2, 3, 0, 5, 20, 21, 26, 27, 16, 17, 2, 3, 22, 23, 6, 7, 0, 14, 15, 10, 11, 5, 24, 25, 2, 3, 12, 13, 0, 6, 7, 20, 21, 10, 11, 16, 17, 24, 25, 16, 17, 0, 12, 13, 5, 10, 11, 14, 15, 12, 13, 2, 3, 5, 6, 7, 14, 15, 0, 2, 3, 5, 10, 11, 5, 0, 14, 15, 6, 7, 6, 7, 2, 3, 0, 5, 2, 3, 0, 16, 17, 10, 11, 20, 21, 26, 27, 6, 7, 30, 31, 34, 35, 22, 23, 5, 24, 25, 0, 2, 3, 14, 15, 12, 13, 20, 21, 6, 7, 26, 27, 22, 23, 16, 17, 24, 25, 0, 12, 13, 14, 15, 5, 10, 11, 2, 3, 5, 16, 17, 10, 11, 16, 17, 12, 13, 20, 21, 6, 7, 24, 25, 10, 11, 0, 12, 13, 14, 15, 5, 2, 3, 6, 7, 14, 15, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 60 61 62 63 66 68 69 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 16:05:49 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.750000000000 AA    0.000000000000   0.000000000000   1.417294593424 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.750000000000 AA    0.000000000000   0.000000000000  -1.417294593424 Bohr   0.0

nuclear repulsion = 203.20404899328
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    201782.12


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp6pkii_ui
max_memory 4000 MB (current use 1989 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.94150127745
HOMO (E2ux) = -0.241295996995133  LUMO (E2ux) = -0.241295996995133
cycle= 1 E= -2098.45840896742  delta_E= 0.483  |g|= 1.16  |ddm|= 2.57
HOMO (E2gy) = 0.186298637341291  LUMO (E1ux) = 0.0458403537299826
cycle= 2 E= -2096.61543127504  delta_E= 1.84  |g|= 2.69  |ddm|= 1.44e+03
HOMO (E2gy) = -0.131732990237751  LUMO (E2gy) = -0.131732990237751
cycle= 3 E= -2098.3531634066  delta_E= -1.74  |g|= 0.57  |ddm|= 1.44e+03
HOMO (E2gy) = -0.0464314446913307  LUMO (E2gy) = -0.0464314446913307
cycle= 4 E= -2098.37099177661  delta_E= -0.0178  |g|= 0.263  |ddm|= 1.58
HOMO (E2gy) = 0.0382119244186486  LUMO (A1u) = -0.0119773857709273
cycle= 5 E= -2098.33749864011  delta_E= 0.0335  |g|= 0.164  |ddm|= 0.302
HOMO (E2gy) = 0.0095165662952507  LUMO (A1u) = -0.00955676811881768
cycle= 6 E= -2098.36735937317  delta_E= -0.0299  |g|= 0.167  |ddm|= 0.16
HOMO (E2gy) = 0.0091210646057878  LUMO (A1u) = -0.0093969775138976
cycle= 7 E= -2098.36763655745  delta_E= -0.000277  |g|= 0.169  |ddm|= 0.00781
HOMO (E2gy) = 0.00620480212111822  LUMO (A1u) = -0.0107499028859652
cycle= 8 E= -2098.36853217958  delta_E= -0.000896  |g|= 0.173  |ddm|= 0.018
HOMO (E2gy) = 0.00485382545858711  LUMO (A1u) = -0.0113242992077508
cycle= 9 E= -2098.36887280403  delta_E= -0.000341  |g|= 0.176  |ddm|= 0.00908
HOMO (E2gy) = 0.0265704309922389  LUMO (A1u) = -0.00680976131747954
cycle= 10 E= -2098.35489230666  delta_E= 0.014  |g|= 0.146  |ddm|= 0.111
HOMO (E2gy) = 0.0443148107001984  LUMO (A1u) = 0.00360274461272989
cycle= 11 E= -2098.34164964858  delta_E= 0.0132  |g|= 0.171  |ddm|= 0.104
HOMO (E2gy) = 0.0574510147120101  LUMO (A1u) = 0.00107463863215947
cycle= 12 E= -2098.10241984687  delta_E= 0.239  |g|= 0.337  |ddm|= 1.38
HOMO (E2gy) = 0.0475467767323631  LUMO (A1u) = 0.00174840844306481
cycle= 13 E= -2098.12496254222  delta_E= -0.0225  |g|= 0.273  |ddm|= 0.116
HOMO (E2gy) = 0.0865289159237412  LUMO (A1u) = 0.0208210267770385
cycle= 14 E= -2098.05445364419  delta_E= 0.0705  |g|= 0.455  |ddm|= 0.652
HOMO (E2gy) = 0.0618139031548176  LUMO (A1u) = 0.0195129762811195
cycle= 15 E= -2098.08750075676  delta_E= -0.033  |g|= 0.54  |ddm|= 0.886
HOMO (E2gy) = 0.0615151261159956  LUMO (A1u) = 0.0194933819729961
cycle= 16 E= -2098.0931821174  delta_E= -0.00568  |g|= 0.522  |ddm|= 0.139
HOMO (E2gy) = 0.0708187292968675  LUMO (A1u) = 0.0238499659812478
cycle= 17 E= -2098.07828398468  delta_E= 0.0149  |g|= 0.581  |ddm|= 0.687
HOMO (E2gy) = 0.0546996275023802  LUMO (A1u) = 0.0198860537515899
cycle= 18 E= -2098.12313602522  delta_E= -0.0449  |g|= 0.438  |ddm|= 0.211
HOMO (E2gy) = 0.049188192877432  LUMO (A1u) = 0.0196157630214473
cycle= 19 E= -2098.11217172833  delta_E= 0.011  |g|= 0.481  |ddm|= 0.861
HOMO (E2gy) = 0.0289673640977329  LUMO (A1u) = 0.0074249117990981
cycle= 20 E= -2098.16280720185  delta_E= -0.0506  |g|= 0.111  |ddm|=  1.1
HOMO (E2gy) = 0.0259725461111033  LUMO (A1u) = 0.00773807572484893
cycle= 21 E= -2098.16614377565  delta_E= -0.00334  |g|= 0.117  |ddm|= 0.175
HOMO (E2gy) = 0.021981774947735  LUMO (A1u) = 0.00710934026814881
cycle= 22 E= -2098.17008415266  delta_E= -0.00394  |g|= 0.119  |ddm|= 0.178
HOMO (E2gy) = 0.0524883031587428  LUMO (A1u) = 0.0147949943776151
cycle= 23 E= -2098.14933652443  delta_E= 0.0207  |g|= 0.145  |ddm|= 0.19
HOMO (E2gy) = 0.0621252771841065  LUMO (A1u) = 0.0167524951806515
cycle= 24 E= -2098.13958260032  delta_E= 0.00975  |g|= 0.177  |ddm|= 0.19
HOMO (E2gy) = 0.0635281807759171  LUMO (A1u) = 0.0173521352177798
cycle= 25 E= -2098.13732161794  delta_E= 0.00226  |g|= 0.18  |ddm|= 0.0643
HOMO (E2gy) = 0.0532725803550614  LUMO (A1u) = 0.0149074673241446
cycle= 26 E= -2098.15032074119  delta_E= -0.013  |g|= 0.148  |ddm|= 0.32
HOMO (E2gy) = 0.0506418401753535  LUMO (A1u) = 0.0138528606236424
cycle= 27 E= -2098.1509438715  delta_E= -0.000623  |g|= 0.148  |ddm|= 0.104
HOMO (E2gy) = 0.0451988623772068  LUMO (A1u) = 0.0132133995268123
cycle= 28 E= -2098.15725474685  delta_E= -0.00631  |g|= 0.124  |ddm|= 0.131
HOMO (E2gy) = 0.0460886866333207  LUMO (A1u) = 0.0136877304456812
cycle= 29 E= -2098.15778409829  delta_E= -0.000529  |g|= 0.124  |ddm|= 0.0555
HOMO (E2gy) = 0.0445727841129523  LUMO (A1u) = 0.0131808182569157
cycle= 30 E= -2098.15577509575  delta_E= 0.00201  |g|= 0.121  |ddm|= 0.125
HOMO (E2gy) = 0.0511275288527468  LUMO (A1u) = 0.0149625803752343
cycle= 31 E= -2098.15034902696  delta_E= 0.00543  |g|= 0.131  |ddm|= 0.174
HOMO (E2gy) = 0.0515102937233704  LUMO (A1u) = 0.0151746657071118
cycle= 32 E= -2098.15141866026  delta_E= -0.00107  |g|= 0.13  |ddm|= 0.0392
SCF not converged.
SCF energy = -2098.15141866026
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp6pkii_ui
max_memory 4000 MB (current use 1990 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2uy E2ux A1g E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.502905197116
CASCI E = -2098.50290519712  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -32.116670548924
2 -1
State   0 energy     -32.236854692452
3 -1
State   0 energy     -32.315582643601
4 -1
State   0 energy   -2098.863661123309
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.86366112331  dE = -0.36075593  S^2 = 0.0000000
               |grad[o]|=0.829  |ddm|= 1.11  |maxRot[o]|=0.301
5 -1
State   0 energy     -32.488107460200
6 -1
State   0 energy     -32.510986437091
7 -1
State   0 energy     -32.541973165594
8 -1
State   0 energy   -2098.977623088634
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.97762308863  dE = -0.11396197  S^2 = 0.0000000
               |grad[o]|=0.211  |ddm|=0.199  |maxRot[o]|=0.301
9 -1
State   0 energy     -32.600653441166
10 -1
State   0 energy     -32.645817871731
11 -1
State   0 energy     -32.689904271952
12 -1
State   0 energy   -2099.144604243131
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.14460424313  dE = -0.16698115  S^2 = 0.0000000
               |grad[o]|=0.145  |ddm|=0.151  |maxRot[o]|=0.302
13 -1
State   0 energy     -32.780190657390
14 -1
State   0 energy     -32.797477275974
15 -1
State   0 energy     -32.810858285652
16 -1
State   0 energy   -2099.205781619010
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.20578161901  dE = -0.061177376  S^2 = 0.0000000
               |grad[o]|=0.106  |ddm|=0.0498  |maxRot[o]|=0.309
17 -1
State   0 energy     -32.779101339166
18 -1
State   0 energy     -32.785261896114
19 -1
State   0 energy     -32.794585720218
20 -1
State   0 energy   -2099.227596870675
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.22759687067  dE = -0.021815252  S^2 = 0.0000000
               |grad[o]|=0.0551  |ddm|=0.0203  |maxRot[o]|=0.297
21 -1
State   0 energy     -33.163361917938
22 -1
State   0 energy     -33.167315619894
23 -1
State   0 energy     -33.171134510192
24 -1
State   0 energy   -2099.239654861934
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.23965486193  dE = -0.012057991  S^2 = 0.0000000
               |grad[o]|=0.0317  |ddm|=0.0137  |maxRot[o]|=0.307
25 -1
State   0 energy     -33.631624879430
26 -1
State   0 energy     -33.632827682932
27 -1
State   0 energy     -33.634272802224
28 -1
State   0 energy   -2099.242867472682
macro iter 7 (18 JK  4 micro), CASSCF E = -2099.24286747268  dE = -0.0032126107  S^2 = 0.0000000
               |grad[o]|=0.0178  |ddm|=0.0116  |maxRot[o]|= 0.22
29 -1
State   0 energy     -33.260715306956
30 -1
State   0 energy     -33.262133100955
31 -1
State   0 energy     -33.263814060015
32 -1
State   0 energy   -2099.244466090061
macro iter 8 (17 JK  4 micro), CASSCF E = -2099.24446609006  dE = -0.0015986174  S^2 = 0.0000000
               |grad[o]|=0.00521  |ddm|=0.0382  |maxRot[o]|=0.0933
33 -1
State   0 energy     -32.886668569708
34 -1
State   0 energy     -32.887386944680
35 -1
State   0 energy     -32.887584296266
36 -1
State   0 energy   -2099.245466630160
macro iter 9 (14 JK  4 micro), CASSCF E = -2099.24546663016  dE = -0.0010005401  S^2 = 0.0000000
               |grad[o]|=0.0118  |ddm|=0.059  |maxRot[o]|=0.0573
37 -1
State   0 energy     -32.777391414032
38 -1
State   0 energy     -32.777400171202
39 -1
State   0 energy     -32.777402952042
40 -1
State   0 energy   -2099.245497298812
macro iter 10 (13 JK  4 micro), CASSCF E = -2099.24549729881  dE = -3.0668652e-05  S^2 = 0.0000000
               |grad[o]|=0.0042  |ddm|=0.00769  |maxRot[o]|=0.00687
41 -1
State   0 energy     -32.770543263147
42 -1
State   0 energy   -2099.245497345323
macro iter 11 (4 JK  1 micro), CASSCF E = -2099.24549734532  dE = -4.651065e-08  S^2 = 0.0000000
               |grad[o]|=0.000132  |ddm|=0.000261  |maxRot[o]|=0.000197
1-step CASSCF converged in 11 macro (192 JK 41 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.88450835 1.88450804 1.90016753 0.20690031 0.20690016 1.85694699
 1.79528364 0.10818782 1.79528378 0.11471832 0.11471799 0.13187708]
CASSCF energy = -2099.24549734532
CASCI E = -2099.24549734532  E(CI) = -32.7703569296254  S^2 = 0.0000000
energy =  -2099.2454973453227
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 14, 15, 0, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 6, 7, 2, 3, 14, 15, 6, 7, 0, 5, 2, 3, 5, 0, 0, 2, 3, 10, 11, 5, 6, 7, 2, 3, 5, 14, 15, 6, 7, 0, 0, 16, 17, 2, 3, 10, 11, 12, 13, 5, 0, 5, 2, 3, 14, 15, 6, 7, 5, 0, 10, 11, 6, 7, 14, 15, 6, 7, 0, 2, 3, 20, 21, 5, 16, 17, 5, 2, 3, 10, 11, 0, 24, 25, 6, 7, 14, 15, 2, 3, 16, 17, 12, 13, 0, 10, 11, 12, 13, 6, 7, 0, 5, 5, 14, 15, 10, 11, 0, 14, 15, 5, 6, 7, 2, 3, 6, 7, 2, 3, 0, 2, 3, 20, 21, 5, 16, 17, 26, 27, 0, 22, 23, 6, 7, 10, 11, 14, 15, 24, 25, 0, 2, 3, 5, 12, 13, 6, 7, 20, 21, 16, 17, 24, 25, 10, 11, 16, 17, 5, 0, 12, 13, 10, 11, 12, 13, 14, 15, 5, 2, 3, 6, 7, 14, 15, 0, 2, 3, 5, 5, 10, 11, 0, 6, 7, 14, 15, 6, 7, 2, 3, 0, 5, 0, 2, 3, 10, 11, 16, 17, 6, 7, 20, 21, 26, 27, 30, 31, 34, 35, 22, 23, 0, 24, 25, 5, 12, 13, 2, 3, 14, 15, 5, 20, 21, 26, 27, 22, 23, 16, 17, 14, 15, 24, 25, 6, 7, 0, 2, 3, 12, 13, 10, 11, 5, 16, 17, 12, 13, 10, 11, 16, 17, 6, 7, 20, 21, 10, 11, 24, 25, 0, 12, 13, 14, 15, 5, 2, 3, 6, 7, 14, 15, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 62 63 68 69 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 17:55:03 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.800000000000 AA    0.000000000000   0.000000000000   1.511780899652 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.800000000000 AA    0.000000000000   0.000000000000  -1.511780899652 Bohr   0.0

nuclear repulsion = 190.5037959312
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    295965.51


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp1mhfgxcw
max_memory 4000 MB (current use 1997 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.70400319606
HOMO (E2ux) = -0.230966770126272  LUMO (E2ux) = -0.230966770126272
cycle= 1 E= -2098.4833166759  delta_E= 0.221  |g|= 1.07  |ddm|= 2.51
HOMO (E2gy) = 0.190428267222486  LUMO (E1ux) = 0.0469723009023565
cycle= 2 E= -2097.20824566724  delta_E= 1.28  |g|= 2.35  |ddm|= 1.15e+03
HOMO (E2gy) = -0.0860515549131277  LUMO (E2ux) = -0.2033005285421
cycle= 3 E= -2098.526011657  delta_E= -1.32  |g|= 0.387  |ddm|= 1.15e+03
HOMO (E2gy) = -0.045232950075459  LUMO (E2ux) = -0.241669040187944
cycle= 4 E= -2098.54918860354  delta_E= -0.0232  |g|= 0.163  |ddm|= 0.186
HOMO (E2gy) = -0.0364231794336646  LUMO (A1g) = -0.228573550480679
cycle= 5 E= -2098.03603460389  delta_E= 0.513  |g|= 1.09  |ddm|= 1.84
HOMO (E2gy) = -0.0388179183997399  LUMO (A1g) = -0.199656137125281
cycle= 6 E= -2098.07531855113  delta_E= -0.0393  |g|= 0.983  |ddm|= 0.0746
HOMO (E2gy) = -0.0276645590369088  LUMO (A1g) = -0.106946757588818
cycle= 7 E= -2098.19618106944  delta_E= -0.121  |g|= 0.623  |ddm|= 0.342
HOMO (E2gy) = -0.0452566982450776  LUMO (A1g) = -0.0667647165322212
cycle= 8 E= -2098.24796589676  delta_E= -0.0518  |g|= 0.485  |ddm|= 0.345
HOMO (E2gy) = -0.0447666080813709  LUMO (A1g) = -0.0673479356712864
cycle= 9 E= -2098.24623852944  delta_E= 0.00173  |g|= 0.49  |ddm|= 0.0156
HOMO (E2gy) = -0.0432109247944806  LUMO (A1g) = -0.0526714045409667
cycle= 10 E= -2098.26812430506  delta_E= -0.0219  |g|= 0.401  |ddm|= 0.156
HOMO (E2gy) = -0.0552130126205894  LUMO (A1g) = -0.00224752070032575
cycle= 11 E= -2098.29798715433  delta_E= -0.0299  |g|= 0.193  |ddm|= 0.259
HOMO (E2gy) = -0.0763338617865724  LUMO (A1u) = 0.0184731562426011
cycle= 12 E= -2098.3131771367  delta_E= -0.0152  |g|= 0.0427  |ddm|= 0.266
HOMO (E2gy) = -0.095684883462914  LUMO (A1u) = 0.0150446728055134
cycle= 13 E= -2098.31863673415  delta_E= -0.00546  |g|= 0.0269  |ddm|= 0.188
HOMO (E2gy) = -0.112680003333713  LUMO (A1u) = 0.0109823156067853
cycle= 14 E= -2098.32184768869  delta_E= -0.00321  |g|= 0.0104  |ddm|= 0.229
HOMO (E2gy) = -0.116208721929532  LUMO (A1u) = 0.0104255488981649
cycle= 15 E= -2098.32208393449  delta_E= -0.000236  |g|= 0.0051  |ddm|= 0.0427
HOMO (E2gy) = -0.120574701168361  LUMO (A1u) = 0.0093481386245963
cycle= 16 E= -2098.32223091725  delta_E= -0.000147  |g|= 0.00131  |ddm|= 0.0548
HOMO (E2gy) = -0.121440282961359  LUMO (A1u) = 0.00906095034955847
cycle= 17 E= -2098.32223552689  delta_E= -4.61e-06  |g|= 0.000785  |ddm|= 0.00847
HOMO (E2gy) = -0.121349866307371  LUMO (A1u) = 0.00908442037869935
cycle= 18 E= -2098.32223589857  delta_E= -3.72e-07  |g|= 0.000718  |ddm|= 0.00246
HOMO (E2gy) = -0.121553763230726  LUMO (A1u) = 0.0090180946029587
cycle= 19 E= -2098.32223619269  delta_E= -2.94e-07  |g|= 7.72e-05  |ddm|= 0.00232
HOMO (E2gy) = -0.12155015838821  LUMO (A1u) = 0.00901953741125723
cycle= 20 E= -2098.32223619918  delta_E= -6.49e-09  |g|= 1.36e-05  |ddm|= 0.000239
HOMO (E2gy) = -0.121541030302241  LUMO (A1u) = 0.00902203642605803
cycle= 21 E= -2098.32223619928  delta_E= -1.01e-10  |g|= 9.22e-06  |ddm|= 8.5e-05
HOMO (E2gy) = -0.121542756574227  LUMO (A1u) = 0.00902182478346582
Extra cycle  E= -2098.32223619931  delta_E= -3.64e-11  |g|= 8.38e-06  |ddm|= 2.18e-05
converged SCF energy = -2098.32223619931
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 31]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp1mhfgxcw
max_memory 4000 MB (current use 1997 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2uy E2ux E2gx E2gy A1u A1g E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.640585334192
CASCI E = -2098.64058533419  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -31.274942730082
2 -1
State   0 energy     -31.283222398584
3 -1
State   0 energy     -31.295485117593
4 -1
State   0 energy   -2098.685161670102
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.6851616701  dE = -0.044576336  S^2 = 0.0000000
               |grad[o]|=0.135  |ddm|=0.102  |maxRot[o]|=0.282
5 -1
State   0 energy     -31.338934201671
6 -1
State   0 energy     -31.365377906101
7 -1
State   0 energy     -31.396151617726
8 -1
State   0 energy   -2098.792386962179
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.79238696218  dE = -0.10722529  S^2 = 0.0000000
               |grad[o]|=0.0893  |ddm|= 0.17  |maxRot[o]|=0.307
9 -1
State   0 energy     -31.480527426385
10 -1
State   0 energy     -31.505726170398
11 -1
State   0 energy     -31.525683198914
12 -1
State   0 energy   -2098.897864064279
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.89786406428  dE = -0.1054771  S^2 = 0.0000000
               |grad[o]|= 0.11  |ddm|=0.0958  |maxRot[o]|=0.299
13 -1
State   0 energy     -31.654762245313
14 -1
State   0 energy     -31.676361332292
15 -1
State   0 energy     -31.783956609611
16 -1
State   0 energy   -2099.045532060302
macro iter 4 (17 JK  4 micro), CASSCF E = -2099.0455320603  dE = -0.147668  S^2 = 0.0000000
               |grad[o]|=0.299  |ddm|= 1.46  |maxRot[o]|=0.227
17 -1
State   0 energy     -31.880846763314
18 -1
State   0 energy     -31.941220709203
19 -1
State   0 energy     -31.965883424901
20 -1
State   0 energy   -2099.211633461609
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.21163346161  dE = -0.1661014  S^2 = 0.0000000
               |grad[o]|= 0.63  |ddm|= 0.13  |maxRot[o]|=0.219
21 -1
State   0 energy     -33.448848857572
22 -1
State   0 energy     -33.457729019328
23 -1
State   0 energy     -33.471374485861
24 -1
State   0 energy   -2099.236499553370
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.23649955337  dE = -0.024866092  S^2 = 0.0000000
               |grad[o]|=0.203  |ddm|=0.0579  |maxRot[o]|=0.313
25 -1
State   0 energy     -37.278889852015
26 -1
State   0 energy     -37.285226814616
27 -1
State   0 energy     -37.297512199756
28 -1
State   0 energy   -2099.241460059024
macro iter 7 (21 JK  4 micro), CASSCF E = -2099.24146005902  dE = -0.0049605057  S^2 = 0.0000000
               |grad[o]|=0.072  |ddm|=0.031  |maxRot[o]|=0.312
29 -1
State   0 energy     -41.623735141617
30 -1
State   0 energy     -41.636384193094
31 -1
State   0 energy     -41.660979918127
32 -1
State   0 energy   -2099.242660348571
macro iter 8 (21 JK  4 micro), CASSCF E = -2099.24266034857  dE = -0.0012002895  S^2 = 0.0000000
               |grad[o]|=0.0311  |ddm|=0.0136  |maxRot[o]|=0.202
33 -1
State   0 energy     -43.096326297018
34 -1
State   0 energy     -43.099338060720
35 -1
State   0 energy     -43.105876829423
36 -1
State   0 energy   -2099.244214559528
macro iter 9 (21 JK  4 micro), CASSCF E = -2099.24421455953  dE = -0.001554211  S^2 = 0.0000000
               |grad[o]|=0.0174  |ddm|=0.0114  |maxRot[o]|=0.227
37 -1
State   0 energy     -43.985114733032
38 -1
State   0 energy     -43.995173529339
39 -1
State   0 energy     -43.987450502830
40 -1
State   0 energy   -2099.247546978204
macro iter 10 (21 JK  4 micro), CASSCF E = -2099.2475469782  dE = -0.0033324187  S^2 = 0.0000000
               |grad[o]|=0.00814  |ddm|=0.00354  |maxRot[o]|=0.203
41 -1
State   0 energy     -43.216489550425
42 -1
State   0 energy     -43.228403200899
43 -1
State   0 energy     -43.216974971494
44 -1
State   0 energy   -2099.250027993481
macro iter 11 (21 JK  4 micro), CASSCF E = -2099.25002799348  dE = -0.0024810153  S^2 = 0.0000000
               |grad[o]|=0.0101  |ddm|=0.00265  |maxRot[o]|=0.159
45 -1
State   0 energy     -41.656188452870
46 -1
State   0 energy     -41.664274889550
47 -1
State   0 energy     -41.656015636077
48 -1
State   0 energy   -2099.252583143380
macro iter 12 (21 JK  4 micro), CASSCF E = -2099.25258314338  dE = -0.0025551499  S^2 = 0.0000000
               |grad[o]|=0.0116  |ddm|=0.00235  |maxRot[o]|=0.159
49 -1
State   0 energy     -39.631497574674
50 -1
State   0 energy     -39.636349309190
51 -1
State   0 energy     -39.631450825490
52 -1
State   0 energy   -2099.255345619150
macro iter 13 (21 JK  4 micro), CASSCF E = -2099.25534561915  dE = -0.0027624758  S^2 = 0.0000000
               |grad[o]|=0.0114  |ddm|=0.00307  |maxRot[o]|=0.159
53 -1
State   0 energy     -37.427598008609
54 -1
State   0 energy     -37.430759712105
55 -1
State   0 energy     -37.426496171255
56 -1
State   0 energy   -2099.257613696252
macro iter 14 (21 JK  4 micro), CASSCF E = -2099.25761369625  dE = -0.0022680771  S^2 = 0.0000000
               |grad[o]|=0.0107  |ddm|=0.00208  |maxRot[o]|=0.127
57 -1
State   0 energy     -35.743841725261
58 -1
State   0 energy     -35.743828578626
59 -1
State   0 energy     -35.747120909365
60 -1
State   0 energy   -2099.258592934008
macro iter 15 (21 JK  4 micro), CASSCF E = -2099.25859293401  dE = -0.00097923776  S^2 = 0.0000000
               |grad[o]|=0.0104  |ddm|=0.00699  |maxRot[o]|=0.0602
61 -1
State   0 energy     -35.083539511238
62 -1
State   0 energy     -35.083185005601
63 -1
State   0 energy     -35.084365912749
64 -1
State   0 energy   -2099.258903792084
macro iter 16 (21 JK  4 micro), CASSCF E = -2099.25890379208  dE = -0.00031085808  S^2 = 0.0000000
               |grad[o]|=0.0127  |ddm|=0.00561  |maxRot[o]|=0.0341
65 -1
State   0 energy     -34.878184710253
66 -1
State   0 energy     -34.875799040653
67 -1
State   0 energy     -34.878770949999
68 -1
State   0 energy   -2099.259317803527
macro iter 17 (21 JK  4 micro), CASSCF E = -2099.25931780353  dE = -0.00041401144  S^2 = 0.0000000
               |grad[o]|=0.012  |ddm|=0.00646  |maxRot[o]|=0.035
69 -1
State   0 energy     -34.575622126681
70 -1
State   0 energy     -34.572380133478
71 -1
State   0 energy     -34.575963393426
72 -1
State   0 energy   -2099.259726693509
macro iter 18 (21 JK  4 micro), CASSCF E = -2099.25972669351  dE = -0.00040888998  S^2 = 0.0000000
               |grad[o]|=0.0111  |ddm|=0.00699  |maxRot[o]|=0.0318
73 -1
State   0 energy     -34.278486031126
74 -1
State   0 energy     -34.275039850168
75 -1
State   0 energy     -34.278761346375
76 -1
State   0 energy   -2099.259983615308
macro iter 19 (21 JK  4 micro), CASSCF E = -2099.25998361531  dE = -0.0002569218  S^2 = 0.0000000
               |grad[o]|=0.0108  |ddm|=0.00676  |maxRot[o]|=0.023
77 -1
State   0 energy     -34.078801598834
78 -1
State   0 energy     -34.075194989872
79 -1
State   0 energy     -34.078973711268
80 -1
State   0 energy   -2099.260139250685
macro iter 20 (21 JK  4 micro), CASSCF E = -2099.26013925069  dE = -0.00015563538  S^2 = 0.0000000
               |grad[o]|=0.011  |ddm|=0.0065  |maxRot[o]|=0.016
81 -1
State   0 energy     -33.947817289081
82 -1
State   0 energy     -33.944086917654
83 -1
State   0 energy     -33.947921621893
84 -1
State   0 energy   -2099.260234854954
macro iter 21 (21 JK  4 micro), CASSCF E = -2099.26023485495  dE = -9.5604269e-05  S^2 = 0.0000000
               |grad[o]|=0.0115  |ddm|=0.00614  |maxRot[o]|=0.0111
85 -1
State   0 energy     -33.860699562058
86 -1
State   0 energy     -33.856884640127
87 -1
State   0 energy     -33.860746624082
88 -1
State   0 energy   -2099.260295915444
macro iter 22 (21 JK  4 micro), CASSCF E = -2099.26029591544  dE = -6.106049e-05  S^2 = 0.0000000
               |grad[o]|=0.012  |ddm|=0.00588  |maxRot[o]|=0.00783
89 -1
State   0 energy     -33.801729955373
90 -1
State   0 energy     -33.797867233761
91 -1
State   0 energy     -33.801751026223
92 -1
State   0 energy   -2099.260336270286
macro iter 23 (21 JK  4 micro), CASSCF E = -2099.26033627029  dE = -4.0354842e-05  S^2 = 0.0000000
               |grad[o]|=0.0124  |ddm|=0.00572  |maxRot[o]|=0.00562
93 -1
State   0 energy     -33.760534268036
94 -1
State   0 energy     -33.757151684189
95 -1
State   0 energy     -33.762179807389
96 -1
State   0 energy   -2099.260720967020
macro iter 24 (20 JK  4 micro), CASSCF E = -2099.26072096702  dE = -0.00038469673  S^2 = 0.0000000
               |grad[o]|=0.0128  |ddm|=0.00714  |maxRot[o]|= 0.02
97 -1
State   0 energy     -33.570857052580
98 -1
State   0 energy     -33.566883951436
99 -1
State   0 energy     -33.570972045706
100 -1
State   0 energy   -2099.260754228820
macro iter 25 (21 JK  4 micro), CASSCF E = -2099.26075422882  dE = -3.3261801e-05  S^2 = 0.0000000
               |grad[o]|=0.0113  |ddm|=0.00663  |maxRot[o]|=0.00757
101 -1
State   0 energy     -33.515842561599
102 -1
State   0 energy     -33.512350177966
103 -1
State   0 energy     -33.517608948771
104 -1
State   0 energy   -2099.261127726503
macro iter 26 (20 JK  4 micro), CASSCF E = -2099.2611277265  dE = -0.00037349768  S^2 = 0.0000000
               |grad[o]|=0.0126  |ddm|=0.00792  |maxRot[o]|= 0.02
105 -1
State   0 energy     -33.334270105701
106 -1
State   0 energy     -33.330221866103
107 -1
State   0 energy     -33.334424141931
108 -1
State   0 energy   -2099.261157385923
macro iter 27 (21 JK  4 micro), CASSCF E = -2099.26115738592  dE = -2.965942e-05  S^2 = 0.0000000
               |grad[o]|=0.0112  |ddm|=0.00751  |maxRot[o]|=0.00872
109 -1
State   0 energy     -33.275093834211
110 -1
State   0 energy     -33.271513682266
111 -1
State   0 energy     -33.276970131619
112 -1
State   0 energy   -2099.261523633750
macro iter 28 (20 JK  4 micro), CASSCF E = -2099.26152363375  dE = -0.00036624783  S^2 = 0.0000000
               |grad[o]|=0.0128  |ddm|=0.00885  |maxRot[o]|= 0.02
113 -1
State   0 energy     -33.103504559213
114 -1
State   0 energy     -33.099924144145
115 -1
State   0 energy     -33.103761273920
116 -1
State   0 energy   -2099.261888066746
macro iter 29 (18 JK  4 micro), CASSCF E = -2099.26188806675  dE = -0.000364433  S^2 = 0.0000000
               |grad[o]|=0.0113  |ddm|=0.00904  |maxRot[o]|= 0.02
117 -1
State   0 energy     -32.901249658059
118 -1
State   0 energy     -32.900630333797
119 -1
State   0 energy     -32.902516327823
120 -1
State   0 energy   -2099.262402599546
macro iter 30 (15 JK  4 micro), CASSCF E = -2099.26240259955  dE = -0.0005145328  S^2 = 0.0000000
               |grad[o]|=0.0111  |ddm|=0.0114  |maxRot[o]|=0.0294
121 -1
State   0 energy     -32.633673608145
122 -1
State   0 energy     -32.632957944081
123 -1
State   0 energy     -32.635243859764
124 -1
State   0 energy   -2099.263008977084
macro iter 31 (15 JK  4 micro), CASSCF E = -2099.26300897708  dE = -0.00060637754  S^2 = 0.0000000
               |grad[o]|=0.0112  |ddm|=0.0177  |maxRot[o]|=0.0365
125 -1
State   0 energy     -32.364637214159
126 -1
State   0 energy     -32.364218722443
127 -1
State   0 energy     -32.366561799029
128 -1
State   0 energy   -2099.264087129332
macro iter 32 (14 JK  4 micro), CASSCF E = -2099.26408712933  dE = -0.0010781522  S^2 = 0.0000000
               |grad[o]|=0.0126  |ddm|=0.0333  |maxRot[o]|=0.0497
129 -1
State   0 energy     -32.104450900982
130 -1
State   0 energy     -32.104910307279
131 -1
State   0 energy     -32.105322638561
132 -1
State   0 energy   -2099.264972141085
macro iter 33 (14 JK  4 micro), CASSCF E = -2099.26497214108  dE = -0.00088501175  S^2 = 0.0000000
               |grad[o]|=0.013  |ddm|=0.0411  |maxRot[o]|=0.0483
133 -1
State   0 energy     -31.974355797814
134 -1
State   0 energy     -31.974386323558
135 -1
State   0 energy     -31.974398069243
136 -1
State   0 energy   -2099.265039501646
macro iter 34 (14 JK  4 micro), CASSCF E = -2099.26503950165  dE = -6.7360561e-05  S^2 = 0.0000000
               |grad[o]|=0.00531  |ddm|=0.012  |maxRot[o]|=0.0131
137 -1
State   0 energy     -31.956675668047
138 -1
State   0 energy     -31.956675873296
139 -1
State   0 energy   -2099.265039924114
macro iter 35 (7 JK  2 micro), CASSCF E = -2099.26503992411  dE = -4.2246802e-07  S^2 = 0.0000000
               |grad[o]|=0.000333  |ddm|=0.000978  |maxRot[o]|=0.00114
140 -1
State   0 energy     -31.955808100794
141 -1
State   0 energy   -2099.265039940831
macro iter 36 (3 JK  1 micro), CASSCF E = -2099.26503994083  dE = -1.6717422e-08  S^2 = 0.0000000
               |grad[o]|=5.62e-05  |ddm|=0.000175  |maxRot[o]|=0.000166
1-step CASSCF converged in 36 macro (681 JK 139 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.85392345 1.85392438 1.90135299 0.2925844  0.29258351 1.7089897
 1.7089888  0.14991022 1.83053988 0.14575596 0.14575699 0.11568973]
CASSCF energy = -2099.26503994083
CASCI E = -2099.26503994083  E(CI) = -31.9557300814699  S^2 = 0.0000000
energy =  -2099.2650399408312
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 14, 15, 10, 11, 5, 0, 2, 3, 5, 6, 7, 0, 0, 10, 11, 5, 2, 3, 6, 7, 14, 15, 6, 7, 0, 5, 2, 3, 5, 0, 0, 2, 3, 10, 11, 5, 6, 7, 2, 3, 5, 0, 14, 15, 6, 7, 0, 2, 3, 16, 17, 10, 11, 12, 13, 5, 0, 5, 2, 3, 14, 15, 6, 7, 0, 5, 10, 11, 6, 7, 14, 15, 6, 7, 0, 2, 3, 5, 20, 21, 16, 17, 2, 3, 5, 0, 10, 11, 24, 25, 6, 7, 2, 3, 14, 15, 16, 17, 12, 13, 0, 10, 11, 12, 13, 6, 7, 0, 5, 5, 14, 15, 0, 10, 11, 14, 15, 5, 6, 7, 2, 3, 6, 7, 2, 3, 2, 3, 0, 5, 20, 21, 0, 16, 17, 26, 27, 22, 23, 10, 11, 6, 7, 0, 24, 25, 14, 15, 2, 3, 5, 12, 13, 6, 7, 16, 17, 20, 21, 0, 5, 24, 25, 10, 11, 16, 17, 12, 13, 12, 13, 10, 11, 14, 15, 5, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 6, 7, 2, 3, 0, 5, 0, 2, 3, 10, 11, 6, 7, 16, 17, 0, 20, 21, 26, 27, 22, 23, 30, 31, 34, 35, 24, 25, 12, 13, 5, 14, 15, 2, 3, 5, 20, 21, 16, 17, 26, 27, 2, 3, 22, 23, 24, 25, 14, 15, 0, 10, 11, 6, 7, 12, 13, 5, 16, 17, 10, 11, 12, 13, 6, 7, 0, 16, 17, 20, 21, 10, 11, 24, 25, 12, 13, 14, 15, 5, 2, 3, 6, 7, 14, 15, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 63 64 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 23:27:48 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.840000000000 AA    0.000000000000   0.000000000000   1.587369944635 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.840000000000 AA    0.000000000000   0.000000000000  -1.587369944635 Bohr   0.0

nuclear repulsion = 181.432186601143
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    587490.33


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp56foie74
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.54659514035
HOMO (E2ux) = -0.223865376701856  LUMO (E2ux) = -0.223865376701856
cycle= 1 E= -2098.48150341526  delta_E= 0.0651  |g|=    1  |ddm|= 2.48
HOMO (E2gy) = 0.192289456010268  LUMO (E1ux) = 0.0477344679978413
cycle= 2 E= -2097.36280537267  delta_E= 1.12  |g|= 2.23  |ddm|=  934
HOMO (E2gy) = -0.0655563586926612  LUMO (E2ux) = -0.201112598175798
cycle= 3 E= -2098.52687221941  delta_E= -1.16  |g|= 0.376  |ddm|=  934
HOMO (E2gy) = -0.0327479412156149  LUMO (E2ux) = -0.242003349155766
cycle= 4 E= -2098.54784227187  delta_E= -0.021  |g|= 0.167  |ddm|= 0.171
HOMO (E2gy) = -0.0241698029785649  LUMO (E2gy) = -0.0241698029785649
cycle= 5 E= -2098.15058447486  delta_E= 0.397  |g|= 0.758  |ddm|= 1.88
HOMO (E2gy) = -0.00551818889138924  LUMO (A1u) = -0.00861702071754297
cycle= 6 E= -2098.17804513455  delta_E= -0.0275  |g|= 0.626  |ddm|= 0.086
HOMO (E2gy) = 0.0685728248233121  LUMO (A1u) = 0.00687122612496963
cycle= 7 E= -2098.20055037106  delta_E= -0.0225  |g|= 0.134  |ddm|= 0.588
HOMO (E2gy) = 0.0520351721294118  LUMO (A1u) = 0.00469022041569711
cycle= 8 E= -2098.22086355766  delta_E= -0.0203  |g|= 0.128  |ddm|= 0.148
HOMO (E2gy) = 0.0529295794789678  LUMO (A1u) = 0.00473300493949616
cycle= 9 E= -2098.22029823959  delta_E= 0.000565  |g|= 0.124  |ddm|= 0.0224
HOMO (E2gy) = 0.0628062152694288  LUMO (A1u) = 0.00919231851074577
cycle= 10 E= -2098.2087889485  delta_E= 0.0115  |g|= 0.124  |ddm|= 0.123
HOMO (E2gy) = 0.0754904020199535  LUMO (A1u) = 0.0159600409558001
cycle= 11 E= -2098.15730042164  delta_E= 0.0515  |g|= 0.331  |ddm|= 0.485
HOMO (E2gy) = 0.063981916375823  LUMO (A1u) = 0.0139044299237285
cycle= 12 E= -2098.1999056612  delta_E= -0.0426  |g|= 0.157  |ddm|= 0.228
HOMO (E2gy) = 0.0685162630595123  LUMO (A1u) = 0.0149993763964567
cycle= 13 E= -2098.18435301092  delta_E= 0.0156  |g|= 0.214  |ddm|= 0.132
HOMO (E2gy) = 0.0793845400568647  LUMO (A1u) = 0.0173761491564266
cycle= 14 E= -2098.13347315509  delta_E= 0.0509  |g|= 0.416  |ddm|= 0.444
HOMO (E2gy) = 0.083083144641157  LUMO (A1u) = 0.0188961084349596
cycle= 15 E= -2098.13368783579  delta_E= -0.000215  |g|= 0.401  |ddm|= 0.141
HOMO (E2gy) = 0.078276535463053  LUMO (A1u) = 0.0181571049303935
cycle= 16 E= -2098.15381268158  delta_E= -0.0201  |g|= 0.346  |ddm|= 0.121
HOMO (E2gy) = 0.0693516852861313  LUMO (A1u) = 0.0163746146983194
cycle= 17 E= -2098.19953688628  delta_E= -0.0457  |g|= 0.156  |ddm|= 0.353
HOMO (E2gy) = 0.0761628147273228  LUMO (A1u) = 0.0187974702679269
cycle= 18 E= -2098.17299703746  delta_E= 0.0265  |g|= 0.251  |ddm|= 0.241
HOMO (E2gy) = 0.0675206480709775  LUMO (A1u) = 0.0164692460810751
cycle= 19 E= -2098.20372281281  delta_E= -0.0307  |g|= 0.151  |ddm|= 0.294
HOMO (E2gy) = 0.0596336296193227  LUMO (A1u) = 0.0143165251882763
cycle= 20 E= -2098.2157018245  delta_E= -0.012  |g|= 0.112  |ddm|= 0.0925
HOMO (E2gy) = 0.051687735668876  LUMO (A1u) = 0.0109300976235525
cycle= 21 E= -2098.22915454944  delta_E= -0.0135  |g|= 0.132  |ddm|= 0.438
HOMO (E2gy) = 0.060670723183628  LUMO (A1u) = 0.0138384762510966
cycle= 22 E= -2098.1951457053  delta_E= 0.034  |g|= 0.236  |ddm|= 0.607
HOMO (E2gy) = 0.0606525388175483  LUMO (A1u) = 0.0137525665273032
cycle= 23 E= -2098.19573860091  delta_E= -0.000593  |g|= 0.234  |ddm|= 0.0353
HOMO (E2gy) = 0.0677319001165675  LUMO (A1u) = 0.0166313905320377
cycle= 24 E= -2098.20503934949  delta_E= -0.0093  |g|= 0.138  |ddm|= 0.389
HOMO (E2gy) = 0.0642374818866558  LUMO (A1u) = 0.0152735322502236
cycle= 25 E= -2098.20608188664  delta_E= -0.00104  |g|= 0.135  |ddm|= 0.0814
HOMO (E2gy) = 0.0654166909888116  LUMO (A1u) = 0.0156013225369111
cycle= 26 E= -2098.19772277217  delta_E= 0.00836  |g|= 0.159  |ddm|= 0.165
HOMO (E2gy) = 0.0692042741593753  LUMO (A1u) = 0.0166635709424451
cycle= 27 E= -2098.16815042953  delta_E= 0.0296  |g|= 0.333  |ddm|= 0.338
HOMO (E2gy) = 0.0656561372883066  LUMO (A1u) = 0.0151406807653483
cycle= 28 E= -2098.19146597358  delta_E= -0.0233  |g|= 0.235  |ddm|= 0.196
HOMO (E2gy) = 0.0661821373300342  LUMO (A1u) = 0.0150825638196525
cycle= 29 E= -2098.18273290896  delta_E= 0.00873  |g|= 0.248  |ddm|= 0.249
HOMO (E2gy) = 0.0622397337612098  LUMO (A1u) = 0.0143087631393256
cycle= 30 E= -2098.20728732181  delta_E= -0.0246  |g|= 0.116  |ddm|= 0.235
HOMO (E2gy) = 0.0577223973744328  LUMO (A1u) = 0.0125768576167277
cycle= 31 E= -2098.2088619129  delta_E= -0.00157  |g|= 0.114  |ddm|= 0.0887
HOMO (E2gy) = 0.0577225415065617  LUMO (A1u) = 0.0126899497849242
cycle= 32 E= -2098.21000550965  delta_E= -0.00114  |g|= 0.113  |ddm|= 0.0342
SCF not converged.
SCF energy = -2098.21000550965
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp56foie74
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2uy E2ux A1g E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.517037399360
CASCI E = -2098.51703739936  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.695529948570
2 -1
State   0 energy     -30.795810201833
3 -1
State   0 energy     -30.874411507077
4 -1
State   0 energy   -2098.839897965664
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.83989796566  dE = -0.32286057  S^2 = 0.0000000
               |grad[o]|=  0.8  |ddm|=0.855  |maxRot[o]|=0.312
5 -1
State   0 energy     -30.987069600200
6 -1
State   0 energy     -31.009112837954
7 -1
State   0 energy     -31.040470665582
8 -1
State   0 energy   -2098.956251917041
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.95625191704  dE = -0.11635395  S^2 = 0.0000000
               |grad[o]|=0.262  |ddm|=0.239  |maxRot[o]|=0.273
9 -1
State   0 energy     -31.088028386543
10 -1
State   0 energy     -31.138301334218
11 -1
State   0 energy     -31.190761066672
12 -1
State   0 energy   -2099.146082061226
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.14608206123  dE = -0.18983014  S^2 = 0.0000000
               |grad[o]|=0.165  |ddm|=0.204  |maxRot[o]|=0.306
13 -1
State   0 energy     -31.315194083474
14 -1
State   0 energy     -31.343919580667
15 -1
State   0 energy     -31.358167569481
16 -1
State   0 energy   -2099.237930997232
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.23793099723  dE = -0.091848936  S^2 = 0.0000000
               |grad[o]|=0.143  |ddm|=0.104  |maxRot[o]|=0.302
17 -1
State   0 energy     -31.501201813710
18 -1
State   0 energy     -31.506792084631
19 -1
State   0 energy     -31.512751798363
20 -1
State   0 energy   -2099.256641561569
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.25664156157  dE = -0.018710564  S^2 = 0.0000000
               |grad[o]|=0.0519  |ddm|=0.0299  |maxRot[o]|=0.298
21 -1
State   0 energy     -31.792845045286
22 -1
State   0 energy     -31.795989601821
23 -1
State   0 energy     -31.798653982144
24 -1
State   0 energy   -2099.267308197711
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.26730819771  dE = -0.010666636  S^2 = 0.0000000
               |grad[o]|=0.0313  |ddm|=0.0266  |maxRot[o]|=0.306
25 -1
State   0 energy     -31.589982672575
26 -1
State   0 energy     -31.591412836867
27 -1
State   0 energy     -31.591896246105
28 -1
State   0 energy   -2099.268778935923
macro iter 7 (16 JK  4 micro), CASSCF E = -2099.26877893592  dE = -0.0014707382  S^2 = 0.0000000
               |grad[o]|=0.0115  |ddm|=0.0535  |maxRot[o]|=0.0781
29 -1
State   0 energy     -31.408523169996
30 -1
State   0 energy     -31.408558752665
31 -1
State   0 energy     -31.408569730681
32 -1
State   0 energy   -2099.268850134566
macro iter 8 (13 JK  4 micro), CASSCF E = -2099.26885013457  dE = -7.1198642e-05  S^2 = 0.0000000
               |grad[o]|=0.00567  |ddm|=0.0146  |maxRot[o]|=0.0158
33 -1
State   0 energy     -31.390466980532
34 -1
State   0 energy     -31.390467194236
35 -1
State   0 energy   -2099.268850644900
macro iter 9 (7 JK  2 micro), CASSCF E = -2099.2688506449  dE = -5.103343e-07  S^2 = 0.0000000
               |grad[o]|=0.000292  |ddm|=0.00116  |maxRot[o]|=0.00126
36 -1
State   0 energy     -31.389503204742
37 -1
State   0 energy   -2099.268850673297
macro iter 10 (4 JK  1 micro), CASSCF E = -2099.2688506733  dE = -2.8397608e-08  S^2 = 0.0000000
               |grad[o]|=6.79e-05  |ddm|=0.000221  |maxRot[o]|=0.000236
1-step CASSCF converged in 10 macro (166 JK 35 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.78420742 1.81685334 1.81685336 0.3979951  0.39799484 1.89912293
 1.60283722 0.14114042 1.60283744 0.1831905  0.18319053 0.17377691]
CASSCF energy = -2099.2688506733
CASCI E = -2099.2688506733  E(CI) = -31.3893868546188  S^2 = 0.0000000
energy =  -2099.2688506732975
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 14, 15, 0, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 5, 10, 11, 2, 3, 6, 7, 14, 15, 6, 7, 0, 5, 5, 2, 3, 0, 0, 2, 3, 5, 10, 11, 5, 6, 7, 2, 3, 0, 14, 15, 6, 7, 0, 2, 3, 16, 17, 10, 11, 12, 13, 5, 0, 5, 2, 3, 14, 15, 6, 7, 5, 0, 10, 11, 6, 7, 14, 15, 6, 7, 0, 2, 3, 5, 16, 17, 20, 21, 2, 3, 5, 0, 10, 11, 24, 25, 6, 7, 2, 3, 14, 15, 16, 17, 0, 12, 13, 12, 13, 10, 11, 0, 6, 7, 5, 5, 14, 15, 0, 10, 11, 14, 15, 6, 7, 5, 2, 3, 6, 7, 2, 3, 2, 3, 0, 5, 16, 17, 20, 21, 0, 26, 27, 22, 23, 10, 11, 0, 6, 7, 24, 25, 5, 2, 3, 14, 15, 12, 13, 20, 21, 6, 7, 16, 17, 0, 24, 25, 16, 17, 10, 11, 5, 12, 13, 12, 13, 10, 11, 14, 15, 2, 3, 5, 6, 7, 14, 15, 5, 2, 3, 0, 0, 5, 10, 11, 6, 7, 14, 15, 6, 7, 2, 3, 0, 0, 5, 2, 3, 10, 11, 6, 7, 0, 16, 17, 20, 21, 26, 27, 22, 23, 30, 31, 34, 35, 24, 25, 5, 12, 13, 14, 15, 2, 3, 5, 20, 21, 16, 17, 26, 27, 22, 23, 2, 3, 24, 25, 10, 11, 0, 14, 15, 12, 13, 6, 7, 5, 16, 17, 10, 11, 12, 13, 0, 6, 7, 16, 17, 20, 21, 24, 25, 10, 11, 12, 13, 14, 15, 2, 3, 5, 6, 7, 14, 15, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 63 64 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 01:01:40 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.900000000000 AA    0.000000000000   0.000000000000   1.700753512109 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.900000000000 AA    0.000000000000   0.000000000000  -1.700753512109 Bohr   0.0

nuclear repulsion = 169.3367074944
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    670703.25


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpl9lqgv54
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.34848224
HOMO (E2ux) = -0.214946752831738  LUMO (E2ux) = -0.214946752831738
cycle= 1 E= -2098.47349127078  delta_E= -0.125  |g|= 0.945  |ddm|= 2.42
HOMO (E2ux) = 0.289163240771994  LUMO (E1ux) = 0.0485531770649081
cycle= 2 E= -2097.45013352966  delta_E= 1.02  |g|= 2.18  |ddm|=  645
HOMO (E2ux) = 0.051963193552535  LUMO (A1u) = -0.0566659385122527
cycle= 3 E= -2098.55077596426  delta_E= -1.1  |g|= 0.473  |ddm|=  645
HOMO (E2ux) = 0.07942476607888  LUMO (A1u) = -0.0298900028986602
cycle= 4 E= -2098.57903565103  delta_E= -0.0283  |g|= 0.279  |ddm|= 0.236
HOMO (E2ux) = 0.093334882884882  LUMO (A1u) = -0.00525197309111849
cycle= 5 E= -2098.58038145462  delta_E= -0.00135  |g|= 0.236  |ddm|= 0.206
HOMO (E2ux) = 0.0791853908229994  LUMO (A1u) = -0.00399529978155059
cycle= 6 E= -2098.5888582319  delta_E= -0.00848  |g|= 0.244  |ddm|= 0.209
HOMO (E2ux) = 0.0793454303307972  LUMO (A1u) = -0.0040216282575258
cycle= 7 E= -2098.58886914251  delta_E= -1.09e-05  |g|= 0.244  |ddm|= 0.00643
HOMO (E2ux) = 0.0844938594667752  LUMO (A1u) = -0.00141014692811259
cycle= 8 E= -2098.57520847021  delta_E= 0.0137  |g|= 0.257  |ddm|= 0.229
HOMO (E2ux) = 0.0845687776981066  LUMO (A1u) = -0.0022323904825272
cycle= 9 E= -2098.57935494047  delta_E= -0.00415  |g|= 0.258  |ddm|= 0.0942
HOMO (E2ux) = 0.0911477688495368  LUMO (A1u) = -9.37686499078277e-05
cycle= 10 E= -2098.58130312043  delta_E= -0.00195  |g|= 0.244  |ddm|= 0.127
HOMO (E2ux) = 0.096194042672796  LUMO (A1u) = -0.000125647948972321
cycle= 11 E= -2098.57812604813  delta_E= 0.00318  |g|= 0.235  |ddm|= 0.108
HOMO (E2ux) = 0.0813256807044068  LUMO (A1u) = -0.00421186739858679
cycle= 12 E= -2098.59090304025  delta_E= -0.0128  |g|= 0.219  |ddm|= 0.218
HOMO (E2ux) = 0.11386619424084  LUMO (A1u) = 0.00483483497396334
cycle= 13 E= -2098.55819796252  delta_E= 0.0327  |g|= 0.237  |ddm|= 0.557
HOMO (E2ux) = 0.103844690006373  LUMO (A1u) = 0.00234395993192819
cycle= 14 E= -2098.57478357887  delta_E= -0.0166  |g|= 0.228  |ddm|= 0.246
HOMO (E2ux) = 0.115416363516437  LUMO (A1u) = 0.00556634781649609
cycle= 15 E= -2098.55609714692  delta_E= 0.0187  |g|= 0.236  |ddm|= 0.297
HOMO (E2ux) = 0.106431735084785  LUMO (A1u) = 0.00122029641615752
cycle= 16 E= -2098.56697903792  delta_E= -0.0109  |g|= 0.233  |ddm|= 0.239
HOMO (E2ux) = 0.108391560809496  LUMO (A1u) = 0.00400312777937567
cycle= 17 E= -2098.5605130998  delta_E= 0.00647  |g|= 0.236  |ddm|= 0.225
HOMO (E2ux) = 0.110400731365081  LUMO (A1u) = 0.00501184303035254
cycle= 18 E= -2098.55917095958  delta_E= 0.00134  |g|= 0.238  |ddm|= 0.0563
HOMO (E2ux) = 0.111283446248449  LUMO (A1u) = 0.00490553032936911
cycle= 19 E= -2098.55983006588  delta_E= -0.000659  |g|= 0.237  |ddm|= 0.0881
HOMO (E2ux) = 0.0982466090683954  LUMO (A1u) = 0.000671853540395483
cycle= 20 E= -2098.57311273327  delta_E= -0.0133  |g|= 0.227  |ddm|= 0.343
HOMO (E2ux) = 0.10254063550339  LUMO (A1u) = 0.001345821662294
cycle= 21 E= -2098.571676413  delta_E= 0.00144  |g|= 0.226  |ddm|= 0.162
HOMO (E2ux) = 0.108833310748503  LUMO (A1u) = 0.00470769510063573
cycle= 22 E= -2098.56222261059  delta_E= 0.00945  |g|= 0.23  |ddm|= 0.202
HOMO (E2ux) = 0.0951067344411917  LUMO (A1u) = 0.00101893070114181
cycle= 23 E= -2098.58439453979  delta_E= -0.0222  |g|= 0.218  |ddm|= 0.35
HOMO (E2ux) = 0.0937870475766273  LUMO (A1u) = 0.00197106592819145
cycle= 24 E= -2098.57585296341  delta_E= 0.00854  |g|= 0.241  |ddm|= 0.142
HOMO (E2ux) = 0.085963237738501  LUMO (A1u) = -0.00228638311824116
cycle= 25 E= -2098.58091093047  delta_E= -0.00506  |g|= 0.242  |ddm|= 0.192
HOMO (E2ux) = 0.0898479010712626  LUMO (A1u) = -0.000535234034148826
cycle= 26 E= -2098.57599309811  delta_E= 0.00492  |g|= 0.24  |ddm|= 0.126
HOMO (E2ux) = 0.0882579508308411  LUMO (A1u) = -0.0017253168685187
cycle= 27 E= -2098.57619358481  delta_E= -0.0002  |g|= 0.247  |ddm|= 0.102
HOMO (E2ux) = 0.0888685633895965  LUMO (A1u) = -0.00105521577860094
cycle= 28 E= -2098.57754894998  delta_E= -0.00136  |g|= 0.243  |ddm|= 0.0873
HOMO (E2ux) = 0.104769533124586  LUMO (A1u) = 0.000561715572579267
cycle= 29 E= -2098.56332425791  delta_E= 0.0142  |g|= 0.242  |ddm|= 0.368
HOMO (E2ux) = 0.115498709281704  LUMO (A1u) = 0.00425731025404406
cycle= 30 E= -2098.5500549368  delta_E= 0.0133  |g|= 0.24  |ddm|= 0.287
HOMO (E2ux) = 0.113695771173828  LUMO (A1u) = 0.00431758753665825
cycle= 31 E= -2098.55498974495  delta_E= -0.00493  |g|= 0.24  |ddm|= 0.157
HOMO (E2ux) = 0.0704850316692775  LUMO (A1u) = -0.00684570830640519
cycle= 32 E= -2098.59750489986  delta_E= -0.0425  |g|= 0.207  |ddm|= 0.746
SCF not converged.
SCF energy = -2098.59750489986
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpl9lqgv54
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2gy E2gx E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.784897531343
CASCI E = -2098.78489753134  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.046399854766
2 -1
State   0 energy     -30.067158901147
3 -1
State   0 energy     -30.090643011101
4 -1
State   0 energy   -2098.904614676836
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.90461467684  dE = -0.11971715  S^2 = 0.0000000
               |grad[o]|= 0.19  |ddm|=0.108  |maxRot[o]|=0.294
5 -1
State   0 energy     -30.202643948495
6 -1
State   0 energy     -30.246152267526
7 -1
State   0 energy     -30.295183583108
8 -1
State   0 energy   -2099.079605259957
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.07960525996  dE = -0.17499058  S^2 = 0.0000000
               |grad[o]|=0.131  |ddm|=0.247  |maxRot[o]|=0.308
9 -1
State   0 energy     -30.445577510083
10 -1
State   0 energy     -30.483686119248
11 -1
State   0 energy     -30.513129738483
12 -1
State   0 energy   -2099.214978550303
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.2149785503  dE = -0.13537329  S^2 = 0.0000000
               |grad[o]|=0.153  |ddm|=0.205  |maxRot[o]|=0.302
13 -1
State   0 energy     -30.628826269574
14 -1
State   0 energy     -30.637324260285
15 -1
State   0 energy     -30.644444034584
16 -1
State   0 energy   -2099.250190656081
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.25019065608  dE = -0.035212106  S^2 = 0.0000000
               |grad[o]|=0.0856  |ddm|=0.0635  |maxRot[o]|=0.306
17 -1
State   0 energy     -30.718967966248
18 -1
State   0 energy     -30.724317795988
19 -1
State   0 energy     -30.728728206367
20 -1
State   0 energy   -2099.268765632164
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.26876563216  dE = -0.018574976  S^2 = 0.0000000
               |grad[o]|=0.0448  |ddm|=0.0751  |maxRot[o]|=0.295
21 -1
State   0 energy     -30.687406605605
22 -1
State   0 energy     -30.687650403504
23 -1
State   0 energy     -30.687704527789
24 -1
State   0 energy   -2099.270322658438
macro iter 6 (15 JK  4 micro), CASSCF E = -2099.27032265844  dE = -0.0015570263  S^2 = 0.0000000
               |grad[o]|= 0.02  |ddm|=0.0389  |maxRot[o]|=0.0573
25 -1
State   0 energy     -30.647666379288
26 -1
State   0 energy     -30.647666679337
27 -1
State   0 energy     -30.647666752965
28 -1
State   0 energy   -2099.270323995194
macro iter 7 (10 JK  3 micro), CASSCF E = -2099.27032399519  dE = -1.3367558e-06  S^2 = 0.0000000
               |grad[o]|=0.000836  |ddm|=0.00222  |maxRot[o]|=0.00212
29 -1
State   0 energy     -30.646555531589
30 -1
State   0 energy   -2099.270324005519
macro iter 8 (3 JK  1 micro), CASSCF E = -2099.27032400552  dE = -1.0325039e-08  S^2 = 0.0000000
               |grad[o]|=4.73e-05  |ddm|=0.00016  |maxRot[o]|=0.000123
1-step CASSCF converged in 8 macro (133 JK 28 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.67876634 1.72763875 1.72763912 1.87589223 1.40323387 1.40323335
 0.59679541 0.17749841 0.27266594 0.27266631 0.26717536 0.59679492]
CASSCF energy = -2099.27032400552
CASCI E = -2099.27032400552  E(CI) = -30.6465028003986  S^2 = 0.0000000
energy =  -2099.270324005519
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 11, 10, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 5, 10, 11, 2, 3, 6, 7, 5, 0, 6, 7, 14, 15, 5, 2, 3, 0, 2, 3, 0, 5, 10, 11, 5, 6, 7, 2, 3, 0, 14, 15, 6, 7, 0, 2, 3, 16, 17, 10, 11, 12, 13, 5, 0, 5, 2, 3, 5, 6, 7, 14, 15, 0, 10, 11, 6, 7, 14, 15, 0, 6, 7, 2, 3, 2, 3, 5, 16, 17, 0, 20, 21, 5, 10, 11, 24, 25, 6, 7, 0, 2, 3, 16, 17, 12, 13, 14, 15, 12, 13, 10, 11, 0, 5, 6, 7, 14, 15, 5, 0, 10, 11, 14, 15, 6, 7, 2, 3, 5, 6, 7, 2, 3, 2, 3, 0, 5, 16, 17, 0, 20, 21, 5, 10, 11, 26, 27, 22, 23, 0, 24, 25, 6, 7, 2, 3, 12, 13, 14, 15, 20, 21, 16, 17, 24, 25, 0, 10, 11, 16, 17, 6, 7, 5, 12, 13, 12, 13, 10, 11, 14, 15, 2, 3, 5, 6, 7, 14, 15, 5, 0, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 6, 7, 2, 3, 0, 2, 3, 0, 5, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 26, 27, 22, 23, 30, 31, 34, 35, 24, 25, 12, 13, 14, 15, 2, 3, 5, 16, 17, 20, 21, 26, 27, 22, 23, 24, 25, 10, 11, 2, 3, 0, 12, 13, 6, 7, 5, 14, 15, 10, 11, 16, 17, 12, 13, 6, 7, 16, 17, 20, 21, 0, 24, 25, 12, 13, 10, 11, 14, 15, 5, 14, 15, 2, 3, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 63 64 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 02:21:34 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.950000000000 AA    0.000000000000   0.000000000000   1.795239818337 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.950000000000 AA    0.000000000000   0.000000000000  -1.795239818337 Bohr   0.0

nuclear repulsion = 160.424249205221
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    739673.79


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp8glvzr0m
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.20923923921
HOMO (E2ux) = -0.208908364776341  LUMO (E2ux) = -0.208908364776341
cycle= 1 E= -2098.44328413806  delta_E= -0.234  |g|= 0.895  |ddm|= 2.37
HOMO (E2ux) = 0.269818556519947  LUMO (E1ux) = 0.0489410682420202
cycle= 2 E= -2097.52964332532  delta_E= 0.914  |g|= 2.09  |ddm|=  447
HOMO (E2ux) = 0.0471680485315688  LUMO (A1u) = -0.0570693281618093
cycle= 3 E= -2098.50771816877  delta_E= -0.978  |g|= 0.479  |ddm|=  447
HOMO (E2ux) = 0.0679204245032779  LUMO (A1u) = -0.0338385160942983
cycle= 4 E= -2098.53899977746  delta_E= -0.0313  |g|= 0.294  |ddm|= 0.178
HOMO (E2ux) = 0.0825053177520722  LUMO (A1u) = -0.00793589079306263
cycle= 5 E= -2098.54351598663  delta_E= -0.00452  |g|= 0.238  |ddm|= 0.205
HOMO (E2ux) = 0.0684152473290333  LUMO (A1u) = -0.00482730468636441
cycle= 6 E= -2098.55031189078  delta_E= -0.0068  |g|= 0.243  |ddm|= 0.186
HOMO (E2ux) = 0.0701086456203173  LUMO (A1u) = -0.00471482768054792
cycle= 7 E= -2098.55011948142  delta_E= 0.000192  |g|= 0.245  |ddm|= 0.0353
HOMO (E2ux) = 0.0731978123053638  LUMO (A1u) = -0.00306990314852328
cycle= 8 E= -2098.5412464956  delta_E= 0.00887  |g|= 0.257  |ddm|= 0.182
HOMO (E2ux) = 0.0731490806290347  LUMO (A1u) = -0.00348769735221495
cycle= 9 E= -2098.54336025274  delta_E= -0.00211  |g|= 0.255  |ddm|= 0.0623
HOMO (E2ux) = 0.0772724907126225  LUMO (A1u) = 0.000417307457421385
cycle= 10 E= -2098.54893822661  delta_E= -0.00558  |g|= 0.226  |ddm|= 0.0684
HOMO (E2ux) = 0.0744239409822632  LUMO (A1u) = -0.00178479186835898
cycle= 11 E= -2098.5465515412  delta_E= 0.00239  |g|= 0.252  |ddm|= 0.0914
HOMO (E2ux) = 0.0736794827939775  LUMO (A1u) = -0.00253506718383918
cycle= 12 E= -2098.54815606805  delta_E= -0.0016  |g|= 0.245  |ddm|= 0.0642
HOMO (E2ux) = 0.0771790582266018  LUMO (A1u) = -0.00351571104497547
cycle= 13 E= -2098.54582407834  delta_E= 0.00233  |g|= 0.246  |ddm|= 0.0964
HOMO (E2ux) = 0.0800200733626344  LUMO (A1u) = -0.00250389540105458
cycle= 14 E= -2098.54417214226  delta_E= 0.00165  |g|= 0.246  |ddm|= 0.0356
HOMO (E2ux) = 0.0733456505984613  LUMO (A1u) = -0.00493057755723038
cycle= 15 E= -2098.54613767621  delta_E= -0.00197  |g|= 0.248  |ddm|= 0.103
HOMO (E2ux) = 0.0833888284881288  LUMO (A1u) = -0.00184553263981726
cycle= 16 E= -2098.53716249047  delta_E= 0.00898  |g|= 0.256  |ddm|= 0.127
HOMO (E2ux) = 0.0884217174121889  LUMO (A1u) = -0.000429479551219335
cycle= 17 E= -2098.53056566431  delta_E= 0.0066  |g|= 0.255  |ddm|= 0.091
HOMO (E2ux) = 0.089530706563344  LUMO (A1u) = 0.000102787563248324
cycle= 18 E= -2098.53449346004  delta_E= -0.00393  |g|= 0.239  |ddm|= 0.14
HOMO (E2ux) = 0.0882359830651202  LUMO (A1u) = -0.000652332859987406
cycle= 19 E= -2098.5288635897  delta_E= 0.00563  |g|= 0.231  |ddm|= 0.254
HOMO (E2ux) = 0.0968569865484346  LUMO (A1u) = 0.00134665171469959
cycle= 20 E= -2098.528514617  delta_E= 0.000349  |g|= 0.227  |ddm|= 0.139
HOMO (E2ux) = 0.085968977026552  LUMO (A1u) = -0.00177917410068623
cycle= 21 E= -2098.53651072543  delta_E= -0.008  |g|= 0.231  |ddm|= 0.165
HOMO (E2ux) = 0.0846663019301557  LUMO (A1u) = -0.00184317650067979
cycle= 22 E= -2098.53725397516  delta_E= -0.000743  |g|= 0.234  |ddm|= 0.0539
HOMO (E2ux) = 0.0836030499506728  LUMO (A1u) = -0.00256286740792842
cycle= 23 E= -2098.53574579806  delta_E= 0.00151  |g|= 0.236  |ddm|= 0.0392
HOMO (E2ux) = 0.090520007393941  LUMO (A1u) = 0.000711661352013332
cycle= 24 E= -2098.53516382024  delta_E= 0.000582  |g|= 0.229  |ddm|= 0.112
HOMO (E2ux) = 0.0940193451388768  LUMO (A1u) = 0.00202807707560688
cycle= 25 E= -2098.54005518043  delta_E= -0.00489  |g|= 0.215  |ddm|= 0.12
HOMO (E2ux) = 0.0912129560367681  LUMO (A1u) = 0.000432230881871001
cycle= 26 E= -2098.52804347802  delta_E= 0.012  |g|= 0.248  |ddm|= 0.183
HOMO (E2ux) = 0.0945331400943637  LUMO (A1u) = 0.000380078244956081
cycle= 27 E= -2098.52827033486  delta_E= -0.000227  |g|= 0.253  |ddm|= 0.0954
HOMO (E2ux) = 0.0943573151081402  LUMO (A1u) = 0.00205194191687851
cycle= 28 E= -2098.52497935796  delta_E= 0.00329  |g|= 0.245  |ddm|= 0.172
HOMO (E2ux) = 0.0910636548732628  LUMO (A1u) = 0.00216873801708649
cycle= 29 E= -2098.53762709594  delta_E= -0.0126  |g|= 0.237  |ddm|= 0.237
HOMO (E2ux) = 0.0915677884805623  LUMO (A1u) = 0.00164042891071762
cycle= 30 E= -2098.54027269845  delta_E= -0.00265  |g|= 0.23  |ddm|= 0.0775
HOMO (E2ux) = 0.0828722960570732  LUMO (A1u) = -0.000671092265632723
cycle= 31 E= -2098.53633620242  delta_E= 0.00394  |g|= 0.261  |ddm|= 0.123
HOMO (E2ux) = 0.0958858345572189  LUMO (A1u) = 0.0021623106939143
cycle= 32 E= -2098.52300400548  delta_E= 0.0133  |g|= 0.254  |ddm|= 0.218
SCF not converged.
SCF energy = -2098.52300400548
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp8glvzr0m
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2gy E2gx E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.706996408418
CASCI E = -2098.70699640842  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -29.420264453254
2 -1
State   0 energy     -29.462437432645
3 -1
State   0 energy     -29.485243367154
4 -1
State   0 energy   -2098.854446023144
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.85444602314  dE = -0.14744961  S^2 = 0.0000000
               |grad[o]|=0.257  |ddm|=0.0943  |maxRot[o]|=0.231
5 -1
State   0 energy     -29.603992657456
6 -1
State   0 energy     -29.648330730219
7 -1
State   0 energy     -29.702761033411
8 -1
State   0 energy   -2099.040074042795
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.04007404279  dE = -0.18562802  S^2 = 0.0000000
               |grad[o]|=0.119  |ddm|=0.274  |maxRot[o]|=0.308
9 -1
State   0 energy     -29.852991998241
10 -1
State   0 energy     -29.898608769647
11 -1
State   0 energy     -29.936178790833
12 -1
State   0 energy   -2099.203454574159
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.20345457416  dE = -0.16338053  S^2 = 0.0000000
               |grad[o]|=0.177  |ddm|=0.296  |maxRot[o]|=0.307
13 -1
State   0 energy     -30.062866168036
14 -1
State   0 energy     -30.078260493731
15 -1
State   0 energy     -30.090130069797
16 -1
State   0 energy   -2099.261191891902
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.2611918919  dE = -0.057737318  S^2 = 0.0000000
               |grad[o]|=0.113  |ddm|=0.153  |maxRot[o]|=0.284
17 -1
State   0 energy     -30.133259499699
18 -1
State   0 energy     -30.137231804051
19 -1
State   0 energy     -30.139083363959
20 -1
State   0 energy   -2099.273433454114
macro iter 5 (18 JK  4 micro), CASSCF E = -2099.27343345411  dE = -0.012241562  S^2 = 0.0000000
               |grad[o]|=0.0499  |ddm|=0.0993  |maxRot[o]|=0.215
21 -1
State   0 energy     -30.109018939300
22 -1
State   0 energy     -30.109020880363
23 -1
State   0 energy     -30.109021405953
24 -1
State   0 energy   -2099.273457152768
macro iter 6 (12 JK  4 micro), CASSCF E = -2099.27345715277  dE = -2.3698654e-05  S^2 = 0.0000000
               |grad[o]|=0.00353  |ddm|=0.00569  |maxRot[o]|=0.0078
25 -1
State   0 energy     -30.108061446479
26 -1
State   0 energy   -2099.273457159030
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.27345715903  dE = -6.2623258e-09  S^2 = 0.0000000
               |grad[o]|=3.64e-05  |ddm|=0.000125  |maxRot[o]|=0.000118
1-step CASSCF converged in 7 macro (117 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.60361784 1.62467248 1.62467257 1.81759265 1.26612432 1.26612603
 0.7337612  0.17127283 0.37556898 0.37556906 0.40725913 0.73376292]
CASSCF energy = -2099.27345715903
CASCI E = -2099.27345715903  E(CI) = -30.1080387140419  S^2 = 0.0000000
energy =  -2099.27345715903
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 11, 10, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 5, 2, 3, 10, 11, 5, 6, 7, 0, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 5, 6, 7, 0, 2, 3, 14, 15, 6, 7, 0, 2, 3, 16, 17, 10, 11, 12, 13, 5, 0, 5, 2, 3, 5, 6, 7, 14, 15, 0, 10, 11, 6, 7, 14, 15, 0, 6, 7, 2, 3, 2, 3, 0, 5, 16, 17, 20, 21, 5, 10, 11, 24, 25, 6, 7, 0, 2, 3, 16, 17, 12, 13, 12, 13, 14, 15, 10, 11, 5, 0, 6, 7, 14, 15, 5, 0, 10, 11, 2, 3, 14, 15, 6, 7, 5, 2, 3, 6, 7, 0, 2, 3, 5, 0, 5, 16, 17, 10, 11, 20, 21, 26, 27, 22, 23, 24, 25, 6, 7, 0, 12, 13, 2, 3, 14, 15, 5, 20, 21, 16, 17, 24, 25, 10, 11, 0, 16, 17, 6, 7, 12, 13, 12, 13, 14, 15, 10, 11, 5, 2, 3, 14, 15, 6, 7, 0, 5, 2, 3, 5, 0, 10, 11, 14, 15, 6, 7, 6, 7, 2, 3, 2, 3, 0, 0, 5, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 26, 27, 22, 23, 30, 31, 34, 35, 24, 25, 12, 13, 14, 15, 2, 3, 5, 16, 17, 20, 21, 10, 11, 26, 27, 22, 23, 24, 25, 12, 13, 0, 6, 7, 2, 3, 5, 14, 15, 10, 11, 16, 17, 12, 13, 6, 7, 16, 17, 20, 21, 0, 24, 25, 12, 13, 10, 11, 14, 15, 14, 15, 5, 2, 3, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 61 62 63 64 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 03:33:05 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.000000000000 AA    0.000000000000   0.000000000000   1.889726124565 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.000000000000 AA    0.000000000000   0.000000000000  -1.889726124565 Bohr   0.0

nuclear repulsion = 152.40303674496
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    801486.55


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpeddsasmk
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.08818818284
HOMO (E2ux) = -0.203951409539573  LUMO (E2ux) = -0.203951409539573
cycle= 1 E= -2098.39270192196  delta_E= -0.305  |g|= 0.839  |ddm|= 2.34
HOMO (E2gy) = 0.191626972305638  LUMO (E2ux) = 0.0442431295328256
cycle= 2 E= -2097.5235332168  delta_E= 0.869  |g|= 2.02  |ddm|=  295
HOMO (E2gy) = -0.0209654799421892  LUMO (A1u) = -0.0598500996501504
cycle= 3 E= -2098.37519139594  delta_E= -0.852  |g|= 0.488  |ddm|=  295
HOMO (E2gy) = 0.04359867909233  LUMO (A1u) = -0.0414323948149195
cycle= 4 E= -2098.37269686081  delta_E= 0.00249  |g|= 0.209  |ddm|= 0.306
HOMO (E2gy) = 0.0593704952979299  LUMO (A1u) = -0.0240144636558041
cycle= 5 E= -2098.14227749198  delta_E= 0.23  |g|= 0.588  |ddm|= 1.21
HOMO (E2gy) = 0.0375704476906558  LUMO (A1u) = -0.0226301250786314
cycle= 6 E= -2098.17787892882  delta_E= -0.0356  |g|= 0.512  |ddm|= 0.177
HOMO (E2gy) = 0.0714092475329143  LUMO (A1u) = -0.00751130528195267
cycle= 7 E= -2098.19514407326  delta_E= -0.0173  |g|= 0.204  |ddm|= 0.378
HOMO (E2gy) = 0.0399380327683189  LUMO (A1u) = 0.000449984843704416
cycle= 8 E= -2098.2496780033  delta_E= -0.0545  |g|= 0.126  |ddm|= 0.416
HOMO (E2gy) = 0.0435502248208222  LUMO (A1u) = 0.00506831921608997
cycle= 9 E= -2098.25250643404  delta_E= -0.00283  |g|= 0.215  |ddm|= 0.248
HOMO (E2gy) = 0.0660161856953503  LUMO (A1u) = 0.0131528737161498
cycle= 10 E= -2098.21048586195  delta_E= 0.042  |g|= 0.407  |ddm|= 0.311
HOMO (E2gy) = 0.0686302450412656  LUMO (A1u) = 0.0121505418137559
cycle= 11 E= -2098.20189880985  delta_E= 0.00859  |g|= 0.396  |ddm|= 0.217
HOMO (E2gy) = 0.0666287226471298  LUMO (A1u) = 0.0124939323909666
cycle= 12 E= -2098.20167481027  delta_E= 0.000224  |g|= 0.401  |ddm|= 0.394
HOMO (E2gy) = 0.0810508358742297  LUMO (A1u) = 0.0116501669489294
cycle= 13 E= -2098.17172410796  delta_E= 0.03  |g|= 0.368  |ddm|= 0.389
HOMO (E2gy) = 0.0743697669060149  LUMO (A1u) = 0.00973195188216966
cycle= 14 E= -2098.19166936352  delta_E= -0.0199  |g|= 0.329  |ddm|= 0.104
HOMO (E2gy) = 0.0476456372401375  LUMO (A1u) = 0.000980887641135077
cycle= 15 E= -2098.24471336823  delta_E= -0.053  |g|= 0.153  |ddm|= 0.435
HOMO (E2gy) = 0.0599294025441123  LUMO (A1u) = 0.00562990809339736
cycle= 16 E= -2098.22094815204  delta_E= 0.0238  |g|= 0.216  |ddm|= 0.259
HOMO (E2gy) = 0.0573569569096016  LUMO (A1u) = 0.00546751964306489
cycle= 17 E= -2098.22071354018  delta_E= 0.000235  |g|= 0.159  |ddm|= 0.26
HOMO (E2gy) = 0.0807215745313657  LUMO (A1u) = 0.0161559153709209
cycle= 18 E= -2098.11125521902  delta_E= 0.109  |g|= 0.503  |ddm|= 1.06
HOMO (E2gy) = 0.0809444525320677  LUMO (A1u) = 0.0162659481374549
cycle= 19 E= -2098.10863167714  delta_E= 0.00262  |g|= 0.511  |ddm|= 0.0776
HOMO (E2gy) = 0.0753431113851457  LUMO (A1u) = 0.0147971194577233
cycle= 20 E= -2098.14320553357  delta_E= -0.0346  |g|= 0.407  |ddm|= 0.447
HOMO (E2gy) = 0.0695543145893006  LUMO (A1u) = 0.0128568615508288
cycle= 21 E= -2098.16606040218  delta_E= -0.0229  |g|= 0.347  |ddm|= 0.192
HOMO (E2gy) = 0.0724681010019031  LUMO (A1u) = 0.0133830461708973
cycle= 22 E= -2098.13637347936  delta_E= 0.0297  |g|= 0.435  |ddm|= 0.523
HOMO (E2gy) = 0.0707928353356511  LUMO (A1u) = 0.0117589326393916
cycle= 23 E= -2098.17257472277  delta_E= -0.0362  |g|= 0.32  |ddm|= 0.674
HOMO (E2gy) = 0.0698696693576458  LUMO (A1u) = 0.0117549747062939
cycle= 24 E= -2098.17285795415  delta_E= -0.000283  |g|= 0.32  |ddm|= 0.0708
HOMO (E2gy) = 0.0582834602092736  LUMO (A1u) = 0.00524641567695072
cycle= 25 E= -2098.23127854928  delta_E= -0.0584  |g|= 0.144  |ddm|= 0.842
HOMO (E2gy) = 0.0521692880944148  LUMO (A1u) = 0.00284875321231269
cycle= 26 E= -2098.24540800298  delta_E= -0.0141  |g|= 0.139  |ddm|= 0.19
HOMO (E2gy) = 0.0621717351745076  LUMO (A1u) = 0.00726047018794376
cycle= 27 E= -2098.21775032154  delta_E= 0.0277  |g|= 0.186  |ddm|= 0.361
HOMO (E2gy) = 0.0646160701680599  LUMO (A1u) = 0.00858320849444286
cycle= 28 E= -2098.20986856701  delta_E= 0.00788  |g|= 0.207  |ddm|= 0.107
HOMO (E2gy) = 0.0600235758103111  LUMO (A1u) = 0.00698408228616884
cycle= 29 E= -2098.22061504315  delta_E= -0.0107  |g|= 0.173  |ddm|= 0.0964
HOMO (E2gy) = 0.0812865375142608  LUMO (A1u) = 0.0165964729706628
cycle= 30 E= -2098.0469036517  delta_E= 0.174  |g|=  0.6  |ddm|=  5.7
HOMO (E2gy) = 0.0817154875845241  LUMO (A1u) = 0.0167158011544013
cycle= 31 E= -2098.03359146556  delta_E= 0.0133  |g|= 0.614  |ddm|= 1.17
HOMO (E2gy) = 0.0854651452516792  LUMO (A1u) = 0.0183448326359139
cycle= 32 E= -2098.09527271369  delta_E= -0.0617  |g|= 0.571  |ddm|=  6.8
SCF not converged.
SCF energy = -2098.09527271369
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpeddsasmk
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2uy E2ux A1g E2gy A1u E1gx E1gy A1u E2gx
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.184995893876
CASCI E = -2098.18499589388  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.544757780002
2 -1
State   0 energy     -28.647388205565
3 -1
State   0 energy     -28.738559413446
4 -1
State   0 energy   -2098.569547407864
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.56954740786  dE = -0.38455151  S^2 = 0.0000000
               |grad[o]|=0.733  |ddm|=  1.5  |maxRot[o]|=0.313
5 -1
State   0 energy     -28.954526371514
6 -1
State   0 energy     -29.014239643706
7 -1
State   0 energy     -29.048093306723
8 -1
State   0 energy   -2098.806102651475
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.80610265148  dE = -0.23655524  S^2 = 0.0000000
               |grad[o]|=0.755  |ddm|=0.263  |maxRot[o]|=0.259
9 -1
State   0 energy     -29.272026777270
10 -1
State   0 energy     -29.307326819216
11 -1
State   0 energy     -29.340350805279
12 -1
State   0 energy   -2098.934995110129
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.93499511013  dE = -0.12889246  S^2 = 0.0000000
               |grad[o]|= 0.28  |ddm|=0.367  |maxRot[o]|=0.305
13 -1
State   0 energy     -29.437051530033
14 -1
State   0 energy     -29.467924336215
15 -1
State   0 energy     -29.505652402491
16 -1
State   0 energy   -2099.069323026720
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.06932302672  dE = -0.13432792  S^2 = 0.0000000
               |grad[o]|=0.173  |ddm|=0.218  |maxRot[o]|=0.305
17 -1
State   0 energy     -29.637591211994
18 -1
State   0 energy     -29.679711639218
19 -1
State   0 energy     -29.716505527024
20 -1
State   0 energy   -2099.222723065941
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.22272306594  dE = -0.15340004  S^2 = 0.0000000
               |grad[o]|=0.164  |ddm|=0.383  |maxRot[o]|=0.308
21 -1
State   0 energy     -29.973509513490
22 -1
State   0 energy     -29.981462927050
23 -1
State   0 energy     -29.987716151991
24 -1
State   0 energy   -2099.264392733373
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.26439273337  dE = -0.041669667  S^2 = 0.0000000
               |grad[o]|=0.106  |ddm|=0.125  |maxRot[o]|=0.266
25 -1
State   0 energy     -29.826505970671
26 -1
State   0 energy     -29.831041517015
27 -1
State   0 energy     -29.835798265229
28 -1
State   0 energy   -2099.278417511950
macro iter 7 (21 JK  4 micro), CASSCF E = -2099.27841751195  dE = -0.014024779  S^2 = 0.0000000
               |grad[o]|=0.0397  |ddm|=0.112  |maxRot[o]|=  0.3
29 -1
State   0 energy     -29.627994588528
30 -1
State   0 energy     -29.628118265367
31 -1
State   0 energy     -29.628131381401
32 -1
State   0 energy   -2099.279051581295
macro iter 8 (12 JK  4 micro), CASSCF E = -2099.27905158129  dE = -0.00063406934  S^2 = 0.0000000
               |grad[o]|=0.0183  |ddm|=0.0352  |maxRot[o]|=0.0397
33 -1
State   0 energy     -29.627840721564
34 -1
State   0 energy     -29.627840745917
35 -1
State   0 energy   -2099.279051829288
macro iter 9 (7 JK  2 micro), CASSCF E = -2099.27905182929  dE = -2.4799283e-07  S^2 = 0.0000000
               |grad[o]|=0.000374  |ddm|=0.000835  |maxRot[o]|=0.000895
36 -1
State   0 energy     -29.627744574043
37 -1
State   0 energy   -2099.279051834397
macro iter 10 (3 JK  1 micro), CASSCF E = -2099.2790518344  dE = -5.1095412e-09  S^2 = 0.0000000
               |grad[o]|=4.23e-05  |ddm|=8e-05  |maxRot[o]|=6.43e-05
1-step CASSCF converged in 10 macro (169 JK 35 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.54809612 1.51193899 1.51193915 0.82215922 0.82215876 1.74266344
 1.17776386 0.25858058 0.48818943 0.48818959 0.45055659 1.17776427]
CASSCF energy = -2099.2790518344
CASCI E = -2099.2790518344  E(CI) = -29.6277149880639  S^2 = 0.0000000
energy =  -2099.2790518343973
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 14, 15, 0, 11, 5, 2, 3, 5, 10, 6, 7, 0, 0, 5, 5, 2, 3, 10, 11, 14, 15, 6, 7, 0, 6, 7, 5, 2, 3, 0, 2, 3, 0, 5, 10, 11, 5, 0, 6, 7, 14, 15, 2, 3, 6, 7, 0, 2, 3, 16, 17, 10, 11, 12, 13, 5, 5, 0, 6, 7, 5, 2, 3, 14, 15, 0, 10, 11, 6, 7, 14, 15, 0, 6, 7, 2, 3, 2, 3, 0, 5, 16, 17, 20, 21, 10, 11, 5, 24, 25, 6, 7, 0, 12, 13, 2, 3, 16, 17, 12, 13, 5, 10, 11, 14, 15, 0, 6, 7, 14, 15, 5, 0, 2, 3, 10, 11, 14, 15, 6, 7, 5, 2, 3, 6, 7, 0, 2, 3, 5, 0, 5, 16, 17, 10, 11, 20, 21, 26, 27, 22, 23, 24, 25, 6, 7, 12, 13, 0, 2, 3, 14, 15, 5, 16, 17, 20, 21, 24, 25, 10, 11, 16, 17, 0, 6, 7, 12, 13, 12, 13, 10, 11, 14, 15, 5, 2, 3, 14, 15, 6, 7, 0, 2, 3, 5, 5, 0, 10, 11, 14, 15, 6, 7, 2, 3, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 26, 27, 22, 23, 24, 25, 30, 31, 34, 35, 12, 13, 14, 15, 2, 3, 5, 16, 17, 10, 11, 20, 21, 26, 27, 22, 23, 24, 25, 6, 7, 12, 13, 0, 2, 3, 5, 14, 15, 10, 11, 16, 17, 6, 7, 12, 13, 5, 16, 17, 0, 14, 15, 20, 21, 24, 25, 12, 13, 10, 11, 14, 15, 2, 3, 6, 7, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 59 60 61 62 63 64 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 05:09:31 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.100000000000 AA    0.000000000000   0.000000000000   2.078698737022 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.100000000000 AA    0.000000000000   0.000000000000  -2.078698737022 Bohr   0.0

nuclear repulsion = 138.548215222691
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    884663.30


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpm6x80xa6
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.88931187197
HOMO (E2ux) = -0.196645869366893  LUMO (E2ux) = -0.196645869366893
cycle= 1 E= -2098.3140384878  delta_E= -0.425  |g|= 0.788  |ddm|=  2.3
HOMO (E2ux) = 0.30229604599273  LUMO (A1u) = 0.0103468105439144
cycle= 2 E= -2098.07555325993  delta_E= 0.238  |g|= 1.16  |ddm|= 2.98
HOMO (E2ux) = 0.115950242959976  LUMO (A1u) = -0.00678652145874746
cycle= 3 E= -2098.27856661562  delta_E= -0.203  |g|= 0.21  |ddm|= 3.12
HOMO (E2ux) = 0.0761114671476162  LUMO (A1u) = -0.00963391216764752
cycle= 4 E= -2098.33470630897  delta_E= -0.0561  |g|= 0.158  |ddm|= 0.698
HOMO (E2ux) = 0.0806813267513673  LUMO (A1u) = -0.00614518223390258
cycle= 5 E= -2098.33802100719  delta_E= -0.00331  |g|= 0.16  |ddm|= 0.156
HOMO (E2ux) = 0.0730381519864065  LUMO (A1u) = -0.00936462374115642
cycle= 6 E= -2098.34371932771  delta_E= -0.0057  |g|= 0.152  |ddm|= 0.131
HOMO (E2ux) = 0.0725070752664617  LUMO (A1u) = -0.00954546931310029
cycle= 7 E= -2098.34404228702  delta_E= -0.000323  |g|= 0.152  |ddm|= 0.01
HOMO (E2ux) = 0.0717175822075464  LUMO (A1u) = -0.00979385776393589
cycle= 8 E= -2098.3444314353  delta_E= -0.000389  |g|= 0.151  |ddm|= 0.0154
HOMO (E2ux) = 0.0783520885883757  LUMO (A1u) = -0.00820328777176325
cycle= 9 E= -2098.34030747036  delta_E= 0.00412  |g|= 0.159  |ddm|= 0.292
HOMO (E2ux) = 0.0706464470809943  LUMO (A1u) = -0.0069110605828941
cycle= 10 E= -2098.34415673814  delta_E= -0.00385  |g|= 0.152  |ddm|= 0.671
HOMO (E2ux) = 0.0734383359377176  LUMO (A1u) = -0.00555520109772835
cycle= 11 E= -2098.34272424343  delta_E= 0.00143  |g|= 0.153  |ddm|= 1.12
HOMO (E2ux) = 0.0756701983057314  LUMO (A1u) = -0.00426037269129552
cycle= 12 E= -2098.34045189521  delta_E= 0.00227  |g|= 0.154  |ddm|= 0.362
HOMO (E2ux) = 0.0717085599264747  LUMO (A1u) = -0.00553784411044278
cycle= 13 E= -2098.34399032901  delta_E= -0.00354  |g|= 0.149  |ddm|= 0.336
HOMO (E2ux) = 0.0680628093833176  LUMO (A1u) = -0.00657153645495522
cycle= 14 E= -2098.34610374703  delta_E= -0.00211  |g|= 0.145  |ddm|= 0.0446
HOMO (E2ux) = 0.0669054800517507  LUMO (A1u) = -0.00694735750808771
cycle= 15 E= -2098.34669806937  delta_E= -0.000594  |g|= 0.144  |ddm|= 0.126
HOMO (E2ux) = 0.0640029229407297  LUMO (A1u) = -0.00784714074578735
cycle= 16 E= -2098.34830161097  delta_E= -0.0016  |g|= 0.142  |ddm|= 0.0864
HOMO (E2ux) = 0.0627853951113264  LUMO (A1u) = -0.00813454211168213
cycle= 17 E= -2098.34891710904  delta_E= -0.000615  |g|= 0.143  |ddm|= 0.127
HOMO (E2ux) = 0.0598903921491608  LUMO (A1u) = -0.00962047662005634
cycle= 18 E= -2098.35036414137  delta_E= -0.00145  |g|= 0.141  |ddm|= 0.0699
HOMO (E2ux) = 0.06066946494191  LUMO (A1u) = -0.0106897379731504
cycle= 19 E= -2098.34942570144  delta_E= 0.000938  |g|= 0.143  |ddm|= 0.645
HOMO (E2ux) = 0.0617176310835291  LUMO (A1u) = -0.0102128657736471
cycle= 20 E= -2098.34910976383  delta_E= 0.000316  |g|= 0.143  |ddm|= 0.125
HOMO (E2ux) = 0.0596174299878595  LUMO (A1u) = -0.0110069871140184
cycle= 21 E= -2098.34988989244  delta_E= -0.00078  |g|= 0.142  |ddm|= 0.193
HOMO (E2ux) = 0.0596818694738404  LUMO (A1u) = -0.0111456759120595
cycle= 22 E= -2098.34969301138  delta_E= 0.000197  |g|= 0.143  |ddm|= 0.187
HOMO (E2ux) = 0.0602999809244339  LUMO (A1u) = -0.010894347348153
cycle= 23 E= -2098.3493819953  delta_E= 0.000311  |g|= 0.143  |ddm|= 0.253
HOMO (E2ux) = 0.0614394304776736  LUMO (A1u) = -0.0102318855552398
cycle= 24 E= -2098.34922225016  delta_E= 0.00016  |g|= 0.143  |ddm|= 0.171
HOMO (E2ux) = 0.0622303444629962  LUMO (A1u) = -0.0099941478522861
cycle= 25 E= -2098.34927025112  delta_E= -4.8e-05  |g|= 0.143  |ddm|= 0.516
HOMO (E2ux) = 0.0594630691783873  LUMO (A1u) = -0.0105303528894622
cycle= 26 E= -2098.35053255442  delta_E= -0.00126  |g|= 0.141  |ddm|= 0.183
HOMO (E2ux) = 0.0587361256185801  LUMO (A1u) = -0.0110172707646338
cycle= 27 E= -2098.35077022959  delta_E= -0.000238  |g|= 0.141  |ddm|= 0.107
HOMO (E2ux) = 0.0608985975842096  LUMO (A1u) = -0.0100101974769253
cycle= 28 E= -2098.35012584219  delta_E= 0.000644  |g|= 0.141  |ddm|= 0.074
HOMO (E2ux) = 0.0602574210048215  LUMO (A1u) = -0.0103968830147616
cycle= 29 E= -2098.35022744946  delta_E= -0.000102  |g|= 0.141  |ddm|= 0.0779
HOMO (E2ux) = 0.0586919702181005  LUMO (A1u) = -0.0109071437148788
cycle= 30 E= -2098.35087319685  delta_E= -0.000646  |g|= 0.141  |ddm|= 0.237
HOMO (E2ux) = 0.056198584219453  LUMO (A1u) = -0.0119329751920343
cycle= 31 E= -2098.3515757816  delta_E= -0.000703  |g|= 0.14  |ddm|= 0.207
HOMO (E2ux) = 0.056175609737583  LUMO (A1u) = -0.0119512902201937
cycle= 32 E= -2098.35157780499  delta_E= -2.02e-06  |g|= 0.14  |ddm|= 0.0144
SCF not converged.
SCF energy = -2098.35157780499
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpm6x80xa6
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2gx E2gy E1uy E1ux A1g A1g E2ux A1u E2uy E1gx E1gy A1u
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.673929455716
CASCI E = -2098.67392945572  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -27.945811001061
2 -1
State   0 energy     -27.990998411746
3 -1
State   0 energy     -28.041751904333
4 -1
State   0 energy   -2098.862281891389
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.86228189139  dE = -0.18835244  S^2 = 0.0000000
               |grad[o]|=0.307  |ddm|=0.452  |maxRot[o]|=0.312
5 -1
State   0 energy     -28.198507068410
6 -1
State   0 energy     -28.249118867459
7 -1
State   0 energy     -28.294551520489
8 -1
State   0 energy   -2099.055540031552
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.05554003155  dE = -0.19325814  S^2 = 0.0000000
               |grad[o]|=0.263  |ddm|=0.568  |maxRot[o]|=0.313
9 -1
State   0 energy     -28.481940847945
10 -1
State   0 energy     -28.506149234470
11 -1
State   0 energy     -28.530520458524
12 -1
State   0 energy   -2099.150583451980
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.15058345198  dE = -0.09504342  S^2 = 0.0000000
               |grad[o]|=0.178  |ddm|=0.533  |maxRot[o]|= 0.31
13 -1
State   0 energy     -28.601705655691
14 -1
State   0 energy     -28.621498147467
15 -1
State   0 energy     -28.641434615834
16 -1
State   0 energy   -2099.229701117222
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.22970111722  dE = -0.079117665  S^2 = 0.0000000
               |grad[o]|=0.165  |ddm|=0.248  |maxRot[o]|=0.308
17 -1
State   0 energy     -28.733597313758
18 -1
State   0 energy     -28.744886963529
19 -1
State   0 energy     -28.753377062304
20 -1
State   0 energy   -2099.273476017327
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.27347601733  dE = -0.0437749  S^2 = 0.0000000
               |grad[o]|=0.117  |ddm|=0.135  |maxRot[o]|=0.311
21 -1
State   0 energy     -28.794161921626
22 -1
State   0 energy     -28.798681379119
23 -1
State   0 energy     -28.802327812730
24 -1
State   0 energy   -2099.290294667529
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.29029466753  dE = -0.01681865  S^2 = 0.0000000
               |grad[o]|=0.0633  |ddm|=0.0872  |maxRot[o]|=0.312
25 -1
State   0 energy     -28.806541559381
26 -1
State   0 energy     -28.807325337419
27 -1
State   0 energy     -28.807412299738
28 -1
State   0 energy   -2099.293488840654
macro iter 7 (14 JK  4 micro), CASSCF E = -2099.29348884065  dE = -0.0031941731  S^2 = 0.0000000
               |grad[o]|=0.0294  |ddm|=0.0693  |maxRot[o]|=0.156
29 -1
State   0 energy     -28.798381561638
30 -1
State   0 energy     -28.798381604447
31 -1
State   0 energy     -28.798381600752
32 -1
State   0 energy   -2099.293490434026
macro iter 8 (9 JK  3 micro), CASSCF E = -2099.29349043403  dE = -1.5933724e-06  S^2 = 0.0000000
               |grad[o]|=0.000907  |ddm|=0.00166  |maxRot[o]|=0.00216
33 -1
State   0 energy     -28.797969320525
34 -1
State   0 energy   -2099.293490435656
macro iter 9 (3 JK  1 micro), CASSCF E = -2099.29349043566  dE = -1.6298145e-09  S^2 = 0.0000000
               |grad[o]|=3.12e-05  |ddm|=6.24e-05  |maxRot[o]|=3.6e-05
1-step CASSCF converged in 9 macro (152 JK 32 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.09119017 1.09118943 1.32465262 1.32465233 1.785065   1.30498619
 0.90879714 0.62650517 0.90879788 0.67537563 0.67537533 0.28341311]
CASSCF energy = -2099.29349043566
CASCI E = -2099.29349043566  E(CI) = -28.7979607879179  S^2 = 0.0000000
energy =  -2099.293490435656
orbsym =  [5, 0, 5, 0, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 10, 11, 6, 7, 0, 0, 15, 5, 14, 2, 3, 5, 6, 7, 0, 0, 2, 3, 5, 10, 11, 5, 0, 6, 7, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 0, 5, 10, 11, 5, 6, 7, 0, 14, 15, 6, 7, 2, 3, 0, 2, 3, 16, 17, 10, 11, 5, 12, 13, 5, 0, 6, 7, 5, 14, 15, 2, 3, 0, 10, 11, 6, 7, 0, 14, 15, 6, 7, 2, 3, 2, 3, 0, 5, 16, 17, 10, 11, 20, 21, 5, 24, 25, 6, 7, 0, 12, 13, 5, 16, 17, 10, 11, 12, 13, 2, 3, 14, 15, 0, 14, 15, 6, 7, 5, 0, 2, 3, 5, 10, 11, 6, 7, 14, 15, 2, 3, 6, 7, 0, 0, 2, 3, 5, 5, 10, 11, 16, 17, 6, 7, 20, 21, 26, 27, 22, 23, 24, 25, 0, 12, 13, 14, 15, 5, 2, 3, 16, 17, 20, 21, 10, 11, 24, 25, 6, 7, 5, 16, 17, 12, 13, 0, 12, 13, 10, 11, 14, 15, 2, 3, 14, 15, 6, 7, 0, 5, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 5, 6, 7, 0, 2, 3, 0, 5, 5, 6, 7, 0, 10, 11, 16, 17, 12, 13, 14, 15, 20, 21, 24, 25, 26, 27, 22, 23, 30, 31, 34, 35, 2, 3, 5, 10, 11, 6, 7, 16, 17, 20, 21, 24, 25, 26, 27, 22, 23, 0, 12, 13, 14, 15, 5, 2, 3, 6, 7, 10, 11, 16, 17, 0, 12, 13, 14, 15, 16, 17, 20, 21, 10, 11, 24, 25, 12, 13, 2, 3, 5, 14, 15, 6, 7, 2, 3, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 61 62 65 66 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 06:36:12 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.250000000000 AA    0.000000000000   0.000000000000   2.362157655706 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.250000000000 AA    0.000000000000   0.000000000000  -2.362157655706 Bohr   0.0

nuclear repulsion = 121.922429395968
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    958862.86


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpnb3t1z_u
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.67390899149
HOMO (E2ux) = -0.190249975002578  LUMO (E2ux) = -0.190249975002578
cycle= 1 E= -2098.19332830311  delta_E= -0.519  |g|= 0.771  |ddm|=  2.3
HOMO (E2gy) = 0.191725011174052  LUMO (A1u) = 0.00699943012749302
cycle= 2 E= -2098.0495272063  delta_E= 0.144  |g|= 0.98  |ddm|=  2.6
HOMO (E2gy) = 0.0171950359247582  LUMO (A1u) = -0.0140849159348272
cycle= 3 E= -2098.2659803452  delta_E= -0.216  |g|= 0.207  |ddm|= 1.51
HOMO (E2gy) = 0.0112531342051471  LUMO (A1u) = -0.0126890294627726
cycle= 4 E= -2098.26975443989  delta_E= -0.00377  |g|= 0.178  |ddm|= 0.163
HOMO (E2gy) = 0.00655065191801215  LUMO (A1u) = -0.0144260321734532
cycle= 5 E= -2098.27052562391  delta_E= -0.000771  |g|= 0.187  |ddm|= 0.0965
HOMO (E2gy) = -0.00236006556566947  LUMO (A1u) = -0.0182061111983621
cycle= 6 E= -2098.27426308419  delta_E= -0.00374  |g|= 0.191  |ddm|= 0.118
HOMO (E2gy) = -0.00101425717107113  LUMO (A1u) = -0.0171839059162336
cycle= 7 E= -2098.27420604274  delta_E= 5.7e-05  |g|= 0.191  |ddm|= 0.0679
HOMO (E2gy) = -0.000528859637935197  LUMO (A1u) = -0.0167747626858042
cycle= 8 E= -2098.27347097312  delta_E= 0.000735  |g|= 0.192  |ddm|= 0.0373
HOMO (E2gy) = -0.00475065201974861  LUMO (A1u) = -0.019008628740748
cycle= 9 E= -2098.27457255067  delta_E= -0.0011  |g|= 0.196  |ddm|= 0.127
HOMO (E2gy) = -0.00864115561373295  LUMO (A1u) = -0.0149762652006074
cycle= 10 E= -2098.27135300087  delta_E= 0.00322  |g|=  0.2  |ddm|= 0.24
HOMO (E2gy) = -0.00919384493847877  LUMO (A1u) = -0.0185995926683428
cycle= 11 E= -2098.27107160582  delta_E= 0.000281  |g|= 0.193  |ddm|= 0.285
HOMO (E2gy) = -0.0052397009235192  LUMO (A1u) = -0.0180090193131857
cycle= 12 E= -2098.27133098743  delta_E= -0.000259  |g|= 0.187  |ddm|= 0.0342
HOMO (E2gy) = -0.00147702455140302  LUMO (A1u) = -0.0170823029671215
cycle= 13 E= -2098.26675985871  delta_E= 0.00457  |g|= 0.192  |ddm|= 0.127
HOMO (E2gy) = -0.00709886080544947  LUMO (A1u) = -0.0161159897689456
cycle= 14 E= -2098.25307472256  delta_E= 0.0137  |g|= 0.172  |ddm|= 1.46
HOMO (E2gy) = 0.0218100737983168  LUMO (A1u) = -0.0182316138772112
cycle= 15 E= -2098.2590141849  delta_E= -0.00594  |g|= 0.182  |ddm|= 1.46
HOMO (E2gy) = 0.0277585858054544  LUMO (A1u) = -0.0153152381406187
cycle= 16 E= -2098.25589497849  delta_E= 0.00312  |g|= 0.185  |ddm|= 0.109
HOMO (E2gy) = 0.026633419143166  LUMO (A1u) = -0.0163766335313498
cycle= 17 E= -2098.25637725318  delta_E= -0.000482  |g|= 0.186  |ddm|= 0.0598
HOMO (E2gy) = 0.0307873643692752  LUMO (A1u) = -0.0142030597756091
cycle= 18 E= -2098.25281881446  delta_E= 0.00356  |g|= 0.187  |ddm|= 0.209
HOMO (E2gy) = 0.029368237079252  LUMO (A1u) = -0.0142399139264364
cycle= 19 E= -2098.25249390662  delta_E= 0.000325  |g|= 0.187  |ddm|= 0.165
HOMO (E2gy) = 0.0418376936774812  LUMO (A1u) = -0.00818184795036539
cycle= 20 E= -2098.24367013546  delta_E= 0.00882  |g|= 0.206  |ddm|= 0.231
HOMO (E2gy) = 0.0250538596804505  LUMO (A1u) = -0.0175187000354712
cycle= 21 E= -2098.2601039006  delta_E= -0.0164  |g|= 0.176  |ddm|= 0.237
HOMO (E2gy) = 0.0323057416358898  LUMO (A1u) = -0.019168852233964
cycle= 22 E= -2098.24777420557  delta_E= 0.0123  |g|= 0.183  |ddm|= 0.346
HOMO (E2gy) = 0.00221199628927484  LUMO (A1u) = -0.0136889474245757
cycle= 23 E= -2098.25232580625  delta_E= -0.00455  |g|= 0.173  |ddm|= 1.45
HOMO (E2gy) = 0.0393002130627255  LUMO (A1u) = -0.0146406921382817
cycle= 24 E= -2098.24407504028  delta_E= 0.00825  |g|= 0.188  |ddm|= 1.44
HOMO (E2gy) = 0.0374947761146155  LUMO (A1u) = -0.0168057701536131
cycle= 25 E= -2098.24329783326  delta_E= 0.000777  |g|= 0.189  |ddm|= 0.0638
HOMO (E2gy) = 0.0431786530391908  LUMO (A1u) = -0.0104036222763699
cycle= 26 E= -2098.24110046704  delta_E= 0.0022  |g|= 0.197  |ddm|= 0.238
HOMO (E2gy) = 0.0303462185912713  LUMO (A1u) = -0.0167312640341913
cycle= 27 E= -2098.24811756792  delta_E= -0.00702  |g|= 0.19  |ddm|= 0.196
HOMO (E2gy) = 0.0292704079269468  LUMO (A1u) = -0.0175756090846662
cycle= 28 E= -2098.24827012584  delta_E= -0.000153  |g|= 0.19  |ddm|= 0.0761
HOMO (E2gy) = 0.0275822829925384  LUMO (A1u) = -0.0183773819352161
cycle= 29 E= -2098.25083329696  delta_E= -0.00256  |g|= 0.192  |ddm|= 0.108
HOMO (E2gy) = 0.0281201950987391  LUMO (A1u) = -0.0182434049443908
cycle= 30 E= -2098.25399441232  delta_E= -0.00316  |g|= 0.186  |ddm|= 0.0801
HOMO (E2gy) = 0.0375216531614199  LUMO (A1u) = -0.0148828825450247
cycle= 31 E= -2098.24857481965  delta_E= 0.00542  |g|= 0.185  |ddm|= 0.114
HOMO (E2gy) = 0.00189241794117355  LUMO (A1u) = -0.0110518969283393
cycle= 32 E= -2098.26540871992  delta_E= -0.0168  |g|= 0.198  |ddm|= 0.205
SCF not converged.
SCF energy = -2098.26540871992
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpnb3t1z_u
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2ux E2uy E2gy A1u E2gx A1u E1gx E1gy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.797807113318
CASCI E = -2098.79780711332  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -27.076349166582
2 -1
State   0 energy     -27.158321997564
3 -1
State   0 energy     -27.243205615324
4 -1
State   0 energy   -2099.110879344775
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.11087934477  dE = -0.31307223  S^2 = 0.0000000
               |grad[o]|=0.401  |ddm|=0.969  |maxRot[o]|=0.312
5 -1
State   0 energy     -27.458892515360
6 -1
State   0 energy     -27.509136139202
7 -1
State   0 energy     -27.546408134549
8 -1
State   0 energy   -2099.293378974458
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.29337897446  dE = -0.18249963  S^2 = 0.0000000
               |grad[o]|=0.324  |ddm|=0.295  |maxRot[o]|=0.299
9 -1
State   0 energy     -27.763175316526
10 -1
State   0 energy     -27.764120170675
11 -1
State   0 energy     -27.764202889308
12 -1
State   0 energy   -2099.310593807131
macro iter 3 (13 JK  4 micro), CASSCF E = -2099.31059380713  dE = -0.017214833  S^2 = 0.0000000
               |grad[o]|=0.106  |ddm|=0.0372  |maxRot[o]|=0.106
13 -1
State   0 energy     -27.789873046222
14 -1
State   0 energy     -27.789873066280
15 -1
State   0 energy     -27.789873087259
16 -1
State   0 energy   -2099.310598956614
macro iter 4 (9 JK  3 micro), CASSCF E = -2099.31059895661  dE = -5.1494826e-06  S^2 = 0.0000000
               |grad[o]|=0.00196  |ddm|=0.00144  |maxRot[o]|=0.00195
17 -1
State   0 energy     -27.788206637920
18 -1
State   0 energy   -2099.310598956614
macro iter 5 (1 JK  1 micro), CASSCF E = -2099.31059895661  dE = 0  S^2 = 0.0000000
               |grad[o]|=1.77e-05  |ddm|=0.000263  |maxRot[o]|=    0
1-step CASSCF converged in 5 macro (65 JK 16 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.47761401 1.17203762 1.17203729 1.436161   0.95690154 0.95690102
 1.0430996  0.27064718 1.04309909 0.81555295 0.82797452 0.82797419]
CASSCF energy = -2099.31059895661
CASCI E = -2099.31059895661  E(CI) = -27.7882066315142  S^2 = 0.0000000
energy =  -2099.310598956614
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 15, 14, 11, 5, 10, 5, 2, 3, 6, 7, 0, 5, 0, 2, 3, 5, 10, 11, 6, 7, 0, 14, 15, 6, 7, 2, 3, 0, 5, 2, 3, 0, 5, 10, 11, 6, 7, 5, 14, 15, 0, 6, 7, 2, 3, 0, 2, 3, 10, 11, 16, 17, 5, 12, 13, 5, 6, 7, 0, 14, 15, 5, 0, 2, 3, 10, 11, 6, 7, 14, 15, 0, 2, 3, 6, 7, 2, 3, 0, 5, 5, 10, 11, 16, 17, 20, 21, 5, 6, 7, 24, 25, 12, 13, 0, 16, 17, 14, 15, 10, 11, 12, 13, 2, 3, 14, 15, 5, 6, 7, 2, 3, 0, 5, 0, 10, 11, 5, 6, 7, 14, 15, 2, 3, 0, 6, 7, 2, 3, 0, 5, 5, 6, 7, 10, 11, 16, 17, 0, 20, 21, 26, 27, 22, 23, 24, 25, 12, 13, 14, 15, 2, 3, 5, 16, 17, 10, 11, 20, 21, 24, 25, 6, 7, 12, 13, 0, 16, 17, 10, 11, 12, 13, 14, 15, 5, 2, 3, 14, 15, 6, 7, 2, 3, 0, 5, 0, 5, 10, 11, 6, 7, 14, 15, 2, 3, 0, 6, 7, 2, 3, 0, 5, 5, 20, 21, 24, 25, 22, 23, 26, 27, 16, 17, 12, 13, 10, 11, 6, 7, 34, 35, 30, 31, 14, 15, 0, 2, 3, 5, 6, 7, 10, 11, 0, 16, 17, 20, 21, 24, 25, 26, 27, 22, 23, 12, 13, 14, 15, 2, 3, 5, 10, 11, 16, 17, 6, 7, 12, 13, 0, 14, 15, 2, 3, 16, 17, 10, 11, 20, 21, 24, 25, 12, 13, 5, 6, 7, 14, 15, 2, 3, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 54]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 65 66 72 73 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 07:19:49 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.400000000000 AA    0.000000000000   0.000000000000   2.645616574391 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.400000000000 AA    0.000000000000   0.000000000000  -2.645616574391 Bohr   0.0

nuclear repulsion = 108.859311960686
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:    994253.64


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp3cw31vy2
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.53076200749
HOMO (A1u) = -0.189485954857899  LUMO (E2ux) = -0.187078424000024
cycle= 1 E= -2098.05048082016  delta_E= -0.52  |g|= 0.655  |ddm|= 2.31
HOMO (E2gy) = 0.103716026732228  LUMO (A1u) = 0.0237696648549913
cycle= 2 E= -2097.85101819038  delta_E= 0.199  |g|= 1.39  |ddm|= 1.92
HOMO (E2gy) = -0.0294678380306003  LUMO (A1u) = -0.0160732719832859
cycle= 3 E= -2098.28427058478  delta_E= -0.433  |g|= 0.226  |ddm|= 1.18
HOMO (E2gy) = -0.0159411861563354  LUMO (A1u) = -0.0142425161045049
cycle= 4 E= -2098.30918162867  delta_E= -0.0249  |g|= 0.12  |ddm|= 0.26
HOMO (E2gy) = -0.00626391721860048  LUMO (A1u) = -0.0139667834034679
cycle= 5 E= -2098.32937235573  delta_E= -0.0202  |g|= 0.0755  |ddm|= 0.245
HOMO (E2gy) = -0.01651674962161  LUMO (A1u) = -0.0160151091422552
cycle= 6 E= -2098.34673031428  delta_E= -0.0174  |g|= 0.0588  |ddm|= 0.302
HOMO (E2gy) = -0.0260232539861848  LUMO (A1u) = -0.0198879484513381
cycle= 7 E= -2098.35254716052  delta_E= -0.00582  |g|= 0.0561  |ddm|= 0.186
HOMO (E2gy) = -0.0407837262617647  LUMO (A1u) = -0.0282032562890806
cycle= 8 E= -2098.35420683141  delta_E= -0.00166  |g|= 0.0196  |ddm|= 0.0841
HOMO (E2gy) = -0.0444874191446878  LUMO (A1u) = -0.0294303346287204
cycle= 9 E= -2098.35484393123  delta_E= -0.000637  |g|= 0.0119  |ddm|= 0.0988
HOMO (E2gy) = -0.0447186047870631  LUMO (A1u) = -0.0291868945619738
cycle= 10 E= -2098.35489345495  delta_E= -4.95e-05  |g|= 0.00359  |ddm|= 0.0236
HOMO (E2gy) = -0.0450247920914064  LUMO (A1u) = -0.0296105515922833
cycle= 11 E= -2098.35490055254  delta_E= -7.1e-06  |g|= 0.00147  |ddm|= 0.0101
HOMO (E2gy) = -0.0454342682433687  LUMO (A1u) = -0.0297710091155242
cycle= 12 E= -2098.35490308344  delta_E= -2.53e-06  |g|= 0.00068  |ddm|= 0.00622
HOMO (E2gy) = -0.0455904245973929  LUMO (A1u) = -0.029865592244351
cycle= 13 E= -2098.35490334964  delta_E= -2.66e-07  |g|= 0.000346  |ddm|= 0.00146
HOMO (E2gy) = -0.0456644386719533  LUMO (A1u) = -0.0299193822227635
cycle= 14 E= -2098.3549034057  delta_E= -5.61e-08  |g|= 5.78e-05  |ddm|= 0.000717
HOMO (E2gy) = -0.0456657538292851  LUMO (A1u) = -0.0299239803775256
cycle= 15 E= -2098.35490340798  delta_E= -2.29e-09  |g|= 1.05e-05  |ddm|= 0.000384
HOMO (E2gy) = -0.0456641667388211  LUMO (A1u) = -0.029923809751721
cycle= 16 E= -2098.35490340812  delta_E= -1.35e-10  |g|= 3.75e-06  |ddm|= 4.34e-05
HOMO (E2gy) = -0.0456655223197131  LUMO (A1u) = -0.0299242644707461
Extra cycle  E= -2098.35490340813  delta_E= -9.09e-12  |g|= 3.68e-06  |ddm|= 1.39e-05
converged SCF energy = -2098.35490340813
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp3cw31vy2
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E1uy E1ux E2gx E2gy A1u E2uy E2ux E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.811884637497
CASCI E = -2098.8118846375  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -26.225548148678
2 -1
State   0 energy     -26.252022702410
3 -1
State   0 energy     -26.273044130866
4 -1
State   0 energy   -2098.934626163930
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.93462616393  dE = -0.12274153  S^2 = 0.0000000
               |grad[o]|=0.373  |ddm|=0.512  |maxRot[o]|=0.313
5 -1
State   0 energy     -26.404457503829
6 -1
State   0 energy     -26.441907230398
7 -1
State   0 energy     -26.533738831820
8 -1
State   0 energy   -2099.151338791185
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.15133879118  dE = -0.21671263  S^2 = 0.0000000
               |grad[o]|=0.204  |ddm|= 1.95  |maxRot[o]|=0.303
9 -1
State   0 energy     -26.694212811308
10 -1
State   0 energy     -26.729279037783
11 -1
State   0 energy     -26.756840465080
12 -1
State   0 energy   -2099.285413051932
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.28541305193  dE = -0.13407426  S^2 = 0.0000000
               |grad[o]|=0.329  |ddm|=0.179  |maxRot[o]|=0.314
13 -1
State   0 energy     -26.930433695035
14 -1
State   0 energy     -26.938022545691
15 -1
State   0 energy     -26.938857525595
16 -1
State   0 energy   -2099.318536658744
macro iter 4 (14 JK  4 micro), CASSCF E = -2099.31853665874  dE = -0.033123607  S^2 = 0.0000000
               |grad[o]|=0.159  |ddm|=0.0885  |maxRot[o]|=0.148
17 -1
State   0 energy     -26.986397169684
18 -1
State   0 energy     -26.986397351270
19 -1
State   0 energy     -26.986397274590
20 -1
State   0 energy   -2099.318595098602
macro iter 5 (11 JK  4 micro), CASSCF E = -2099.3185950986  dE = -5.8439858e-05  S^2 = 0.0000000
               |grad[o]|=0.00663  |ddm|=0.00165  |maxRot[o]|=0.00603
21 -1
State   0 energy     -26.982614766757
22 -1
State   0 energy   -2099.318595100769
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.31859510077  dE = -2.1664164e-09  S^2 = 0.0000000
               |grad[o]|=3.54e-05  |ddm|=3.16e-05  |maxRot[o]|=3.81e-05
1-step CASSCF converged in 6 macro (91 JK 21 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.13482368 0.88306197 1.65812196 1.09878209 1.09878317 1.02303603
 1.02303553 0.32397719 0.97696494 0.97696444 0.90122397 0.90122504]
CASSCF energy = -2099.31859510077
CASCI E = -2099.31859510077  E(CI) = -26.9825951689063  S^2 = 0.0000000
energy =  -2099.3185951007686
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 0, 6, 7, 10, 11, 5, 14, 15, 2, 3, 0, 6, 7, 5, 0, 2, 3, 5, 10, 11, 6, 7, 0, 14, 15, 6, 7, 2, 3, 0, 5, 2, 3, 5, 0, 10, 11, 5, 6, 7, 0, 14, 15, 6, 7, 2, 3, 0, 2, 3, 5, 10, 11, 5, 16, 17, 12, 13, 6, 7, 0, 14, 15, 0, 5, 2, 3, 10, 11, 6, 7, 5, 14, 15, 0, 2, 3, 6, 7, 2, 3, 5, 0, 10, 11, 5, 16, 17, 6, 7, 20, 21, 24, 25, 12, 13, 0, 14, 15, 16, 17, 12, 13, 10, 11, 2, 3, 14, 15, 6, 7, 5, 5, 2, 3, 0, 0, 5, 10, 11, 14, 15, 6, 7, 0, 2, 3, 6, 7, 2, 3, 0, 5, 5, 6, 7, 10, 11, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 0, 12, 13, 14, 15, 2, 3, 5, 10, 11, 16, 17, 20, 21, 24, 25, 6, 7, 12, 13, 0, 16, 17, 12, 13, 14, 15, 10, 11, 2, 3, 14, 15, 6, 7, 5, 2, 3, 0, 5, 0, 5, 10, 11, 14, 15, 6, 7, 2, 3, 0, 6, 7, 2, 3, 0, 5, 5, 30, 31, 34, 35, 26, 27, 22, 23, 20, 21, 24, 25, 12, 13, 16, 17, 14, 15, 10, 11, 6, 7, 2, 3, 0, 5, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 16, 17, 12, 13, 10, 11, 14, 15, 6, 7, 2, 3, 20, 21, 24, 25, 0, 16, 17, 5, 10, 11, 12, 13, 6, 7, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 61 62 65 66 74 75 76 77]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    # BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]
    BASIS = ["ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode08', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Tue Jun  3 08:08:20 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.600000000000 AA    0.000000000000   0.000000000000   3.023561799304 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.600000000000 AA    0.000000000000   0.000000000000  -3.023561799304 Bohr   0.0

nuclear repulsion = 95.2518979656
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 33
num. orbitals of irrep E1gx = 24
num. orbitals of irrep E1gy = 24
num. orbitals of irrep A1u = 33
num. orbitals of irrep E1uy = 24
num. orbitals of irrep E1ux = 24
num. orbitals of irrep E2gx = 16
num. orbitals of irrep E2gy = 16
num. orbitals of irrep E3gx = 10
num. orbitals of irrep E3gy = 10
num. orbitals of irrep E2uy = 16
num. orbitals of irrep E2ux = 16
num. orbitals of irrep E3uy = 10
num. orbitals of irrep E3ux = 10
num. orbitals of irrep E4gx = 6
num. orbitals of irrep E4gy = 6
num. orbitals of irrep E5gx = 3
num. orbitals of irrep E5gy = 3
num. orbitals of irrep E4uy = 6
num. orbitals of irrep E4ux = 6
num. orbitals of irrep E5uy = 3
num. orbitals of irrep E5ux = 3
num. orbitals of irrep E6gx = 1
num. orbitals of irrep E6gy = 1
num. orbitals of irrep E6uy = 1
num. orbitals of irrep E6ux = 1
number of shells = 32
number of NR pGTOs = 476
number of NR cGTOs = 306
basis = ccpv5z-dk
ecp = {}
CPU time:   1032624.58


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp3ackh5s1
max_memory 4000 MB (current use 2002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E5gx E5gy E4uy E4ux E5uy E5ux E6gx E6gy E6uy E6ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.4141231557
HOMO (E2gy) = -0.189441588455756  LUMO (E2ux) = -0.185287846847443
cycle= 1 E= -2098.09105515717  delta_E= -0.677  |g|= 0.42  |ddm|= 2.31
HOMO (E2gy) = 0.00215469575645762  LUMO (A1u) = -0.0144211489204262
cycle= 2 E= -2098.13857087051  delta_E= -0.0475  |g|= 0.316  |ddm|= 0.735
HOMO (E2gy) = -0.0462017953515725  LUMO (A1u) = -0.0323285148418511
cycle= 3 E= -2098.1705554049  delta_E= -0.032  |g|= 0.22  |ddm|= 0.423
HOMO (E2gy) = -0.0124763083610005  LUMO (A1u) = -0.01998464738177
cycle= 4 E= -2098.20092718541  delta_E= -0.0304  |g|= 0.114  |ddm|= 0.305
HOMO (E2gy) = -0.00389881465227409  LUMO (A1u) = -0.0166764254721516
cycle= 5 E= -2098.23122894461  delta_E= -0.0303  |g|= 0.083  |ddm|= 0.366
HOMO (E2gy) = -0.0173204743656654  LUMO (A1u) = -0.0248275066957667
cycle= 6 E= -2098.25492543461  delta_E= -0.0237  |g|= 0.0545  |ddm|= 0.353
HOMO (E2gy) = -0.0321083288149753  LUMO (A1u) = -0.0374409356539869
cycle= 7 E= -2098.2631105465  delta_E= -0.00819  |g|= 0.0259  |ddm|= 0.208
HOMO (E2gy) = -0.0318533111584357  LUMO (A1u) = -0.0304561583648311
cycle= 8 E= -2098.26484423971  delta_E= -0.00173  |g|= 0.0582  |ddm|= 0.155
HOMO (E2gy) = -0.0367211398890582  LUMO (A1u) = -0.034482680636878
cycle= 9 E= -2098.26554489725  delta_E= -0.000701  |g|= 0.0204  |ddm|= 0.0453
HOMO (E2gy) = -0.043999143416362  LUMO (A1u) = -0.0381023756736226
cycle= 10 E= -2098.26588963612  delta_E= -0.000345  |g|= 0.0132  |ddm|= 0.0843
HOMO (E2gy) = -0.046107188200014  LUMO (A1u) = -0.0395065900331096
cycle= 11 E= -2098.26594931929  delta_E= -5.97e-05  |g|= 0.00243  |ddm|= 0.0193
HOMO (E2gy) = -0.0463108197592981  LUMO (A1u) = -0.040111561483238
cycle= 12 E= -2098.26595251143  delta_E= -3.19e-06  |g|= 0.00125  |ddm|= 0.00697
HOMO (E2gy) = -0.0464085631277601  LUMO (A1u) = -0.0400979049404922
cycle= 13 E= -2098.26595339007  delta_E= -8.79e-07  |g|= 0.000186  |ddm|= 0.00298
HOMO (E2gy) = -0.0464181834392854  LUMO (A1u) = -0.040100490353214
cycle= 14 E= -2098.26595340282  delta_E= -1.28e-08  |g|= 0.000196  |ddm|= 0.000677
HOMO (E2gy) = -0.0464494403961414  LUMO (A1u) = -0.0401218992587877
cycle= 15 E= -2098.26595341642  delta_E= -1.36e-08  |g|= 3.85e-05  |ddm|= 0.000413
HOMO (E2gy) = -0.046448297838879  LUMO (A1u) = -0.0401228236910228
cycle= 16 E= -2098.26595341722  delta_E= -8.08e-10  |g|= 5.66e-06  |ddm|= 7.25e-05
HOMO (E2gy) = -0.0464468165490877  LUMO (A1u) = -0.0401224282404005
Extra cycle  E= -2098.26595341725  delta_E= -2.91e-11  |g|= 4.18e-06  |ddm|= 3.02e-05
converged SCF energy = -2098.26595341725
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 27 28 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 276
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp3ackh5s1
max_memory 4000 MB (current use 2002 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E1uy E1ux E2gx E2gy A1u E2uy E2ux E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.840017446761
CASCI E = -2098.84001744676  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -25.390941612189
2 -1
State   0 energy     -25.494326936077
3 -1
State   0 energy     -25.595685133004
4 -1
State   0 energy   -2099.169958690863
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.16995869086  dE = -0.32994124  S^2 = 0.0000000
               |grad[o]|=0.385  |ddm|= 1.65  |maxRot[o]|=0.314
5 -1
State   0 energy     -25.850230847430
6 -1
State   0 energy     -25.893010811245
7 -1
State   0 energy     -25.916525780156
8 -1
State   0 energy   -2099.318483702139
macro iter 2 (20 JK  4 micro), CASSCF E = -2099.31848370214  dE = -0.14852501  S^2 = 0.0000000
               |grad[o]|=0.346  |ddm|=0.201  |maxRot[o]|=0.278
9 -1
State   0 energy     -26.144975929058
10 -1
State   0 energy     -26.144990607038
11 -1
State   0 energy     -26.144998650983
12 -1
State   0 energy   -2099.320971523835
macro iter 3 (12 JK  4 micro), CASSCF E = -2099.32097152384  dE = -0.0024878217  S^2 = 0.0000000
               |grad[o]|=0.0536  |ddm|=0.0227  |maxRot[o]|=0.0259
13 -1
State   0 energy     -26.134992006108
14 -1
State   0 energy     -26.134992009652
15 -1
State   0 energy   -2099.320971742991
macro iter 4 (7 JK  2 micro), CASSCF E = -2099.32097174299  dE = -2.1915548e-07  S^2 = 0.0000000
               |grad[o]|=0.000361  |ddm|=0.000313  |maxRot[o]|=0.000447
16 -1
State   0 energy     -26.134770307316
17 -1
State   0 energy   -2099.320971742990
macro iter 5 (1 JK  1 micro), CASSCF E = -2099.32097174299  dE = 1.3642421e-12  S^2 = 0.0000000
               |grad[o]|=9.09e-06  |ddm|=1.47e-05  |maxRot[o]|=    0
1-step CASSCF converged in 5 macro (61 JK 15 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.07623206 0.93401544 1.573469   1.05060401 1.050604   1.01072001
 1.0107198  0.41627851 0.98928029 0.98928008 0.94939841 0.94939839]
CASSCF energy = -2099.32097174299
CASCI E = -2099.32097174299  E(CI) = -26.1347703069127  S^2 = 0.0000000
energy =  -2099.3209717429895
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 0, 6, 7, 10, 11, 5, 14, 15, 2, 3, 0, 6, 7, 2, 3, 5, 0, 5, 10, 11, 6, 7, 0, 14, 15, 6, 7, 2, 3, 5, 2, 3, 0, 5, 0, 5, 10, 11, 0, 6, 7, 14, 15, 6, 7, 2, 3, 2, 3, 0, 5, 5, 10, 11, 16, 17, 6, 7, 12, 13, 14, 15, 0, 0, 5, 2, 3, 10, 11, 5, 14, 15, 6, 7, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 6, 7, 10, 11, 16, 17, 20, 21, 24, 25, 0, 12, 13, 14, 15, 2, 3, 16, 17, 5, 10, 11, 12, 13, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5, 10, 11, 14, 15, 6, 7, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 10, 11, 6, 7, 0, 14, 15, 2, 3, 5, 20, 21, 24, 25, 10, 11, 16, 17, 6, 7, 12, 13, 0, 14, 15, 16, 17, 12, 13, 10, 11, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 5, 0, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 6, 7, 2, 3, 0, 5, 30, 31, 34, 35, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 14, 15, 10, 11, 2, 3, 6, 7, 0, 5, 26, 27, 22, 23, 20, 21, 24, 25, 16, 17, 12, 13, 10, 11, 14, 15, 6, 7, 2, 3, 0, 5, 16, 17, 12, 13, 10, 11, 14, 15, 6, 7, 2, 3, 20, 21, 24, 25, 0, 16, 17, 5, 12, 13, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E5gx': 0, 'E5gy': 0, 'E4uy': 0, 'E4ux': 0, 'E5uy': 0, 'E5ux': 0, 'E6gx': 0, 'E6gy': 0, 'E6uy': 0, 'E6ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 59 60 61 62 65 66 74 75 78 79]
