#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 21:15:20 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.650000000000 AA    0.000000000000   0.000000000000   1.228321980967 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.650000000000 AA    0.000000000000   0.000000000000  -1.228321980967 Bohr   0.0

nuclear repulsion = 234.466210376862
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:         0.38


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmppdgh1_fq
max_memory 4000 MB (current use 76 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.65051806349
HOMO (E2ux) = -0.267400914698127  LUMO (E2ux) = -0.267400914698127
cycle= 1 E= -2098.07669763387  delta_E= 1.57  |g|= 1.44  |ddm|= 6.49
HOMO (A1g) = 0.0510758618216334  LUMO (E1ux) = 0.0643035066575395
cycle= 2 E= -2097.32736825253  delta_E= 0.749  |g|= 2.41  |ddm|=  682
HOMO (E2ux) = 0.165596171183569  LUMO (A1u) = -0.0230164969476764
cycle= 3 E= -2098.41369145319  delta_E= -1.09  |g|= 0.174  |ddm|=  682
HOMO (E2ux) = 0.215691406177153  LUMO (A1u) = 0.0143145528871837
cycle= 4 E= -2098.39562987849  delta_E= 0.0181  |g|= 0.143  |ddm|= 0.804
HOMO (E2ux) = 0.205607602642595  LUMO (A1u) = 0.0139800863533562
cycle= 5 E= -2098.40739551325  delta_E= -0.0118  |g|= 0.14  |ddm|= 0.274
HOMO (E2ux) = 0.212413335808246  LUMO (A1u) = 0.0134971640402925
cycle= 6 E= -2098.39877806753  delta_E= 0.00862  |g|= 0.134  |ddm|= 0.409
HOMO (E2ux) = 0.21254250521006  LUMO (A1u) = 0.0134732298644373
cycle= 7 E= -2098.39774090196  delta_E= 0.00104  |g|= 0.135  |ddm|= 0.051
HOMO (E2ux) = 0.214114105293122  LUMO (A1u) = 0.0131410917357102
cycle= 8 E= -2098.39561151906  delta_E= 0.00213  |g|= 0.141  |ddm|= 0.0546
HOMO (E2ux) = 0.218105383907506  LUMO (A1u) = 0.0142418594897238
cycle= 9 E= -2098.39170460708  delta_E= 0.00391  |g|= 0.148  |ddm|= 0.0889
HOMO (E2ux) = 0.215890274011641  LUMO (A1u) = 0.0128043516875485
cycle= 10 E= -2098.39306941719  delta_E= -0.00136  |g|= 0.146  |ddm|= 0.0584
HOMO (E2ux) = 0.219782535191053  LUMO (A1u) = 0.0202359909949814
cycle= 11 E= -2098.39396998295  delta_E= -0.000901  |g|= 0.14  |ddm|= 0.158
HOMO (E2ux) = 0.220449706364102  LUMO (A1u) = 0.0213443824492675
cycle= 12 E= -2098.39432192168  delta_E= -0.000352  |g|= 0.139  |ddm|= 0.0298
HOMO (E2ux) = 0.219473008684663  LUMO (A1u) = 0.0213133887233144
cycle= 13 E= -2098.39664297951  delta_E= -0.00232  |g|= 0.131  |ddm|= 0.0941
HOMO (E2ux) = 0.219869496763368  LUMO (A1u) = 0.0214037556936938
cycle= 14 E= -2098.39619685944  delta_E= 0.000446  |g|= 0.132  |ddm|= 0.0121
HOMO (E2ux) = 0.219141586494533  LUMO (A1u) = 0.0211230849428136
cycle= 15 E= -2098.3966577607  delta_E= -0.000461  |g|= 0.131  |ddm|= 0.0211
HOMO (E2ux) = 0.220627449620157  LUMO (A1u) = 0.0211444781193596
cycle= 16 E= -2098.39481346315  delta_E= 0.00184  |g|= 0.135  |ddm|= 0.0521
HOMO (E2ux) = 0.220605654492073  LUMO (A1u) = 0.0211281730841351
cycle= 17 E= -2098.39483156555  delta_E= -1.81e-05  |g|= 0.135  |ddm|= 0.00695
HOMO (E2ux) = 0.220608874447536  LUMO (A1u) = 0.0209287324776377
cycle= 18 E= -2098.39424051316  delta_E= 0.000591  |g|= 0.136  |ddm|= 0.0378
HOMO (E2ux) = 0.220506669296369  LUMO (A1u) = 0.020717652397074
cycle= 19 E= -2098.39421908097  delta_E= 2.14e-05  |g|= 0.137  |ddm|= 0.0176
HOMO (E2ux) = 0.220033038646257  LUMO (A1u) = 0.0204733057083408
cycle= 20 E= -2098.39444558849  delta_E= -0.000227  |g|= 0.138  |ddm|= 0.0326
HOMO (E2ux) = 0.218676527836243  LUMO (A1u) = 0.0208417428679417
cycle= 21 E= -2098.39703140368  delta_E= -0.00259  |g|= 0.131  |ddm|= 0.0854
HOMO (E2ux) = 0.218580057136578  LUMO (A1u) = 0.0209107028300491
cycle= 22 E= -2098.39704319511  delta_E= -1.18e-05  |g|= 0.131  |ddm|= 0.0143
HOMO (E2ux) = 0.218597207588621  LUMO (A1u) = 0.0207416519966416
cycle= 23 E= -2098.3966765376  delta_E= 0.000367  |g|= 0.132  |ddm|= 0.0166
HOMO (E2ux) = 0.218499300503236  LUMO (A1u) = 0.0208674603738644
cycle= 24 E= -2098.39739328752  delta_E= -0.000717  |g|= 0.131  |ddm|= 0.0396
HOMO (E2ux) = 0.218509349475702  LUMO (A1u) = 0.0208680765810387
cycle= 25 E= -2098.39738073862  delta_E= 1.25e-05  |g|= 0.131  |ddm|= 0.000369
HOMO (E2ux) = 0.218832623545844  LUMO (A1u) = 0.021214213650805
cycle= 26 E= -2098.39729859733  delta_E= 8.21e-05  |g|= 0.13  |ddm|= 0.0213
HOMO (E2ux) = 0.219128813120368  LUMO (A1u) = 0.0212694933282404
cycle= 27 E= -2098.39670862841  delta_E= 0.00059  |g|= 0.131  |ddm|= 0.0259
HOMO (E2ux) = 0.220139614590809  LUMO (A1u) = 0.021374561142186
cycle= 28 E= -2098.39521135017  delta_E= 0.0015  |g|= 0.134  |ddm|= 0.0453
HOMO (E2ux) = 0.219118234807977  LUMO (A1u) = 0.020968274798531
cycle= 29 E= -2098.39637913479  delta_E= -0.00117  |g|= 0.133  |ddm|= 0.0318
HOMO (E2ux) = 0.220106116606564  LUMO (A1u) = 0.0216229230905008
cycle= 30 E= -2098.39560379473  delta_E= 0.000775  |g|= 0.132  |ddm|= 0.0384
HOMO (E2ux) = 0.218956318337577  LUMO (A1u) = 0.0211193932389578
cycle= 31 E= -2098.39662314144  delta_E= -0.00102  |g|= 0.131  |ddm|= 0.0269
HOMO (E2ux) = 0.219482813539264  LUMO (A1u) = 0.0214891384771381
cycle= 32 E= -2098.39651170953  delta_E= 0.000111  |g|= 0.131  |ddm|= 0.0267
SCF not converged.
SCF energy = -2098.39651170953
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 29 31 35]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmppdgh1_fq
max_memory 4000 MB (current use 166 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.584340503569
CASCI E = -2098.58434050357  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -34.287972170346
2 -1
State   0 energy     -34.315890696420
3 -1
State   0 energy     -34.342448061436
4 -1
State   0 energy   -2098.687589753074
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.68758975307  dE = -0.10324925  S^2 = 0.0000000
               |grad[o]|=0.311  |ddm|=0.168  |maxRot[o]|=0.314
5 -1
State   0 energy     -34.335695082314
6 -1
State   0 energy     -34.353748966415
7 -1
State   0 energy     -34.372860747945
8 -1
State   0 energy   -2098.764960130188
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.76496013019  dE = -0.077370377  S^2 = 0.0000000
               |grad[o]|=0.174  |ddm|=0.0396  |maxRot[o]|=0.311
9 -1
State   0 energy     -34.390480411149
10 -1
State   0 energy     -34.414104041309
11 -1
State   0 energy     -34.438733916385
12 -1
State   0 energy   -2098.859132857136
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.85913285714  dE = -0.094172727  S^2 = 0.0000000
               |grad[o]|=0.122  |ddm|=0.0541  |maxRot[o]|=0.312
13 -1
State   0 energy     -34.517343876232
14 -1
State   0 energy     -34.542746383936
15 -1
State   0 energy     -34.564826238419
16 -1
State   0 energy   -2098.952665720637
macro iter 4 (21 JK  4 micro), CASSCF E = -2098.95266572064  dE = -0.093532864  S^2 = 0.0000000
               |grad[o]|=0.108  |ddm|=0.0437  |maxRot[o]|=0.297
17 -1
State   0 energy     -34.707382626837
18 -1
State   0 energy     -34.722988248995
19 -1
State   0 energy     -34.736457014886
20 -1
State   0 energy   -2099.009281232296
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.0092812323  dE = -0.056615512  S^2 = 0.0000000
               |grad[o]|=0.0862  |ddm|=0.0275  |maxRot[o]|=0.309
21 -1
State   0 energy     -34.911235145098
22 -1
State   0 energy     -34.916542232083
23 -1
State   0 energy     -34.918490178907
24 -1
State   0 energy   -2099.025322136914
macro iter 6 (18 JK  4 micro), CASSCF E = -2099.02532213691  dE = -0.016040905  S^2 = 0.0000000
               |grad[o]|=0.0492  |ddm|=0.014  |maxRot[o]|=0.235
25 -1
State   0 energy     -34.949064985480
26 -1
State   0 energy     -34.949065076523
27 -1
State   0 energy     -34.949065087901
28 -1
State   0 energy   -2099.025324459669
macro iter 7 (8 JK  3 micro), CASSCF E = -2099.02532445967  dE = -2.3227549e-06  S^2 = 0.0000000
               |grad[o]|=0.00103  |ddm|=0.000984  |maxRot[o]|=0.0017
29 -1
State   0 energy     -34.940360630155
30 -1
State   0 energy   -2099.025324459669
macro iter 8 (1 JK  1 micro), CASSCF E = -2099.02532445967  dE = 0  S^2 = 0.0000000
               |grad[o]|=2.44e-05  |ddm|=1.15e-05  |maxRot[o]|=    0
1-step CASSCF converged in 8 macro (132 JK 28 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.92392951 1.92392949 1.94526858 1.88421669 1.88421613 1.81849815
 0.1179688  0.14690309 0.07479901 0.074799   0.08750222 0.11796934]
CASSCF energy = -2099.02532445967
CASCI E = -2099.02532445967  E(CI) = -34.9403606299643  S^2 = 0.0000000
energy =  -2099.025324459669
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 6, 7, 2, 3, 5, 10, 11, 0, 6, 7, 5, 14, 15, 2, 3, 5, 6, 7, 0, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 0, 5, 2, 3, 0, 10, 11, 16, 17, 5, 2, 3, 12, 13, 6, 7, 5, 14, 15, 2, 3, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 52 53 54 55]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 64 65 66 70 71 75 76]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 21:25:16 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.700000000000 AA    0.000000000000   0.000000000000   1.322808287196 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.700000000000 AA    0.000000000000   0.000000000000  -1.322808287196 Bohr   0.0

nuclear repulsion = 217.718623921371
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      1487.55


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmplta6wpa4
max_memory 4000 MB (current use 210 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.2450971109
HOMO (E2ux) = -0.253417055748855  LUMO (E2ux) = -0.253417055748855
cycle= 1 E= -2098.2622877659  delta_E= 0.983  |g|= 1.26  |ddm|= 5.02
HOMO (A1g) = 0.0555826200258882  LUMO (E1ux) = 0.0632959845445751
cycle= 2 E= -2097.48239617968  delta_E= 0.78  |g|= 2.22  |ddm|=  397
HOMO (E2ux) = 0.129823677643272  LUMO (A1u) = -0.0273547399003489
cycle= 3 E= -2098.5299071449  delta_E= -1.05  |g|= 0.215  |ddm|=  397
HOMO (E2ux) = 0.187595108501716  LUMO (A1u) = 0.00827640679899522
cycle= 4 E= -2098.51838806835  delta_E= 0.0115  |g|= 0.148  |ddm|= 0.578
HOMO (E2ux) = 0.182604004312333  LUMO (A1u) = 0.00949250502476385
cycle= 5 E= -2098.52376438407  delta_E= -0.00538  |g|= 0.152  |ddm|= 0.129
HOMO (E2ux) = 0.183691144675286  LUMO (A1u) = 0.00968089148091585
cycle= 6 E= -2098.52425818146  delta_E= -0.000494  |g|= 0.14  |ddm|= 0.19
HOMO (E2ux) = 0.189252737252169  LUMO (A1u) = 0.0106682454360803
cycle= 7 E= -2098.51840445937  delta_E= 0.00585  |g|= 0.136  |ddm|= 0.217
HOMO (E2ux) = 0.191730936574758  LUMO (A1u) = 0.010770917124715
cycle= 8 E= -2098.51656703655  delta_E= 0.00184  |g|= 0.14  |ddm|= 0.0496
HOMO (E2ux) = 0.194408180298884  LUMO (A1u) = 0.0114243888364426
cycle= 9 E= -2098.514715403  delta_E= 0.00185  |g|= 0.141  |ddm|= 0.0666
HOMO (E2ux) = 0.190109528843378  LUMO (A1u) = 0.00878458406631945
cycle= 10 E= -2098.51676890462  delta_E= -0.00205  |g|= 0.139  |ddm|= 0.094
HOMO (E2ux) = 0.203266049093465  LUMO (A1u) = 0.01868944947241
cycle= 11 E= -2098.50812556094  delta_E= 0.00864  |g|= 0.155  |ddm|= 0.218
HOMO (E2ux) = 0.203779315437247  LUMO (A1u) = 0.02084662637633
cycle= 12 E= -2098.51154766874  delta_E= -0.00342  |g|= 0.142  |ddm|= 0.161
HOMO (E2ux) = 0.203050385029278  LUMO (A1u) = 0.0204901668037273
cycle= 13 E= -2098.51308147242  delta_E= -0.00153  |g|= 0.14  |ddm|= 0.0765
HOMO (E2ux) = 0.204177440898424  LUMO (A1u) = 0.0204371675959298
cycle= 14 E= -2098.51207393739  delta_E= 0.00101  |g|= 0.141  |ddm|= 0.034
HOMO (E2ux) = 0.203420564724748  LUMO (A1u) = 0.0196323539957425
cycle= 15 E= -2098.51012976123  delta_E= 0.00194  |g|= 0.144  |ddm|= 0.15
HOMO (E2ux) = 0.202900995759581  LUMO (A1u) = 0.0194425608923451
cycle= 16 E= -2098.51046260051  delta_E= -0.000333  |g|= 0.143  |ddm|= 0.019
HOMO (E2ux) = 0.204630856959078  LUMO (A1u) = 0.0205056772548156
cycle= 17 E= -2098.50961829837  delta_E= 0.000844  |g|= 0.144  |ddm|= 0.0525
HOMO (E2ux) = 0.203670076774407  LUMO (A1u) = 0.0203352632650313
cycle= 18 E= -2098.51064450927  delta_E= -0.00103  |g|= 0.142  |ddm|= 0.0209
HOMO (E2ux) = 0.203423587974268  LUMO (A1u) = 0.0201845362675907
cycle= 19 E= -2098.51016491974  delta_E= 0.00048  |g|= 0.142  |ddm|= 0.045
HOMO (E2ux) = 0.203664761187816  LUMO (A1u) = 0.0204338300297664
cycle= 20 E= -2098.51045427964  delta_E= -0.000289  |g|= 0.142  |ddm|= 0.0244
HOMO (E2ux) = 0.202807382243703  LUMO (A1u) = 0.0204053579546271
cycle= 21 E= -2098.51110955628  delta_E= -0.000655  |g|= 0.139  |ddm|= 0.0295
HOMO (E2ux) = 0.203379772213891  LUMO (A1u) = 0.0205991339463569
cycle= 22 E= -2098.51039468223  delta_E= 0.000715  |g|= 0.14  |ddm|= 0.0198
HOMO (E2ux) = 0.203080227962234  LUMO (A1u) = 0.0204104620313482
cycle= 23 E= -2098.51035271162  delta_E= 4.2e-05  |g|= 0.14  |ddm|= 0.0129
HOMO (E2ux) = 0.20737544778256  LUMO (A1u) = 0.0219054331011757
cycle= 24 E= -2098.50805597401  delta_E= 0.0023  |g|= 0.143  |ddm|= 0.0964
HOMO (E2ux) = 0.205497601989747  LUMO (A1u) = 0.0215684984777885
cycle= 25 E= -2098.50974821882  delta_E= -0.00169  |g|= 0.14  |ddm|= 0.0352
HOMO (E2ux) = 0.202702998839985  LUMO (A1u) = 0.0204148680788952
cycle= 26 E= -2098.51181945929  delta_E= -0.00207  |g|= 0.138  |ddm|= 0.0595
HOMO (E2ux) = 0.202717697395324  LUMO (A1u) = 0.0206473038234071
cycle= 27 E= -2098.51163829554  delta_E= 0.000181  |g|= 0.138  |ddm|= 0.0162
HOMO (E2ux) = 0.202519768366635  LUMO (A1u) = 0.0203614780260834
cycle= 28 E= -2098.5115174684  delta_E= 0.000121  |g|= 0.138  |ddm|= 0.0116
HOMO (E2ux) = 0.2021373822425  LUMO (A1u) = 0.0200056000782566
cycle= 29 E= -2098.51151966728  delta_E= -2.2e-06  |g|= 0.138  |ddm|= 0.0193
HOMO (E2ux) = 0.202161190459474  LUMO (A1u) = 0.0199783760805276
cycle= 30 E= -2098.51136871229  delta_E= 0.000151  |g|= 0.139  |ddm|= 0.00527
HOMO (E2ux) = 0.20182579689027  LUMO (A1u) = 0.0201646818391131
cycle= 31 E= -2098.5127714978  delta_E= -0.0014  |g|= 0.137  |ddm|= 0.0535
HOMO (E2ux) = 0.202614606750659  LUMO (A1u) = 0.0204461960981433
cycle= 32 E= -2098.51183049398  delta_E= 0.000941  |g|= 0.137  |ddm|= 0.0222
SCF not converged.
SCF energy = -2098.51183049398
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 29 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmplta6wpa4
max_memory 4000 MB (current use 407 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.694865740195
CASCI E = -2098.6948657402  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -33.181987562714
2 -1
State   0 energy     -33.215545535106
3 -1
State   0 energy     -33.245720215887
4 -1
State   0 energy   -2098.816450030424
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.81645003042  dE = -0.12158429  S^2 = 0.0000000
               |grad[o]|=0.349  |ddm|=0.241  |maxRot[o]|=0.314
5 -1
State   0 energy     -33.243186283166
6 -1
State   0 energy     -33.261424147379
7 -1
State   0 energy     -33.282056102086
8 -1
State   0 energy   -2098.894782137284
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.89478213728  dE = -0.078332107  S^2 = 0.0000000
               |grad[o]|=0.166  |ddm|=0.0584  |maxRot[o]|=0.312
9 -1
State   0 energy     -33.322545232565
10 -1
State   0 energy     -33.350361306940
11 -1
State   0 energy     -33.379879729187
12 -1
State   0 energy   -2099.007184881300
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.0071848813  dE = -0.11240274  S^2 = 0.0000000
               |grad[o]|=0.132  |ddm|=0.0751  |maxRot[o]|=0.312
13 -1
State   0 energy     -33.471026057832
14 -1
State   0 energy     -33.500532577690
15 -1
State   0 energy     -33.526349371526
16 -1
State   0 energy   -2099.117607906603
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.1176079066  dE = -0.11042303  S^2 = 0.0000000
               |grad[o]|= 0.12  |ddm|=0.0623  |maxRot[o]|=0.304
17 -1
State   0 energy     -33.655228623840
18 -1
State   0 energy     -33.668993615493
19 -1
State   0 energy     -33.678315474748
20 -1
State   0 energy   -2099.164612415332
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.16461241533  dE = -0.047004509  S^2 = 0.0000000
               |grad[o]|=0.0847  |ddm|=0.0326  |maxRot[o]|=0.307
21 -1
State   0 energy     -33.754126335410
22 -1
State   0 energy     -33.754183172887
23 -1
State   0 energy     -33.754188424612
24 -1
State   0 energy   -2099.166016163377
macro iter 6 (11 JK  4 micro), CASSCF E = -2099.16601616338  dE = -0.001403748  S^2 = 0.0000000
               |grad[o]|=0.0191  |ddm|=0.0064  |maxRot[o]|=0.0461
25 -1
State   0 energy     -33.728500612650
26 -1
State   0 energy   -2099.166016188267
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.16601618827  dE = -2.4890596e-08  S^2 = 0.0000000
               |grad[o]|=0.000173  |ddm|=5.38e-05  |maxRot[o]|=0.000123
1-step CASSCF converged in 7 macro (119 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.90601133 1.90601126 1.92246136 1.84662831 1.84662341 1.84141602
 0.15568873 0.13272226 0.09292524 0.09292517 0.10089334 0.15569358]
CASSCF energy = -2099.16601618827
CASCI E = -2099.16601618827  E(CI) = -33.7284622536336  S^2 = 0.0000000
energy =  -2099.1660161882673
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 6, 7, 2, 3, 5, 10, 11, 0, 5, 6, 7, 14, 15, 2, 3, 5, 0, 6, 7, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 5, 2, 3, 0, 0, 10, 11, 16, 17, 2, 3, 5, 6, 7, 12, 13, 5, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 53 54 55]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 63 64 65 70 71 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 21:33:50 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.750000000000 AA    0.000000000000   0.000000000000   1.417294593424 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.750000000000 AA    0.000000000000   0.000000000000  -1.417294593424 Bohr   0.0

nuclear repulsion = 203.20404899328
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      2769.12


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpyvz7orea
max_memory 4000 MB (current use 411 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.9414018755
HOMO (E2ux) = -0.241287083549002  LUMO (E2ux) = -0.241287083549002
cycle= 1 E= -2098.46910195738  delta_E= 0.472  |g|= 0.961  |ddm|= 4.28
HOMO (E2ux) = 0.145748397291512  LUMO (E1ux) = 0.0534599622575273
cycle= 2 E= -2097.41656449717  delta_E= 1.05  |g|= 1.96  |ddm|=  218
HOMO (E2gy) = -0.0961286278978472  LUMO (E2ux) = -0.182540760930676
cycle= 3 E= -2098.48072052018  delta_E= -1.06  |g|= 0.374  |ddm|=  218
HOMO (E2gy) = -0.0633844477423474  LUMO (E2ux) = -0.232545085733382
cycle= 4 E= -2098.50513955132  delta_E= -0.0244  |g|= 0.179  |ddm|= 0.491
HOMO (E2gy) = -0.056414073964919  LUMO (A1g) = -0.220001921530693
cycle= 5 E= -2097.97229464275  delta_E= 0.533  |g|= 0.991  |ddm|= 1.76
HOMO (E2gy) = -0.0556569816081032  LUMO (A1g) = -0.197147864584594
cycle= 6 E= -2098.00313960153  delta_E= -0.0308  |g|= 0.917  |ddm|= 0.167
HOMO (E2gy) = -0.0432837004665197  LUMO (A1g) = -0.119254261442925
cycle= 7 E= -2098.10812608528  delta_E= -0.105  |g|= 0.66  |ddm|= 0.461
HOMO (E2gy) = -0.053522968571397  LUMO (A1g) = -0.0915762945980959
cycle= 8 E= -2098.15530396071  delta_E= -0.0472  |g|= 0.549  |ddm|= 0.288
HOMO (E2gy) = -0.0494604763022803  LUMO (A1g) = -0.0890587328076626
cycle= 9 E= -2098.14514593237  delta_E= 0.0102  |g|= 0.566  |ddm|= 0.131
HOMO (E2gy) = -0.0501981323952431  LUMO (A1g) = -0.043796508727111
cycle= 10 E= -2098.18840297022  delta_E= -0.0433  |g|= 0.386  |ddm|= 0.358
HOMO (E2gy) = -0.0626268698196652  LUMO (A1g) = 0.0174369016468834
cycle= 11 E= -2098.22817797115  delta_E= -0.0398  |g|= 0.065  |ddm|= 0.588
HOMO (E2gy) = -0.0635149217281146  LUMO (A1g) = 0.0277304643717541
cycle= 12 E= -2098.23248929848  delta_E= -0.00431  |g|= 0.0251  |ddm|= 0.163
HOMO (E2gy) = -0.0722215101630284  LUMO (A1u) = 0.0299317482828303
cycle= 13 E= -2098.23502613174  delta_E= -0.00254  |g|= 0.0171  |ddm|= 0.148
HOMO (E2gy) = -0.0843321325075153  LUMO (A1u) = 0.0263943844582215
cycle= 14 E= -2098.23675808998  delta_E= -0.00173  |g|= 0.00522  |ddm|= 0.223
HOMO (E2gy) = -0.0869845295290892  LUMO (A1u) = 0.0258479220792091
cycle= 15 E= -2098.23679748501  delta_E= -3.94e-05  |g|= 0.00172  |ddm|= 0.0297
HOMO (E2gy) = -0.0880339532868541  LUMO (A1u) = 0.0254918577130083
cycle= 16 E= -2098.23680610076  delta_E= -8.62e-06  |g|= 0.000653  |ddm|= 0.0174
HOMO (E2gy) = -0.0884065036058481  LUMO (A1u) = 0.0254228289681911
cycle= 17 E= -2098.23680639185  delta_E= -2.91e-07  |g|= 0.000328  |ddm|= 0.00244
HOMO (E2gy) = -0.0883212771745483  LUMO (A1u) = 0.0254258768170274
cycle= 18 E= -2098.23680641767  delta_E= -2.58e-08  |g|= 3.66e-05  |ddm|= 0.00135
HOMO (E2gy) = -0.0883092020691097  LUMO (A1u) = 0.0254273273160502
cycle= 19 E= -2098.23680641992  delta_E= -2.25e-09  |g|= 8.98e-06  |ddm|= 0.000245
HOMO (E2gy) = -0.0883130332015734  LUMO (A1u) = 0.0254264040860921
cycle= 20 E= -2098.23680642004  delta_E= -1.14e-10  |g|= 3.46e-06  |ddm|= 7.99e-05
HOMO (E2gy) = -0.0883114705114684  LUMO (A1u) = 0.0254265812505241
Extra cycle  E= -2098.23680642004  delta_E= -5e-12  |g|= 2.53e-06  |ddm|= 1.74e-05
converged SCF energy = -2098.23680642004
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 31]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpyvz7orea
max_memory 4000 MB (current use 512 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2uy E2ux E2gx E2gy A1u A1g E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.606058538241
CASCI E = -2098.60605853824  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -32.178208217366
2 -1
State   0 energy     -32.201410075654
3 -1
State   0 energy     -32.223157936854
4 -1
State   0 energy   -2098.734163132287
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.73416313229  dE = -0.12810459  S^2 = 0.0000000
               |grad[o]|=0.466  |ddm|= 0.12  |maxRot[o]|=  0.3
5 -1
State   0 energy     -32.228622581846
6 -1
State   0 energy     -32.253719953985
7 -1
State   0 energy     -32.281332078963
8 -1
State   0 energy   -2098.852167624257
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.85216762426  dE = -0.11800449  S^2 = 0.0000000
               |grad[o]|=0.159  |ddm|=0.0712  |maxRot[o]|=0.312
9 -1
State   0 energy     -32.416363903049
10 -1
State   0 energy     -32.494169672487
11 -1
State   0 energy     -32.566944505160
12 -1
State   0 energy   -2099.129116234676
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.12911623468  dE = -0.27694861  S^2 = 0.0000000
               |grad[o]|=0.569  |ddm|=0.621  |maxRot[o]|=0.288
13 -1
State   0 energy     -32.666803793858
14 -1
State   0 energy     -32.692679652879
15 -1
State   0 energy     -32.711968460005
16 -1
State   0 energy   -2099.221121385122
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.22112138512  dE = -0.09200515  S^2 = 0.0000000
               |grad[o]|=0.172  |ddm|=0.0593  |maxRot[o]|=0.306
17 -1
State   0 energy     -32.768236731434
18 -1
State   0 energy     -32.768527849374
19 -1
State   0 energy     -32.768610930646
20 -1
State   0 energy   -2099.229420513564
macro iter 5 (12 JK  4 micro), CASSCF E = -2099.22942051356  dE = -0.0082991284  S^2 = 0.0000000
               |grad[o]|=0.0552  |ddm|=0.0431  |maxRot[o]|=0.103
21 -1
State   0 energy     -32.751446757732
22 -1
State   0 energy     -32.751446843047
23 -1
State   0 energy     -32.751446909145
24 -1
State   0 energy   -2099.229423563018
macro iter 6 (9 JK  3 micro), CASSCF E = -2099.22942356302  dE = -3.0494543e-06  S^2 = 0.0000000
               |grad[o]|=0.00113  |ddm|=0.00228  |maxRot[o]|=0.00208
25 -1
State   0 energy     -32.754829005279
26 -1
State   0 energy   -2099.229423569977
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.22942356998  dE = -6.9594535e-09  S^2 = 0.0000000
               |grad[o]|=4.21e-05  |ddm|=7.38e-05  |maxRot[o]|=0.000129
1-step CASSCF converged in 7 macro (108 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.88392797 1.88392679 1.91218656 0.21089636 0.21089579 1.79122986
 1.7912293  0.13064158 1.84662312 0.11536555 0.11536437 0.10771277]
CASSCF energy = -2099.22942356998
CASCI E = -2099.22942356998  E(CI) = -32.7548829294301  S^2 = 0.0000000
energy =  -2099.2294235699774
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 14, 15, 10, 11, 5, 0, 2, 3, 5, 6, 7, 0, 0, 2, 3, 6, 7, 5, 10, 11, 5, 6, 7, 0, 14, 15, 2, 3, 5, 0, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 2, 3, 14, 15, 0, 5, 0, 10, 11, 2, 3, 16, 17, 5, 6, 7, 12, 13, 5, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 53 54 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 61 62 63 64 66 72 73 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 21:42:47 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.800000000000 AA    0.000000000000   0.000000000000   1.511780899652 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.800000000000 AA    0.000000000000   0.000000000000  -1.511780899652 Bohr   0.0

nuclear repulsion = 190.5037959312
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      3944.18


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmph02c2i6v
max_memory 4000 MB (current use 503 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.70386233914
HOMO (E2ux) = -0.230914428092635  LUMO (E2ux) = -0.230914428092635
cycle= 1 E= -2098.49594721254  delta_E= 0.208  |g|= 0.882  |ddm|= 3.83
HOMO (E2gy) = 0.144377803604795  LUMO (E1ux) = 0.0550185936358212
cycle= 2 E= -2097.54378328298  delta_E= 0.952  |g|= 1.86  |ddm|=  145
HOMO (E2gy) = -0.0709810133422608  LUMO (E2gy) = -0.0709810133422608
cycle= 3 E= -2098.39270993173  delta_E= -0.849  |g|= 0.502  |ddm|=  145
HOMO (E2gy) = -0.0252349614211411  LUMO (A1u) = -0.0350793033408695
cycle= 4 E= -2098.40555146467  delta_E= -0.0128  |g|= 0.306  |ddm|= 1.58
HOMO (E2gy) = 0.0365224481993765  LUMO (A1u) = -0.021559763579202
cycle= 5 E= -2098.40063061004  delta_E= 0.00492  |g|= 0.183  |ddm|= 0.223
HOMO (E2gy) = 0.0449161000313118  LUMO (A1u) = -0.00451445830835095
cycle= 6 E= -2098.4083688722  delta_E= -0.00774  |g|= 0.149  |ddm|= 0.184
HOMO (E2gy) = 0.0552628663127326  LUMO (A1u) = 0.000427261646689102
cycle= 7 E= -2098.4021449951  delta_E= 0.00622  |g|= 0.143  |ddm|= 0.126
HOMO (E2gy) = 0.0560594540288008  LUMO (A1u) = -0.000314495440707594
cycle= 8 E= -2098.39837357469  delta_E= 0.00377  |g|= 0.152  |ddm|= 0.0752
HOMO (E2gy) = 0.0610444803893035  LUMO (A1u) = 0.000175427587915357
cycle= 9 E= -2098.39415430818  delta_E= 0.00422  |g|= 0.159  |ddm|= 0.0417
HOMO (E2gy) = 0.0668284910746356  LUMO (A1u) = 0.00093261678830301
cycle= 10 E= -2098.15821681594  delta_E= 0.236  |g|= 0.387  |ddm|= 1.18
HOMO (E2gy) = 0.0716649249901322  LUMO (A1u) = 0.00794059987940432
cycle= 11 E= -2098.17141122701  delta_E= -0.0132  |g|= 0.305  |ddm|= 0.139
HOMO (E2gy) = 0.0684440894913398  LUMO (A1u) = 0.0250736896002571
cycle= 12 E= -2098.19547612575  delta_E= -0.0241  |g|= 0.23  |ddm|= 0.857
HOMO (E2gy) = 0.0678858511144308  LUMO (A1u) = 0.029483374504635
cycle= 13 E= -2098.15939886871  delta_E= 0.0361  |g|= 0.465  |ddm|= 0.787
HOMO (E2gy) = 0.0738229405383754  LUMO (A1u) = 0.0308510654247123
cycle= 14 E= -2098.15860291753  delta_E= 0.000796  |g|= 0.469  |ddm|= 0.165
HOMO (E2gy) = 0.071351951812745  LUMO (A1u) = 0.0298092719957682
cycle= 15 E= -2098.15714112898  delta_E= 0.00146  |g|= 0.468  |ddm|= 0.146
HOMO (E2gy) = 0.0578986833983707  LUMO (A1u) = 0.0265191214461089
cycle= 16 E= -2098.1608421601  delta_E= -0.0037  |g|= 0.449  |ddm|= 0.285
HOMO (E2gy) = 0.0537111877095173  LUMO (A1u) = 0.02680631934473
cycle= 17 E= -2098.16675816382  delta_E= -0.00592  |g|= 0.428  |ddm|= 0.136
HOMO (E2gy) = 0.0637476352345489  LUMO (A1u) = 0.0193219144363941
cycle= 18 E= -2098.20185390601  delta_E= -0.0351  |g|= 0.123  |ddm|= 1.13
HOMO (E2gy) = 0.0617507385413953  LUMO (A1u) = 0.0189770010467696
cycle= 19 E= -2098.20607533853  delta_E= -0.00422  |g|= 0.113  |ddm|= 0.146
HOMO (E2gy) = 0.0614391692575908  LUMO (A1u) = 0.0186886071698175
cycle= 20 E= -2098.20354015605  delta_E= 0.00254  |g|= 0.112  |ddm|= 0.0977
HOMO (E2gy) = 0.07460543847879  LUMO (A1u) = 0.0235292451711478
cycle= 21 E= -2098.18541104696  delta_E= 0.0181  |g|= 0.16  |ddm|= 0.344
HOMO (E2gy) = 0.0747263397988115  LUMO (A1u) = 0.0237754752454845
cycle= 22 E= -2098.18967384324  delta_E= -0.00426  |g|= 0.15  |ddm|= 0.0965
HOMO (E2gy) = 0.0767307987111073  LUMO (A1u) = 0.0248473066223
cycle= 23 E= -2098.17943426063  delta_E= 0.0102  |g|= 0.196  |ddm|= 0.202
HOMO (E2gy) = 0.0828806018388437  LUMO (A1u) = 0.0272096282285158
cycle= 24 E= -2098.16892889638  delta_E= 0.0105  |g|= 0.239  |ddm|= 0.134
HOMO (E2gy) = 0.0849363005190872  LUMO (A1u) = 0.0280261413369127
cycle= 25 E= -2098.1582456068  delta_E= 0.0107  |g|= 0.281  |ddm|= 0.151
HOMO (E2gy) = 0.0820653786196775  LUMO (A1u) = 0.0271573821397906
cycle= 26 E= -2098.17132702049  delta_E= -0.0131  |g|= 0.218  |ddm|= 0.336
HOMO (E2gy) = 0.0797905112511502  LUMO (A1u) = 0.0258790842479435
cycle= 27 E= -2098.17487243989  delta_E= -0.00355  |g|= 0.206  |ddm|= 0.0589
HOMO (E2gy) = 0.0750182125669054  LUMO (A1u) = 0.0247587629981945
cycle= 28 E= -2098.19228842859  delta_E= -0.0174  |g|= 0.118  |ddm|= 0.315
HOMO (E2gy) = 0.0724326154868788  LUMO (A1u) = 0.0237223129251762
cycle= 29 E= -2098.1958415392  delta_E= -0.00355  |g|= 0.112  |ddm|= 0.105
HOMO (E2gy) = 0.0735761015764145  LUMO (A1u) = 0.0243273426023101
cycle= 30 E= -2098.18845853269  delta_E= 0.00738  |g|= 0.12  |ddm|= 0.172
HOMO (E2gy) = 0.072017929595998  LUMO (A1u) = 0.02348693696769
cycle= 31 E= -2098.19624204776  delta_E= -0.00778  |g|= 0.108  |ddm|= 0.17
HOMO (E2gy) = 0.07322565324337  LUMO (A1u) = 0.0239816398791492
cycle= 32 E= -2098.19567429123  delta_E= 0.000568  |g|= 0.109  |ddm|= 0.0231
SCF not converged.
SCF energy = -2098.19567429123
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmph02c2i6v
max_memory 4000 MB (current use 560 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2uy E2ux A1g E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.575419850739
CASCI E = -2098.57541985074  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -31.347735102762
2 -1
State   0 energy     -31.439270726543
3 -1
State   0 energy     -31.502447851140
4 -1
State   0 energy   -2098.859297584952
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.85929758495  dE = -0.28387773  S^2 = 0.0000000
               |grad[o]|=0.735  |ddm|=0.805  |maxRot[o]|=0.276
5 -1
State   0 energy     -31.633358842915
6 -1
State   0 energy     -31.651859831822
7 -1
State   0 energy     -31.675125117920
8 -1
State   0 energy   -2098.945221032391
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.94522103239  dE = -0.085923447  S^2 = 0.0000000
               |grad[o]|=0.197  |ddm|=0.183  |maxRot[o]|=0.312
9 -1
State   0 energy     -31.677851662290
10 -1
State   0 energy     -31.715764554630
11 -1
State   0 energy     -31.757188706990
12 -1
State   0 energy   -2099.097923447883
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.09792344788  dE = -0.15270242  S^2 = 0.0000000
               |grad[o]|=0.164  |ddm|=0.142  |maxRot[o]|=0.312
13 -1
State   0 energy     -31.827907701242
14 -1
State   0 energy     -31.866875627126
15 -1
State   0 energy     -31.898852034409
16 -1
State   0 energy   -2099.230065959125
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.23006595913  dE = -0.13214251  S^2 = 0.0000000
               |grad[o]|=0.159  |ddm|=0.109  |maxRot[o]|=0.286
17 -1
State   0 energy     -31.958726500167
18 -1
State   0 energy     -31.965662730714
19 -1
State   0 energy     -31.969280630313
20 -1
State   0 energy   -2099.253356063710
macro iter 5 (19 JK  4 micro), CASSCF E = -2099.25335606371  dE = -0.023290105  S^2 = 0.0000000
               |grad[o]|=0.0722  |ddm|=0.0473  |maxRot[o]|=0.271
21 -1
State   0 energy     -31.948131986594
22 -1
State   0 energy     -31.948134793533
23 -1
State   0 energy     -31.948135349121
24 -1
State   0 energy   -2099.253382087227
macro iter 6 (10 JK  3 micro), CASSCF E = -2099.25338208723  dE = -2.6023517e-05  S^2 = 0.0000000
               |grad[o]|=0.00414  |ddm|=0.00436  |maxRot[o]|=0.0126
25 -1
State   0 energy     -31.943594927650
26 -1
State   0 energy   -2099.253382113917
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.25338211392  dE = -2.6690032e-08  S^2 = 0.0000000
               |grad[o]|=6.19e-05  |ddm|=0.000204  |maxRot[o]|=0.000237
1-step CASSCF converged in 7 macro (116 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.85290328 1.85290368 1.83917672 0.29929999 0.29930001 1.89300106
 1.70217507 0.15414838 1.702175   0.14684378 0.1468442  0.11122882]
CASSCF energy = -2099.25338211392
CASCI E = -2099.25338211392  E(CI) = -31.9434657778215  S^2 = 0.0000000
energy =  -2099.2533821139173
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 14, 15, 0, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 2, 3, 5, 6, 7, 0, 5, 10, 11, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 6, 7, 0, 5, 10, 11, 2, 3, 6, 7, 5, 14, 15, 0, 0, 2, 3, 10, 11, 16, 17, 6, 7, 5, 12, 13, 5, 14, 15, 0, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 63 64 65 72 73 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 21:51:58 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.840000000000 AA    0.000000000000   0.000000000000   1.587369944635 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.840000000000 AA    0.000000000000   0.000000000000  -1.587369944635 Bohr   0.0

nuclear repulsion = 181.432186601143
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      5389.03


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpuyzc2kgf
max_memory 4000 MB (current use 547 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.54637931032
HOMO (E2ux) = -0.22379281228203  LUMO (E2ux) = -0.22379281228203
cycle= 1 E= -2098.49465827228  delta_E= 0.0517  |g|= 0.83  |ddm|= 3.61
HOMO (E2gy) = 0.147100690688186  LUMO (E1ux) = 0.0561156303861879
cycle= 2 E= -2097.61041166892  delta_E= 0.884  |g|= 1.79  |ddm|=  106
HOMO (E2gy) = -0.055211954012021  LUMO (E2gy) = -0.055211954012021
cycle= 3 E= -2098.41360254895  delta_E= -0.803  |g|= 0.491  |ddm|=  106
HOMO (E2gy) = -0.015515840181229  LUMO (A1u) = -0.0361993809237484
cycle= 4 E= -2098.42469820496  delta_E= -0.0111  |g|= 0.306  |ddm|= 1.54
HOMO (E2gy) = 0.0422806153887251  LUMO (A1u) = -0.0238696039587761
cycle= 5 E= -2098.41974790754  delta_E= 0.00495  |g|= 0.189  |ddm|= 0.214
HOMO (E2gy) = 0.0515145457565281  LUMO (A1u) = -0.00649866775736326
cycle= 6 E= -2098.42734385979  delta_E= -0.0076  |g|= 0.151  |ddm|= 0.191
HOMO (E2gy) = 0.0624445366979817  LUMO (A1u) = -0.00103617571366485
cycle= 7 E= -2098.42096510707  delta_E= 0.00638  |g|= 0.143  |ddm|= 0.126
HOMO (E2gy) = 0.0644146604814925  LUMO (A1u) = -0.00131910831695347
cycle= 8 E= -2098.41625223896  delta_E= 0.00471  |g|= 0.154  |ddm|= 0.0727
HOMO (E2gy) = 0.0676601349228431  LUMO (A1u) = -0.00118080737991982
cycle= 9 E= -2098.41317507974  delta_E= 0.00308  |g|= 0.159  |ddm|= 0.0239
HOMO (E2gy) = 0.0748874112012768  LUMO (A1u) = 2.00001049349592e-05
cycle= 10 E= -2098.40398890964  delta_E= 0.00919  |g|= 0.183  |ddm|= 0.0634
HOMO (E2gy) = 0.0744154513721343  LUMO (A1u) = 0.00249967851948859
cycle= 11 E= -2098.40618321705  delta_E= -0.00219  |g|= 0.186  |ddm|= 0.0887
HOMO (E2gy) = 0.0869154061011702  LUMO (A1u) = 0.00440776957689801
cycle= 12 E= -2098.17746993906  delta_E= 0.229  |g|= 0.339  |ddm|= 1.16
HOMO (E2gy) = 0.0816409699083878  LUMO (A1u) = 0.00960781569877293
cycle= 13 E= -2098.19780543978  delta_E= -0.0203  |g|= 0.242  |ddm|= 0.175
HOMO (E2gy) = 0.0811343689001938  LUMO (A1u) = 0.0255931571144053
cycle= 14 E= -2098.20607105053  delta_E= -0.00827  |g|= 0.251  |ddm|= 0.719
HOMO (E2gy) = 0.0726911337519035  LUMO (A1u) = 0.0290064705292651
cycle= 15 E= -2098.18850858396  delta_E= 0.0176  |g|= 0.411  |ddm|= 0.407
HOMO (E2gy) = 0.0721086649573171  LUMO (A1u) = 0.0287026135813596
cycle= 16 E= -2098.18799660841  delta_E= 0.000512  |g|= 0.413  |ddm|= 0.0218
HOMO (E2gy) = 0.0717219720872714  LUMO (A1u) = 0.0294001141458288
cycle= 17 E= -2098.18683490814  delta_E= 0.00116  |g|= 0.422  |ddm|= 0.0446
HOMO (E2gy) = 0.0609203809372467  LUMO (A1u) = 0.0289688247748494
cycle= 18 E= -2098.19144017881  delta_E= -0.00461  |g|= 0.417  |ddm|= 0.14
HOMO (E2gy) = 0.0643735040629719  LUMO (A1u) = 0.0284991045289246
cycle= 19 E= -2098.19537036933  delta_E= -0.00393  |g|= 0.384  |ddm|= 0.167
HOMO (E2gy) = 0.0785078101101663  LUMO (A1u) = 0.0212817135956983
cycle= 20 E= -2098.21428906249  delta_E= -0.0189  |g|= 0.122  |ddm|= 0.63
HOMO (E2gy) = 0.0818676163592966  LUMO (A1u) = 0.0224214195735115
cycle= 21 E= -2098.21094343983  delta_E= 0.00335  |g|= 0.135  |ddm|= 0.0936
HOMO (E2gy) = 0.0818533010356025  LUMO (A1u) = 0.022407052283095
cycle= 22 E= -2098.21118826877  delta_E= -0.000245  |g|= 0.134  |ddm|= 0.0115
HOMO (E2gy) = 0.0776913913061572  LUMO (A1u) = 0.0213599431272447
cycle= 23 E= -2098.21068399204  delta_E= 0.000504  |g|= 0.125  |ddm|= 0.108
HOMO (E2gy) = 0.0802239467614279  LUMO (A1u) = 0.0216478078220611
cycle= 24 E= -2098.20779238735  delta_E= 0.00289  |g|= 0.133  |ddm|= 0.111
HOMO (E2gy) = 0.0805390097286681  LUMO (A1u) = 0.0218610734705684
cycle= 25 E= -2098.20782708949  delta_E= -3.47e-05  |g|= 0.132  |ddm|= 0.0194
HOMO (E2gy) = 0.0657461525983453  LUMO (A1u) = 0.0173195185311672
cycle= 26 E= -2098.21459949072  delta_E= -0.00677  |g|= 0.102  |ddm|= 0.219
HOMO (E2gy) = 0.0689239163549458  LUMO (A1u) = 0.0182460749724613
cycle= 27 E= -2098.21167352854  delta_E= 0.00293  |g|= 0.106  |ddm|= 0.0664
HOMO (E2gy) = 0.0724855381585555  LUMO (A1u) = 0.0203764306021833
cycle= 28 E= -2098.21438395087  delta_E= -0.00271  |g|= 0.104  |ddm|= 0.122
HOMO (E2gy) = 0.0789340397639317  LUMO (A1u) = 0.0227422496621538
cycle= 29 E= -2098.21067900642  delta_E= 0.0037  |g|= 0.111  |ddm|= 0.0929
HOMO (E2gy) = 0.0791526407653325  LUMO (A1u) = 0.0226864775440812
cycle= 30 E= -2098.21263003355  delta_E= -0.00195  |g|= 0.11  |ddm|= 0.0798
HOMO (E2gy) = 0.0777563595059925  LUMO (A1u) = 0.0223143545130584
cycle= 31 E= -2098.21474418595  delta_E= -0.00211  |g|= 0.107  |ddm|= 0.0661
HOMO (E2gy) = 0.0787613364875801  LUMO (A1u) = 0.0225347656983948
cycle= 32 E= -2098.20812840266  delta_E= 0.00662  |g|= 0.112  |ddm|= 0.208
SCF not converged.
SCF energy = -2098.20812840266
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpuyzc2kgf
max_memory 4000 MB (current use 595 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2uy E2ux A1g E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = E2gy
0 -1
State   0 energy   -2098.565919613429
CASCI E = -2098.56591961343  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.760298959068
2 -1
State   0 energy     -30.848564974383
3 -1
State   0 energy     -30.912140401413
4 -1
State   0 energy   -2098.849667360329
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.84966736033  dE = -0.28374775  S^2 = 0.0000000
               |grad[o]|=0.718  |ddm|=0.755  |maxRot[o]|=  0.3
5 -1
State   0 energy     -31.066426646602
6 -1
State   0 energy     -31.084406693573
7 -1
State   0 energy     -31.108425604509
8 -1
State   0 energy   -2098.936280488402
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.9362804884  dE = -0.086613128  S^2 = 0.0000000
               |grad[o]|=0.189  |ddm|=0.203  |maxRot[o]|=0.312
9 -1
State   0 energy     -31.104243793035
10 -1
State   0 energy     -31.145582196693
11 -1
State   0 energy     -31.191116905534
12 -1
State   0 energy   -2099.102178491367
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.10217849137  dE = -0.165898  S^2 = 0.0000000
               |grad[o]|=0.166  |ddm|=0.171  |maxRot[o]|=0.312
13 -1
State   0 energy     -31.266454221537
14 -1
State   0 energy     -31.306558096563
15 -1
State   0 energy     -31.339384289144
16 -1
State   0 energy   -2099.238421021953
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.23842102195  dE = -0.13624253  S^2 = 0.0000000
               |grad[o]|=0.165  |ddm|=0.139  |maxRot[o]|=0.286
17 -1
State   0 energy     -31.402296400696
18 -1
State   0 energy     -31.408694311147
19 -1
State   0 energy     -31.411720012960
20 -1
State   0 energy   -2099.259753235299
macro iter 5 (19 JK  4 micro), CASSCF E = -2099.2597532353  dE = -0.021332213  S^2 = 0.0000000
               |grad[o]|=0.0702  |ddm|=0.0542  |maxRot[o]|=0.259
21 -1
State   0 energy     -31.381092497987
22 -1
State   0 energy     -31.381094567383
23 -1
State   0 energy     -31.381095374327
24 -1
State   0 energy   -2099.259771223946
macro iter 6 (10 JK  3 micro), CASSCF E = -2099.25977122395  dE = -1.7988647e-05  S^2 = 0.0000000
               |grad[o]|=0.00379  |ddm|=0.00473  |maxRot[o]|=0.00999
25 -1
State   0 energy     -31.377197193328
26 -1
State   0 energy   -2099.259771298464
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.25977129846  dE = -7.4517629e-08  S^2 = 0.0000000
               |grad[o]|=9.36e-05  |ddm|=0.000333  |maxRot[o]|=0.0004
1-step CASSCF converged in 7 macro (116 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.78154482 1.8153699  1.81536981 0.40638585 0.40638572 1.90080439
 1.5943499  0.19036172 1.59435    0.18472455 0.18472446 0.12562889]
CASSCF energy = -2099.25977129846
CASCI E = -2099.25977129846  E(CI) = -31.3769932894807  S^2 = 0.0000000
energy =  -2099.259771298464
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 14, 15, 0, 11, 5, 10, 2, 3, 5, 6, 7, 0, 0, 5, 2, 3, 6, 7, 0, 5, 10, 11, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 10, 11, 6, 7, 5, 14, 15, 0, 0, 2, 3, 10, 11, 6, 7, 16, 17, 5, 12, 13, 5, 0, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 63 64 65 74 75 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 22:01:55 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.900000000000 AA    0.000000000000   0.000000000000   1.700753512109 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.900000000000 AA    0.000000000000   0.000000000000  -1.700753512109 Bohr   0.0

nuclear repulsion = 169.3367074944
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      6984.60


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp9s2nub49
max_memory 4000 MB (current use 581 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.34811665371
HOMO (E2ux) = -0.21487044289103  LUMO (E2ux) = -0.21487044289103
cycle= 1 E= -2098.48629569087  delta_E= -0.138  |g|= 0.782  |ddm|= 3.49
HOMO (E2gy) = 0.08962976585292  LUMO (E1ux) = 0.0573646448961303
cycle= 2 E= -2097.78006403691  delta_E= 0.706  |g|= 1.52  |ddm|=   66
HOMO (E2ux) = 0.0241527843900605  LUMO (A1u) = -0.0601912474164978
cycle= 3 E= -2098.55376044618  delta_E= -0.774  |g|= 0.441  |ddm|=   66
HOMO (E2ux) = 0.0511220502944918  LUMO (A1u) = -0.0399144509067838
cycle= 4 E= -2098.57554421759  delta_E= -0.0218  |g|= 0.328  |ddm|= 0.314
HOMO (E2ux) = 0.0649732218089073  LUMO (A1u) = -0.0243255981391367
cycle= 5 E= -2098.57968724906  delta_E= -0.00414  |g|= 0.294  |ddm|= 0.204
HOMO (E2ux) = 0.0643182783988398  LUMO (A1u) = -0.0228691212805529
cycle= 6 E= -2098.58058583355  delta_E= -0.000899  |g|= 0.289  |ddm|= 0.0399
HOMO (E2ux) = 0.083264288440841  LUMO (A1u) = -0.0136998172325589
cycle= 7 E= -2098.57119012403  delta_E= 0.0094  |g|= 0.299  |ddm|= 0.154
HOMO (E2ux) = 0.0861630762689238  LUMO (A1u) = -0.0127545815576378
cycle= 8 E= -2098.56596348535  delta_E= 0.00523  |g|= 0.31  |ddm|= 0.119
HOMO (E2ux) = 0.0859396249281734  LUMO (A1u) = -0.0129868729794937
cycle= 9 E= -2098.56624068837  delta_E= -0.000277  |g|= 0.31  |ddm|= 0.00508
HOMO (E2ux) = 0.0856892581881161  LUMO (A1u) = -0.0131143981332021
cycle= 10 E= -2098.5679042729  delta_E= -0.00166  |g|=  0.3  |ddm|= 0.0604
HOMO (E2ux) = 0.113860282160443  LUMO (A1u) = 0.00816464707146611
cycle= 11 E= -2098.54577360819  delta_E= 0.0221  |g|= 0.231  |ddm|= 1.41
HOMO (E2ux) = 0.15491721519301  LUMO (A1u) = 0.00801016495736812
cycle= 12 E= -2098.5335278892  delta_E= 0.0122  |g|= 0.206  |ddm|= 0.241
HOMO (E2ux) = 0.159672108549202  LUMO (A1u) = 0.00720477435398355
cycle= 13 E= -2098.54796960605  delta_E= -0.0144  |g|= 0.23  |ddm|= 1.34
HOMO (E2ux) = 0.135811003385686  LUMO (A1u) = 0.00852262036452973
cycle= 14 E= -2098.54023440512  delta_E= 0.00774  |g|= 0.214  |ddm|= 1.36
HOMO (E2ux) = 0.143588992126083  LUMO (A1u) = 0.0122596134575104
cycle= 15 E= -2098.53601408517  delta_E= 0.00422  |g|= 0.215  |ddm|= 0.116
HOMO (E2ux) = 0.145054501882605  LUMO (A1u) = 0.00935834171234837
cycle= 16 E= -2098.53642318171  delta_E= -0.000409  |g|= 0.215  |ddm|= 0.13
HOMO (E2ux) = 0.153093404136269  LUMO (A1u) = 0.00804717009487119
cycle= 17 E= -2098.54232937095  delta_E= -0.00591  |g|= 0.209  |ddm|= 0.606
HOMO (E2ux) = 0.157822875761072  LUMO (A1u) = 0.00660255557686047
cycle= 18 E= -2098.39957166547  delta_E= 0.143  |g|= 0.381  |ddm|= 0.998
HOMO (E2ux) = 0.148160057664403  LUMO (A1u) = 0.00639726453560242
cycle= 19 E= -2098.56549019577  delta_E= -0.166  |g|= 0.207  |ddm|= 0.987
HOMO (E2ux) = 0.097901574315447  LUMO (A1u) = -0.00613353301354342
cycle= 20 E= -2098.48257181046  delta_E= 0.0829  |g|= 0.41  |ddm|= 0.653
HOMO (E2ux) = 0.101429547981994  LUMO (A1u) = 0.00361040912254592
cycle= 21 E= -2098.50613724157  delta_E= -0.0236  |g|= 0.323  |ddm|= 0.185
HOMO (E2ux) = 0.107254825146297  LUMO (A1u) = 0.0113250484261321
cycle= 22 E= -2098.53275790745  delta_E= -0.0266  |g|= 0.213  |ddm|= 1.45
HOMO (E2ux) = 0.122302895972546  LUMO (A1u) = 0.0159141424701709
cycle= 23 E= -2098.34731709205  delta_E= 0.185  |g|= 0.453  |ddm|= 1.08
HOMO (E2ux) = 0.139036585113163  LUMO (A1u) = 0.0234255155348514
cycle= 24 E= -2098.31484536969  delta_E= 0.0325  |g|= 0.356  |ddm|= 0.365
HOMO (E2ux) = 0.135966027363031  LUMO (A1u) = 0.0180308328466236
cycle= 25 E= -2098.5233328407  delta_E= -0.208  |g|= 0.266  |ddm|= 1.15
HOMO (E2ux) = 0.160760041407651  LUMO (A1u) = 0.022233819107479
cycle= 26 E= -2098.3463305662  delta_E= 0.177  |g|= 0.342  |ddm|= 1.11
HOMO (E2ux) = 0.144539082469496  LUMO (A1u) = 0.00906835031704049
cycle= 27 E= -2098.47038219506  delta_E= -0.124  |g|= 0.278  |ddm|= 1.13
HOMO (E2ux) = 0.17203964772996  LUMO (A1u) = 0.00945955296913893
cycle= 28 E= -2098.41535457663  delta_E= 0.055  |g|= 0.26  |ddm|=  1.2
HOMO (E2ux) = 0.175432173614146  LUMO (A1u) = 0.0195335223207302
cycle= 29 E= -2098.41141814501  delta_E= 0.00394  |g|= 0.27  |ddm|= 0.607
HOMO (E2ux) = 0.189370728760252  LUMO (A1u) = 0.0261557110070032
cycle= 30 E= -2098.37609556528  delta_E= 0.0353  |g|= 0.461  |ddm|= 0.255
HOMO (E2ux) = 0.195638127521709  LUMO (A1u) = 0.0361457946709779
cycle= 31 E= -2098.20484164954  delta_E= 0.171  |g|= 0.858  |ddm|= 5.79
HOMO (E2ux) = 0.195415759156792  LUMO (A1u) = 0.0363730003008766
cycle= 32 E= -2098.21193977745  delta_E= -0.0071  |g|= 0.87  |ddm|= 1.53
SCF not converged.
SCF energy = -2098.21193977745
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp9s2nub49
max_memory 4000 MB (current use 624 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2gx E2gy A1g E1uy E1ux A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.308048725153
CASCI E = -2098.30804872515  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -29.813174234917
2 -1
State   0 energy     -29.874836439900
3 -1
State   0 energy     -29.917745711632
4 -1
State   0 energy   -2098.517952948674
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.51795294867  dE = -0.20990422  S^2 = 0.0000000
               |grad[o]|=0.665  |ddm|=0.621  |maxRot[o]|=  0.3
5 -1
State   0 energy     -30.154155945580
6 -1
State   0 energy     -30.250040079304
7 -1
State   0 energy     -30.336302715465
8 -1
State   0 energy   -2098.774176696479
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.77417669648  dE = -0.25622375  S^2 = 0.0000000
               |grad[o]|=0.187  |ddm|= 2.38  |maxRot[o]|=0.241
9 -1
State   0 energy     -30.263758608892
10 -1
State   0 energy     -30.316151815310
11 -1
State   0 energy     -30.362516082134
12 -1
State   0 energy   -2098.975591695108
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.97559169511  dE = -0.201415  S^2 = 0.0000000
               |grad[o]|=0.518  |ddm|=0.275  |maxRot[o]|=0.293
13 -1
State   0 energy     -30.346649711826
14 -1
State   0 energy     -30.374854472310
15 -1
State   0 energy     -30.404843962321
16 -1
State   0 energy   -2099.090524963602
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.0905249636  dE = -0.11493327  S^2 = 0.0000000
               |grad[o]|=0.224  |ddm|=0.144  |maxRot[o]|=0.313
17 -1
State   0 energy     -30.472936437049
18 -1
State   0 energy     -30.503151524827
19 -1
State   0 energy     -30.530614448712
20 -1
State   0 energy   -2099.203908102103
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.2039081021  dE = -0.11338314  S^2 = 0.0000000
               |grad[o]|= 0.18  |ddm|=0.168  |maxRot[o]|=0.313
21 -1
State   0 energy     -30.623539858499
22 -1
State   0 energy     -30.632919350121
23 -1
State   0 energy     -30.639283728586
24 -1
State   0 energy   -2099.243288420820
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.24328842082  dE = -0.039380319  S^2 = 0.0000000
               |grad[o]|=0.109  |ddm|=0.0629  |maxRot[o]|=0.306
25 -1
State   0 energy     -30.797974684344
26 -1
State   0 energy     -30.801445361348
27 -1
State   0 energy     -30.804438694233
28 -1
State   0 energy   -2099.256556954747
macro iter 7 (21 JK  4 micro), CASSCF E = -2099.25655695475  dE = -0.013268534  S^2 = 0.0000000
               |grad[o]|=0.0513  |ddm|=0.0263  |maxRot[o]|=0.312
29 -1
State   0 energy     -30.787954835297
30 -1
State   0 energy     -30.790071896944
31 -1
State   0 energy     -30.792174258717
32 -1
State   0 energy   -2099.263569359229
macro iter 8 (20 JK  4 micro), CASSCF E = -2099.26356935923  dE = -0.0070124045  S^2 = 0.0000000
               |grad[o]|=0.0283  |ddm|=0.0478  |maxRot[o]|=0.292
33 -1
State   0 energy     -30.649050339183
34 -1
State   0 energy     -30.649144896458
35 -1
State   0 energy     -30.649174761478
36 -1
State   0 energy   -2099.263838833138
macro iter 9 (11 JK  4 micro), CASSCF E = -2099.26383883314  dE = -0.00026947391  S^2 = 0.0000000
               |grad[o]|=0.00703  |ddm|=0.0325  |maxRot[o]|=0.0459
37 -1
State   0 energy     -30.631252876389
38 -1
State   0 energy     -30.631253043427
39 -1
State   0 energy     -30.631253095795
40 -1
State   0 energy   -2099.263839620607
macro iter 10 (8 JK  3 micro), CASSCF E = -2099.26383962061  dE = -7.8746916e-07  S^2 = 0.0000000
               |grad[o]|=0.000427  |ddm|=0.00187  |maxRot[o]|=0.00235
41 -1
State   0 energy     -30.630512706730
42 -1
State   0 energy   -2099.263839626578
macro iter 11 (3 JK  1 micro), CASSCF E = -2099.26383962658  dE = -5.9712875e-09  S^2 = 0.0000000
               |grad[o]|=3.47e-05  |ddm|=0.000153  |maxRot[o]|=0.000132
1-step CASSCF converged in 11 macro (189 JK 40 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.39710281 1.39710025 1.67841821 1.72620305 1.72620293 1.87587154
 0.60288403 0.305936   0.27411724 0.27411713 0.1391603  0.60288651]
CASSCF energy = -2099.26383962658
CASCI E = -2099.26383962658  E(CI) = -30.6304703026094  S^2 = 0.0000000
energy =  -2099.2638396265784
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 10, 11, 0, 6, 7, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 5, 0, 2, 3, 6, 7, 0, 10, 11, 5, 6, 7, 14, 15, 2, 3, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 10, 11, 5, 6, 7, 0, 14, 15, 0, 2, 3, 10, 11, 5, 6, 7, 16, 17, 12, 13, 5, 0, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 65 66 75 76 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 22:18:32 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.950000000000 AA    0.000000000000   0.000000000000   1.795239818337 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.950000000000 AA    0.000000000000   0.000000000000  -1.795239818337 Bohr   0.0

nuclear repulsion = 160.424249205221
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:      9135.93


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpabgd18lu
max_memory 4000 MB (current use 611 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.20873602955
HOMO (E2ux) = -0.208845502900386  LUMO (E2ux) = -0.208845502900386
cycle= 1 E= -2098.43971059795  delta_E= -0.231  |g|= 0.722  |ddm|= 3.47
HOMO (E2gy) = 0.149980315833083  LUMO (E2ux) = 0.0462928954362145
cycle= 2 E= -2097.69266718704  delta_E= 0.747  |g|= 1.64  |ddm|= 44.8
HOMO (E2gy) = -0.0261893937094246  LUMO (A1u) = -0.0553503007981685
cycle= 3 E= -2098.40369673554  delta_E= -0.711  |g|= 0.465  |ddm|= 44.8
HOMO (E2gy) = 0.000454672760618769  LUMO (A1u) = -0.0396494195107791
cycle= 4 E= -2098.4252880847  delta_E= -0.0216  |g|= 0.317  |ddm|= 0.348
HOMO (E2gy) = 0.0197423506295128  LUMO (A1u) = -0.013797607430707
cycle= 5 E= -2098.44140259231  delta_E= -0.0161  |g|= 0.214  |ddm|= 0.368
HOMO (E2gy) = 0.0253730845720311  LUMO (A1u) = 0.00849928719821245
cycle= 6 E= -2098.44741014112  delta_E= -0.00601  |g|= 0.162  |ddm|= 0.343
HOMO (E2gy) = 0.0228696612317815  LUMO (A1u) = 0.00853668530109963
cycle= 7 E= -2098.44780195838  delta_E= -0.000392  |g|= 0.163  |ddm|= 0.0458
HOMO (E2gy) = 0.0216898753523635  LUMO (A1u) = 0.0083643733400027
cycle= 8 E= -2098.4479131068  delta_E= -0.000111  |g|= 0.163  |ddm|= 0.0194
HOMO (E2gy) = 0.0219206530018602  LUMO (A1u) = 0.00880530848185794
cycle= 9 E= -2098.44766959473  delta_E= 0.000244  |g|= 0.163  |ddm|= 0.0166
HOMO (E2gy) = 0.0328790874097767  LUMO (A1u) = 0.0210023279380617
cycle= 10 E= -2098.44154076437  delta_E= 0.00613  |g|= 0.194  |ddm|= 0.186
HOMO (E2gy) = 0.0239773810034133  LUMO (A1u) = 0.00197332034631042
cycle= 11 E= -2098.44597444834  delta_E= -0.00443  |g|= 0.165  |ddm|= 0.314
HOMO (E2gy) = 0.0252539678629945  LUMO (A1u) = 0.00230123707145684
cycle= 12 E= -2098.44593194258  delta_E= 4.25e-05  |g|= 0.165  |ddm|= 0.0387
HOMO (E2gy) = 0.028111950641184  LUMO (A1u) = 0.00272669914366929
cycle= 13 E= -2098.4443834181  delta_E= 0.00155  |g|= 0.167  |ddm|= 0.0716
HOMO (E2gy) = 0.0335813773722751  LUMO (A1u) = 0.00407304677692706
cycle= 14 E= -2098.4413762359  delta_E= 0.00301  |g|= 0.171  |ddm|= 0.081
HOMO (E2gy) = 0.0219265593024525  LUMO (A1u) = -0.000401799351967522
cycle= 15 E= -2098.43902342978  delta_E= 0.00235  |g|= 0.182  |ddm|= 0.193
HOMO (E2gy) = 0.0339853824648747  LUMO (A1u) = 0.00283530932568705
cycle= 16 E= -2098.43169769415  delta_E= 0.00733  |g|= 0.186  |ddm|= 0.149
HOMO (E2gy) = 0.026295876263797  LUMO (A1u) = 2.69805392186332e-05
cycle= 17 E= -2098.43248772227  delta_E= -0.00079  |g|= 0.189  |ddm|= 0.141
HOMO (E2gy) = 0.0239215083837805  LUMO (A1u) = -0.000744219998305752
cycle= 18 E= -2098.43486521822  delta_E= -0.00238  |g|= 0.192  |ddm|= 0.14
HOMO (E2gy) = 0.0347119302890565  LUMO (A1u) = 0.0014034874536059
cycle= 19 E= -2098.43151620554  delta_E= 0.00335  |g|= 0.182  |ddm|= 0.366
HOMO (E2gy) = 0.0393634971665488  LUMO (A1u) = 0.00355746697557903
cycle= 20 E= -2098.42978999982  delta_E= 0.00173  |g|= 0.178  |ddm|= 0.0895
HOMO (E2gy) = 0.0425201142537567  LUMO (A1u) = 0.00512425900821192
cycle= 21 E= -2098.42975325563  delta_E= 3.67e-05  |g|= 0.175  |ddm|= 0.149
HOMO (E2gy) = 0.0425422111845483  LUMO (A1u) = 0.00536197506847634
cycle= 22 E= -2098.43012945535  delta_E= -0.000376  |g|= 0.175  |ddm|= 0.0187
HOMO (E2gy) = 0.0338474364694847  LUMO (A1u) = 0.00369074133121421
cycle= 23 E= -2098.43970397789  delta_E= -0.00957  |g|= 0.169  |ddm|= 0.205
HOMO (E2gy) = 0.0360181415091442  LUMO (A1u) = 0.0044508216388995
cycle= 24 E= -2098.44076504291  delta_E= -0.00106  |g|= 0.163  |ddm|= 0.0875
HOMO (E2gy) = 0.0381724958492133  LUMO (A1u) = 0.00520022867771707
cycle= 25 E= -2098.43599467548  delta_E= 0.00477  |g|= 0.165  |ddm|= 0.131
HOMO (E2gy) = 0.0343276716498468  LUMO (A1u) = 0.00428541667485136
cycle= 26 E= -2098.43832068089  delta_E= -0.00233  |g|= 0.169  |ddm|= 0.132
HOMO (E2gy) = 0.0334349829245661  LUMO (A1u) = 0.00402688465332422
cycle= 27 E= -2098.43856825526  delta_E= -0.000248  |g|= 0.17  |ddm|= 0.00917
HOMO (E2gy) = 0.0320572896742616  LUMO (A1u) = 0.00365665806639822
cycle= 28 E= -2098.43891666456  delta_E= -0.000348  |g|= 0.17  |ddm|= 0.0195
HOMO (E2gy) = 0.0253723491662676  LUMO (A1u) = 0.000573516519690252
cycle= 29 E= -2098.44009857469  delta_E= -0.00118  |g|= 0.172  |ddm|= 0.0667
HOMO (E2gy) = 0.0271319415643296  LUMO (A1u) = 0.00140989097780539
cycle= 30 E= -2098.43983341373  delta_E= 0.000265  |g|= 0.172  |ddm|= 0.0154
HOMO (E2gy) = 0.0189543480044234  LUMO (A1u) = -0.00221103351650867
cycle= 31 E= -2098.44008712703  delta_E= -0.000254  |g|= 0.177  |ddm|= 0.101
HOMO (E2gy) = 0.0162640329303131  LUMO (A1u) = -0.00190562226811895
cycle= 32 E= -2098.44723566363  delta_E= -0.00715  |g|= 0.162  |ddm|= 0.204
SCF not converged.
SCF energy = -2098.44723566363
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpabgd18lu
max_memory 4000 MB (current use 643 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2ux E2uy E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.748722432517
CASCI E = -2098.74872243252  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -29.489974525438
2 -1
State   0 energy     -29.519557797129
3 -1
State   0 energy     -29.550195502627
4 -1
State   0 energy   -2098.878822440400
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.8788224404  dE = -0.13010001  S^2 = 0.0000000
               |grad[o]|=0.304  |ddm|=0.233  |maxRot[o]|=0.312
5 -1
State   0 energy     -29.642563617727
6 -1
State   0 energy     -29.688122829493
7 -1
State   0 energy     -29.738090278612
8 -1
State   0 energy   -2099.065218989912
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.06521898991  dE = -0.18639655  S^2 = 0.0000000
               |grad[o]|=0.229  |ddm|=0.243  |maxRot[o]|=0.312
9 -1
State   0 energy     -29.857482149239
10 -1
State   0 energy     -29.900596504147
11 -1
State   0 energy     -29.937742840809
12 -1
State   0 energy   -2099.222844571721
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.22284457172  dE = -0.15762558  S^2 = 0.0000000
               |grad[o]|=0.212  |ddm|= 0.31  |maxRot[o]|=0.312
13 -1
State   0 energy     -30.036839823031
14 -1
State   0 energy     -30.051610899786
15 -1
State   0 energy     -30.056225613154
16 -1
State   0 energy   -2099.268150078260
macro iter 4 (17 JK  4 micro), CASSCF E = -2099.26815007826  dE = -0.045305507  S^2 = 0.0000000
               |grad[o]|=0.122  |ddm|=0.127  |maxRot[o]|=0.232
17 -1
State   0 energy     -30.090409070301
18 -1
State   0 energy     -30.090409523287
19 -1
State   0 energy     -30.090409701429
20 -1
State   0 energy   -2099.268178721139
macro iter 5 (11 JK  4 micro), CASSCF E = -2099.26817872114  dE = -2.8642879e-05  S^2 = 0.0000000
               |grad[o]|=0.00443  |ddm|=0.00443  |maxRot[o]|=0.00492
21 -1
State   0 energy     -30.087484571446
22 -1
State   0 energy   -2099.268178724949
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.26817872495  dE = -3.8107828e-09  S^2 = 0.0000000
               |grad[o]|=4.01e-05  |ddm|=6.39e-05  |maxRot[o]|=0.000101
1-step CASSCF converged in 6 macro (94 JK 21 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.59281544 1.62414094 1.62414103 1.82982328 0.73665867 0.73665904
 1.26321302 0.15635547 1.2632134  0.37610401 0.37610409 0.42077161]
CASSCF energy = -2099.26817872495
CASCI E = -2099.26817872495  E(CI) = -30.0874968400658  S^2 = 0.0000000
energy =  -2099.2681787249494
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 15, 14, 11, 5, 10, 2, 3, 5, 6, 7, 0, 5, 2, 3, 0, 6, 7, 0, 5, 10, 11, 2, 3, 14, 15, 6, 7, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 10, 11, 5, 6, 7, 0, 14, 15, 0, 2, 3, 5, 10, 11, 6, 7, 16, 17, 12, 13, 5, 0, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 65 66 75 76 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 22:26:44 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.000000000000 AA    0.000000000000   0.000000000000   1.889726124565 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.000000000000 AA    0.000000000000   0.000000000000  -1.889726124565 Bohr   0.0

nuclear repulsion = 152.40303674496
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:     10249.41


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpxjdzquxi
max_memory 4000 MB (current use 639 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.08755390922
HOMO (E2ux) = -0.203908424432894  LUMO (E2ux) = -0.203908424432894
cycle= 1 E= -2098.4027945187  delta_E= -0.315  |g|= 0.687  |ddm|= 3.48
HOMO (E2gy) = 0.150110912764597  LUMO (E2ux) = 0.0288440416376394
cycle= 2 E= -2097.696402551  delta_E= 0.706  |g|= 1.61  |ddm|= 30.8
HOMO (E2gy) = -0.0176042610851261  LUMO (A1u) = -0.0560367063127835
cycle= 3 E= -2098.38151407439  delta_E= -0.685  |g|= 0.454  |ddm|= 30.8
HOMO (E2gy) = 0.00410754405927983  LUMO (A1u) = -0.0412876793038606
cycle= 4 E= -2098.40224761667  delta_E= -0.0207  |g|= 0.314  |ddm|= 0.304
HOMO (E2gy) = 0.019381619466727  LUMO (A1u) = -0.0167774736239265
cycle= 5 E= -2098.41836733625  delta_E= -0.0161  |g|= 0.218  |ddm|= 0.377
HOMO (E2gy) = 0.0235722750335979  LUMO (A1u) = 0.00664906200001372
cycle= 6 E= -2098.42518501545  delta_E= -0.00682  |g|= 0.165  |ddm|= 0.366
HOMO (E2gy) = 0.0206373256027182  LUMO (A1u) = 0.0066272205841511
cycle= 7 E= -2098.42563253599  delta_E= -0.000448  |g|= 0.167  |ddm|= 0.0462
HOMO (E2gy) = 0.0191881710068982  LUMO (A1u) = 0.00632871263317337
cycle= 8 E= -2098.42574775548  delta_E= -0.000115  |g|= 0.167  |ddm|= 0.0239
HOMO (E2gy) = 0.0195917062588658  LUMO (A1u) = 0.00693000346661721
cycle= 9 E= -2098.42541822105  delta_E= 0.00033  |g|= 0.167  |ddm|= 0.0219
HOMO (E2gy) = 0.028928567457026  LUMO (A1u) = 0.0198759276798009
cycle= 10 E= -2098.41927219805  delta_E= 0.00615  |g|= 0.201  |ddm|= 0.183
HOMO (E2gy) = 0.0204846600242427  LUMO (A1u) = -0.000738940021218165
cycle= 11 E= -2098.42386937866  delta_E= -0.0046  |g|= 0.169  |ddm|= 0.332
HOMO (E2gy) = 0.0215185891450672  LUMO (A1u) = -0.000499903588612832
cycle= 12 E= -2098.42392788178  delta_E= -5.85e-05  |g|= 0.17  |ddm|= 0.0479
HOMO (E2gy) = 0.0222173265222576  LUMO (A1u) = -0.00098435627461168
cycle= 13 E= -2098.4231184894  delta_E= 0.000809  |g|= 0.171  |ddm|= 0.0827
HOMO (E2gy) = 0.0265202742756895  LUMO (A1u) = 0.000731778646346122
cycle= 14 E= -2098.42170963008  delta_E= 0.00141  |g|= 0.173  |ddm|= 0.0606
HOMO (E2gy) = 0.0119620097094604  LUMO (A1u) = -0.00629468882895419
cycle= 15 E= -2098.42274248075  delta_E= -0.00103  |g|= 0.176  |ddm|= 0.156
HOMO (E2gy) = 0.0256978162082991  LUMO (A1u) = 0.000185809708810626
cycle= 16 E= -2098.41828788549  delta_E= 0.00445  |g|= 0.181  |ddm|= 0.17
HOMO (E2gy) = 0.0301395200509546  LUMO (A1u) = 0.000469734528519628
cycle= 17 E= -2098.41093942486  delta_E= 0.00735  |g|= 0.189  |ddm|= 0.199
HOMO (E2gy) = 0.0280682749756406  LUMO (A1u) = 0.000260496446021849
cycle= 18 E= -2098.4136574238  delta_E= -0.00272  |g|= 0.19  |ddm|= 0.0748
HOMO (E2gy) = 0.0308692268439624  LUMO (A1u) = 0.000325826215353846
cycle= 19 E= -2098.41325865802  delta_E= 0.000399  |g|= 0.183  |ddm|= 0.0725
HOMO (E2gy) = 0.0305081992185237  LUMO (A1u) = 0.000248877671101885
cycle= 20 E= -2098.41332425201  delta_E= -6.56e-05  |g|= 0.187  |ddm|= 0.0436
HOMO (E2gy) = 0.0301392592430452  LUMO (A1u) = 0.000254041659264935
cycle= 21 E= -2098.41316156935  delta_E= 0.000163  |g|= 0.182  |ddm|= 0.175
HOMO (E2gy) = 0.0310831868168872  LUMO (A1u) = 0.00140331446656085
cycle= 22 E= -2098.41283714373  delta_E= 0.000324  |g|= 0.182  |ddm|= 0.113
HOMO (E2gy) = 0.0265714172429315  LUMO (A1u) = -0.000299854648667329
cycle= 23 E= -2098.41509334352  delta_E= -0.00226  |g|= 0.181  |ddm|= 0.0716
HOMO (E2gy) = 0.0319442850057158  LUMO (A1u) = 0.00259913919398241
cycle= 24 E= -2098.41646509095  delta_E= -0.00137  |g|= 0.175  |ddm|= 0.102
HOMO (E2gy) = 0.0331633214080377  LUMO (A1u) = 0.00278978667407261
cycle= 25 E= -2098.4177983444  delta_E= -0.00133  |g|= 0.172  |ddm|= 0.0706
HOMO (E2gy) = 0.0240555637075489  LUMO (A1u) = 0.00172308015155147
cycle= 26 E= -2098.42188327685  delta_E= -0.00408  |g|= 0.17  |ddm|= 0.0932
HOMO (E2gy) = 0.0312932016023792  LUMO (A1u) = 0.00279642482228857
cycle= 27 E= -2098.41180258348  delta_E= 0.0101  |g|= 0.179  |ddm|= 0.182
HOMO (E2gy) = 0.035189772771539  LUMO (A1u) = 0.00257477107347571
cycle= 28 E= -2098.40915031463  delta_E= 0.00265  |g|= 0.179  |ddm|= 0.113
HOMO (E2gy) = 0.0301013528131568  LUMO (A1u) = 0.00158430560154624
cycle= 29 E= -2098.41290995647  delta_E= -0.00376  |g|= 0.179  |ddm|= 0.139
HOMO (E2gy) = 0.0330762942155106  LUMO (A1u) = 0.00356182678145438
cycle= 30 E= -2098.41117662724  delta_E= 0.00173  |g|= 0.177  |ddm|= 0.167
HOMO (E2gy) = 0.0346941069087817  LUMO (A1u) = 0.00443948682216845
cycle= 31 E= -2098.41280082624  delta_E= -0.00162  |g|= 0.174  |ddm|= 0.118
HOMO (E2gy) = 0.0340730373842624  LUMO (A1u) = 0.00387784907267592
cycle= 32 E= -2098.41295453798  delta_E= -0.000154  |g|= 0.175  |ddm|= 0.028
SCF not converged.
SCF energy = -2098.41295453798
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpxjdzquxi
max_memory 4000 MB (current use 663 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2ux E2uy E2gy A1u E2gx E1gx E1gy A1u
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.705081352934
CASCI E = -2098.70508135293  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.962003446566
2 -1
State   0 energy     -28.998290175381
3 -1
State   0 energy     -29.035267679886
4 -1
State   0 energy   -2098.862601795595
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.86260179559  dE = -0.15752044  S^2 = 0.0000000
               |grad[o]|=0.317  |ddm|=0.249  |maxRot[o]|=0.312
5 -1
State   0 energy     -29.135988733790
6 -1
State   0 energy     -29.189018592673
7 -1
State   0 energy     -29.247587978896
8 -1
State   0 energy   -2099.078530228087
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.07853022809  dE = -0.21592843  S^2 = 0.0000000
               |grad[o]|=0.244  |ddm|=0.344  |maxRot[o]|=0.312
9 -1
State   0 energy     -29.380773988572
10 -1
State   0 energy     -29.425641849642
11 -1
State   0 energy     -29.462675587362
12 -1
State   0 energy   -2099.241045134591
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.24104513459  dE = -0.16251491  S^2 = 0.0000000
               |grad[o]|=0.227  |ddm|=0.385  |maxRot[o]|=0.313
13 -1
State   0 energy     -29.569990274305
14 -1
State   0 energy     -29.579747398486
15 -1
State   0 energy     -29.580514218425
16 -1
State   0 energy   -2099.274419555050
macro iter 4 (15 JK  4 micro), CASSCF E = -2099.27441955505  dE = -0.03337442  S^2 = 0.0000000
               |grad[o]|=0.113  |ddm|=0.114  |maxRot[o]|= 0.18
17 -1
State   0 energy     -29.603501840877
18 -1
State   0 energy     -29.603502202342
19 -1
State   0 energy     -29.603502300099
20 -1
State   0 energy   -2099.274435953835
macro iter 5 (9 JK  3 micro), CASSCF E = -2099.27443595384  dE = -1.6398785e-05  S^2 = 0.0000000
               |grad[o]|=0.00311  |ddm|=0.00328  |maxRot[o]|=0.00349
21 -1
State   0 energy     -29.602778760107
22 -1
State   0 energy   -2099.274435960070
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.27443596007  dE = -6.2350409e-09  S^2 = 0.0000000
               |grad[o]|=4.19e-05  |ddm|=9.28e-05  |maxRot[o]|=0.000138
1-step CASSCF converged in 6 macro (90 JK 20 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.55754872 1.51230742 1.51230741 1.73591897 0.82334844 0.82334914
 1.17656749 0.17669364 1.17656819 0.4878227  0.48782269 0.52974518]
CASSCF energy = -2099.27443596007
CASCI E = -2099.27443596007  E(CI) = -29.6027872648947  S^2 = 0.0000000
energy =  -2099.27443596007
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 15, 14, 11, 5, 10, 2, 3, 5, 6, 7, 0, 5, 2, 3, 0, 6, 7, 0, 5, 10, 11, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 5, 10, 11, 6, 7, 0, 14, 15, 0, 2, 3, 5, 10, 11, 6, 7, 16, 17, 5, 12, 13, 0, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 65 66 75 76 78 79]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 22:35:05 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.100000000000 AA    0.000000000000   0.000000000000   2.078698737022 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.100000000000 AA    0.000000000000   0.000000000000  -2.078698737022 Bohr   0.0

nuclear repulsion = 138.548215222691
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:     11295.37


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp5rtqdqzm
max_memory 4000 MB (current use 659 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.88847366206
HOMO (E2ux) = -0.196645184506769  LUMO (E2ux) = -0.196645184506769
cycle= 1 E= -2098.33658176741  delta_E= -0.448  |g|= 0.656  |ddm|= 3.49
HOMO (E2ux) = 0.188051275314239  LUMO (E1ux) = 0.0583333283255243
cycle= 2 E= -2097.63320000012  delta_E= 0.703  |g|= 1.59  |ddm|= 15.4
HOMO (E2ux) = 0.031742748061338  LUMO (A1u) = -0.0558109243107673
cycle= 3 E= -2098.36946880565  delta_E= -0.736  |g|= 0.432  |ddm|= 15.3
HOMO (E2ux) = 0.0420910902264936  LUMO (A1u) = -0.0414619280095233
cycle= 4 E= -2098.39744924924  delta_E= -0.028  |g|= 0.313  |ddm|= 0.234
HOMO (E2ux) = 0.0541294159881037  LUMO (A1u) = -0.00611108608262766
cycle= 5 E= -2098.41406094058  delta_E= -0.0166  |g|= 0.221  |ddm|= 0.64
HOMO (E2ux) = 0.0396872002060819  LUMO (A1u) = 0.00909071494646085
cycle= 6 E= -2098.40983463548  delta_E= 0.00423  |g|= 0.225  |ddm|= 0.369
HOMO (E2ux) = 0.0566422917902899  LUMO (A1u) = 0.0114178166795061
cycle= 7 E= -2098.40603273464  delta_E= 0.0038  |g|= 0.223  |ddm|= 0.137
HOMO (E2ux) = 0.0534423957621558  LUMO (A1u) = 0.00899148561372748
cycle= 8 E= -2098.40259587889  delta_E= 0.00344  |g|= 0.229  |ddm|= 0.0707
HOMO (E2ux) = 0.054072731370555  LUMO (A1u) = 0.00993196742366697
cycle= 9 E= -2098.40202723132  delta_E= 0.000569  |g|= 0.229  |ddm|= 0.0317
HOMO (E2ux) = 0.0579378245029999  LUMO (A1u) = 0.0186699950395227
cycle= 10 E= -2098.40243678007  delta_E= -0.00041  |g|= 0.237  |ddm|= 0.267
HOMO (E2ux) = 0.0586298118446009  LUMO (A1u) = -0.0025291500569711
cycle= 11 E= -2098.40330221191  delta_E= -0.000865  |g|= 0.236  |ddm|= 0.365
HOMO (E2ux) = 0.0491227472136334  LUMO (A1u) = -0.00541499046988752
cycle= 12 E= -2098.40053048217  delta_E= 0.00277  |g|= 0.231  |ddm|= 0.442
HOMO (E2ux) = 0.0482343462669448  LUMO (A1u) = -0.00475735991562293
cycle= 13 E= -2098.4012674123  delta_E= -0.000737  |g|= 0.231  |ddm|= 0.114
HOMO (E2ux) = 0.0340958364131554  LUMO (A1u) = -0.0108531683240157
cycle= 14 E= -2098.40289111352  delta_E= -0.00162  |g|= 0.236  |ddm|= 0.168
HOMO (E2ux) = 0.0405973658934937  LUMO (A1u) = -0.00801089351266497
cycle= 15 E= -2098.40586348696  delta_E= -0.00297  |g|= 0.225  |ddm|= 0.197
HOMO (E2ux) = 0.0514414898036298  LUMO (A1u) = -0.00739840146177269
cycle= 16 E= -2098.40383843055  delta_E= 0.00203  |g|= 0.245  |ddm|=  0.6
HOMO (E2ux) = 0.0428822265288445  LUMO (A1u) = -0.0102525895122104
cycle= 17 E= -2098.40608564923  delta_E= -0.00225  |g|= 0.251  |ddm|= 0.151
HOMO (E2ux) = 0.0433612945873105  LUMO (A1u) = -0.0103546778711135
cycle= 18 E= -2098.4072593235  delta_E= -0.00117  |g|= 0.248  |ddm|= 0.0213
HOMO (E2ux) = 0.0385827922221497  LUMO (A1u) = -0.0118472445656865
cycle= 19 E= -2098.40529208313  delta_E= 0.00197  |g|= 0.257  |ddm|= 0.036
HOMO (E2ux) = 0.0358930177886378  LUMO (A1u) = -0.011586943311756
cycle= 20 E= -2098.4037827176  delta_E= 0.00151  |g|= 0.266  |ddm|= 0.13
HOMO (E2ux) = 0.0375267554476928  LUMO (A1u) = -0.0104425577089921
cycle= 21 E= -2098.40704562378  delta_E= -0.00326  |g|= 0.245  |ddm|= 0.333
HOMO (E2ux) = 0.0340386166201743  LUMO (A1u) = -0.0107732065452607
cycle= 22 E= -2098.41176501245  delta_E= -0.00472  |g|= 0.243  |ddm|= 0.139
HOMO (E2ux) = 0.0513361395419893  LUMO (A1u) = -0.00413190932872469
cycle= 23 E= -2098.41249435107  delta_E= -0.000729  |g|= 0.211  |ddm|= 0.247
HOMO (E2ux) = 0.0503894453635512  LUMO (A1u) = -0.00441414381557838
cycle= 24 E= -2098.40732420539  delta_E= 0.00517  |g|= 0.216  |ddm|= 0.401
HOMO (E2ux) = 0.0748629551959905  LUMO (A1u) = -0.000720372574138418
cycle= 25 E= -2098.40076786471  delta_E= 0.00656  |g|= 0.237  |ddm|= 1.01
HOMO (E2ux) = 0.0781813445663105  LUMO (A1u) = 0.000167603576637206
cycle= 26 E= -2098.39755423921  delta_E= 0.00321  |g|= 0.238  |ddm|= 0.054
HOMO (E2ux) = 0.0833451053059805  LUMO (A1u) = 0.00328452622767004
cycle= 27 E= -2098.39334983805  delta_E= 0.0042  |g|= 0.236  |ddm|= 0.0859
HOMO (E2ux) = 0.0773115749738455  LUMO (A1u) = 0.00403984464186652
cycle= 28 E= -2098.394294308  delta_E= -0.000944  |g|= 0.242  |ddm|= 0.215
HOMO (E2ux) = 0.0543943383968297  LUMO (A1u) = -0.00539855846183676
cycle= 29 E= -2098.39547490824  delta_E= -0.00118  |g|= 0.264  |ddm|= 0.165
HOMO (E2ux) = 0.0394758866675414  LUMO (A1u) = -0.0111626468728106
cycle= 30 E= -2098.39328643005  delta_E= 0.00219  |g|= 0.285  |ddm|= 0.273
HOMO (E2ux) = 0.0414512785373818  LUMO (A1u) = -0.0101576174903036
cycle= 31 E= -2098.39286771641  delta_E= 0.000419  |g|= 0.284  |ddm|= 0.0634
HOMO (E2ux) = 0.0338436372940362  LUMO (A1u) = -0.0124168617526617
cycle= 32 E= -2098.39388919522  delta_E= -0.00102  |g|= 0.293  |ddm|= 0.0839
SCF not converged.
SCF energy = -2098.39388919522
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp5rtqdqzm
max_memory 4000 MB (current use 678 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux A1g E2gy E2gx E2ux A1u E2uy A1u E1gx E1gy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.858914408043
CASCI E = -2098.85891440804  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.229285560738
2 -1
State   0 energy     -28.288703752947
3 -1
State   0 energy     -28.350476134504
4 -1
State   0 energy   -2099.093963731229
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.09396373123  dE = -0.23504932  S^2 = 0.0000000
               |grad[o]|=0.297  |ddm|=0.616  |maxRot[o]|=0.313
5 -1
State   0 energy     -28.506508688424
6 -1
State   0 energy     -28.551742636968
7 -1
State   0 energy     -28.588238248206
8 -1
State   0 energy   -2099.259052553064
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.25905255306  dE = -0.16508882  S^2 = 0.0000000
               |grad[o]|=0.264  |ddm|=0.351  |maxRot[o]|=0.314
9 -1
State   0 energy     -28.729968620860
10 -1
State   0 energy     -28.737630576824
11 -1
State   0 energy     -28.738168645496
12 -1
State   0 energy   -2099.289478215671
macro iter 3 (15 JK  4 micro), CASSCF E = -2099.28947821567  dE = -0.030425663  S^2 = 0.0000000
               |grad[o]|=0.119  |ddm|=0.0743  |maxRot[o]|=0.168
13 -1
State   0 energy     -28.768647140054
14 -1
State   0 energy     -28.768647432341
15 -1
State   0 energy     -28.768647471045
16 -1
State   0 energy   -2099.289501380335
macro iter 4 (9 JK  3 micro), CASSCF E = -2099.28950138033  dE = -2.3164664e-05  S^2 = 0.0000000
               |grad[o]|=0.00397  |ddm|=0.00224  |maxRot[o]|=0.00429
17 -1
State   0 energy     -28.767339118557
18 -1
State   0 energy   -2099.289501380332
macro iter 5 (1 JK  1 micro), CASSCF E = -2099.28950138033  dE = 2.7284841e-12  S^2 = 0.0000000
               |grad[o]|=2.74e-05  |ddm|=5.6e-05  |maxRot[o]|=    0
1-step CASSCF converged in 5 macro (67 JK 16 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.45023074 1.32516204 1.32516199 1.64256766 1.09097283 1.09097306
 0.90901259 0.21684956 0.90901283 0.69032432 0.67486621 0.67486615]
CASSCF energy = -2099.28950138033
CASCI E = -2099.28950138033  E(CI) = -28.7673391174458  S^2 = 0.0000000
energy =  -2099.289501380332
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 0, 11, 10, 15, 5, 14, 5, 2, 3, 6, 7, 0, 5, 2, 3, 0, 0, 6, 7, 5, 10, 11, 2, 3, 14, 15, 6, 7, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 5, 6, 7, 10, 11, 0, 14, 15, 2, 3, 0, 5, 6, 7, 5, 10, 11, 16, 17, 0, 12, 13, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 62 63 65 66 76 77 79 80]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 22:43:06 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.250000000000 AA    0.000000000000   0.000000000000   2.362157655706 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.250000000000 AA    0.000000000000   0.000000000000  -2.362157655706 Bohr   0.0

nuclear repulsion = 121.922429395968
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:     12233.35


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpngeflcru
max_memory 4000 MB (current use 682 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.67292358523
HOMO (E2ux) = -0.190308549818199  LUMO (E2ux) = -0.190308549818199
cycle= 1 E= -2098.19897749275  delta_E= -0.526  |g|= 0.61  |ddm|= 3.26
HOMO (E2gy) = 0.153200120881714  LUMO (A1u) = 0.00985858623595117
cycle= 2 E= -2098.11169464887  delta_E= 0.0873  |g|= 0.665  |ddm|= 3.09
HOMO (E2gy) = 0.0121673311556824  LUMO (A1u) = -0.0108821156147484
cycle= 3 E= -2098.26316379133  delta_E= -0.151  |g|= 0.206  |ddm|= 1.18
HOMO (E2gy) = 0.0124498085897844  LUMO (A1u) = -0.0102071106719725
cycle= 4 E= -2098.26410581852  delta_E= -0.000942  |g|= 0.175  |ddm|= 0.103
HOMO (E2gy) = 0.0105200024114295  LUMO (A1u) = -0.0111488806784801
cycle= 5 E= -2098.26485627332  delta_E= -0.00075  |g|= 0.178  |ddm|= 0.0464
HOMO (E2gy) = -0.000528262449988917  LUMO (A1u) = -0.0166822204262704
cycle= 6 E= -2098.26856929613  delta_E= -0.00371  |g|= 0.182  |ddm|= 0.177
HOMO (E2gy) = -0.00178418594569009  LUMO (A1u) = -0.0173529030082456
cycle= 7 E= -2098.26876216325  delta_E= -0.000193  |g|= 0.183  |ddm|= 0.0243
HOMO (E2gy) = -0.0020673656475755  LUMO (A1u) = -0.0175018319110759
cycle= 8 E= -2098.26885080799  delta_E= -8.86e-05  |g|= 0.183  |ddm|= 0.00662
HOMO (E2gy) = -0.00210453190292819  LUMO (A1u) = -0.0173634795795106
cycle= 9 E= -2098.2686094471  delta_E= 0.000241  |g|= 0.184  |ddm|= 0.023
HOMO (E2gy) = 0.000360494804442048  LUMO (A1u) = -0.0163412842381725
cycle= 10 E= -2098.25557374238  delta_E= 0.013  |g|= 0.202  |ddm|= 0.202
HOMO (E2gy) = 0.00280798278278334  LUMO (A1u) = -0.0142155813444287
cycle= 11 E= -2098.25347105974  delta_E= 0.0021  |g|= 0.205  |ddm|= 0.0757
HOMO (E2gy) = 0.0042316572279769  LUMO (A1u) = -0.0123956635880301
cycle= 12 E= -2098.25669589179  delta_E= -0.00322  |g|= 0.199  |ddm|= 0.0884
HOMO (E2gy) = 0.00348346480054534  LUMO (A1u) = -0.0140544654448011
cycle= 13 E= -2098.25505475335  delta_E= 0.00164  |g|= 0.199  |ddm|= 0.102
HOMO (E2gy) = -0.000957532741324491  LUMO (A1u) = -0.0163737030639402
cycle= 14 E= -2098.25689533477  delta_E= -0.00184  |g|= 0.201  |ddm|= 0.109
HOMO (E2gy) = 0.0111792870453144  LUMO (A1u) = -0.0106752644369078
cycle= 15 E= -2098.2542841222  delta_E= 0.00261  |g|= 0.196  |ddm|= 0.107
HOMO (E2gy) = 0.0177629054096131  LUMO (A1u) = -0.00612494098375367
cycle= 16 E= -2098.24874312424  delta_E= 0.00554  |g|= 0.194  |ddm|= 0.21
HOMO (E2gy) = 0.0124233229012685  LUMO (A1u) = -0.00873884563501672
cycle= 17 E= -2098.25240722239  delta_E= -0.00366  |g|= 0.197  |ddm|= 0.163
HOMO (E2gy) = 0.00384215695764495  LUMO (A1u) = -0.0101791163601764
cycle= 18 E= -2098.2517772376  delta_E= 0.00063  |g|= 0.203  |ddm|= 0.182
HOMO (E2gy) = 0.00309575766176596  LUMO (A1u) = -0.00748110390083521
cycle= 19 E= -2098.25928207289  delta_E= -0.0075  |g|= 0.181  |ddm|= 0.348
HOMO (E2gy) = -4.81234034447882e-05  LUMO (A1u) = -0.009212204758832
cycle= 20 E= -2098.2540305141  delta_E= 0.00525  |g|= 0.198  |ddm|= 0.112
HOMO (E2gy) = 0.0191337078801979  LUMO (A1u) = -0.0119653922108361
cycle= 21 E= -2098.24696304604  delta_E= 0.00707  |g|= 0.194  |ddm|= 0.62
HOMO (E2gy) = 0.0119398071566751  LUMO (A1u) = -0.0127457130942461
cycle= 22 E= -2098.25562913684  delta_E= -0.00867  |g|= 0.195  |ddm|= 0.311
HOMO (E2gy) = 0.0166420168019182  LUMO (A1u) = -0.0110573994946534
cycle= 23 E= -2098.25527630528  delta_E= 0.000353  |g|= 0.188  |ddm|= 0.12
HOMO (E2gy) = 0.028471736678911  LUMO (A1u) = -0.0103921703763826
cycle= 24 E= -2098.24824489727  delta_E= 0.00703  |g|= 0.195  |ddm|= 0.28
HOMO (E2gy) = 0.025932758353535  LUMO (A1u) = -0.00847317092505214
cycle= 25 E= -2098.2487224439  delta_E= -0.000478  |g|= 0.189  |ddm|= 0.275
HOMO (E2gy) = 0.0293698992575426  LUMO (A1u) = -0.00709702343228806
cycle= 26 E= -2098.25220729468  delta_E= -0.00348  |g|= 0.19  |ddm|= 0.166
HOMO (E2gy) = -0.0019935020838954  LUMO (A1u) = -0.0140559512611252
cycle= 27 E= -2098.26077146155  delta_E= -0.00856  |g|= 0.187  |ddm|= 0.612
HOMO (E2gy) = 0.000843084973845003  LUMO (A1u) = -0.0128894739470462
cycle= 28 E= -2098.26163876383  delta_E= -0.000867  |g|= 0.178  |ddm|= 0.153
HOMO (E2gy) = -0.00508156692217814  LUMO (A1u) = -0.0110571839761618
cycle= 29 E= -2098.25676925011  delta_E= 0.00487  |g|= 0.201  |ddm|= 0.38
HOMO (E2gy) = -0.0172966441206569  LUMO (A1u) = -0.0205863027783926
cycle= 30 E= -2098.25872421529  delta_E= -0.00195  |g|= 0.197  |ddm|= 0.346
HOMO (E2gy) = 0.0254365526562377  LUMO (A1u) = -0.00474113525204093
cycle= 31 E= -2098.25025580464  delta_E= 0.00847  |g|= 0.202  |ddm|= 0.295
HOMO (E2gy) = 0.0280086570248638  LUMO (A1u) = -0.00710703776912724
cycle= 32 E= -2098.24698992123  delta_E= 0.00327  |g|= 0.207  |ddm|= 0.352
SCF not converged.
SCF energy = -2098.24698992123
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 27 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpngeflcru
max_memory 4000 MB (current use 699 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1g E1uy E1ux E2ux E2uy E2gy A1u E2gx A1u E1gx E1gy
Active space CI wfn symmetry = A1u
0 -1
State   0 energy   -2098.735503302423
CASCI E = -2098.73550330242  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -27.118949514399
2 -1
State   0 energy     -27.154408605524
3 -1
State   0 energy     -27.187706254728
4 -1
State   0 energy   -2098.863262891083
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.86326289108  dE = -0.12775959  S^2 = 0.0000000
               |grad[o]|=0.492  |ddm|=0.101  |maxRot[o]|=0.248
5 -1
State   0 energy     -28.452555655987
6 -1
State   0 energy     -28.459367597821
7 -1
State   0 energy     -28.478742511254
8 -1
State   0 energy   -2098.888569409089
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.88856940909  dE = -0.025306518  S^2 = 0.0000000
               |grad[o]|=0.118  |ddm|=0.346  |maxRot[o]|=0.281
9 -1
State   0 energy     -30.673945719978
10 -1
State   0 energy     -30.699299545308
11 -1
State   0 energy     -30.721031714734
12 -1
State   0 energy   -2098.987093176232
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.98709317623  dE = -0.098523767  S^2 = 0.0000000
               |grad[o]|=0.398  |ddm|=0.265  |maxRot[o]|=0.314
13 -1
State   0 energy     -30.980373402747
14 -1
State   0 energy     -30.994104988984
15 -1
State   0 energy     -31.002750655537
16 -1
State   0 energy   -2099.032643724001
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.032643724  dE = -0.045550548  S^2 = 0.0000000
               |grad[o]|=0.188  |ddm|=0.602  |maxRot[o]|=0.275
17 -1
State   0 energy     -32.068702907234
18 -1
State   0 energy     -32.089702415157
19 -1
State   0 energy     -32.144843069034
20 -1
State   0 energy   -2099.037575986829
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.03757598683  dE = -0.0049322628  S^2 = 0.0000000
               |grad[o]|=0.0544  |ddm|=0.032  |maxRot[o]|=0.176
21 -1
State   0 energy     -35.714373179055
22 -1
State   0 energy     -35.735305853098
23 -1
State   0 energy     -35.711154607661
24 -1
State   0 energy   -2099.041757962462
macro iter 6 (21 JK  4 micro), CASSCF E = -2099.04175796246  dE = -0.0041819756  S^2 = 0.0000000
               |grad[o]|=0.0248  |ddm|=0.0202  |maxRot[o]|=0.187
25 -1
State   0 energy     -36.816053711157
26 -1
State   0 energy     -36.799269883328
27 -1
State   0 energy     -36.831924547349
28 -1
State   0 energy   -2099.044662331958
macro iter 7 (20 JK  4 micro), CASSCF E = -2099.04466233196  dE = -0.0029043695  S^2 = 0.0000000
               |grad[o]|=0.0222  |ddm|=0.0351  |maxRot[o]|=0.142
29 -1
State   0 energy     -36.995212960349
30 -1
State   0 energy     -37.029959676035
31 -1
State   0 energy     -37.082944572803
32 -1
State   0 energy   -2099.047337885708
macro iter 8 (20 JK  4 micro), CASSCF E = -2099.04733788571  dE = -0.0026755537  S^2 = 0.0000000
               |grad[o]|=0.0352  |ddm|=0.0678  |maxRot[o]|=0.286
33 -1
State   0 energy     -38.057820073738
34 -1
State   0 energy     -38.054172125809
35 -1
State   0 energy     -38.068013811070
36 -1
State   0 energy   -2099.050932085152
macro iter 9 (21 JK  4 micro), CASSCF E = -2099.05093208515  dE = -0.0035941994  S^2 = 0.0000000
               |grad[o]|=0.039  |ddm|=0.0839  |maxRot[o]|=0.198
37 -1
State   0 energy     -39.275875377848
38 -1
State   0 energy     -39.271131884650
39 -1
State   0 energy     -39.280266761347
40 -1
State   0 energy   -2099.057769936178
macro iter 10 (21 JK  4 micro), CASSCF E = -2099.05776993618  dE = -0.006837851  S^2 = 0.0000000
               |grad[o]|=0.0436  |ddm|=0.108  |maxRot[o]|=0.211
41 -1
State   0 energy     -40.495514341006
42 -1
State   0 energy     -40.511314430110
43 -1
State   0 energy     -40.503670475067
44 -1
State   0 energy   -2099.082782628973
macro iter 11 (21 JK  4 micro), CASSCF E = -2099.08278262897  dE = -0.025012693  S^2 = 0.0000000
               |grad[o]|=0.0634  |ddm|=0.185  |maxRot[o]|=  0.2
45 -1
State   0 energy     -41.701003083125
46 -1
State   0 energy     -41.731061012080
47 -1
State   0 energy     -41.751873784735
48 -1
State   0 energy   -2099.135974993920
macro iter 12 (21 JK  4 micro), CASSCF E = -2099.13597499392  dE = -0.053192365  S^2 = 0.0000000
               |grad[o]|=0.107  |ddm|=0.445  |maxRot[o]|=0.257
49 -1
State   0 energy     -44.310105611459
50 -1
State   0 energy     -44.318942338463
51 -1
State   0 energy     -44.324032916430
52 -1
State   0 energy   -2099.176737308470
macro iter 13 (21 JK  4 micro), CASSCF E = -2099.17673730847  dE = -0.040762315  S^2 = 0.0000000
               |grad[o]|=0.134  |ddm|=0.354  |maxRot[o]|=0.264
53 -1
State   0 energy     -44.669599975359
54 -1
State   0 energy     -44.697256432726
55 -1
State   0 energy     -44.740786235918
56 -1
State   0 energy   -2099.181996364500
macro iter 14 (21 JK  4 micro), CASSCF E = -2099.1819963645  dE = -0.005259056  S^2 = 0.0000000
               |grad[o]|=0.0555  |ddm|=0.0617  |maxRot[o]|=0.182
57 -1
State   0 energy     -44.970392760104
58 -1
State   0 energy     -44.970618273815
59 -1
State   0 energy     -44.979363412567
60 -1
State   0 energy   -2099.183565148252
macro iter 15 (21 JK  4 micro), CASSCF E = -2099.18356514825  dE = -0.0015687838  S^2 = 0.0000000
               |grad[o]|=0.0321  |ddm|=0.0374  |maxRot[o]|=0.0511
61 -1
State   0 energy     -45.233997020544
62 -1
State   0 energy     -45.243829959455
63 -1
State   0 energy     -45.238247621881
64 -1
State   0 energy   -2099.183624076018
macro iter 16 (21 JK  4 micro), CASSCF E = -2099.18362407602  dE = -5.8927765e-05  S^2 = 0.0000000
               |grad[o]|=0.0078  |ddm|=0.00188  |maxRot[o]|=0.0316
65 -1
State   0 energy     -45.399560024543
66 -1
State   0 energy     -45.411333524664
67 -1
State   0 energy     -45.400171512464
68 -1
State   0 energy   -2099.183801618821
macro iter 17 (21 JK  4 micro), CASSCF E = -2099.18380161882  dE = -0.0001775428  S^2 = 0.0000000
               |grad[o]|=0.00562  |ddm|=0.00223  |maxRot[o]|=0.0559
69 -1
State   0 energy     -45.733331758380
70 -1
State   0 energy     -45.734690255588
71 -1
State   0 energy     -45.736028299375
72 -1
State   0 energy   -2099.183789279113
macro iter 18 (21 JK  4 micro), CASSCF E = -2099.18378927911  dE = 1.2339708e-05  S^2 = 0.0000000
               |grad[o]|=0.00229  |ddm|=0.00182  |maxRot[o]|=0.031
73 -1
State   0 energy     -45.560358695128
74 -1
State   0 energy     -45.561052337929
75 -1
State   0 energy     -45.561570462281
76 -1
State   0 energy   -2099.183863065403
macro iter 19 (21 JK  4 micro), CASSCF E = -2099.1838630654  dE = -7.378629e-05  S^2 = 0.0000000
               |grad[o]|=0.00393  |ddm|=0.000947  |maxRot[o]|=0.037
77 -1
State   0 energy     -45.698165246605
78 -1
State   0 energy     -45.698583303969
79 -1
State   0 energy     -45.697791213496
80 -1
State   0 energy   -2099.183893813128
macro iter 20 (20 JK  4 micro), CASSCF E = -2099.18389381313  dE = -3.0747725e-05  S^2 = 0.0000000
               |grad[o]|=0.00155  |ddm|=0.000355  |maxRot[o]|=0.0278
81 -1
State   0 energy     -45.819052037178
82 -1
State   0 energy     -45.819254474725
83 -1
State   0 energy     -45.819140973678
84 -1
State   0 energy   -2099.183903431084
macro iter 21 (25 JK  4 micro), CASSCF E = -2099.18390343108  dE = -9.617956e-06  S^2 = 0.0000000
               |grad[o]|=0.00119  |ddm|=0.000522  |maxRot[o]|=0.0179
85 -1
State   0 energy     -45.937921182395
86 -1
State   0 energy     -45.937973523811
87 -1
State   0 energy     -45.937974436469
88 -1
State   0 energy   -2099.183906274485
macro iter 22 (24 JK  4 micro), CASSCF E = -2099.18390627449  dE = -2.843401e-06  S^2 = 0.0000000
               |grad[o]|=0.000533  |ddm|=0.000303  |maxRot[o]|=0.00751
89 -1
State   0 energy     -45.976475726453
90 -1
State   0 energy   -2099.183906342970
macro iter 23 (4 JK  1 micro), CASSCF E = -2099.18390634297  dE = -6.8484951e-08  S^2 = 0.0000000
               |grad[o]|=0.000191  |ddm|=2.96e-05  |maxRot[o]|=0.000466
1-step CASSCF converged in 23 macro (470 JK 89 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.39382968 1.7612245  0.0030705  1.12879032 0.97746434 0.97714878
 1.02286379 1.21488691 1.02243226 1.62404108 0.8711755  0.00307232]
CASSCF energy = -2099.18390634297
CASCI E = -2099.18390634297  E(CI) = -45.9789806287931  S^2 = 0.0000000
energy =  -2099.18390634297
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 0, 6, 7, 15, 14, 11, 5, 10, 5, 2, 3, 6, 7, 0, 5, 2, 3, 0, 0, 6, 7, 5, 10, 11, 2, 3, 14, 15, 6, 7, 5, 0, 2, 3, 6, 7, 0, 5, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 2, 3, 0, 5, 5, 6, 7, 10, 11, 0, 16, 17, 12, 13, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 56]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 63 64 65 66 77 78 79 80]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:08:39 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.400000000000 AA    0.000000000000   0.000000000000   2.645616574391 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.400000000000 AA    0.000000000000   0.000000000000  -2.645616574391 Bohr   0.0

nuclear repulsion = 108.859311960686
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:     15854.40


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp3unx6lq3
max_memory 4000 MB (current use 690 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.52975502855
HOMO (A1u) = -0.189513115011368  LUMO (E2ux) = -0.187179475424286
cycle= 1 E= -2098.05273183911  delta_E= -0.523  |g|= 0.494  |ddm|= 2.88
HOMO (A1u) = -0.0509896384318918  LUMO (A1u) = 0.0251861481133607
cycle= 2 E= -2098.0601359664  delta_E= -0.0074  |g|= 0.523  |ddm|= 2.13
HOMO (E1ux) = -0.115033266253055  LUMO (A1u) = 0.00086454132719374
cycle= 3 E= -2098.29829849828  delta_E= -0.238  |g|= 0.223  |ddm|= 1.55
HOMO (E1ux) = -0.0756289679424627  LUMO (A1u) = -0.00200992726287146
cycle= 4 E= -2098.3105461666  delta_E= -0.0122  |g|= 0.178  |ddm|= 0.117
HOMO (E1ux) = -0.014939575383512  LUMO (A1u) = -0.0098272281261311
cycle= 5 E= -2098.34144091941  delta_E= -0.0309  |g|= 0.0809  |ddm|=  0.4
HOMO (E1ux) = -0.0119253464629483  LUMO (A1u) = -0.0168884719206355
cycle= 6 E= -2098.35615023347  delta_E= -0.0147  |g|= 0.0566  |ddm|= 0.446
HOMO (E1ux) = -0.0153632006705873  LUMO (A1u) = -0.0240700739999273
cycle= 7 E= -2098.36052748051  delta_E= -0.00438  |g|= 0.0626  |ddm|= 0.255
HOMO (E1ux) = -0.0244149967218597  LUMO (A1u) = -0.0302116578902998
cycle= 8 E= -2098.36232603375  delta_E= -0.0018  |g|= 0.0478  |ddm|= 0.298
HOMO (E1ux) = -0.0336868835296005  LUMO (E2ux) = -0.0389041376262913
cycle= 9 E= -2098.36302529107  delta_E= -0.000699  |g|= 0.015  |ddm|= 0.204
HOMO (E1ux) = -0.0386994970783648  LUMO (E2ux) = -0.0403118435231715
cycle= 10 E= -2098.36320990735  delta_E= -0.000185  |g|= 0.0131  |ddm|= 0.0852
HOMO (E1ux) = -0.0343149693187935  LUMO (E2ux) = -0.0323736610313444
cycle= 11 E= -2098.36337481474  delta_E= -0.000165  |g|= 0.00344  |ddm|= 0.0755
HOMO (E1ux) = -0.0348427178543331  LUMO (E2ux) = -0.0318573613270161
cycle= 12 E= -2098.36337952458  delta_E= -4.71e-06  |g|= 0.00455  |ddm|= 0.0237
HOMO (E1ux) = -0.0335093010434523  LUMO (E2ux) = -0.0301833508227456
cycle= 13 E= -2098.36338713734  delta_E= -7.61e-06  |g|= 0.000717  |ddm|= 0.0347
HOMO (E1ux) = -0.033949600657307  LUMO (E2ux) = -0.0310267458946039
cycle= 14 E= -2098.36338838138  delta_E= -1.24e-06  |g|= 0.000321  |ddm|= 0.0114
HOMO (E1ux) = -0.0338203289729553  LUMO (E2ux) = -0.0309764331717876
cycle= 15 E= -2098.36338845478  delta_E= -7.34e-08  |g|= 0.000165  |ddm|= 0.00223
HOMO (E1ux) = -0.0338821754254975  LUMO (E2ux) = -0.031070233982386
cycle= 16 E= -2098.36338847771  delta_E= -2.29e-08  |g|= 1.32e-05  |ddm|= 0.00155
HOMO (E1ux) = -0.0338769824026735  LUMO (E2ux) = -0.031064388443741
cycle= 17 E= -2098.36338847777  delta_E= -6.55e-11  |g|= 7.02e-06  |ddm|= 0.000101
HOMO (E1ux) = -0.0338796223467575  LUMO (E2ux) = -0.0310682646287484
Extra cycle  E= -2098.36338847779  delta_E= -2.14e-11  |g|= 6.16e-06  |ddm|= 5.28e-05
converged SCF energy = -2098.36338847779
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 27 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp3unx6lq3
max_memory 4000 MB (current use 703 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E2gx E2gy E1uy E1ux E2uy E2ux A1u E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.844342923879
CASCI E = -2098.84434292388  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -26.351388366596
2 -1
State   0 energy     -26.396825665331
3 -1
State   0 energy     -26.425475143562
4 -1
State   0 energy   -2099.005853830542
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.00585383054  dE = -0.16151091  S^2 = 0.0000000
               |grad[o]|=0.208  |ddm|= 2.23  |maxRot[o]|=0.259
5 -1
State   0 energy     -26.475870062450
6 -1
State   0 energy     -26.483358898548
7 -1
State   0 energy     -26.489755641344
8 -1
State   0 energy   -2099.033613191563
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.03361319156  dE = -0.027759361  S^2 = 0.0000000
               |grad[o]|=0.113  |ddm|=0.0869  |maxRot[o]|=0.313
9 -1
State   0 energy     -26.493612018413
10 -1
State   0 energy     -26.497884604487
11 -1
State   0 energy     -26.517263765291
12 -1
State   0 energy   -2099.041884578214
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.04188457821  dE = -0.0082713867  S^2 = 0.0000000
               |grad[o]|=0.0435  |ddm|=0.0161  |maxRot[o]|=0.209
13 -1
State   0 energy     -26.489884092560
14 -1
State   0 energy     -26.478193720878
15 -1
State   0 energy     -26.482984956229
16 -1
State   0 energy   -2099.042203369893
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.04220336989  dE = -0.00031879168  S^2 = 0.0000000
               |grad[o]|=0.00703  |ddm|=0.00395  |maxRot[o]|=0.065
17 -1
State   0 energy     -26.499105807049
18 -1
State   0 energy     -26.495637992714
19 -1
State   0 energy   -2099.042266947500
macro iter 5 (7 JK  2 micro), CASSCF E = -2099.0422669475  dE = -6.3577606e-05  S^2 = 0.0000000
               |grad[o]|=0.00307  |ddm|=0.000683  |maxRot[o]|=0.0682
20 -1
State   0 energy     -26.555762181815
21 -1
State   0 energy     -26.552990508111
22 -1
State   0 energy   -2099.042301002444
macro iter 6 (7 JK  2 micro), CASSCF E = -2099.04230100244  dE = -3.4054945e-05  S^2 = 0.0000000
               |grad[o]|=0.00181  |ddm|=0.000558  |maxRot[o]|=0.0699
23 -1
State   0 energy     -26.711969901394
24 -1
State   0 energy     -26.710020358132
25 -1
State   0 energy   -2099.042313254823
macro iter 7 (6 JK  2 micro), CASSCF E = -2099.04231325482  dE = -1.2252378e-05  S^2 = 0.0000000
               |grad[o]|=0.000881  |ddm|=0.000427  |maxRot[o]|= 0.05
26 -1
State   0 energy     -26.875596931059
27 -1
State   0 energy     -26.874372490564
28 -1
State   0 energy   -2099.042316637521
macro iter 8 (5 JK  2 micro), CASSCF E = -2099.04231663752  dE = -3.3826987e-06  S^2 = 0.0000000
               |grad[o]|=0.000329  |ddm|=0.00024  |maxRot[o]|= 0.03
29 -1
State   0 energy     -26.996438315022
30 -1
State   0 energy   -2099.042317551857
macro iter 9 (3 JK  1 micro), CASSCF E = -2099.04231755186  dE = -9.1433594e-07  S^2 = 0.0000000
               |grad[o]|=0.000121  |ddm|=0.000135  |maxRot[o]|= 0.02
31 -1
State   0 energy     -27.085765685330
32 -1
State   0 energy   -2099.042317691763
macro iter 10 (3 JK  1 micro), CASSCF E = -2099.04231769176  dE = -1.3990621e-07  S^2 = 0.0000000
               |grad[o]|=3.44e-05  |ddm|=4.23e-05  |maxRot[o]|=0.00925
33 -1
State   0 energy     -27.127568589303
34 -1
State   0 energy   -2099.042317691765
macro iter 11 (1 JK  1 micro), CASSCF E = -2099.04231769177  dE = -1.8189894e-12  S^2 = 0.0000000
               |grad[o]|=2.12e-05  |ddm|=2.81e-06  |maxRot[o]|=    0
1-step CASSCF converged in 11 macro (116 JK 27 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.99850459 1.99687339 1.88954244 1.01256848 1.01256838 0.07762776
 0.07762736 0.98240127 0.98240116 1.86955906 0.05016304 0.05016306]
CASSCF energy = -2099.04231769177
CASCI E = -2099.04231769177  E(CI) = -27.1275685887208  S^2 = 0.0000000
energy =  -2099.042317691765
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 0, 2, 3, 5, 0, 5, 0, 10, 11, 6, 7, 14, 15, 5, 2, 3, 0, 6, 7, 5, 2, 3, 0, 0, 6, 7, 5, 10, 11, 2, 3, 5, 14, 15, 6, 7, 0, 2, 3, 5, 0, 6, 7, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 0, 5, 5, 6, 7, 0, 16, 17, 10, 11, 12, 13, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 61 62 65 66 75 76 79 80]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:18:13 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.600000000000 AA    0.000000000000   0.000000000000   3.023561799304 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.600000000000 AA    0.000000000000   0.000000000000  -3.023561799304 Bohr   0.0

nuclear repulsion = 95.2518979656
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 15
num. orbitals of irrep E1gx = 9
num. orbitals of irrep E1gy = 9
num. orbitals of irrep A1u = 15
num. orbitals of irrep E1uy = 9
num. orbitals of irrep E1ux = 9
num. orbitals of irrep E2gx = 4
num. orbitals of irrep E2gy = 4
num. orbitals of irrep E3gx = 1
num. orbitals of irrep E3gy = 1
num. orbitals of irrep E2uy = 4
num. orbitals of irrep E2ux = 4
num. orbitals of irrep E3uy = 1
num. orbitals of irrep E3ux = 1
number of shells = 14
number of NR pGTOs = 244
number of NR cGTOs = 86
basis = ccpvdz-dk
ecp = {}
CPU time:     17014.23


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmplupns47w
max_memory 4000 MB (current use 690 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.41317026769
HOMO (E2gy) = -0.189522999598513  LUMO (E2ux) = -0.185404460355607
cycle= 1 E= -2098.08689110837  delta_E= -0.674  |g|= 0.269  |ddm|= 2.57
HOMO (E2gy) = -0.00864832484823677  LUMO (A1u) = -0.01756123275234
cycle= 2 E= -2098.13951508391  delta_E= -0.0526  |g|= 0.167  |ddm|= 0.815
HOMO (E2gy) = -0.0400662254335556  LUMO (A1u) = -0.0285278550151039
cycle= 3 E= -2098.16754648253  delta_E= -0.028  |g|= 0.165  |ddm|= 0.363
HOMO (E2gy) = -0.00845249443648607  LUMO (A1u) = -0.016438460331028
cycle= 4 E= -2098.19749395616  delta_E= -0.0299  |g|= 0.0995  |ddm|= 0.401
HOMO (E2gy) = -0.00289582772050277  LUMO (A1u) = -0.0152237141005365
cycle= 5 E= -2098.22765902243  delta_E= -0.0302  |g|= 0.0759  |ddm|= 0.389
HOMO (E2gy) = -0.0236705516269867  LUMO (A1u) = -0.0289100673998013
cycle= 6 E= -2098.24703989871  delta_E= -0.0194  |g|= 0.0389  |ddm|= 0.317
HOMO (E2gy) = -0.0302882956683261  LUMO (A1u) = -0.0334798755651275
cycle= 7 E= -2098.25230199872  delta_E= -0.00526  |g|= 0.0202  |ddm|= 0.204
HOMO (E2gy) = -0.0375170719563809  LUMO (A1u) = -0.0342912097504533
cycle= 8 E= -2098.25359219464  delta_E= -0.00129  |g|= 0.016  |ddm|= 0.163
HOMO (E2gy) = -0.0438915554204167  LUMO (A1u) = -0.0383853561114082
cycle= 9 E= -2098.25386413855  delta_E= -0.000272  |g|= 0.00448  |ddm|= 0.0755
HOMO (E2gy) = -0.0463276030016381  LUMO (A1u) = -0.0387235456137067
cycle= 10 E= -2098.25392264336  delta_E= -5.85e-05  |g|= 0.00597  |ddm|= 0.0544
HOMO (E2gy) = -0.0468324889375467  LUMO (A1u) = -0.0393947691163647
cycle= 11 E= -2098.25394127515  delta_E= -1.86e-05  |g|= 0.000577  |ddm|= 0.0153
HOMO (E2gy) = -0.0467428085342862  LUMO (A1u) = -0.0394509941291308
cycle= 12 E= -2098.25394149617  delta_E= -2.21e-07  |g|= 0.000369  |ddm|= 0.00164
HOMO (E2gy) = -0.0467670468067006  LUMO (A1u) = -0.0394167010078724
cycle= 13 E= -2098.25394156706  delta_E= -7.09e-08  |g|= 0.00012  |ddm|= 0.00079
HOMO (E2gy) = -0.0467808476952199  LUMO (A1u) = -0.0394364943506513
cycle= 14 E= -2098.25394157322  delta_E= -6.16e-09  |g|= 1.5e-05  |ddm|= 0.000233
HOMO (E2gy) = -0.0467825856561033  LUMO (A1u) = -0.0394377498903817
cycle= 15 E= -2098.25394157335  delta_E= -1.29e-10  |g|= 2.09e-06  |ddm|= 8.22e-05
HOMO (E2gy) = -0.0467828166480454  LUMO (A1u) = -0.0394377843848045
Extra cycle  E= -2098.25394157336  delta_E= -3.18e-12  |g|= 2.21e-06  |ddm|= 1.78e-05
converged SCF energy = -2098.25394157336
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 27 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 56
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmplupns47w
max_memory 4000 MB (current use 709 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E1uy E1ux E2gx E2gy A1u E2uy E2ux E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.873418721075
CASCI E = -2098.87341872108  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -25.566093174981
2 -1
State   0 energy     -25.673651526120
3 -1
State   0 energy     -25.757551922296
4 -1
State   0 energy   -2099.233538933485
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.23353893349  dE = -0.36012021  S^2 = 0.0000000
               |grad[o]|=0.317  |ddm|=  1.6  |maxRot[o]|=0.314
5 -1
State   0 energy     -25.940569687373
6 -1
State   0 energy     -25.963917218653
7 -1
State   0 energy     -25.969354743195
8 -1
State   0 energy   -2099.317356398712
macro iter 2 (17 JK  4 micro), CASSCF E = -2099.31735639871  dE = -0.083817465  S^2 = 0.0000000
               |grad[o]|=0.236  |ddm|=0.134  |maxRot[o]|=0.208
9 -1
State   0 energy     -26.102893659113
10 -1
State   0 energy     -26.102896048993
11 -1
State   0 energy     -26.102896237564
12 -1
State   0 energy   -2099.317658895984
macro iter 3 (12 JK  4 micro), CASSCF E = -2099.31765889598  dE = -0.00030249727  S^2 = 0.0000000
               |grad[o]|=0.0131  |ddm|=0.006  |maxRot[o]|=0.012
13 -1
State   0 energy     -26.096640766193
14 -1
State   0 energy   -2099.317658909877
macro iter 4 (3 JK  1 micro), CASSCF E = -2099.31765890988  dE = -1.3892986e-08  S^2 = 0.0000000
               |grad[o]|=7.23e-05  |ddm|=8.77e-05  |maxRot[o]|=0.000112
1-step CASSCF converged in 4 macro (53 JK 13 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.0759635  0.93378148 1.57312862 1.05083322 1.05083319 1.01089027
 1.01089002 0.41712162 0.98911007 0.98910983 0.9491691  0.94916907]
CASSCF energy = -2099.31765890988
CASCI E = -2099.31765890988  E(CI) = -26.0965995495694  S^2 = 0.0000000
energy =  -2099.317658909877
orbsym =  [5, 0, 5, 0, 6, 7, 2, 3, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 5, 0, 6, 7, 10, 11, 5, 14, 15, 2, 3, 0, 6, 7, 2, 3, 5, 0, 0, 6, 7, 5, 2, 3, 10, 11, 5, 14, 15, 6, 7, 0, 2, 3, 5, 6, 7, 0, 2, 3, 5, 0, 10, 11, 14, 15, 6, 7, 2, 3, 0, 5, 5, 6, 7, 16, 17, 0, 12, 13, 10, 11, 14, 15, 2, 3, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 61 62 63 64 74 75 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:23:53 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.650000000000 AA    0.000000000000   0.000000000000   1.228321980967 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.650000000000 AA    0.000000000000   0.000000000000  -1.228321980967 Bohr   0.0

nuclear repulsion = 234.466210376862
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     17577.67


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpejfzn_rv
max_memory 4000 MB (current use 704 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.64913534438
HOMO (E2ux) = -0.267132009956381  LUMO (E2ux) = -0.267132009956381
cycle= 1 E= -2098.06678513681  delta_E= 1.58  |g|= 1.65  |ddm|= 4.26
HOMO (A1g) = 0.0547442911255287  LUMO (E1ux) = 0.0641763225075025
cycle= 2 E= -2097.14397910986  delta_E= 0.923  |g|= 2.84  |ddm|=  833
HOMO (E2ux) = 0.16092664602143  LUMO (A1g) = -0.100705569524324
cycle= 3 E= -2098.28068735846  delta_E= -1.14  |g|= 0.399  |ddm|=  833
HOMO (E2ux) = 0.0883143483172233  LUMO (A1g) = 0.00595751698242734
cycle= 4 E= -2098.3228343375  delta_E= -0.0421  |g|= 0.323  |ddm|= 1.24
HOMO (E2ux) = 0.148744194356332  LUMO (A1g) = 0.0214411370963857
cycle= 5 E= -2098.3429702932  delta_E= -0.0201  |g|= 0.0636  |ddm|= 0.25
HOMO (E2ux) = 0.156528068432454  LUMO (A1g) = 0.0313927209326682
cycle= 6 E= -2098.34413409971  delta_E= -0.00116  |g|= 0.0102  |ddm|= 0.0902
HOMO (E2ux) = 0.151023463391009  LUMO (A1g) = 0.0315534663758238
cycle= 7 E= -2098.34421656378  delta_E= -8.25e-05  |g|= 0.0051  |ddm|= 0.0843
HOMO (E2ux) = 0.150961534976902  LUMO (A1g) = 0.0316505647877136
cycle= 8 E= -2098.34423281963  delta_E= -1.63e-05  |g|= 0.00193  |ddm|= 0.0352
HOMO (E2ux) = 0.150453992102733  LUMO (A1g) = 0.0315567387251551
cycle= 9 E= -2098.34423542702  delta_E= -2.61e-06  |g|= 0.000827  |ddm|= 0.00907
HOMO (E2ux) = 0.150780504085424  LUMO (A1g) = 0.0315561543252532
cycle= 10 E= -2098.34423589379  delta_E= -4.67e-07  |g|= 0.000338  |ddm|= 0.00207
HOMO (E2ux) = 0.150845252949194  LUMO (A1g) = 0.0315588527225437
cycle= 11 E= -2098.34423612432  delta_E= -2.31e-07  |g|= 0.000122  |ddm|= 0.00197
HOMO (E2ux) = 0.150859515949255  LUMO (A1g) = 0.0315549203050236
cycle= 12 E= -2098.34423615627  delta_E= -3.2e-08  |g|= 4.74e-05  |ddm|= 0.000671
HOMO (E2ux) = 0.150868092672456  LUMO (A1g) = 0.0315533409486626
cycle= 13 E= -2098.34423616172  delta_E= -5.45e-09  |g|= 1.33e-05  |ddm|= 0.000334
HOMO (E2ux) = 0.150871329967054  LUMO (A1g) = 0.0315528713374887
cycle= 14 E= -2098.34423616206  delta_E= -3.43e-10  |g|= 3.91e-06  |ddm|= 0.000104
HOMO (E2ux) = 0.150870345538093  LUMO (A1g) = 0.0315526883569782
Extra cycle  E= -2098.34423616207  delta_E= -9.55e-12  |g|= 5.35e-06  |ddm|= 2.09e-05
converged SCF energy = -2098.34423616207
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpejfzn_rv
max_memory 4000 MB (current use 1004 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy E2uy E2ux A1g A1u E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.460903668962
CASCI E = -2098.46090366896  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -34.350333363728
2 -1
State   0 energy     -34.379175878035
3 -1
State   0 energy     -34.428643799238
4 -1
State   0 energy   -2098.582369243346
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.58236924335  dE = -0.12146557  S^2 = 0.0000000
               |grad[o]|=0.582  |ddm|=0.0515  |maxRot[o]|=0.277
5 -1
State   0 energy     -34.687995310486
6 -1
State   0 energy     -34.758089262633
7 -1
State   0 energy     -34.822792394322
8 -1
State   0 energy   -2098.821535036586
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.82153503659  dE = -0.23916579  S^2 = 0.0000000
               |grad[o]|=0.725  |ddm|=0.781  |maxRot[o]|=0.268
9 -1
State   0 energy     -34.782708367586
10 -1
State   0 energy     -34.819304936936
11 -1
State   0 energy     -34.858227292380
12 -1
State   0 energy   -2098.959965677947
macro iter 3 (21 JK  4 micro), CASSCF E = -2098.95996567795  dE = -0.13843064  S^2 = 0.0000000
               |grad[o]|=0.204  |ddm|=0.0667  |maxRot[o]|=0.308
13 -1
State   0 energy     -34.849675965193
14 -1
State   0 energy     -34.870292110855
15 -1
State   0 energy     -34.887315465528
16 -1
State   0 energy   -2099.032942232753
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.03294223275  dE = -0.072976555  S^2 = 0.0000000
               |grad[o]|=0.123  |ddm|=0.0321  |maxRot[o]|=0.308
17 -1
State   0 energy     -34.976347998089
18 -1
State   0 energy     -34.981468999964
19 -1
State   0 energy     -34.982058942674
20 -1
State   0 energy   -2099.048352035363
macro iter 5 (15 JK  4 micro), CASSCF E = -2099.04835203536  dE = -0.015409803  S^2 = 0.0000000
               |grad[o]|=0.0575  |ddm|=0.0252  |maxRot[o]|= 0.18
21 -1
State   0 energy     -34.959700816891
22 -1
State   0 energy     -34.959701751542
23 -1
State   0 energy   -2099.048357111840
macro iter 6 (8 JK  2 micro), CASSCF E = -2099.04835711184  dE = -5.076477e-06  S^2 = 0.0000000
               |grad[o]|=0.00169  |ddm|=0.0017  |maxRot[o]|=0.00346
24 -1
State   0 energy     -34.962814801109
25 -1
State   0 energy   -2099.048357117459
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.04835711746  dE = -5.6188583e-09  S^2 = 0.0000000
               |grad[o]|=5.82e-05  |ddm|=8.04e-05  |maxRot[o]|=8.22e-05
1-step CASSCF converged in 7 macro (110 JK 23 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.92403679 1.92403648 1.94630499 1.88501279 1.88501275 0.11714779
 0.11714775 1.81759748 0.14574797 0.07468196 0.07468165 0.08859161]
CASSCF energy = -2099.04835711746
CASCI E = -2099.04835711746  E(CI) = -34.9628567909381  S^2 = 0.0000000
energy =  -2099.0483571174586
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 0, 5, 2, 3, 5, 6, 7, 0, 0, 5, 6, 7, 2, 3, 10, 11, 6, 7, 0, 14, 15, 5, 2, 3, 0, 2, 3, 5, 5, 6, 7, 0, 2, 3, 10, 11, 6, 7, 0, 14, 15, 2, 3, 5, 16, 17, 0, 10, 11, 12, 13, 5, 6, 7, 0, 14, 15, 5, 2, 3, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 6, 7, 10, 11, 16, 17, 0, 5, 20, 21, 24, 25, 16, 17, 2, 3, 12, 13, 14, 15, 10, 11, 12, 13, 0, 5, 6, 7, 14, 15, 5, 0, 2, 3, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 64 65 68 69 70 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:30:57 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.700000000000 AA    0.000000000000   0.000000000000   1.322808287196 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.700000000000 AA    0.000000000000   0.000000000000  -1.322808287196 Bohr   0.0

nuclear repulsion = 217.718623921371
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     19091.40


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpjijzx7lz
max_memory 4000 MB (current use 1086 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2099.24346750565
HOMO (E2ux) = -0.253218891749564  LUMO (E2ux) = -0.253218891749564
cycle= 1 E= -2098.25052566214  delta_E= 0.993  |g|= 1.44  |ddm|= 3.36
HOMO (A1g) = 0.0584853924200518  LUMO (E1ux) = 0.0632216125790287
cycle= 2 E= -2097.02696873337  delta_E= 1.22  |g|= 2.88  |ddm|=  476
HOMO (E2ux) = -0.0251820710169852  LUMO (A1g) = -0.108587733613509
cycle= 3 E= -2098.42128076457  delta_E= -1.39  |g|= 0.579  |ddm|=  475
HOMO (E2ux) = 0.0823652263641437  LUMO (A1g) = -0.000775710868826032
cycle= 4 E= -2098.47245568759  delta_E= -0.0512  |g|= 0.187  |ddm|= 0.418
HOMO (E2ux) = 0.100628574992169  LUMO (A1g) = 0.0263412964484435
cycle= 5 E= -2098.47954997759  delta_E= -0.00709  |g|= 0.0437  |ddm|= 0.197
HOMO (E2ux) = 0.101395583828737  LUMO (A1g) = 0.0290435894384633
cycle= 6 E= -2098.48001250903  delta_E= -0.000463  |g|= 0.0125  |ddm|= 0.0521
HOMO (E2ux) = 0.101640379841085  LUMO (A1g) = 0.0300597248799467
cycle= 7 E= -2098.48006439843  delta_E= -5.19e-05  |g|= 0.00158  |ddm|= 0.0237
HOMO (E2ux) = 0.101287931718185  LUMO (A1g) = 0.0300205746642674
cycle= 8 E= -2098.48006751786  delta_E= -3.12e-06  |g|= 0.000732  |ddm|= 0.0118
HOMO (E2ux) = 0.101241629551975  LUMO (A1g) = 0.0300170488836231
cycle= 9 E= -2098.4800685042  delta_E= -9.86e-07  |g|= 0.000756  |ddm|= 0.00321
HOMO (E2ux) = 0.101100147178935  LUMO (A1g) = 0.0300354044003581
cycle= 10 E= -2098.48006901247  delta_E= -5.08e-07  |g|= 0.000384  |ddm|= 0.00187
HOMO (E2ux) = 0.100964823691714  LUMO (A1g) = 0.0300266831837819
cycle= 11 E= -2098.48006936024  delta_E= -3.48e-07  |g|= 0.00014  |ddm|= 0.00197
HOMO (E2ux) = 0.100901263787665  LUMO (A1g) = 0.0300304542815805
cycle= 12 E= -2098.48006941121  delta_E= -5.1e-08  |g|= 3.66e-05  |ddm|= 0.000996
HOMO (E2ux) = 0.100885493324954  LUMO (A1g) = 0.0300303254700162
cycle= 13 E= -2098.48006941331  delta_E= -2.1e-09  |g|= 8.92e-06  |ddm|= 0.000183
HOMO (E2ux) = 0.100884881851747  LUMO (A1g) = 0.0300294015195812
cycle= 14 E= -2098.48006941347  delta_E= -1.53e-10  |g|= 3.15e-06  |ddm|= 7.52e-05
HOMO (E2ux) = 0.100886390704468  LUMO (A1g) = 0.0300296298212204
Extra cycle  E= -2098.48006941347  delta_E= -3.18e-12  |g|= 4.49e-06  |ddm|= 1.18e-05
converged SCF energy = -2098.48006941347
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 29 30 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpjijzx7lz
max_memory 4000 MB (current use 1086 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy E2uy E2ux A1g A1u E1gx E1gy A1u
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.584462358601
CASCI E = -2098.5844623586  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -33.207302963943
2 -1
State   0 energy     -33.232835876022
3 -1
State   0 energy     -33.265684559200
4 -1
State   0 energy   -2098.710840474164
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.71084047416  dE = -0.12637812  S^2 = 0.0000000
               |grad[o]|=0.556  |ddm|=0.042  |maxRot[o]|=0.286
5 -1
State   0 energy     -33.341582673079
6 -1
State   0 energy     -33.372180933289
7 -1
State   0 energy     -33.407492589310
8 -1
State   0 energy   -2098.844669321656
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.84466932166  dE = -0.13382885  S^2 = 0.0000000
               |grad[o]|=0.164  |ddm|=0.0739  |maxRot[o]|=0.309
9 -1
State   0 energy     -33.489377072914
10 -1
State   0 energy     -33.566063753429
11 -1
State   0 energy     -33.631451894356
12 -1
State   0 energy   -2099.105967309835
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.10596730983  dE = -0.26129799  S^2 = 0.0000000
               |grad[o]|=0.661  |ddm|=0.722  |maxRot[o]|=0.278
13 -1
State   0 energy     -33.704118084144
14 -1
State   0 energy     -33.723943119903
15 -1
State   0 energy     -33.738383030526
16 -1
State   0 energy   -2099.175884122686
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.17588412269  dE = -0.069916813  S^2 = 0.0000000
               |grad[o]|=0.165  |ddm|=0.0361  |maxRot[o]|=0.308
17 -1
State   0 energy     -33.771189085457
18 -1
State   0 energy     -33.771475063269
19 -1
State   0 energy     -33.771528322100
20 -1
State   0 energy   -2099.180956737202
macro iter 5 (13 JK  4 micro), CASSCF E = -2099.1809567372  dE = -0.0050726145  S^2 = 0.0000000
               |grad[o]|=0.0471  |ddm|=0.0302  |maxRot[o]|=0.0802
21 -1
State   0 energy     -33.738188472194
22 -1
State   0 energy     -33.738188440994
23 -1
State   0 energy     -33.738188452236
24 -1
State   0 energy   -2099.180957615405
macro iter 6 (8 JK  3 micro), CASSCF E = -2099.18095761541  dE = -8.7820308e-07  S^2 = 0.0000000
               |grad[o]|=0.000684  |ddm|=0.000415  |maxRot[o]|=0.00161
25 -1
State   0 energy     -33.740803549511
26 -1
State   0 energy   -2099.180957615407
macro iter 7 (1 JK  1 micro), CASSCF E = -2099.18095761541  dE = -1.8189894e-12  S^2 = 0.0000000
               |grad[o]|=2.77e-05  |ddm|=3.65e-05  |maxRot[o]|=    0
1-step CASSCF converged in 7 macro (106 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.90616043 1.90616089 1.92849783 1.84818116 1.84818131 0.1541444
 0.15414456 1.83355476 0.14562895 0.09273764 0.09273811 0.08986997]
CASSCF energy = -2099.18095761541
CASCI E = -2099.18095761541  E(CI) = -33.7408035490375  S^2 = 0.0000000
energy =  -2099.180957615407
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 14, 15, 0, 5, 2, 3, 5, 6, 7, 0, 0, 5, 6, 7, 2, 3, 10, 11, 6, 7, 0, 5, 14, 15, 2, 3, 2, 3, 0, 5, 5, 6, 7, 0, 2, 3, 10, 11, 6, 7, 14, 15, 0, 5, 2, 3, 0, 16, 17, 10, 11, 12, 13, 6, 7, 5, 14, 15, 5, 0, 2, 3, 6, 7, 0, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 6, 7, 10, 11, 0, 5, 16, 17, 20, 21, 24, 25, 12, 13, 16, 17, 10, 11, 14, 15, 2, 3, 12, 13, 5, 0, 6, 7, 14, 15, 5, 2, 3, 0, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 63 64 66 70 71 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:38:40 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.750000000000 AA    0.000000000000   0.000000000000   1.417294593424 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.750000000000 AA    0.000000000000   0.000000000000  -1.417294593424 Bohr   0.0

nuclear repulsion = 203.20404899328
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     20722.54


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpo6h1v797
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.93969831173
HOMO (E2ux) = -0.241159869304745  LUMO (E2ux) = -0.241159869304745
cycle= 1 E= -2098.47451244838  delta_E= 0.465  |g|= 1.13  |ddm|= 3.11
HOMO (E2gy) = 0.105214134819701  LUMO (E1ux) = 0.0536905125544663
cycle= 2 E= -2097.49986090639  delta_E= 0.975  |g|= 2.14  |ddm|=  254
HOMO (E2ux) = 0.0546890088501575  LUMO (A1u) = -0.0592417599223921
cycle= 3 E= -2098.60338249681  delta_E= -1.1  |g|= 0.44  |ddm|=  254
HOMO (E2ux) = 0.152292627249906  LUMO (A1u) = -0.0270913066059715
cycle= 4 E= -2098.49110168839  delta_E= 0.112  |g|= 0.571  |ddm|= 1.17
HOMO (E2ux) = 0.151920686276144  LUMO (A1u) = -0.0254988595521975
cycle= 5 E= -2098.50117600924  delta_E= -0.0101  |g|= 0.531  |ddm|= 0.0249
HOMO (E2ux) = 0.182558668087301  LUMO (A1u) = 0.00476892699742452
cycle= 6 E= -2098.54703730648  delta_E= -0.0459  |g|= 0.241  |ddm|= 0.405
HOMO (E2ux) = 0.180963155531446  LUMO (A1u) = 0.00514307949459712
cycle= 7 E= -2098.54874167709  delta_E= -0.0017  |g|= 0.239  |ddm|= 0.0238
HOMO (E2ux) = 0.185493879473346  LUMO (A1u) = 0.00587785332241812
cycle= 8 E= -2098.55249195131  delta_E= -0.00375  |g|= 0.182  |ddm|= 0.162
HOMO (E2ux) = 0.189755912386044  LUMO (A1u) = 0.00717089607899608
cycle= 9 E= -2098.54940738874  delta_E= 0.00308  |g|= 0.173  |ddm|= 0.0926
HOMO (E2ux) = 0.204184627003325  LUMO (A1u) = 0.0123564449996978
cycle= 10 E= -2098.53345581837  delta_E= 0.016  |g|= 0.164  |ddm|= 0.325
HOMO (E2ux) = 0.208567783649538  LUMO (A1u) = 0.0210393496394584
cycle= 11 E= -2098.52843134891  delta_E= 0.00502  |g|= 0.194  |ddm|= 0.0962
HOMO (E2ux) = 0.204737122137807  LUMO (A1u) = 0.0218982054790824
cycle= 12 E= -2098.53285749041  delta_E= -0.00443  |g|= 0.22  |ddm|= 0.139
HOMO (E2ux) = 0.205588166408144  LUMO (A1u) = 0.0213866866486781
cycle= 13 E= -2098.51987107123  delta_E= 0.013  |g|= 0.273  |ddm|= 0.228
HOMO (E2ux) = 0.204043330250875  LUMO (A1u) = 0.0221043822379649
cycle= 14 E= -2098.52573399313  delta_E= -0.00586  |g|= 0.241  |ddm|= 0.124
HOMO (E2ux) = 0.206935013013451  LUMO (A1u) = 0.0233682436562062
cycle= 15 E= -2098.53305855834  delta_E= -0.00732  |g|= 0.214  |ddm|= 0.204
HOMO (E2ux) = 0.20488497416559  LUMO (A1u) = 0.0231242683098411
cycle= 16 E= -2098.53995715749  delta_E= -0.0069  |g|= 0.19  |ddm|= 0.136
HOMO (E2ux) = 0.200791664717848  LUMO (A1u) = 0.0217553309493513
cycle= 17 E= -2098.54588039865  delta_E= -0.00592  |g|= 0.167  |ddm|= 0.0986
HOMO (E2ux) = 0.199837292910235  LUMO (A1u) = 0.0217204646670233
cycle= 18 E= -2098.54692858262  delta_E= -0.00105  |g|= 0.164  |ddm|= 0.0207
HOMO (E2ux) = 0.191545885324692  LUMO (A1u) = 0.0194472206024046
cycle= 19 E= -2098.55079149337  delta_E= -0.00386  |g|= 0.15  |ddm|= 0.194
HOMO (E2ux) = 0.199553145040669  LUMO (A1u) = 0.0236780909640285
cycle= 20 E= -2098.532960552  delta_E= 0.0178  |g|= 0.205  |ddm|= 0.467
HOMO (E2ux) = 0.192228092952445  LUMO (A1u) = 0.0213359361228228
cycle= 21 E= -2098.54461101346  delta_E= -0.0117  |g|= 0.168  |ddm|= 0.265
HOMO (E2ux) = 0.190673457077424  LUMO (A1u) = 0.0207097819762861
cycle= 22 E= -2098.546282207  delta_E= -0.00167  |g|= 0.165  |ddm|= 0.0335
HOMO (E2ux) = 0.187915064884724  LUMO (A1u) = 0.0194396958600214
cycle= 23 E= -2098.54921683861  delta_E= -0.00293  |g|= 0.155  |ddm|= 0.0999
HOMO (E2ux) = 0.185204100875558  LUMO (A1u) = 0.0182064303081418
cycle= 24 E= -2098.55127648901  delta_E= -0.00206  |g|= 0.151  |ddm|= 0.0433
HOMO (E2ux) = 0.189708474897067  LUMO (A1u) = 0.0205696910964897
cycle= 25 E= -2098.55106411763  delta_E= 0.000212  |g|= 0.147  |ddm|= 0.121
HOMO (E2ux) = 0.192115992796073  LUMO (A1u) = 0.0214211702941894
cycle= 26 E= -2098.55155453695  delta_E= -0.00049  |g|= 0.145  |ddm|= 0.0828
HOMO (E2ux) = 0.18914365485739  LUMO (A1u) = 0.0201449289034093
cycle= 27 E= -2098.55560927474  delta_E= -0.00405  |g|= 0.141  |ddm|= 0.0879
HOMO (E2ux) = 0.189335965441764  LUMO (A1u) = 0.0202365200969511
cycle= 28 E= -2098.55161595693  delta_E= 0.00399  |g|= 0.144  |ddm|= 0.126
HOMO (E2ux) = 0.188516989854349  LUMO (A1u) = 0.0197648340469544
cycle= 29 E= -2098.54898355497  delta_E= 0.00263  |g|= 0.149  |ddm|= 0.0681
HOMO (E2ux) = 0.190310561293529  LUMO (A1u) = 0.0212402684492882
cycle= 30 E= -2098.54891765943  delta_E= 6.59e-05  |g|= 0.151  |ddm|= 0.0532
HOMO (E2ux) = 0.188430591923763  LUMO (A1u) = 0.020656159111438
cycle= 31 E= -2098.55532909674  delta_E= -0.00641  |g|= 0.14  |ddm|= 0.151
HOMO (E2ux) = 0.185664216837948  LUMO (A1u) = 0.0197951836588662
cycle= 32 E= -2098.55899380376  delta_E= -0.00366  |g|= 0.138  |ddm|= 0.089
SCF not converged.
SCF energy = -2098.55899380376
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 28 29 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpo6h1v797
max_memory 4000 MB (current use 1018 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.752666796447
CASCI E = -2098.75266679645  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -32.230441872460
2 -1
State   0 energy     -32.268441827374
3 -1
State   0 energy     -32.301683081927
4 -1
State   0 energy   -2098.893969746087
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.89396974609  dE = -0.14130295  S^2 = 0.0000000
               |grad[o]|=0.367  |ddm|=0.319  |maxRot[o]|=0.308
5 -1
State   0 energy     -32.322890304838
6 -1
State   0 energy     -32.350161582000
7 -1
State   0 energy     -32.382448264039
8 -1
State   0 energy   -2099.010272857299
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.0102728573  dE = -0.11630311  S^2 = 0.0000000
               |grad[o]|=0.144  |ddm|= 0.12  |maxRot[o]|=0.309
9 -1
State   0 energy     -32.470238786168
10 -1
State   0 energy     -32.514664637517
11 -1
State   0 energy     -32.560311053350
12 -1
State   0 energy   -2099.174694347103
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.1746943471  dE = -0.16442149  S^2 = 0.0000000
               |grad[o]|=0.144  |ddm|=0.112  |maxRot[o]|=0.293
13 -1
State   0 energy     -32.682251410789
14 -1
State   0 energy     -32.698318843749
15 -1
State   0 energy     -32.709757544255
16 -1
State   0 energy   -2099.232303828012
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.23230382801  dE = -0.057609481  S^2 = 0.0000000
               |grad[o]|=0.104  |ddm|=0.0444  |maxRot[o]|= 0.31
17 -1
State   0 energy     -32.772734734713
18 -1
State   0 energy     -32.774103197407
19 -1
State   0 energy     -32.774134104126
20 -1
State   0 energy   -2099.239331627261
macro iter 5 (14 JK  4 micro), CASSCF E = -2099.23933162726  dE = -0.0070277992  S^2 = 0.0000000
               |grad[o]|=0.0399  |ddm|=0.0197  |maxRot[o]|= 0.14
21 -1
State   0 energy     -32.762650319322
22 -1
State   0 energy     -32.762650362083
23 -1
State   0 energy   -2099.239332039884
macro iter 6 (7 JK  2 micro), CASSCF E = -2099.23933203988  dE = -4.1262319e-07  S^2 = 0.0000000
               |grad[o]|=0.000537  |ddm|=0.000352  |maxRot[o]|=0.00077
24 -1
State   0 energy     -32.763175106782
25 -1
State   0 energy   -2099.239332039886
macro iter 7 (1 JK  1 micro), CASSCF E = -2099.23933203989  dE = -1.8189894e-12  S^2 = 0.0000000
               |grad[o]|=2.2e-05  |ddm|=9.24e-05  |maxRot[o]|=    0
1-step CASSCF converged in 7 macro (106 JK 23 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.88421086 1.88421138 1.89588822 1.79411228 1.79410423 1.86090382
 0.20805891 0.13295554 0.11502502 0.11502554 0.10743733 0.20806686]
CASSCF energy = -2099.23933203989
CASCI E = -2099.23933203989  E(CI) = -32.7631751043991  S^2 = 0.0000000
energy =  -2099.2393320398855
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 6, 7, 5, 2, 3, 10, 11, 5, 0, 6, 7, 14, 15, 2, 3, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 10, 11, 6, 7, 5, 14, 15, 0, 2, 3, 0, 10, 11, 16, 17, 12, 13, 6, 7, 5, 14, 15, 5, 0, 2, 3, 6, 7, 0, 2, 3, 5, 6, 7, 10, 11, 0, 14, 15, 2, 3, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 16, 17, 5, 10, 11, 14, 15, 12, 13, 2, 3, 0, 6, 7, 14, 15, 5, 2, 3, 0, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 63 64 65 72 73 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:45:40 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.800000000000 AA    0.000000000000   0.000000000000   1.511780899652 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.800000000000 AA    0.000000000000   0.000000000000  -1.511780899652 Bohr   0.0

nuclear repulsion = 190.5037959312
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     22408.33


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp824tvcdb
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.70218799855
HOMO (E2ux) = -0.230847727121243  LUMO (E2ux) = -0.230847727121243
cycle= 1 E= -2098.48388210357  delta_E= 0.218  |g|= 1.02  |ddm|= 3.05
HOMO (E2ux) = 0.47586846127708  LUMO (A1u) = 0.0260536262390912
cycle= 2 E= -2098.25570592079  delta_E= 0.228  |g|= 1.26  |ddm|= 3.88
HOMO (E2ux) = 0.193659412178597  LUMO (A1u) = 0.00989822797424281
cycle= 3 E= -2098.51251700612  delta_E= -0.257  |g|= 0.216  |ddm|= 3.69
HOMO (E2ux) = 0.171626824967322  LUMO (A1u) = 0.0147136175048119
cycle= 4 E= -2098.54042069018  delta_E= -0.0279  |g|= 0.154  |ddm|= 0.306
HOMO (E2ux) = 0.171426315248081  LUMO (A1u) = 0.0144004561555928
cycle= 5 E= -2098.54180049188  delta_E= -0.00138  |g|= 0.153  |ddm|= 0.0959
HOMO (E2ux) = 0.165986331363407  LUMO (A1u) = 0.0125145765125456
cycle= 6 E= -2098.54467620765  delta_E= -0.00288  |g|= 0.157  |ddm|= 0.0758
HOMO (E2ux) = 0.164542630837667  LUMO (A1u) = 0.0120998100490277
cycle= 7 E= -2098.54588413452  delta_E= -0.00121  |g|= 0.156  |ddm|= 0.0478
HOMO (E2ux) = 0.196381467495706  LUMO (A1u) = 0.0239107094778629
cycle= 8 E= -2098.50188414192  delta_E= 0.044  |g|= 0.316  |ddm|= 0.779
HOMO (E2ux) = 0.196366316374686  LUMO (A1u) = 0.0240147525317461
cycle= 9 E= -2098.50006180475  delta_E= 0.00182  |g|= 0.324  |ddm|= 0.0305
HOMO (E2ux) = 0.205479017015901  LUMO (A1u) = 0.0297964253486197
cycle= 10 E= -2098.44673564121  delta_E= 0.0533  |g|= 0.512  |ddm|= 0.803
HOMO (E2ux) = 0.198449259749943  LUMO (A1u) = 0.0254775955105084
cycle= 11 E= -2098.49583186493  delta_E= -0.0491  |g|= 0.355  |ddm|= 0.853
HOMO (E2ux) = 0.182224923628224  LUMO (A1u) = 0.0224813019585803
cycle= 12 E= -2098.53174994062  delta_E= -0.0359  |g|= 0.199  |ddm|= 0.38
HOMO (E2ux) = 0.18347082865259  LUMO (A1u) = 0.0219320554653857
cycle= 13 E= -2098.52794531592  delta_E= 0.0038  |g|=  0.2  |ddm|= 0.111
HOMO (E2ux) = 0.186479144973656  LUMO (A1u) = 0.0231097410375944
cycle= 14 E= -2098.51643092603  delta_E= 0.0115  |g|= 0.245  |ddm|= 0.193
HOMO (E2ux) = 0.18151996574115  LUMO (A1u) = 0.0210624194349617
cycle= 15 E= -2098.52641598083  delta_E= -0.00999  |g|= 0.184  |ddm|= 0.131
HOMO (E2ux) = 0.167284650337735  LUMO (A1u) = 0.0148101822582195
cycle= 16 E= -2098.54090157347  delta_E= -0.0145  |g|= 0.143  |ddm|= 0.302
HOMO (E2ux) = 0.168214862768514  LUMO (A1u) = 0.0164509731294006
cycle= 17 E= -2098.54105416014  delta_E= -0.000153  |g|= 0.14  |ddm|= 0.15
HOMO (E2ux) = 0.173325432075663  LUMO (A1u) = 0.0188658673487545
cycle= 18 E= -2098.53747583386  delta_E= 0.00358  |g|= 0.139  |ddm|= 0.137
HOMO (E2ux) = 0.184651730882134  LUMO (A1u) = 0.0230042762889623
cycle= 19 E= -2098.52173644314  delta_E= 0.0157  |g|= 0.166  |ddm|= 0.278
HOMO (E2ux) = 0.190455694622074  LUMO (A1u) = 0.0244600095964216
cycle= 20 E= -2098.5080382164  delta_E= 0.0137  |g|= 0.255  |ddm|= 0.334
HOMO (E2ux) = 0.18827958735808  LUMO (A1u) = 0.0238244578766592
cycle= 21 E= -2098.51731821698  delta_E= -0.00928  |g|= 0.214  |ddm|= 0.142
HOMO (E2ux) = 0.189536541872403  LUMO (A1u) = 0.0249258091299456
cycle= 22 E= -2098.5171897629  delta_E= 0.000128  |g|= 0.212  |ddm|= 0.0394
HOMO (E2ux) = 0.188169286025998  LUMO (A1u) = 0.0245151544587317
cycle= 23 E= -2098.52273663124  delta_E= -0.00555  |g|= 0.189  |ddm|= 0.0836
HOMO (E2ux) = 0.186585912728178  LUMO (A1u) = 0.0234179472620172
cycle= 24 E= -2098.52562808882  delta_E= -0.00289  |g|= 0.18  |ddm|= 0.0654
HOMO (E2ux) = 0.187716662192621  LUMO (A1u) = 0.0237594710921823
cycle= 25 E= -2098.52508076021  delta_E= 0.000547  |g|= 0.179  |ddm|= 0.0519
HOMO (E2ux) = 0.177978742680792  LUMO (A1u) = 0.020405379547102
cycle= 26 E= -2098.53500975812  delta_E= -0.00993  |g|= 0.14  |ddm|= 0.169
HOMO (E2ux) = 0.178463045587624  LUMO (A1u) = 0.0208915184293538
cycle= 27 E= -2098.53426297638  delta_E= 0.000747  |g|= 0.14  |ddm|= 0.0389
HOMO (E2ux) = 0.180014073775143  LUMO (A1u) = 0.0211591344563447
cycle= 28 E= -2098.53072686608  delta_E= 0.00354  |g|= 0.141  |ddm|= 0.0809
HOMO (E2ux) = 0.176618663264805  LUMO (A1u) = 0.0199312090644961
cycle= 29 E= -2098.53458524784  delta_E= -0.00386  |g|= 0.14  |ddm|= 0.0939
HOMO (E2ux) = 0.175273750658716  LUMO (A1u) = 0.019266472764906
cycle= 30 E= -2098.53482377435  delta_E= -0.000239  |g|= 0.14  |ddm|= 0.0375
HOMO (E2ux) = 0.175511601379808  LUMO (A1u) = 0.0198345881902563
cycle= 31 E= -2098.53464082409  delta_E= 0.000183  |g|= 0.14  |ddm|= 0.0591
HOMO (E2ux) = 0.175254066883796  LUMO (A1u) = 0.0196959375460468
cycle= 32 E= -2098.53475926819  delta_E= -0.000118  |g|= 0.139  |ddm|= 0.00495
SCF not converged.
SCF energy = -2098.53475926819
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp824tvcdb
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E1uy E1ux A1g E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.740730572581
CASCI E = -2098.74073057258  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -31.407632338784
2 -1
State   0 energy     -31.450688328016
3 -1
State   0 energy     -31.486906288550
4 -1
State   0 energy   -2098.895644071612
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.89564407161  dE = -0.1549135  S^2 = 0.0000000
               |grad[o]|=0.419  |ddm|=0.425  |maxRot[o]|=0.293
5 -1
State   0 energy     -31.530353303987
6 -1
State   0 energy     -31.560033099362
7 -1
State   0 energy     -31.596010863741
8 -1
State   0 energy   -2099.023614082258
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.02361408226  dE = -0.12797001  S^2 = 0.0000000
               |grad[o]|=0.154  |ddm|=0.158  |maxRot[o]|= 0.31
9 -1
State   0 energy     -31.686766623201
10 -1
State   0 energy     -31.734905510671
11 -1
State   0 energy     -31.782641850941
12 -1
State   0 energy   -2099.201549160860
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.20154916086  dE = -0.17793508  S^2 = 0.0000000
               |grad[o]|=0.162  |ddm|=0.142  |maxRot[o]|=0.303
13 -1
State   0 energy     -31.892494739163
14 -1
State   0 energy     -31.906556682011
15 -1
State   0 energy     -31.916311941508
16 -1
State   0 energy   -2099.253023215064
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.25302321506  dE = -0.051474054  S^2 = 0.0000000
               |grad[o]|=0.106  |ddm|=0.0502  |maxRot[o]|=0.312
17 -1
State   0 energy     -31.961450001844
18 -1
State   0 energy     -31.963021064184
19 -1
State   0 energy     -31.963156275941
20 -1
State   0 energy   -2099.259955704726
macro iter 5 (14 JK  4 micro), CASSCF E = -2099.25995570473  dE = -0.0069324897  S^2 = 0.0000000
               |grad[o]|=0.0406  |ddm|=0.0243  |maxRot[o]|=0.152
21 -1
State   0 energy     -31.950359048270
22 -1
State   0 energy     -31.950359118166
23 -1
State   0 energy     -31.950359160931
24 -1
State   0 energy   -2099.259956441852
macro iter 6 (10 JK  3 micro), CASSCF E = -2099.25995644185  dE = -7.3712545e-07  S^2 = 0.0000000
               |grad[o]|=0.000603  |ddm|=0.000956  |maxRot[o]|=0.00146
25 -1
State   0 energy     -31.950314488608
26 -1
State   0 energy   -2099.259956445198
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.2599564452  dE = -3.3469405e-09  S^2 = 0.0000000
               |grad[o]|=3.12e-05  |ddm|=7.98e-05  |maxRot[o]|=6.41e-05
1-step CASSCF converged in 7 macro (111 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.85346158 1.8534613  1.84288725 1.70690192 1.70690325 1.88789512
 0.29465002 0.15087156 0.14622835 0.14622806 0.11586287 0.29464873]
CASSCF energy = -2099.2599564452
CASCI E = -2099.2599564452  E(CI) = -31.9502709958447  S^2 = 0.0000000
energy =  -2099.2599564451984
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 0, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 5, 2, 3, 6, 7, 5, 10, 11, 0, 6, 7, 14, 15, 2, 3, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 10, 11, 5, 6, 7, 14, 15, 0, 2, 3, 0, 10, 11, 16, 17, 12, 13, 6, 7, 5, 14, 15, 5, 0, 6, 7, 2, 3, 2, 3, 0, 5, 6, 7, 10, 11, 0, 14, 15, 2, 3, 5, 0, 6, 7, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 5, 16, 17, 14, 15, 10, 11, 12, 13, 2, 3, 6, 7, 14, 15, 0, 5, 2, 3, 0, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 72 73 74 75]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:52:48 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.840000000000 AA    0.000000000000   0.000000000000   1.587369944635 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.840000000000 AA    0.000000000000   0.000000000000  -1.587369944635 Bohr   0.0

nuclear repulsion = 181.432186601143
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     24045.30


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpx5s9a4f1
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.54476917905
HOMO (E2ux) = -0.223758207443774  LUMO (E2ux) = -0.223758207443774
cycle= 1 E= -2098.48218445525  delta_E= 0.0626  |g|= 0.961  |ddm|= 3.02
HOMO (E2ux) = 0.459018306911909  LUMO (A1u) = 0.0241734241115335
cycle= 2 E= -2098.2089381304  delta_E= 0.273  |g|= 1.26  |ddm|= 3.72
HOMO (E2ux) = 0.178031093243432  LUMO (A1u) = 0.00629535599168597
cycle= 3 E= -2098.48161185843  delta_E= -0.273  |g|= 0.277  |ddm|= 3.58
HOMO (E2ux) = 0.162368778494224  LUMO (A1u) = 0.0133685143528383
cycle= 4 E= -2098.5085946259  delta_E= -0.027  |g|= 0.155  |ddm|= 0.251
HOMO (E2ux) = 0.158606358233133  LUMO (A1u) = 0.0127551064472542
cycle= 5 E= -2098.51268705682  delta_E= -0.00409  |g|= 0.154  |ddm|= 0.122
HOMO (E2ux) = 0.152873242630531  LUMO (A1u) = 0.0105179228865641
cycle= 6 E= -2098.51726296157  delta_E= -0.00458  |g|= 0.157  |ddm|= 0.145
HOMO (E2ux) = 0.163340738062389  LUMO (A1u) = 0.01389590325741
cycle= 7 E= -2098.50799280127  delta_E= 0.00927  |g|= 0.155  |ddm|= 0.32
HOMO (E2ux) = 0.186285048083072  LUMO (A1u) = 0.0240146664570795
cycle= 8 E= -2098.47124854714  delta_E= 0.0367  |g|= 0.307  |ddm|= 0.742
HOMO (E2ux) = 0.187751962959403  LUMO (A1u) = 0.0249252025538043
cycle= 9 E= -2098.47147657176  delta_E= -0.000228  |g|= 0.31  |ddm|= 0.0628
HOMO (E2ux) = 0.188565807288219  LUMO (A1u) = 0.0278256489352706
cycle= 10 E= -2098.45747344443  delta_E= 0.014  |g|= 0.387  |ddm|= 0.357
HOMO (E2ux) = 0.179561265661928  LUMO (A1u) = 0.0233637517315307
cycle= 11 E= -2098.48653672039  delta_E= -0.0291  |g|= 0.269  |ddm|= 0.463
HOMO (E2ux) = 0.176770473763851  LUMO (A1u) = 0.0230434892180041
cycle= 12 E= -2098.48581976262  delta_E= 0.000717  |g|= 0.266  |ddm|= 0.135
HOMO (E2ux) = 0.194419797721623  LUMO (A1u) = 0.028076934971035
cycle= 13 E= -2098.38057205937  delta_E= 0.105  |g|= 0.586  |ddm|= 1.53
HOMO (E2ux) = 0.198011594238865  LUMO (A1u) = 0.0284119118872465
cycle= 14 E= -2098.38604417318  delta_E= -0.00547  |g|= 0.592  |ddm|= 0.877
HOMO (E2ux) = 0.172344901107638  LUMO (A1u) = 0.0185545278124889
cycle= 15 E= -2098.49299601738  delta_E= -0.107  |g|= 0.18  |ddm|= 1.09
HOMO (E2ux) = 0.169009540252896  LUMO (A1u) = 0.0173549369694824
cycle= 16 E= -2098.4969359967  delta_E= -0.00394  |g|= 0.162  |ddm|= 0.0633
HOMO (E2ux) = 0.167042203998278  LUMO (A1u) = 0.0159296103228396
cycle= 17 E= -2098.49913280071  delta_E= -0.0022  |g|= 0.165  |ddm|= 0.155
HOMO (E2ux) = 0.179127686989318  LUMO (A1u) = 0.0227284822467144
cycle= 18 E= -2098.49421093693  delta_E= 0.00492  |g|= 0.158  |ddm|= 0.294
HOMO (E2ux) = 0.178956555432114  LUMO (A1u) = 0.0226280788567926
cycle= 19 E= -2098.49500081516  delta_E= -0.00079  |g|= 0.157  |ddm|= 0.0224
HOMO (E2ux) = 0.178979414724657  LUMO (A1u) = 0.0226020303876238
cycle= 20 E= -2098.49475947594  delta_E= 0.000241  |g|= 0.156  |ddm|= 0.0134
HOMO (E2ux) = 0.175779254425755  LUMO (A1u) = 0.0215723623936798
cycle= 21 E= -2098.49946450965  delta_E= -0.00471  |g|= 0.16  |ddm|= 0.23
HOMO (E2ux) = 0.16554618145852  LUMO (A1u) = 0.0180887190869279
cycle= 22 E= -2098.50320146714  delta_E= -0.00374  |g|= 0.146  |ddm|= 0.181
HOMO (E2ux) = 0.168725618058613  LUMO (A1u) = 0.0192111105039663
cycle= 23 E= -2098.50219797089  delta_E= 0.001  |g|= 0.146  |ddm|= 0.0568
HOMO (E2ux) = 0.167233090313109  LUMO (A1u) = 0.0183154644253894
cycle= 24 E= -2098.50291608527  delta_E= -0.000718  |g|= 0.146  |ddm|= 0.0318
HOMO (E2ux) = 0.169007795378078  LUMO (A1u) = 0.0190669342624988
cycle= 25 E= -2098.50072953425  delta_E= 0.00219  |g|= 0.15  |ddm|= 0.0612
HOMO (E2ux) = 0.164357652637354  LUMO (A1u) = 0.0174344905967625
cycle= 26 E= -2098.50121516968  delta_E= -0.000486  |g|= 0.139  |ddm|= 0.144
HOMO (E2ux) = 0.164569745732623  LUMO (A1u) = 0.0173193033953497
cycle= 27 E= -2098.50064916658  delta_E= 0.000566  |g|= 0.139  |ddm|= 0.0289
HOMO (E2ux) = 0.163782773899943  LUMO (A1u) = 0.0172784217072602
cycle= 28 E= -2098.5026842704  delta_E= -0.00204  |g|= 0.138  |ddm|= 0.0651
HOMO (E2ux) = 0.162366293819747  LUMO (A1u) = 0.0169305153954244
cycle= 29 E= -2098.50447903726  delta_E= -0.00179  |g|= 0.137  |ddm|= 0.0666
HOMO (E2ux) = 0.161864320990336  LUMO (A1u) = 0.0175173387485029
cycle= 30 E= -2098.50413404627  delta_E= 0.000345  |g|= 0.136  |ddm|= 0.0563
HOMO (E2ux) = 0.163645607084473  LUMO (A1u) = 0.0183915177249966
cycle= 31 E= -2098.50235333707  delta_E= 0.00178  |g|= 0.136  |ddm|= 0.0603
HOMO (E2ux) = 0.165108965169214  LUMO (A1u) = 0.0190086867311028
cycle= 32 E= -2098.50488352635  delta_E= -0.00253  |g|= 0.139  |ddm|= 0.148
SCF not converged.
SCF energy = -2098.50488352635
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpx5s9a4f1
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.723281332286
CASCI E = -2098.72328133229  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.815202663083
2 -1
State   0 energy     -30.861647405552
3 -1
State   0 energy     -30.900565989765
4 -1
State   0 energy   -2098.888313383501
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.8883133835  dE = -0.16503205  S^2 = 0.0000000
               |grad[o]|=0.442  |ddm|=0.479  |maxRot[o]|=0.278
5 -1
State   0 energy     -30.968119789359
6 -1
State   0 energy     -31.002465752862
7 -1
State   0 energy     -31.044771574705
8 -1
State   0 energy   -2099.036489403165
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.03648940317  dE = -0.14817602  S^2 = 0.0000000
               |grad[o]|=0.158  |ddm|=0.183  |maxRot[o]|= 0.31
9 -1
State   0 energy     -31.137204449450
10 -1
State   0 energy     -31.189932623215
11 -1
State   0 energy     -31.239431069945
12 -1
State   0 energy   -2099.223369081149
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.22336908115  dE = -0.18687968  S^2 = 0.0000000
               |grad[o]|=0.174  |ddm|=0.184  |maxRot[o]|=0.299
13 -1
State   0 energy     -31.347169101850
14 -1
State   0 energy     -31.358662915309
15 -1
State   0 energy     -31.365439839668
16 -1
State   0 energy   -2099.264152347753
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.26415234775  dE = -0.040783267  S^2 = 0.0000000
               |grad[o]|=0.0965  |ddm|=0.0599  |maxRot[o]|=0.311
17 -1
State   0 energy     -31.392994082988
18 -1
State   0 energy     -31.393003879882
19 -1
State   0 energy     -31.393003618547
20 -1
State   0 energy   -2099.264481284541
macro iter 5 (13 JK  4 micro), CASSCF E = -2099.26448128454  dE = -0.00032893679  S^2 = 0.0000000
               |grad[o]|=0.0135  |ddm|=0.00985  |maxRot[o]|=0.0185
21 -1
State   0 energy     -31.384597828021
22 -1
State   0 energy   -2099.264481310051
macro iter 6 (4 JK  1 micro), CASSCF E = -2099.26448131005  dE = -2.5510417e-08  S^2 = 0.0000000
               |grad[o]|=7.61e-05  |ddm|=0.000171  |maxRot[o]|=0.000171
1-step CASSCF converged in 6 macro (101 JK 21 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.7892498  1.81614984 1.81614986 1.5998708  1.5998756  1.89197319
 0.40093909 0.16993107 0.18390138 0.18390141 0.14712381 0.40093413]
CASSCF energy = -2099.26448131005
CASCI E = -2099.26448131005  E(CI) = -31.384740797163  S^2 = 0.0000000
energy =  -2099.264481310051
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 0, 5, 2, 3, 6, 7, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 10, 11, 5, 6, 7, 14, 15, 0, 2, 3, 0, 10, 11, 16, 17, 6, 7, 12, 13, 5, 14, 15, 0, 5, 6, 7, 2, 3, 2, 3, 0, 5, 6, 7, 10, 11, 0, 14, 15, 2, 3, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 5, 14, 15, 16, 17, 10, 11, 12, 13, 2, 3, 6, 7, 14, 15, 5, 0, 2, 3, 0, 5, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 72 73 76 77]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Sun Jun  1 23:59:43 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.900000000000 AA    0.000000000000   0.000000000000   1.700753512109 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.900000000000 AA    0.000000000000   0.000000000000  -1.700753512109 Bohr   0.0

nuclear repulsion = 169.3367074944
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     25534.47


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpn0p03c8j
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.34663904754
HOMO (E2ux) = -0.214854671637564  LUMO (E2ux) = -0.214854671637564
cycle= 1 E= -2098.45904436234  delta_E= -0.112  |g|= 0.889  |ddm|= 2.98
HOMO (E2ux) = 0.43736714381624  LUMO (A1u) = 0.0213318605026462
cycle= 2 E= -2098.14505561812  delta_E= 0.314  |g|= 1.24  |ddm|= 3.56
HOMO (E2ux) = 0.158665057859178  LUMO (A1u) = 0.00197551882112682
cycle= 3 E= -2098.40595445291  delta_E= -0.261  |g|= 0.44  |ddm|= 3.53
HOMO (E2ux) = 0.152903070112368  LUMO (A1u) = 0.0119434970404729
cycle= 4 E= -2098.43955920749  delta_E= -0.0336  |g|= 0.224  |ddm|= 0.235
HOMO (E2ux) = 0.152582156018875  LUMO (A1u) = 0.0146815085615478
cycle= 5 E= -2098.44710502658  delta_E= -0.00755  |g|= 0.172  |ddm|= 0.124
HOMO (E2ux) = 0.148868830085667  LUMO (A1u) = 0.0128690862794348
cycle= 6 E= -2098.44753694809  delta_E= -0.000432  |g|= 0.19  |ddm|= 0.0486
HOMO (E2ux) = 0.14802600125265  LUMO (A1u) = 0.0127455916382132
cycle= 7 E= -2098.44807724295  delta_E= -0.00054  |g|= 0.19  |ddm|= 0.0101
HOMO (E2ux) = 0.146201438121663  LUMO (A1u) = 0.0120518110824647
cycle= 8 E= -2098.4490812337  delta_E= -0.001  |g|= 0.191  |ddm|= 0.0507
HOMO (E2ux) = 0.148462570405683  LUMO (A1u) = 0.0128945345518059
cycle= 9 E= -2098.44910450525  delta_E= -2.33e-05  |g|= 0.178  |ddm|= 0.0382
HOMO (E2ux) = 0.151141670187883  LUMO (A1u) = 0.015812475450451
cycle= 10 E= -2098.45104152562  delta_E= -0.00194  |g|= 0.142  |ddm|= 0.0755
HOMO (E2ux) = 0.158417073264151  LUMO (A1u) = 0.0174142552867601
cycle= 11 E= -2098.44713115432  delta_E= 0.00391  |g|= 0.15  |ddm|= 0.096
HOMO (E2ux) = 0.153351174657827  LUMO (A1u) = 0.0166543662644452
cycle= 12 E= -2098.44807869276  delta_E= -0.000948  |g|= 0.154  |ddm|= 0.302
HOMO (E2ux) = 0.164286040424032  LUMO (A1u) = 0.0200170076072574
cycle= 13 E= -2098.43924053737  delta_E= 0.00884  |g|= 0.202  |ddm|= 0.511
HOMO (E2ux) = 0.159218488502273  LUMO (A1u) = 0.0173837229929454
cycle= 14 E= -2098.43963894903  delta_E= -0.000398  |g|= 0.209  |ddm|= 0.209
HOMO (E2ux) = 0.1608497183492  LUMO (A1u) = 0.0187278650170332
cycle= 15 E= -2098.42887993591  delta_E= 0.0108  |g|= 0.286  |ddm|= 0.204
HOMO (E2ux) = 0.16405869244172  LUMO (A1u) = 0.0213820054377805
cycle= 16 E= -2098.42750357322  delta_E= 0.00138  |g|= 0.29  |ddm|= 0.427
HOMO (E2ux) = 0.164396146425895  LUMO (A1u) = 0.0206102021528502
cycle= 17 E= -2098.4234656375  delta_E= 0.00404  |g|= 0.31  |ddm|= 0.181
HOMO (E2ux) = 0.158636686490126  LUMO (A1u) = 0.0183082246451303
cycle= 18 E= -2098.43074696198  delta_E= -0.00728  |g|= 0.279  |ddm|=  0.3
HOMO (E2ux) = 0.145997751409316  LUMO (A1u) = 0.0169216063170386
cycle= 19 E= -2098.45386671572  delta_E= -0.0231  |g|= 0.136  |ddm|= 0.617
HOMO (E2ux) = 0.15294138163697  LUMO (A1u) = 0.0172113496320561
cycle= 20 E= -2098.44777311943  delta_E= 0.00609  |g|= 0.162  |ddm|= 0.414
HOMO (E2ux) = 0.151616615880068  LUMO (A1u) = 0.017858278307506
cycle= 21 E= -2098.44610874688  delta_E= 0.00166  |g|= 0.184  |ddm|= 0.658
HOMO (E2ux) = 0.1549882648877  LUMO (A1u) = 0.0179172170966591
cycle= 22 E= -2098.44393375196  delta_E= 0.00217  |g|= 0.194  |ddm|= 0.461
HOMO (E2ux) = 0.172081901898875  LUMO (A1u) = 0.0216446570719068
cycle= 23 E= -2098.40185833176  delta_E= 0.0421  |g|= 0.41  |ddm|= 0.443
HOMO (E2ux) = 0.174764040858851  LUMO (A1u) = 0.0221477698079691
cycle= 24 E= -2098.39548670132  delta_E= 0.00637  |g|= 0.432  |ddm|= 0.141
HOMO (E2ux) = 0.164207074008278  LUMO (A1u) = 0.0196998802270232
cycle= 25 E= -2098.43131540731  delta_E= -0.0358  |g|= 0.272  |ddm|= 0.452
HOMO (E2ux) = 0.165060679525807  LUMO (A1u) = 0.0199570781007317
cycle= 26 E= -2098.42907807887  delta_E= 0.00224  |g|= 0.284  |ddm|= 0.0292
HOMO (E2ux) = 0.163770106761075  LUMO (A1u) = 0.019668942862624
cycle= 27 E= -2098.43382022283  delta_E= -0.00474  |g|= 0.255  |ddm|= 0.0758
HOMO (E2ux) = 0.166479722283172  LUMO (A1u) = 0.0198238741690451
cycle= 28 E= -2098.42072501244  delta_E= 0.0131  |g|= 0.326  |ddm|= 0.303
HOMO (E2ux) = 0.175506899245173  LUMO (A1u) = 0.0234221747843362
cycle= 29 E= -2098.39515148142  delta_E= 0.0256  |g|= 0.435  |ddm|= 0.345
HOMO (E2ux) = 0.151385329706008  LUMO (A1u) = 0.0174394492250054
cycle= 30 E= -2098.45132313719  delta_E= -0.0562  |g|= 0.137  |ddm|= 0.821
HOMO (E2ux) = 0.148492938203657  LUMO (A1u) = 0.016347397721693
cycle= 31 E= -2098.45297484068  delta_E= -0.00165  |g|= 0.135  |ddm|= 0.0619
HOMO (E2ux) = 0.148065448741813  LUMO (A1u) = 0.0158872391318076
cycle= 32 E= -2098.45294653974  delta_E= 2.83e-05  |g|= 0.135  |ddm|= 0.077
SCF not converged.
SCF energy = -2098.45294653974
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpn0p03c8j
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2gx E2gy A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.694203598442
CASCI E = -2098.69420359844  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -30.019373180350
2 -1
State   0 energy     -30.069217310198
3 -1
State   0 energy     -30.108816045457
4 -1
State   0 energy   -2098.873581229534
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.87358122953  dE = -0.17937763  S^2 = 0.0000000
               |grad[o]|=0.466  |ddm|=0.456  |maxRot[o]|=0.253
5 -1
State   0 energy     -30.220081180158
6 -1
State   0 energy     -30.264088024513
7 -1
State   0 energy     -30.318950847330
8 -1
State   0 energy   -2099.061222568918
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.06122256892  dE = -0.18764134  S^2 = 0.0000000
               |grad[o]|=0.166  |ddm|=0.217  |maxRot[o]|=0.309
9 -1
State   0 energy     -30.422916820564
10 -1
State   0 energy     -30.476329593923
11 -1
State   0 energy     -30.515654302923
12 -1
State   0 energy   -2099.239691789072
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.23969178907  dE = -0.17846922  S^2 = 0.0000000
               |grad[o]|=0.187  |ddm|=0.268  |maxRot[o]|=0.299
13 -1
State   0 energy     -30.624199937012
14 -1
State   0 energy     -30.631891004107
15 -1
State   0 energy     -30.633571598260
16 -1
State   0 energy   -2099.266754809172
macro iter 4 (17 JK  4 micro), CASSCF E = -2099.26675480917  dE = -0.02706302  S^2 = 0.0000000
               |grad[o]|=0.0877  |ddm|=0.0886  |maxRot[o]|=0.207
17 -1
State   0 energy     -30.643710125646
18 -1
State   0 energy     -30.643710362619
19 -1
State   0 energy     -30.643710417764
20 -1
State   0 energy   -2099.266767712468
macro iter 5 (10 JK  3 micro), CASSCF E = -2099.26676771247  dE = -1.2903296e-05  S^2 = 0.0000000
               |grad[o]|=0.00212  |ddm|=0.00115  |maxRot[o]|=0.00684
21 -1
State   0 energy     -30.643398391176
22 -1
State   0 energy   -2099.266767729994
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.26676772999  dE = -1.7526418e-08  S^2 = 0.0000000
               |grad[o]|=5.9e-05  |ddm|=0.00023  |maxRot[o]|=0.000132
1-step CASSCF converged in 6 macro (93 JK 20 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.68119994 1.72669153 1.72669235 1.40050138 1.40050276 1.87123054
 0.59951798 0.21445584 0.27361445 0.27361525 0.23246157 0.5995164 ]
CASSCF energy = -2099.26676772999
CASCI E = -2099.26676772999  E(CI) = -30.643329518859  S^2 = 0.0000000
energy =  -2099.266767729994
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 10, 11, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 5, 0, 2, 3, 6, 7, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 10, 11, 5, 6, 7, 14, 15, 0, 2, 3, 0, 10, 11, 16, 17, 6, 7, 5, 12, 13, 14, 15, 0, 5, 2, 3, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 0, 14, 15, 2, 3, 5, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 14, 15, 10, 11, 2, 3, 16, 17, 12, 13, 5, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 72 73 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 00:06:58 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   0.950000000000 AA    0.000000000000   0.000000000000   1.795239818337 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -0.950000000000 AA    0.000000000000   0.000000000000  -1.795239818337 Bohr   0.0

nuclear repulsion = 160.424249205221
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     26837.44


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp542_ww0t
max_memory 4000 MB (current use 1022 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.20738217415
HOMO (E2ux) = -0.208826271675092  LUMO (E2ux) = -0.208826271675092
cycle= 1 E= -2098.42891175656  delta_E= -0.222  |g|= 0.842  |ddm|= 2.95
HOMO (A1u) = 0.0190369299005251  LUMO (E1ux) = 0.058300307542552
cycle= 2 E= -2097.99554111523  delta_E= 0.433  |g|= 1.47  |ddm|= 33.8
HOMO (E2ux) = 0.101034125702254  LUMO (A1u) = -0.0356796803085905
cycle= 3 E= -2098.35916630889  delta_E= -0.364  |g|= 0.561  |ddm|= 33.7
HOMO (E2ux) = 0.101632198036235  LUMO (A1u) = -0.0204541547576493
cycle= 4 E= -2098.40453808032  delta_E= -0.0454  |g|= 0.31  |ddm|= 0.259
HOMO (E2ux) = 0.111877139034522  LUMO (A1u) = -0.0085161532101241
cycle= 5 E= -2098.42069882274  delta_E= -0.0162  |g|= 0.194  |ddm|= 0.188
HOMO (E2ux) = 0.111777153842332  LUMO (A1u) = -0.00773870837315413
cycle= 6 E= -2098.42411649643  delta_E= -0.00342  |g|= 0.186  |ddm|= 0.0836
HOMO (E2ux) = 0.122589517287211  LUMO (A1u) = -0.00289189708084635
cycle= 7 E= -2098.41460192829  delta_E= 0.00951  |g|= 0.184  |ddm|= 0.256
HOMO (E2ux) = 0.13058440801053  LUMO (A1u) = 0.00134067146337432
cycle= 8 E= -2098.40914879379  delta_E= 0.00545  |g|= 0.159  |ddm|= 0.269
HOMO (E2ux) = 0.136134500152381  LUMO (A1u) = 0.00394186790998217
cycle= 9 E= -2098.40599670297  delta_E= 0.00315  |g|= 0.146  |ddm|= 0.119
HOMO (E2ux) = 0.123539300453083  LUMO (A1u) = -0.000483875322244621
cycle= 10 E= -2098.42007599079  delta_E= -0.0141  |g|= 0.138  |ddm|= 0.448
HOMO (E2ux) = 0.160019597665093  LUMO (A1u) = 0.0209950275995589
cycle= 11 E= -2098.3896169386  delta_E= 0.0305  |g|= 0.256  |ddm|= 0.509
HOMO (E2ux) = 0.177668463534826  LUMO (A1u) = 0.0272279141508149
cycle= 12 E= -2098.30911795271  delta_E= 0.0805  |g|= 0.546  |ddm|= 0.76
HOMO (E2ux) = 0.176076534719177  LUMO (A1u) = 0.0266740031861603
cycle= 13 E= -2098.32431507127  delta_E= -0.0152  |g|= 0.516  |ddm|= 0.321
HOMO (E2ux) = 0.14427692283791  LUMO (A1u) = 0.0171846454060874
cycle= 14 E= -2098.40459690439  delta_E= -0.0803  |g|= 0.193  |ddm|= 0.679
HOMO (E2ux) = 0.138151856216356  LUMO (A1u) = 0.0149340592564898
cycle= 15 E= -2098.41156589271  delta_E= -0.00697  |g|= 0.149  |ddm|= 0.122
HOMO (E2ux) = 0.128571961052537  LUMO (A1u) = 0.0112727125469043
cycle= 16 E= -2098.41726183637  delta_E= -0.0057  |g|= 0.137  |ddm|= 0.135
HOMO (E2ux) = 0.12902841331711  LUMO (A1u) = 0.0113873440632993
cycle= 17 E= -2098.4172772217  delta_E= -1.54e-05  |g|= 0.137  |ddm|= 0.0254
HOMO (E2ux) = 0.14356086224237  LUMO (A1u) = 0.0174917842245826
cycle= 18 E= -2098.39889326969  delta_E= 0.0184  |g|= 0.205  |ddm|= 0.455
HOMO (E2ux) = 0.155524275191979  LUMO (A1u) = 0.0219964184266158
cycle= 19 E= -2098.35682699212  delta_E= 0.0421  |g|= 0.405  |ddm|= 0.876
HOMO (E2ux) = 0.156826302448262  LUMO (A1u) = 0.023235380265898
cycle= 20 E= -2098.37281242042  delta_E= -0.016  |g|= 0.342  |ddm|= 0.638
HOMO (E2ux) = 0.157258890559566  LUMO (A1u) = 0.0233207218402191
cycle= 21 E= -2098.3734062197  delta_E= -0.000594  |g|= 0.341  |ddm|= 0.0592
HOMO (E2ux) = 0.159170376021317  LUMO (A1u) = 0.0241054578143599
cycle= 22 E= -2098.36001685481  delta_E= 0.0134  |g|=  0.4  |ddm|= 0.348
HOMO (E2ux) = 0.155347160302231  LUMO (A1u) = 0.0226864249223501
cycle= 23 E= -2098.38381629251  delta_E= -0.0238  |g|= 0.286  |ddm|= 0.492
HOMO (E2ux) = 0.149380701479607  LUMO (A1u) = 0.0186812066335333
cycle= 24 E= -2098.3947337568  delta_E= -0.0109  |g|= 0.226  |ddm|= 0.296
HOMO (E2ux) = 0.13851424240938  LUMO (A1u) = 0.0143591386684523
cycle= 25 E= -2098.41352075431  delta_E= -0.0188  |g|= 0.136  |ddm|= 0.45
HOMO (E2ux) = 0.137842926797184  LUMO (A1u) = 0.0141905721676853
cycle= 26 E= -2098.41417127579  delta_E= -0.000651  |g|= 0.137  |ddm|= 0.0816
HOMO (E2ux) = 0.13064658941808  LUMO (A1u) = 0.0120829963094868
cycle= 27 E= -2098.41864127839  delta_E= -0.00447  |g|= 0.14  |ddm|= 0.244
HOMO (E2ux) = 0.132312301096001  LUMO (A1u) = 0.0129952060840422
cycle= 28 E= -2098.41705368643  delta_E= 0.00159  |g|= 0.141  |ddm|= 0.0638
HOMO (E2ux) = 0.140619689528054  LUMO (A1u) = 0.0171454858736539
cycle= 29 E= -2098.40619414562  delta_E= 0.0109  |g|= 0.168  |ddm|= 0.349
HOMO (E2ux) = 0.157848414914672  LUMO (A1u) = 0.0241262305384788
cycle= 30 E= -2098.35830175033  delta_E= 0.0479  |g|= 0.407  |ddm|= 0.749
HOMO (E2ux) = 0.170228017481859  LUMO (A1u) = 0.0280594968872152
cycle= 31 E= -2098.30849672175  delta_E= 0.0498  |g|= 0.554  |ddm|= 0.858
HOMO (E2ux) = 0.170776059533181  LUMO (A1u) = 0.0282272937803135
cycle= 32 E= -2098.31236356384  delta_E= -0.00387  |g|= 0.548  |ddm|= 0.415
SCF not converged.
SCF energy = -2098.31236356384
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 33]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp542_ww0t
max_memory 4000 MB (current use 1022 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E2gx E2gy E1uy E1ux A1g E2ux A1u E1gx E1gy A1u E2uy
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.456004113992
CASCI E = -2098.45600411399  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -29.389962888976
2 -1
State   0 energy     -29.499663629216
3 -1
State   0 energy     -29.583374251818
4 -1
State   0 energy   -2098.830419479879
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.83041947988  dE = -0.37441537  S^2 = 0.0000000
               |grad[o]|=0.903  |ddm|=0.904  |maxRot[o]|=0.267
5 -1
State   0 energy     -29.644795973351
6 -1
State   0 energy     -29.677318425083
7 -1
State   0 energy     -29.707288686474
8 -1
State   0 energy   -2098.953627804931
macro iter 2 (21 JK  4 micro), CASSCF E = -2098.95362780493  dE = -0.12320833  S^2 = 0.0000000
               |grad[o]|= 0.33  |ddm|=0.279  |maxRot[o]|=0.311
9 -1
State   0 energy     -29.737073579027
10 -1
State   0 energy     -29.762815423746
11 -1
State   0 energy     -29.791979088692
12 -1
State   0 energy   -2099.064771802986
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.06477180299  dE = -0.111144  S^2 = 0.0000000
               |grad[o]|=  0.2  |ddm|=0.141  |maxRot[o]|=0.311
13 -1
State   0 energy     -29.855880830806
14 -1
State   0 energy     -29.892389799002
15 -1
State   0 energy     -29.928711124680
16 -1
State   0 energy   -2099.205118137649
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.20511813765  dE = -0.14034633  S^2 = 0.0000000
               |grad[o]|= 0.17  |ddm|=0.268  |maxRot[o]|=0.311
17 -1
State   0 energy     -30.028601164782
18 -1
State   0 energy     -30.050283610072
19 -1
State   0 energy     -30.059861724717
20 -1
State   0 energy   -2099.270109562591
macro iter 5 (19 JK  4 micro), CASSCF E = -2099.27010956259  dE = -0.064991425  S^2 = 0.0000000
               |grad[o]|=0.132  |ddm|=0.192  |maxRot[o]|=0.242
21 -1
State   0 energy     -30.111542912711
22 -1
State   0 energy     -30.111545800277
23 -1
State   0 energy     -30.111545783262
24 -1
State   0 energy   -2099.270337187008
macro iter 6 (11 JK  4 micro), CASSCF E = -2099.27033718701  dE = -0.00022762442  S^2 = 0.0000000
               |grad[o]|=0.0152  |ddm|=0.0103  |maxRot[o]|=0.0139
25 -1
State   0 energy     -30.105499405794
26 -1
State   0 energy   -2099.270337193485
macro iter 7 (3 JK  1 micro), CASSCF E = -2099.27033719349  dE = -6.4774213e-09  S^2 = 0.0000000
               |grad[o]|=8.13e-05  |ddm|=3.64e-05  |maxRot[o]|=5.87e-05
1-step CASSCF converged in 7 macro (117 JK 25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.57187136 1.26426427 1.2642642  1.62372716 1.62372709 1.84722515
 0.73562038 0.15650353 0.37651429 0.37651423 0.42414787 0.73562047]
CASSCF energy = -2099.27033719349
CASCI E = -2099.27033719349  E(CI) = -30.1054891551635  S^2 = 0.0000000
energy =  -2099.2703371934854
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 10, 11, 6, 7, 0, 15, 5, 2, 3, 5, 14, 6, 7, 0, 5, 0, 2, 3, 5, 6, 7, 0, 10, 11, 6, 7, 14, 15, 2, 3, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 0, 10, 11, 5, 16, 17, 6, 7, 12, 13, 14, 15, 0, 5, 2, 3, 6, 7, 2, 3, 5, 0, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 14, 15, 2, 3, 10, 11, 16, 17, 12, 13, 5, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 73 74 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 00:15:12 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.000000000000 AA    0.000000000000   0.000000000000   1.889726124565 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.000000000000 AA    0.000000000000   0.000000000000  -1.889726124565 Bohr   0.0

nuclear repulsion = 152.40303674496
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     28774.33


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpivutz0n5
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2098.08631951719
HOMO (E2ux) = -0.203876962127546  LUMO (E2ux) = -0.203876962127546
cycle= 1 E= -2098.39333965443  delta_E= -0.307  |g|= 0.805  |ddm|= 2.96
HOMO (A1u) = 0.0168953342307081  LUMO (E1ux) = 0.0586263303612036
cycle= 2 E= -2097.97886699088  delta_E= 0.414  |g|= 1.41  |ddm|= 23.1
HOMO (E2ux) = 0.0929815666887532  LUMO (A1u) = -0.0371632869532982
cycle= 3 E= -2098.35423951024  delta_E= -0.375  |g|= 0.433  |ddm|= 23.1
HOMO (E2ux) = -0.00725046338307844  LUMO (A1u) = -0.0218482213086303
cycle= 4 E= -2098.41489825836  delta_E= -0.0607  |g|= 0.179  |ddm|= 0.403
HOMO (E2ux) = -0.0408710042389462  LUMO (E2ux) = -0.0408710042389462
cycle= 5 E= -2098.4329248563  delta_E= -0.018  |g|= 0.106  |ddm|= 0.208
HOMO (E2ux) = -0.0494653493991264  LUMO (E2ux) = -0.0494653493991264
cycle= 6 E= -2098.43978442219  delta_E= -0.00686  |g|= 0.108  |ddm|= 0.125
HOMO (E2ux) = -0.0503611611930534  LUMO (E2ux) = -0.0503611611930534
cycle= 7 E= -2098.4403092229  delta_E= -0.000525  |g|= 0.108  |ddm|= 0.011
HOMO (E2ux) = -0.0689336374752713  LUMO (E2ux) = -0.0689336374752713
cycle= 8 E= -2098.45073484681  delta_E= -0.0104  |g|= 0.0998  |ddm|= 0.402
HOMO (E2ux) = -0.0547880566273474  LUMO (E2ux) = -0.0547880566273474
cycle= 9 E= -2098.43809486939  delta_E= 0.0126  |g|= 0.104  |ddm|= 0.425
HOMO (E2ux) = -0.119069806928016  LUMO (E2ux) = -0.119069806928016
cycle= 10 E= -2098.44576424583  delta_E= -0.00767  |g|= 0.125  |ddm|= 0.219
HOMO (A1g) = -0.0616289547804323  LUMO (E2ux) = -0.0963540180279961
cycle= 11 E= -2098.41676057718  delta_E= 0.029  |g|= 0.191  |ddm|= 0.55
HOMO (A1g) = -0.0499891600106939  LUMO (E2ux) = -0.0905087941507453
cycle= 12 E= -2098.41477167828  delta_E= 0.00199  |g|= 0.216  |ddm|= 0.0471
HOMO (A1g) = -0.0551400775200692  LUMO (E2ux) = -0.0924780500757169
cycle= 13 E= -2098.4164329496  delta_E= -0.00166  |g|= 0.202  |ddm|= 0.0216
HOMO (A1g) = -0.0569277149377323  LUMO (E2ux) = -0.0937760814997066
cycle= 14 E= -2098.41729996635  delta_E= -0.000867  |g|= 0.206  |ddm|= 0.0413
HOMO (A1g) = -0.0616184365095679  LUMO (E2ux) = -0.09722636446734
cycle= 15 E= -2098.42011568635  delta_E= -0.00282  |g|= 0.199  |ddm|= 0.0791
HOMO (A1g) = -0.0774477063754027  LUMO (E2ux) = -0.106956756603126
cycle= 16 E= -2098.4299518387  delta_E= -0.00984  |g|= 0.185  |ddm|= 0.183
HOMO (A1g) = -0.0462687476833678  LUMO (E2ux) = -0.0912021800872065
cycle= 17 E= -2098.41568299317  delta_E= 0.0143  |g|= 0.253  |ddm|= 0.252
HOMO (A1g) = -0.0663549913747389  LUMO (E2ux) = -0.0961645842990101
cycle= 18 E= -2098.41524348118  delta_E= 0.00044  |g|= 0.183  |ddm|= 0.191
HOMO (A1g) = -0.0285693098161864  LUMO (E2ux) = -0.0806843944069841
cycle= 19 E= -2098.40069220205  delta_E= 0.0146  |g|= 0.281  |ddm|= 0.166
HOMO (A1g) = -0.0197180288183138  LUMO (E2ux) = -0.0777157747301691
cycle= 20 E= -2098.39370812164  delta_E= 0.00698  |g|= 0.313  |ddm|= 0.0978
HOMO (A1g) = 0.0211378213898811  LUMO (E2ux) = -0.0604931611283279
cycle= 21 E= -2098.36359086124  delta_E= 0.0301  |g|= 0.453  |ddm|= 0.211
HOMO (A1g) = 0.00820408563333756  LUMO (E2ux) = -0.0627317344145678
cycle= 22 E= -2098.37176647771  delta_E= -0.00818  |g|= 0.416  |ddm|= 0.082
HOMO (A1g) = 0.00448322152998342  LUMO (E2ux) = -0.0655444086645346
cycle= 23 E= -2098.37940263431  delta_E= -0.00764  |g|= 0.387  |ddm|= 0.11
HOMO (A1g) = -0.0349630333153761  LUMO (E2ux) = -0.0777810218409138
cycle= 24 E= -2098.39365909535  delta_E= -0.0143  |g|= 0.302  |ddm|= 0.161
HOMO (A1g) = -0.0508787008630579  LUMO (E2ux) = -0.0935199295224861
cycle= 25 E= -2098.41747648509  delta_E= -0.0238  |g|= 0.223  |ddm|= 0.344
HOMO (A1g) = -0.05098694891517  LUMO (E2ux) = -0.0902629329984257
cycle= 26 E= -2098.41231525789  delta_E= 0.00516  |g|= 0.231  |ddm|= 0.12
HOMO (A1g) = -0.0485526837415733  LUMO (E2ux) = -0.105144767880077
cycle= 27 E= -2098.42862843343  delta_E= -0.0163  |g|= 0.211  |ddm|= 0.345
HOMO (A1g) = -0.0297136999918933  LUMO (E2ux) = -0.0996169871800215
cycle= 28 E= -2098.42000655327  delta_E= 0.00862  |g|= 0.239  |ddm|= 0.189
HOMO (A1g) = -0.0192925488735808  LUMO (E2ux) = -0.118023773223678
cycle= 29 E= -2098.43738988568  delta_E= -0.0174  |g|= 0.175  |ddm|= 0.317
HOMO (A1g) = -0.0579023906264767  LUMO (E2ux) = -0.0978633058960308
cycle= 30 E= -2098.41315414379  delta_E= 0.0242  |g|= 0.229  |ddm|= 0.47
HOMO (A1g) = -0.054510200421642  LUMO (E2ux) = -0.0919320775498422
cycle= 31 E= -2098.40544265946  delta_E= 0.00771  |g|= 0.234  |ddm|= 0.181
HOMO (A1g) = -0.0411212087246611  LUMO (E2ux) = -0.0912747199716599
cycle= 32 E= -2098.40474237021  delta_E= 0.0007  |g|= 0.233  |ddm|= 0.177
SCF not converged.
SCF energy = -2098.40474237021
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpivutz0n5
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g E1uy E1ux E2gx E2gy E2uy A1g E2ux A1u E1gx E1gy A1u
Active space CI wfn symmetry = E2uy
0 -1
State   0 energy   -2098.693601645185
CASCI E = -2098.69360164519  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.907767537054
2 -1
State   0 energy     -28.936171186576
3 -1
State   0 energy     -28.964553430746
4 -1
State   0 energy   -2098.847985634059
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.84798563406  dE = -0.15438399  S^2 = 0.0000000
               |grad[o]|=0.374  |ddm|=0.239  |maxRot[o]|=0.288
5 -1
State   0 energy     -29.090898523331
6 -1
State   0 energy     -29.140917033996
7 -1
State   0 energy     -29.197975750395
8 -1
State   0 energy   -2099.051298433474
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.05129843347  dE = -0.2033128  S^2 = 0.0000000
               |grad[o]|=0.202  |ddm|=0.348  |maxRot[o]|=0.311
9 -1
State   0 energy     -29.351725188537
10 -1
State   0 energy     -29.393807158275
11 -1
State   0 energy     -29.429702514275
12 -1
State   0 energy   -2099.206897211399
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.2068972114  dE = -0.15559878  S^2 = 0.0000000
               |grad[o]|=0.214  |ddm|=0.343  |maxRot[o]|=0.311
13 -1
State   0 energy     -29.584847258578
14 -1
State   0 energy     -29.596993814251
15 -1
State   0 energy     -29.604999637133
16 -1
State   0 energy   -2099.258668002280
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.25866800228  dE = -0.051770791  S^2 = 0.0000000
               |grad[o]|=0.126  |ddm|= 0.14  |maxRot[o]|=0.301
17 -1
State   0 energy     -29.653545208451
18 -1
State   0 energy     -29.657657723491
19 -1
State   0 energy     -29.660823226100
20 -1
State   0 energy   -2099.273896375839
macro iter 5 (21 JK  4 micro), CASSCF E = -2099.27389637584  dE = -0.015228374  S^2 = 0.0000000
               |grad[o]|=0.0584  |ddm|=0.0888  |maxRot[o]|=0.311
21 -1
State   0 energy     -29.642479006155
22 -1
State   0 energy     -29.642879539965
23 -1
State   0 energy     -29.642987880972
24 -1
State   0 energy   -2099.276207105777
macro iter 6 (14 JK  4 micro), CASSCF E = -2099.27620710578  dE = -0.0023107299  S^2 = 0.0000000
               |grad[o]|=0.0252  |ddm|=0.0813  |maxRot[o]|=0.131
25 -1
State   0 energy     -29.625664456472
26 -1
State   0 energy     -29.625664556956
27 -1
State   0 energy     -29.625664526763
28 -1
State   0 energy   -2099.276208561200
macro iter 7 (10 JK  3 micro), CASSCF E = -2099.2762085612  dE = -1.455423e-06  S^2 = 0.0000000
               |grad[o]|=0.000818  |ddm|=0.00203  |maxRot[o]|=0.00173
29 -1
State   0 energy     -29.625538211126
30 -1
State   0 energy   -2099.276208561201
macro iter 8 (1 JK  1 micro), CASSCF E = -2099.2762085612  dE = -1.3642421e-12  S^2 = 0.0000000
               |grad[o]|=2.3e-05  |ddm|=8.31e-05  |maxRot[o]|=    0
1-step CASSCF converged in 8 macro (130 JK 28 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.67365739 1.51123638 1.51123629 1.17667533 1.17667818 0.82324393
 1.61547412 0.82324678 0.49272117 0.48889233 0.48889224 0.21804586]
CASSCF energy = -2099.2762085612
CASCI E = -2099.2762085612  E(CI) = -29.6255382101144  S^2 = 0.0000000
energy =  -2099.276208561201
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 0, 6, 7, 10, 11, 14, 0, 15, 5, 2, 3, 5, 6, 7, 0, 5, 2, 3, 0, 6, 7, 5, 0, 10, 11, 2, 3, 14, 15, 6, 7, 5, 2, 3, 0, 5, 6, 7, 0, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 0, 5, 10, 11, 6, 7, 16, 17, 12, 13, 0, 14, 15, 5, 2, 3, 6, 7, 5, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 6, 7, 0, 10, 11, 16, 17, 20, 21, 24, 25, 12, 13, 14, 15, 2, 3, 5, 10, 11, 16, 17, 12, 13, 6, 7, 14, 15, 0, 2, 3, 5, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 75 76 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 00:23:48 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.100000000000 AA    0.000000000000   0.000000000000   2.078698737022 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.100000000000 AA    0.000000000000   0.000000000000  -2.078698737022 Bohr   0.0

nuclear repulsion = 138.548215222691
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     30553.36


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp1g0kmpcz
max_memory 4000 MB (current use 1001 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.88742876891
HOMO (E2ux) = -0.196582242063801  LUMO (E2ux) = -0.196582242063801
cycle= 1 E= -2098.31455563569  delta_E= -0.427  |g|= 0.757  |ddm|= 3.05
HOMO (A1u) = 0.0132679921097134  LUMO (E1ux) = 0.0585922540200982
cycle= 2 E= -2097.92653363739  delta_E= 0.388  |g|= 1.33  |ddm|= 11.6
HOMO (E2ux) = 0.0791698533559407  LUMO (A1u) = -0.0402325977851625
cycle= 3 E= -2098.3040503968  delta_E= -0.378  |g|= 0.334  |ddm|= 11.5
HOMO (E2ux) = 0.0702037760764723  LUMO (A1u) = -0.0249322173795326
cycle= 4 E= -2098.334215959  delta_E= -0.0302  |g|= 0.178  |ddm|= 0.211
HOMO (E2ux) = 0.0711648527709592  LUMO (A1u) = -0.0194309566721627
cycle= 5 E= -2098.34083755783  delta_E= -0.00662  |g|= 0.163  |ddm|= 0.117
HOMO (E2ux) = 0.0673188499899162  LUMO (A1u) = -0.0204116096267647
cycle= 6 E= -2098.34473613039  delta_E= -0.0039  |g|= 0.167  |ddm|= 0.0984
HOMO (E2ux) = 0.0645559365531174  LUMO (A1u) = -0.0216252350895858
cycle= 7 E= -2098.34585687777  delta_E= -0.00112  |g|= 0.168  |ddm|= 0.0322
HOMO (E2ux) = 0.0646425839972669  LUMO (A1u) = -0.0206701575642233
cycle= 8 E= -2098.34680679493  delta_E= -0.00095  |g|= 0.157  |ddm|= 0.0621
HOMO (E2ux) = 0.0656248543275625  LUMO (A1u) = -0.0200210786473271
cycle= 9 E= -2098.34670092873  delta_E= 0.000106  |g|= 0.155  |ddm|= 0.0249
HOMO (E2ux) = 0.0578365643586218  LUMO (A1u) = -0.0184312040398206
cycle= 10 E= -2098.34929997625  delta_E= -0.0026  |g|= 0.144  |ddm|= 0.106
HOMO (E2ux) = 0.0765159721964425  LUMO (A1u) = -0.0058248309994598
cycle= 11 E= -2098.3430473216  delta_E= 0.00625  |g|= 0.157  |ddm|= 0.983
HOMO (E2ux) = 0.0779937208990481  LUMO (A1u) = -0.00407155343876494
cycle= 12 E= -2098.33986144583  delta_E= 0.00319  |g|= 0.153  |ddm|= 1.07
HOMO (E2ux) = 0.0740581973521785  LUMO (A1u) = -0.00523139609737835
cycle= 13 E= -2098.34296184081  delta_E= -0.0031  |g|= 0.149  |ddm|= 0.427
HOMO (E2ux) = 0.0690050281367931  LUMO (A1u) = -0.00679507969928892
cycle= 14 E= -2098.34659118034  delta_E= -0.00363  |g|= 0.143  |ddm|= 0.0844
HOMO (E2ux) = 0.0665360828377408  LUMO (A1u) = -0.0080501142329947
cycle= 15 E= -2098.34055023995  delta_E= 0.00604  |g|= 0.143  |ddm|= 0.258
HOMO (E2ux) = 0.060659772967198  LUMO (A1u) = -0.0104838388994568
cycle= 16 E= -2098.35037905448  delta_E= -0.00983  |g|= 0.142  |ddm|= 0.417
HOMO (E2ux) = 0.0663535216587682  LUMO (A1u) = -0.00829487337634143
cycle= 17 E= -2098.3490164539  delta_E= 0.00136  |g|= 0.148  |ddm|= 0.181
HOMO (E2ux) = 0.0672273941610078  LUMO (A1u) = -0.00725059133782214
cycle= 18 E= -2098.34919520985  delta_E= -0.000179  |g|= 0.14  |ddm|= 0.203
HOMO (E2ux) = 0.0649432204340504  LUMO (A1u) = -0.00927750105051911
cycle= 19 E= -2098.34985152231  delta_E= -0.000656  |g|= 0.142  |ddm|= 0.0974
HOMO (E2ux) = 0.0677340127572668  LUMO (A1u) = -0.0065063238033984
cycle= 20 E= -2098.34994693749  delta_E= -9.54e-05  |g|= 0.139  |ddm|= 0.252
HOMO (E2ux) = 0.0685832711095089  LUMO (A1u) = -0.00603082316643889
cycle= 21 E= -2098.34929142162  delta_E= 0.000656  |g|= 0.139  |ddm|= 0.154
HOMO (E2ux) = 0.0669581014841272  LUMO (A1u) = -0.00697359100292529
cycle= 22 E= -2098.34924987961  delta_E= 4.15e-05  |g|= 0.14  |ddm|= 0.21
HOMO (E2ux) = 0.0610152965223614  LUMO (A1u) = -0.00924053100984194
cycle= 23 E= -2098.34736338735  delta_E= 0.00189  |g|= 0.155  |ddm|= 0.492
HOMO (E2ux) = 0.070744082469882  LUMO (A1u) = -0.00522289916377566
cycle= 24 E= -2098.34669105996  delta_E= 0.000672  |g|= 0.145  |ddm|= 0.46
HOMO (E2ux) = 0.0628305472587854  LUMO (A1u) = -0.00832232957182544
cycle= 25 E= -2098.35063862533  delta_E= -0.00395  |g|= 0.139  |ddm|= 0.22
HOMO (E2ux) = 0.0667002343259343  LUMO (A1u) = -0.00643783544491395
cycle= 26 E= -2098.35022552582  delta_E= 0.000413  |g|= 0.138  |ddm|= 0.127
HOMO (E2ux) = 0.0659508753885304  LUMO (A1u) = -0.00701306874868203
cycle= 27 E= -2098.35026028055  delta_E= -3.48e-05  |g|= 0.138  |ddm|= 0.0163
HOMO (E2ux) = 0.0657967621204805  LUMO (A1u) = -0.00694953861521647
cycle= 28 E= -2098.35032200438  delta_E= -6.17e-05  |g|= 0.138  |ddm|= 0.00989
HOMO (E2ux) = 0.0633860855255366  LUMO (A1u) = -0.00802032560340788
cycle= 29 E= -2098.35082592203  delta_E= -0.000504  |g|= 0.139  |ddm|= 0.041
HOMO (E2ux) = 0.0634378617495846  LUMO (A1u) = -0.0079957623484086
cycle= 30 E= -2098.35077318057  delta_E= 5.27e-05  |g|= 0.139  |ddm|= 0.0143
HOMO (E2ux) = 0.063141854206787  LUMO (A1u) = -0.00817526455030543
cycle= 31 E= -2098.35074239784  delta_E= 3.08e-05  |g|= 0.139  |ddm|= 0.05
HOMO (E2ux) = 0.0625806987436056  LUMO (A1u) = -0.00770839591362359
cycle= 32 E= -2098.35073441467  delta_E= 7.98e-06  |g|= 0.138  |ddm|= 0.135
SCF not converged.
SCF energy = -2098.35073441467
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 29 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp1g0kmpcz
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2gx E2gy E1uy E1ux A1g A1g E2ux A1u E2uy E1gx E1gy A1u
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.716189129431
CASCI E = -2098.71618912943  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -28.001177040347
2 -1
State   0 energy     -28.054750697292
3 -1
State   0 energy     -28.113036097647
4 -1
State   0 energy   -2098.930662225645
macro iter 1 (21 JK  4 micro), CASSCF E = -2098.93066222564  dE = -0.2144731  S^2 = 0.0000000
               |grad[o]|=0.306  |ddm|=0.614  |maxRot[o]|=0.313
5 -1
State   0 energy     -28.284124506783
6 -1
State   0 energy     -28.334041218633
7 -1
State   0 energy     -28.374434652648
8 -1
State   0 energy   -2099.115139189536
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.11513918954  dE = -0.18447696  S^2 = 0.0000000
               |grad[o]|=0.271  |ddm|=0.524  |maxRot[o]|=0.302
9 -1
State   0 energy     -28.531138082245
10 -1
State   0 energy     -28.557145985501
11 -1
State   0 energy     -28.581248793002
12 -1
State   0 energy   -2099.216076522936
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.21607652294  dE = -0.10093733  S^2 = 0.0000000
               |grad[o]|= 0.21  |ddm|= 0.27  |maxRot[o]|=0.312
13 -1
State   0 energy     -28.681848844238
14 -1
State   0 energy     -28.700707370104
15 -1
State   0 energy     -28.715255058814
16 -1
State   0 energy   -2099.282879092466
macro iter 4 (21 JK  4 micro), CASSCF E = -2099.28287909247  dE = -0.06680257  S^2 = 0.0000000
               |grad[o]|=0.155  |ddm|=0.184  |maxRot[o]|=0.294
17 -1
State   0 energy     -28.783829925274
18 -1
State   0 energy     -28.784857184541
19 -1
State   0 energy     -28.784894568282
20 -1
State   0 energy   -2099.290957072530
macro iter 5 (14 JK  4 micro), CASSCF E = -2099.29095707253  dE = -0.0080779801  S^2 = 0.0000000
               |grad[o]|=0.0609  |ddm|=0.0441  |maxRot[o]|=0.101
21 -1
State   0 energy     -28.797021161077
22 -1
State   0 energy     -28.797021196588
23 -1
State   0 energy     -28.797021207464
24 -1
State   0 energy   -2099.290958643000
macro iter 6 (8 JK  3 micro), CASSCF E = -2099.290958643  dE = -1.57047e-06  S^2 = 0.0000000
               |grad[o]|=0.00112  |ddm|=0.000684  |maxRot[o]|=0.000998
25 -1
State   0 energy     -28.796093112035
26 -1
State   0 energy   -2099.290958643001
macro iter 7 (1 JK  1 micro), CASSCF E = -2099.290958643  dE = -9.094947e-13  S^2 = 0.0000000
               |grad[o]|=2.83e-05  |ddm|=9.35e-05  |maxRot[o]|=    0
1-step CASSCF converged in 7 macro (107 JK 24 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.09070944 1.09070827 1.32427013 1.32427023 1.78502385 1.30409599
 0.90927749 0.22177069 0.90927866 0.67575798 0.67575808 0.68907918]
CASSCF energy = -2099.290958643
CASCI E = -2099.290958643  E(CI) = -28.7960931101165  S^2 = 0.0000000
energy =  -2099.2909586430005
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 10, 11, 6, 7, 0, 0, 15, 5, 14, 2, 3, 5, 6, 7, 0, 2, 3, 5, 0, 0, 5, 6, 7, 10, 11, 2, 3, 6, 7, 14, 15, 5, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 10, 11, 6, 7, 14, 15, 0, 2, 3, 5, 0, 10, 11, 6, 7, 16, 17, 12, 13, 0, 14, 15, 5, 2, 3, 6, 7, 5, 2, 3, 5, 0, 10, 11, 6, 7, 14, 15, 2, 3, 5, 0, 6, 7, 0, 10, 11, 16, 17, 14, 15, 12, 13, 20, 21, 24, 25, 2, 3, 5, 10, 11, 6, 7, 16, 17, 12, 13, 14, 15, 0, 2, 3, 5, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 60 61 64 65 75 76 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 00:32:03 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.250000000000 AA    0.000000000000   0.000000000000   2.362157655706 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.250000000000 AA    0.000000000000   0.000000000000  -2.362157655706 Bohr   0.0

nuclear repulsion = 121.922429395968
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     32207.76


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmpgbzj3_zb
max_memory 4000 MB (current use 1002 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.67201678632
HOMO (E2ux) = -0.190198929617876  LUMO (E2ux) = -0.190198929617876
cycle= 1 E= -2098.19363116888  delta_E= -0.522  |g|= 0.74  |ddm|= 3.15
HOMO (E2ux) = 0.230551262203826  LUMO (A1u) = 0.00944663283643711
cycle= 2 E= -2097.82107352213  delta_E= 0.373  |g|= 1.22  |ddm|= 2.88
HOMO (E2ux) = 0.087162584405646  LUMO (A1u) = -0.0136819781418287
cycle= 3 E= -2098.21103844112  delta_E= -0.39  |g|= 0.222  |ddm|= 1.84
HOMO (E2ux) = 0.0661120827834385  LUMO (A1u) = -0.00958597004305822
cycle= 4 E= -2098.22993912301  delta_E= -0.0189  |g|= 0.149  |ddm|= 0.161
HOMO (E2ux) = 0.0544325983159319  LUMO (A1u) = -0.0116570479174984
cycle= 5 E= -2098.23651466067  delta_E= -0.00658  |g|= 0.145  |ddm|= 0.149
HOMO (E2ux) = 0.0469519559150803  LUMO (A1u) = -0.0151624441845525
cycle= 6 E= -2098.23781348155  delta_E= -0.0013  |g|= 0.147  |ddm|= 0.124
HOMO (E2ux) = 0.0511469947471402  LUMO (A1u) = -0.0136830915818393
cycle= 7 E= -2098.23701116883  delta_E= 0.000802  |g|= 0.146  |ddm|= 0.0402
HOMO (E2ux) = 0.0557776754484421  LUMO (A1u) = -0.0132385207259812
cycle= 8 E= -2098.23608651402  delta_E= 0.000925  |g|= 0.145  |ddm|= 0.053
HOMO (E2ux) = 0.0554521484915685  LUMO (A1u) = -0.0118815127310822
cycle= 9 E= -2098.23630341945  delta_E= -0.000217  |g|= 0.143  |ddm|= 0.0501
HOMO (E2ux) = 0.041339066982724  LUMO (A1u) = -0.0151773027559451
cycle= 10 E= -2098.23937111665  delta_E= -0.00307  |g|= 0.139  |ddm|= 0.15
HOMO (E2ux) = 0.044435405282767  LUMO (A1u) = -0.0141046055413159
cycle= 11 E= -2098.23892126799  delta_E= 0.00045  |g|= 0.139  |ddm|= 0.044
HOMO (E2ux) = 0.0506168534521284  LUMO (A1u) = -0.0104555472830704
cycle= 12 E= -2098.23675298531  delta_E= 0.00217  |g|= 0.141  |ddm|= 0.135
HOMO (E2ux) = 0.0453493079220343  LUMO (A1u) = -0.0118358964717607
cycle= 13 E= -2098.23787398834  delta_E= -0.00112  |g|= 0.14  |ddm|= 0.288
HOMO (E2ux) = 0.0435295164097918  LUMO (A1u) = -0.0123208252141944
cycle= 14 E= -2098.23852924687  delta_E= -0.000655  |g|= 0.14  |ddm|= 0.198
HOMO (E2ux) = 0.0452290275518394  LUMO (A1u) = -0.0112429195149155
cycle= 15 E= -2098.23844722898  delta_E= 8.2e-05  |g|= 0.139  |ddm|= 0.0625
HOMO (E2ux) = 0.0461054107124907  LUMO (A1u) = -0.0107349273058092
cycle= 16 E= -2098.23834909845  delta_E= 9.81e-05  |g|= 0.139  |ddm|= 0.0418
HOMO (E2ux) = 0.0442497565155229  LUMO (A1u) = -0.0133249043103248
cycle= 17 E= -2098.23752936906  delta_E= 0.00082  |g|= 0.14  |ddm|= 0.138
HOMO (E2ux) = 0.0451839298552137  LUMO (A1u) = -0.0119689899983549
cycle= 18 E= -2098.23907916886  delta_E= -0.00155  |g|= 0.136  |ddm|= 0.0999
HOMO (E2ux) = 0.0471797622416132  LUMO (A1u) = -0.0130099737097487
cycle= 19 E= -2098.23869963233  delta_E= 0.00038  |g|= 0.139  |ddm|= 0.0579
HOMO (E2ux) = 0.0442761494193835  LUMO (A1u) = -0.0128951066328874
cycle= 20 E= -2098.23967936273  delta_E= -0.00098  |g|= 0.135  |ddm|= 0.0564
HOMO (E2ux) = 0.0458064608358205  LUMO (A1u) = -0.0117496710595836
cycle= 21 E= -2098.23925292987  delta_E= 0.000426  |g|= 0.136  |ddm|= 0.122
HOMO (E2ux) = 0.0464093170980209  LUMO (A1u) = -0.0113120331836919
cycle= 22 E= -2098.23926103677  delta_E= -8.11e-06  |g|= 0.135  |ddm|= 0.143
HOMO (E2ux) = 0.0445269291473429  LUMO (A1u) = -0.0115346950901691
cycle= 23 E= -2098.23948488916  delta_E= -0.000224  |g|= 0.136  |ddm|= 0.0261
HOMO (E2ux) = 0.0450728330142699  LUMO (A1u) = -0.0114997310952968
cycle= 24 E= -2098.23952942191  delta_E= -4.45e-05  |g|= 0.135  |ddm|= 0.0641
HOMO (E2ux) = 0.0451439739402761  LUMO (A1u) = -0.0114448050962105
cycle= 25 E= -2098.23961512812  delta_E= -8.57e-05  |g|= 0.135  |ddm|= 0.0504
HOMO (E2ux) = 0.04409678610628  LUMO (A1u) = -0.0118743210055334
cycle= 26 E= -2098.23972466732  delta_E= -0.00011  |g|= 0.135  |ddm|= 0.0227
HOMO (E2ux) = 0.0440629441055638  LUMO (A1u) = -0.0118074146364849
cycle= 27 E= -2098.23980052157  delta_E= -7.59e-05  |g|= 0.134  |ddm|= 0.0539
HOMO (E2ux) = 0.0398709275510042  LUMO (A1u) = -0.0136657705737539
cycle= 28 E= -2098.24057496597  delta_E= -0.000774  |g|= 0.134  |ddm|= 0.112
HOMO (E2ux) = 0.038580512188256  LUMO (A1u) = -0.0152370960955842
cycle= 29 E= -2098.24052070341  delta_E= 5.43e-05  |g|= 0.134  |ddm|= 0.127
HOMO (E2ux) = 0.0410455803458777  LUMO (A1u) = -0.0134786450498116
cycle= 30 E= -2098.24039022672  delta_E= 0.00013  |g|= 0.134  |ddm|= 0.258
HOMO (E2ux) = 0.0386429603622165  LUMO (A1u) = -0.0154071461249127
cycle= 31 E= -2098.24027117933  delta_E= 0.000119  |g|= 0.134  |ddm|= 0.35
HOMO (E2ux) = 0.0385045591657638  LUMO (A1u) = -0.0145771543953014
cycle= 32 E= -2098.24053742368  delta_E= -0.000266  |g|= 0.135  |ddm|= 0.134
SCF not converged.
SCF energy = -2098.24053742368
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 30 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmpgbzj3_zb
max_memory 4000 MB (current use 1019 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: E2gx E2gy A1g E1uy E1ux A1g E2ux A1u E2uy E1gx E1gy A1u
Active space CI wfn symmetry = E2ux
0 -1
State   0 energy   -2098.751087250909
CASCI E = -2098.75108725091  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -27.023458251746
2 -1
State   0 energy     -27.108109001445
3 -1
State   0 energy     -27.192007532394
4 -1
State   0 energy   -2099.081125622888
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.08112562289  dE = -0.33003837  S^2 = 0.0000000
               |grad[o]|=0.435  |ddm|=0.879  |maxRot[o]|=0.307
5 -1
State   0 energy     -27.420463198746
6 -1
State   0 energy     -27.452922536283
7 -1
State   0 energy     -27.480920362898
8 -1
State   0 energy   -2099.208378740214
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.20837874021  dE = -0.12725312  S^2 = 0.0000000
               |grad[o]|=0.303  |ddm|=0.346  |maxRot[o]|=0.313
9 -1
State   0 energy     -27.607976183024
10 -1
State   0 energy     -27.629569232295
11 -1
State   0 energy     -27.647228409327
12 -1
State   0 energy   -2099.290130678591
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.29013067859  dE = -0.081751938  S^2 = 0.0000000
               |grad[o]|=0.199  |ddm|=0.231  |maxRot[o]|=0.306
13 -1
State   0 energy     -27.746603961783
14 -1
State   0 energy     -27.749929278132
15 -1
State   0 energy     -27.750264353425
16 -1
State   0 energy   -2099.308301264284
macro iter 4 (14 JK  4 micro), CASSCF E = -2099.30830126428  dE = -0.018170586  S^2 = 0.0000000
               |grad[o]|=0.0913  |ddm|=0.0653  |maxRot[o]|=0.159
17 -1
State   0 energy     -27.787788848311
18 -1
State   0 energy     -27.787789227375
19 -1
State   0 energy     -27.787789257157
20 -1
State   0 energy   -2099.308312496308
macro iter 5 (9 JK  3 micro), CASSCF E = -2099.30831249631  dE = -1.1232024e-05  S^2 = 0.0000000
               |grad[o]|=0.00266  |ddm|=0.00382  |maxRot[o]|=0.00512
21 -1
State   0 energy     -27.786533684474
22 -1
State   0 energy   -2099.308312499794
macro iter 6 (3 JK  1 micro), CASSCF E = -2099.30831249979  dE = -3.4865479e-09  S^2 = 0.0000000
               |grad[o]|=5.47e-05  |ddm|=8.4e-05  |maxRot[o]|=7.66e-05
1-step CASSCF converged in 6 macro (89 JK 20 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.04295678 1.04295567 1.74167652 1.17176029 1.17176039 1.17169558
 0.95704375 0.27347716 0.95704487 0.82825139 0.8282515  0.8131261 ]
CASSCF energy = -2099.30831249979
CASCI E = -2099.30831249979  E(CI) = -27.7865401642061  S^2 = 0.0000000
energy =  -2099.3083124997943
orbsym =  [5, 0, 0, 5, 0, 5, 6, 7, 2, 3, 0, 5, 0, 6, 7, 5, 2, 3, 10, 11, 0, 6, 7, 0, 15, 5, 14, 2, 3, 5, 6, 7, 0, 2, 3, 5, 0, 0, 5, 6, 7, 10, 11, 2, 3, 6, 7, 14, 15, 5, 2, 3, 0, 5, 0, 6, 7, 2, 3, 5, 6, 7, 10, 11, 14, 15, 0, 2, 3, 5, 0, 6, 7, 10, 11, 16, 17, 12, 13, 0, 14, 15, 5, 2, 3, 5, 6, 7, 2, 3, 0, 5, 10, 11, 6, 7, 14, 15, 2, 3, 5, 0, 0, 6, 7, 10, 11, 14, 15, 2, 3, 5, 16, 17, 12, 13, 20, 21, 24, 25, 6, 7, 10, 11, 0, 16, 17, 12, 13, 14, 15, 2, 3, 5, 0, 5]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 8, 'A1g': 8, 'E1ux': 5, 'E1gy': 5, 'E1gx': 5, 'E1uy': 5, 'E2gy': 2, 'E2gx': 2, 'E2uy': 2, 'E2ux': 2}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]
ncore for each irreps {'A1g': 3, 'E1gx': 1, 'E1gy': 1, 'A1u': 3, 'E1uy': 1, 'E1ux': 1, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 9, 'A1g': 9, 'E1ux': 6, 'E1gy': 6, 'E1gx': 6, 'E1uy': 6, 'E2gy': 3, 'E2gx': 3, 'E2uy': 3, 'E2ux': 3, 'E3gy': 1, 'E3gx': 1, 'E3uy': 1, 'E3ux': 1}
(0-based) caslst = [10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33
 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57
 58 59 62 63 64 65 75 76 77 78]
#INFO: **** input file is /apps/users/zhangning/2025_work/Cr2Orb/02-cas_orb_dump.py ****
# coding=UTF-8

import pyscf
from pyscf import tools
from pyscf import symm
from pyscf.tools import fcidump
import pyscf.mcscf
from pyscf_util.MeanField import iciscf
from pyscf_util.File import file_cmoao


def OrbSymInfo(Mol, mo_coeff):
    IRREP_MAP = {}
    nsym = len(Mol.irrep_name)
    for i in range(nsym):
        IRREP_MAP[Mol.irrep_name[i]] = i
    # print(IRREP_MAP)

    OrbSym = pyscf.symm.label_orb_symm(Mol, Mol.irrep_name, Mol.symm_orb, mo_coeff)
    IrrepOrb = []
    for i in range(len(OrbSym)):
        IrrepOrb.append(symm.irrep_name2id(Mol.groupname, OrbSym[i]))
    return IrrepOrb


def get_sym(IrrepMap, Occ):
    res = 0
    for i in range(len(Occ)):
        if Occ[i] == 1:
            res ^= IrrepMap[i] % 10
    return res


cas_space_symmetry = {
    "A1u": 1 + 1,  # 5
    "A1g": 1 + 1,  # 0
    "E1ux": 1,  # 7
    "E1gy": 1,  # 3
    "E1gx": 1,  # 2
    "E1uy": 1,  # 6
    "E2gy": 1,  # 1
    "E2gx": 1,  # 0
    "E2uy": 1,  # 4
    "E2ux": 1,  # 5
}

cas_space_44_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1,  # 1
    "E2gx": 1 + 1,  # 0
    "E2uy": 1 + 1,  # 4
    "E2ux": 1 + 1,  # 5
}

cas_space_58_symmetry = {
    "A1u": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 5
    "A1g": 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1,  # 0
    "E1ux": 1 + 1 + 1 + 1 + 1 + 1,  # 7
    "E1gy": 1 + 1 + 1 + 1 + 1 + 1,  # 3
    "E1gx": 1 + 1 + 1 + 1 + 1 + 1,  # 2
    "E1uy": 1 + 1 + 1 + 1 + 1 + 1,  # 6
    "E2gy": 1 + 1 + 1,  # 1
    "E2gx": 1 + 1 + 1,  # 0
    "E2uy": 1 + 1 + 1,  # 4
    "E2ux": 1 + 1 + 1,  # 5
    "E3gy": 1,  # 1
    "E3gx": 1,  # 0
    "E3uy": 1,  # 4
    "E3ux": 1,  # 5
}

# cas_space_symmetry = {
#     'Ag': 3,
#     'B1g':1,
#     'B2g':1,
#     'B3g':1,
#     'Au': 1,
#     'B1u':3,
#     'B2u':1,
#     'B3u':1,
# }


if __name__ == "__main__":

    BOND_LENGTH = [1.3, 1.4, 1.5, 1.6, 1.68, 1.8, 1.9, 2.0, 2.2, 2.5, 2.8, 3.2]
    # BOND_LENGTH = [1.68]
    BASIS = ["ccpvdz-dk", "ccpvtz-dk", "ccpvqz-dk", "ccpv5z-dk"]

    for basis in BASIS:
        for BondLength in BOND_LENGTH:

            Mol = pyscf.gto.Mole()
            Mol.atom = """
    Cr     0.0000      0.0000  %f 
    Cr     0.0000      0.0000  -%f 
    """ % (
                BondLength / 2,
                BondLength / 2,
            )
            Mol.basis = basis
            Mol.symmetry = "Dooh"
            Mol.spin = 2
            Mol.charge = 0
            Mol.verbose = 4 # print everything!
            Mol.unit = "angstorm"
            Mol.build()
            SCF = pyscf.scf.sfx2c(pyscf.scf.RHF(Mol))
            SCF.max_cycle = 32
            SCF.conv_tol = 1e-9
            SCF.run()

            # print(SCF.energy)

            DumpFileName = (
                "FCIDUMP"
                + "_"
                + "CR2"
                + "_"
                + basis
                + "_"
                + str(int(BondLength * 100))
                # + "_SCF"
            )

            bond_int = int(BondLength * 100)

            Mol.spin = 0
            Mol.build()

            # iCISCF

            # the driver

            norb = 12
            nelec = 12
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_symmetry
            )  # right!
            SCF.mo_coeff = mo_init
            CASSCF_Driver = iciscf.iCISCF(SCF, norb, nelec, cmin=0.0)

            energy, _, _, mo_coeff, _ = CASSCF_Driver.kernel(mo_coeff=mo_init)

            print("energy = ", energy)

            print("orbsym = ", OrbSymInfo(Mol, mo_coeff))

            # dump 积分系数

            SCF.mo_coeff = mo_coeff
            norb = 44
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_44_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_44_%s_%d" % (basis, BondLength*100), mo_init)

            SCF.mo_coeff = mo_coeff
            norb = 58
            nelec = 28
            CASSCF_Driver = pyscf.mcscf.CASSCF(SCF, norb, nelec)
            mo_init = pyscf.mcscf.sort_mo_by_irrep(
                CASSCF_Driver, CASSCF_Driver.mo_coeff, cas_space_58_symmetry
            )  # right!

            file_cmoao.Dump_Cmoao("cas_28_58_%s_%d" % (basis, BondLength*100), mo_init)#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='fnode10', release='3.10.0-957.el7.x86_64', version='#1 SMP Thu Nov 8 23:39:32 UTC 2018', machine='x86_64', processor='x86_64')  Threads 64
Python 3.6.15 | packaged by conda-forge | (default, Dec  3 2021, 18:49:41) 
[GCC 9.4.0]
numpy 1.19.5  scipy 1.5.3
Date: Mon Jun  2 00:39:42 2025
PySCF version 2.1.1
PySCF path  /apps/users/zhangning/Github_Repo/pyscf_isdf
GIT ORIG_HEAD b72212cc17706d9418d5e61274b4d0577d0c8b46
GIT HEAD (branch ning_isdf) b72212cc17706d9418d5e61274b4d0577d0c8b46

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 48
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 2
[INPUT] symmetry Dooh subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Cr     0.000000000000   0.000000000000   1.400000000000 AA    0.000000000000   0.000000000000   2.645616574391 Bohr   0.0
[INPUT]  2 Cr     0.000000000000   0.000000000000  -1.400000000000 AA    0.000000000000   0.000000000000  -2.645616574391 Bohr   0.0

nuclear repulsion = 108.859311960686
point group symmetry = Dooh
symmetry origin: [0. 0. 0.]
symmetry axis x: [1. 0. 0.]
symmetry axis y: [0. 1. 0.]
symmetry axis z: [0. 0. 1.]
num. orbitals of irrep A1g = 20
num. orbitals of irrep E1gx = 13
num. orbitals of irrep E1gy = 13
num. orbitals of irrep A1u = 20
num. orbitals of irrep E1uy = 13
num. orbitals of irrep E1ux = 13
num. orbitals of irrep E2gx = 7
num. orbitals of irrep E2gy = 7
num. orbitals of irrep E3gx = 3
num. orbitals of irrep E3gy = 3
num. orbitals of irrep E2uy = 7
num. orbitals of irrep E2ux = 7
num. orbitals of irrep E3uy = 3
num. orbitals of irrep E3ux = 3
num. orbitals of irrep E4gx = 1
num. orbitals of irrep E4gy = 1
num. orbitals of irrep E4uy = 1
num. orbitals of irrep E4ux = 1
number of shells = 18
number of NR pGTOs = 262
number of NR cGTOs = 136
basis = ccpvtz-dk
ecp = {}
CPU time:     33590.06


******** <class 'pyscf.x2c.sfx2c1e.sfx2c1e.<locals>.SFX2C1E_SCF'> ********
method = SFX2C1E_SCF-SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 32
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /apps/users/zhangning/2025_work/Cr2Orb/tmp23xkywy4
max_memory 4000 MB (current use 1022 MB)
num. doubly occ = 23  num. singly occ = 2


******** <class 'pyscf.x2c.sfx2c1e.SpinFreeX2CHelper'> ********
approx = 1e
xuncontract = 1
Freeze 0 electrons in irreps []
    48 free electrons in irreps A1g E1gx E1gy A1u E1uy E1ux E2gx E2gy E3gx E3gy E2uy E2ux E3uy E3ux E4gx E4gy E4uy E4ux
Set gradient conv threshold to 3.16228e-05
init E= -2097.52887598495
HOMO (A1u) = -0.189416928858265  LUMO (E2ux) = -0.187033789879518
cycle= 1 E= -2098.05008199544  delta_E= -0.521  |g|= 0.622  |ddm|= 3.11
HOMO (A1u) = -0.0440551370389426  LUMO (A1u) = 0.0261845427327649
cycle= 2 E= -2098.0424166323  delta_E= 0.00767  |g|= 0.81  |ddm|= 1.99
HOMO (A1u) = -0.15097298588318  LUMO (A1u) = 0.00228802542702458
cycle= 3 E= -2098.13831667606  delta_E= -0.0959  |g|= 0.193  |ddm|= 1.78
HOMO (A1u) = -0.157664872554562  LUMO (A1u) = -0.00331209980536405
cycle= 4 E= -2098.16559659868  delta_E= -0.0273  |g|= 0.102  |ddm|= 1.28
HOMO (A1u) = -0.166385156911106  LUMO (A1u) = -0.0110601835171277
cycle= 5 E= -2098.16236466533  delta_E= 0.00323  |g|= 0.106  |ddm|= 1.29
HOMO (A1u) = -0.177167111394059  LUMO (A1u) = -0.0164927255292971
cycle= 6 E= -2098.16697137156  delta_E= -0.00461  |g|= 0.0759  |ddm|= 0.223
HOMO (E1ux) = -0.182757581592389  LUMO (A1u) = -0.017541958169417
cycle= 7 E= -2098.33879781057  delta_E= -0.172  |g|= 0.246  |ddm|= 1.33
HOMO (E1ux) = -0.171187532149487  LUMO (A1u) = -0.0175992596174177
cycle= 8 E= -2098.34108966624  delta_E= -0.00229  |g|= 0.231  |ddm|= 0.0398
HOMO (E1ux) = -0.0511740668394581  LUMO (A1u) = -0.018187404413308
cycle= 9 E= -2098.36149093277  delta_E= -0.0204  |g|= 0.0494  |ddm|= 0.361
HOMO (E1ux) = -0.022545484869752  LUMO (A1u) = -0.0188763232695135
cycle= 10 E= -2098.36584356396  delta_E= -0.00435  |g|= 0.036  |ddm|= 0.162
HOMO (E1ux) = -0.0243309130358605  LUMO (A1u) = -0.0203893291859236
cycle= 11 E= -2098.36691811899  delta_E= -0.00107  |g|= 0.0253  |ddm|= 0.0868
HOMO (E1ux) = -0.0234546425183549  LUMO (A1u) = -0.0255850486291043
cycle= 12 E= -2098.36914406108  delta_E= -0.00223  |g|= 0.0369  |ddm|= 0.191
HOMO (E1ux) = -0.0360569130295525  LUMO (A1u) = -0.0277299765615757
cycle= 13 E= -2098.36943323756  delta_E= -0.000289  |g|= 0.0163  |ddm|= 0.0814
HOMO (E1ux) = -0.0324166494657906  LUMO (A1u) = -0.0283380217711402
cycle= 14 E= -2098.36985478499  delta_E= -0.000422  |g|= 0.00349  |ddm|= 0.0684
HOMO (E1ux) = -0.0319427536984037  LUMO (A1u) = -0.0286374458730473
cycle= 15 E= -2098.36991136549  delta_E= -5.66e-05  |g|= 0.00596  |ddm|= 0.0208
HOMO (E1ux) = -0.0341158738016236  LUMO (A1u) = -0.0298490487747741
cycle= 16 E= -2098.36995624463  delta_E= -4.49e-05  |g|= 0.00078  |ddm|= 0.0348
HOMO (E1ux) = -0.0339830722549164  LUMO (A1u) = -0.0299756712454028
cycle= 17 E= -2098.36995904701  delta_E= -2.8e-06  |g|= 0.00159  |ddm|= 0.00759
HOMO (E1ux) = -0.0344450810964987  LUMO (E2ux) = -0.0303505600516058
cycle= 18 E= -2098.36995998864  delta_E= -9.42e-07  |g|= 0.000226  |ddm|= 0.00666
HOMO (E1ux) = -0.0343466584309063  LUMO (E2ux) = -0.0302549274455416
cycle= 19 E= -2098.36996001708  delta_E= -2.84e-08  |g|= 0.00013  |ddm|= 0.00133
HOMO (E1ux) = -0.0343944426120806  LUMO (E2ux) = -0.0303126844327772
cycle= 20 E= -2098.36996002322  delta_E= -6.14e-09  |g|= 4.27e-05  |ddm|= 0.00078
HOMO (E1ux) = -0.0343774569959761  LUMO (E2ux) = -0.0302858149857429
cycle= 21 E= -2098.36996002407  delta_E= -8.49e-10  |g|= 8.01e-06  |ddm|= 0.000248
HOMO (E1ux) = -0.034379234612174  LUMO (E2ux) = -0.030288913922581
Extra cycle  E= -2098.36996002413  delta_E= -6.23e-11  |g|= 5.44e-06  |ddm|= 2.39e-05
converged SCF energy = -2098.36996002413
ncore for each irreps {'A1g': 5, 'E1gx': 2, 'E1gy': 2, 'A1u': 5, 'E1uy': 2, 'E1ux': 2, 'E2gx': 0, 'E2gy': 0, 'E3gx': 0, 'E3gy': 0, 'E2uy': 0, 'E2ux': 0, 'E3uy': 0, 'E3ux': 0, 'E4gx': 0, 'E4gy': 0, 'E4uy': 0, 'E4ux': 0}
ncas for each irreps {'A1u': 2, 'A1g': 2, 'E1ux': 1, 'E1gy': 1, 'E1gx': 1, 'E1uy': 1, 'E2gy': 1, 'E2gx': 1, 'E2uy': 1, 'E2ux': 1}
(0-based) caslst = [18 19 20 21 22 23 24 25 26 27 31 32]
/apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe

******** <class 'pyscf.mcscf.mc1step_symm.SymAdaptedCASSCF'> ********
CAS (6e+6e, 12o), ncore = 18, nvir = 106
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /apps/users/zhangning/2025_work/Cr2Orb/tmp23xkywy4
max_memory 4000 MB (current use 1022 MB)
internal_rotation = False

******** iCI flags ********
executable    = /apps/users/zhangning/Github_Repo/iCIPT2_Loong/bin/iCIPT2_D2H_CSF.exe
runtimedir    = .

Symmetries of active orbitals: A1g A1u A1g E2gx E2gy E1uy E1ux E2uy E2ux A1u E1gx E1gy
Active space CI wfn symmetry = A2g
0 -1
State   0 energy   -2098.847043238766
CASCI E = -2098.84704323877  S^2 = 0.0000000
Set conv_tol_grad to 0.000316228
1 -1
State   0 energy     -26.280696620218
2 -1
State   0 energy     -26.326040291247
3 -1
State   0 energy     -26.353947520685
4 -1
State   0 energy   -2099.008967564760
macro iter 1 (21 JK  4 micro), CASSCF E = -2099.00896756476  dE = -0.16192433  S^2 = 0.0000000
               |grad[o]|= 0.21  |ddm|= 2.26  |maxRot[o]|=0.258
5 -1
State   0 energy     -26.423037642090
6 -1
State   0 energy     -26.430296534974
7 -1
State   0 energy     -26.436531823373
8 -1
State   0 energy   -2099.035999467377
macro iter 2 (21 JK  4 micro), CASSCF E = -2099.03599946738  dE = -0.027031903  S^2 = 0.0000000
               |grad[o]|=0.119  |ddm|=0.0847  |maxRot[o]|=0.313
9 -1
State   0 energy     -26.442815925877
10 -1
State   0 energy     -26.446494326094
11 -1
State   0 energy     -26.462339320069
12 -1
State   0 energy   -2099.044982115639
macro iter 3 (21 JK  4 micro), CASSCF E = -2099.04498211564  dE = -0.0089826483  S^2 = 0.0000000
               |grad[o]|=0.0476  |ddm|=0.0196  |maxRot[o]|=0.227
13 -1
State   0 energy     -26.483212047634
14 -1
State   0 energy     -26.472591702368
15 -1
State   0 energy     -26.481256749172
16 -1
State   0 energy   -2099.045407025105
macro iter 4 (17 JK  4 micro), CASSCF E = -2099.04540702511  dE = -0.00042490947  S^2 = 0.0000000
               |grad[o]|=0.00779  |ddm|=0.00608  |maxRot[o]|=0.067
17 -1
State   0 energy     -26.614648920139
18 -1
State   0 energy     -26.612427955561
19 -1
